var xo=Object.defineProperty;var To=(t,e,n)=>e in t?xo(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var te=(t,e,n)=>(To(t,typeof e!="symbol"?e+"":e,n),n);import{F as Ao,b as N,G as Ie,J as Re,Q as Ne,K as pr,V as U,a as jt,O as Mo,X as bn,Y as Co,Z as Lo,_ as Ke,z as dr,y as hr,T as mr,$ as rn,a0 as ko,C as $,g as Q,a1 as Do,s as I,a2 as _r,a3 as gr,r as Ct,a4 as sn,a5 as bs,i as Es,a6 as En,o as oe,a7 as Oo,a8 as Ps,a9 as Io,h as Ss,aa as Ro,ab as Fo,ac as Bo,ad as xs,ae as St,af as Ee,ag as jo,ah as No,ai as Ts,aj as Pe,ak as $o,al as Uo,am as zo,an as Vo,k as Ho,U as $n,ao as tt,S as st,ap as yr,aq as Wo,ar as vr,as as Go,at as Xo,N as Ko,au as As,av as Yo,aw as qo,ax as Zo,ay as Qo,az as Jo,aA as ea,aB as ta,aC as na,aD as ra,aE as sa,B as ia,aF as oa,A as aa,q as ca,W as Ms,H as la,e as ua,aG as Cs,L as wr,p as fa,aH as pa,aI as da,j as ha}from"./65e4a706-three.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();var ut,E,Ls,Me,br,ks,Pn,Ds,Ue={},Os=[],ma=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Nt=Array.isArray;function pe(t,e){for(var n in e)t[n]=e[n];return t}function Is(t){var e=t.parentNode;e&&e.removeChild(t)}function ae(t,e,n){var r,s,i,o={};for(i in e)i=="key"?r=e[i]:i=="ref"?s=e[i]:o[i]=e[i];if(arguments.length>2&&(o.children=arguments.length>3?ut.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(i in t.defaultProps)o[i]===void 0&&(o[i]=t.defaultProps[i]);return nt(t,o,r,s,null)}function nt(t,e,n,r,s){var i={type:t,props:e,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:s??++Ls};return s==null&&E.vnode!=null&&E.vnode(i),i}function Rs(){return{current:null}}function ce(t){return t.children}function ie(t,e){this.props=t,this.context=e}function Lt(t,e){if(e==null)return t.__?Lt(t.__,t.__.__k.indexOf(t)+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?Lt(t):null}function Fs(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return Fs(t)}}function Sn(t){(!t.__d&&(t.__d=!0)&&Me.push(t)&&!kt.__r++||br!==E.debounceRendering)&&((br=E.debounceRendering)||ks)(kt)}function kt(){var t,e,n,r,s,i,o,l,a;for(Me.sort(Pn);t=Me.shift();)t.__d&&(e=Me.length,r=void 0,s=void 0,i=void 0,l=(o=(n=t).__v).__e,(a=n.__P)&&(r=[],s=[],(i=pe({},o)).__v=o.__v+1,Un(a,o,i,n.__n,a.ownerSVGElement!==void 0,o.__h!=null?[l]:null,r,l??Lt(o),o.__h,s),$s(r,o,s),o.__e!=l&&Fs(o)),Me.length>e&&Me.sort(Pn));kt.__r=0}function Bs(t,e,n,r,s,i,o,l,a,u,f){var c,p,d,h,_,w,y,v,g,P,b=0,x=r&&r.__k||Os,O=x.length,A=O,M=e.length;for(n.__k=[],c=0;c<M;c++)(h=n.__k[c]=(h=e[c])==null||typeof h=="boolean"||typeof h=="function"?null:typeof h=="string"||typeof h=="number"||typeof h=="bigint"?nt(null,h,null,null,h):Nt(h)?nt(ce,{children:h},null,null,null):h.__b>0?nt(h.type,h.props,h.key,h.ref?h.ref:null,h.__v):h)!=null&&(h.__=n,h.__b=n.__b+1,(v=_a(h,x,y=c+b,A))===-1?d=Ue:(d=x[v]||Ue,x[v]=void 0,A--),Un(t,h,d,s,i,o,l,a,u,f),_=h.__e,(p=h.ref)&&d.ref!=p&&(d.ref&&zn(d.ref,null,h),f.push(p,h.__c||_,h)),_!=null&&(w==null&&(w=_),P=!(g=d===Ue||d.__v===null)&&v===y,g?v==-1&&b--:v!==y&&(v===y+1?(b++,P=!0):v>y?A>M-y?(b+=v-y,P=!0):b--:b=v<y&&v==y-1?v-y:0),y=c+b,P=P||v==c&&!g,typeof h.type!="function"||v===y&&d.__k!==h.__k?typeof h.type=="function"||P?h.__d!==void 0?(a=h.__d,h.__d=void 0):a=_.nextSibling:a=Ns(t,_,a):a=js(h,a,t),typeof n.type=="function"&&(n.__d=a)));for(n.__e=w,c=O;c--;)x[c]!=null&&(typeof n.type=="function"&&x[c].__e!=null&&x[c].__e==n.__d&&(n.__d=x[c].__e.nextSibling),Us(x[c],x[c]))}function js(t,e,n){for(var r,s=t.__k,i=0;s&&i<s.length;i++)(r=s[i])&&(r.__=t,e=typeof r.type=="function"?js(r,e,n):Ns(n,r.__e,e));return e}function me(t,e){return e=e||[],t==null||typeof t=="boolean"||(Nt(t)?t.some(function(n){me(n,e)}):e.push(t)),e}function Ns(t,e,n){return n==null||n.parentNode!==t?t.insertBefore(e,null):e==n&&e.parentNode!=null||t.insertBefore(e,n),e.nextSibling}function _a(t,e,n,r){var s=t.key,i=t.type,o=n-1,l=n+1,a=e[n];if(a===null||a&&s==a.key&&i===a.type)return n;if(r>(a!=null?1:0))for(;o>=0||l<e.length;){if(o>=0){if((a=e[o])&&s==a.key&&i===a.type)return o;o--}if(l<e.length){if((a=e[l])&&s==a.key&&i===a.type)return l;l++}}return-1}function ga(t,e,n,r,s){var i;for(i in n)i==="children"||i==="key"||i in e||Dt(t,i,null,n[i],r);for(i in e)s&&typeof e[i]!="function"||i==="children"||i==="key"||i==="value"||i==="checked"||n[i]===e[i]||Dt(t,i,e[i],n[i],r)}function Er(t,e,n){e[0]==="-"?t.setProperty(e,n??""):t[e]=n==null?"":typeof n!="number"||ma.test(e)?n:n+"px"}function Dt(t,e,n,r,s){var i;e:if(e==="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof r=="string"&&(t.style.cssText=r=""),r)for(e in r)n&&e in n||Er(t.style,e,"");if(n)for(e in n)r&&n[e]===r[e]||Er(t.style,e,n[e])}else if(e[0]==="o"&&e[1]==="n")i=e!==(e=e.replace(/Capture$/,"")),e=e.toLowerCase()in t?e.toLowerCase().slice(2):e.slice(2),t.l||(t.l={}),t.l[e+i]=n,n?r||t.addEventListener(e,i?Sr:Pr,i):t.removeEventListener(e,i?Sr:Pr,i);else if(e!=="dangerouslySetInnerHTML"){if(s)e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!=="width"&&e!=="height"&&e!=="href"&&e!=="list"&&e!=="form"&&e!=="tabIndex"&&e!=="download"&&e!=="rowSpan"&&e!=="colSpan"&&e in t)try{t[e]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&e[4]!=="-"?t.removeAttribute(e):t.setAttribute(e,n))}}function Pr(t){return this.l[t.type+!1](E.event?E.event(t):t)}function Sr(t){return this.l[t.type+!0](E.event?E.event(t):t)}function Un(t,e,n,r,s,i,o,l,a,u){var f,c,p,d,h,_,w,y,v,g,P,b,x,O,A,M=e.type;if(e.constructor!==void 0)return null;n.__h!=null&&(a=n.__h,l=e.__e=n.__e,e.__h=null,i=[l]),(f=E.__b)&&f(e);try{e:if(typeof M=="function"){if(y=e.props,v=(f=M.contextType)&&r[f.__c],g=f?v?v.props.value:f.__:r,n.__c?w=(c=e.__c=n.__c).__=c.__E:("prototype"in M&&M.prototype.render?e.__c=c=new M(y,g):(e.__c=c=new ie(y,g),c.constructor=M,c.render=va),v&&v.sub(c),c.props=y,c.state||(c.state={}),c.context=g,c.__n=r,p=c.__d=!0,c.__h=[],c._sb=[]),c.__s==null&&(c.__s=c.state),M.getDerivedStateFromProps!=null&&(c.__s==c.state&&(c.__s=pe({},c.__s)),pe(c.__s,M.getDerivedStateFromProps(y,c.__s))),d=c.props,h=c.state,c.__v=e,p)M.getDerivedStateFromProps==null&&c.componentWillMount!=null&&c.componentWillMount(),c.componentDidMount!=null&&c.__h.push(c.componentDidMount);else{if(M.getDerivedStateFromProps==null&&y!==d&&c.componentWillReceiveProps!=null&&c.componentWillReceiveProps(y,g),!c.__e&&(c.shouldComponentUpdate!=null&&c.shouldComponentUpdate(y,c.__s,g)===!1||e.__v===n.__v)){for(e.__v!==n.__v&&(c.props=y,c.state=c.__s,c.__d=!1),e.__e=n.__e,e.__k=n.__k,e.__k.forEach(function(L){L&&(L.__=e)}),P=0;P<c._sb.length;P++)c.__h.push(c._sb[P]);c._sb=[],c.__h.length&&o.push(c);break e}c.componentWillUpdate!=null&&c.componentWillUpdate(y,c.__s,g),c.componentDidUpdate!=null&&c.__h.push(function(){c.componentDidUpdate(d,h,_)})}if(c.context=g,c.props=y,c.__P=t,c.__e=!1,b=E.__r,x=0,"prototype"in M&&M.prototype.render){for(c.state=c.__s,c.__d=!1,b&&b(e),f=c.render(c.props,c.state,c.context),O=0;O<c._sb.length;O++)c.__h.push(c._sb[O]);c._sb=[]}else do c.__d=!1,b&&b(e),f=c.render(c.props,c.state,c.context),c.state=c.__s;while(c.__d&&++x<25);c.state=c.__s,c.getChildContext!=null&&(r=pe(pe({},r),c.getChildContext())),p||c.getSnapshotBeforeUpdate==null||(_=c.getSnapshotBeforeUpdate(d,h)),Bs(t,Nt(A=f!=null&&f.type===ce&&f.key==null?f.props.children:f)?A:[A],e,n,r,s,i,o,l,a,u),c.base=e.__e,e.__h=null,c.__h.length&&o.push(c),w&&(c.__E=c.__=null)}else i==null&&e.__v===n.__v?(e.__k=n.__k,e.__e=n.__e):e.__e=ya(n.__e,e,n,r,s,i,o,a,u);(f=E.diffed)&&f(e)}catch(L){e.__v=null,(a||i!=null)&&(e.__e=l,e.__h=!!a,i[i.indexOf(l)]=null),E.__e(L,e,n)}}function $s(t,e,n){for(var r=0;r<n.length;r++)zn(n[r],n[++r],n[++r]);E.__c&&E.__c(e,t),t.some(function(s){try{t=s.__h,s.__h=[],t.some(function(i){i.call(s)})}catch(i){E.__e(i,s.__v)}})}function ya(t,e,n,r,s,i,o,l,a){var u,f,c,p=n.props,d=e.props,h=e.type,_=0;if(h==="svg"&&(s=!0),i!=null){for(;_<i.length;_++)if((u=i[_])&&"setAttribute"in u==!!h&&(h?u.localName===h:u.nodeType===3)){t=u,i[_]=null;break}}if(t==null){if(h===null)return document.createTextNode(d);t=s?document.createElementNS("http://www.w3.org/2000/svg",h):document.createElement(h,d.is&&d),i=null,l=!1}if(h===null)p===d||l&&t.data===d||(t.data=d);else{if(i=i&&ut.call(t.childNodes),f=(p=n.props||Ue).dangerouslySetInnerHTML,c=d.dangerouslySetInnerHTML,!l){if(i!=null)for(p={},_=0;_<t.attributes.length;_++)p[t.attributes[_].name]=t.attributes[_].value;(c||f)&&(c&&(f&&c.__html==f.__html||c.__html===t.innerHTML)||(t.innerHTML=c&&c.__html||""))}if(ga(t,d,p,s,l),c)e.__k=[];else if(Bs(t,Nt(_=e.props.children)?_:[_],e,n,r,s&&h!=="foreignObject",i,o,i?i[0]:n.__k&&Lt(n,0),l,a),i!=null)for(_=i.length;_--;)i[_]!=null&&Is(i[_]);l||("value"in d&&(_=d.value)!==void 0&&(_!==t.value||h==="progress"&&!_||h==="option"&&_!==p.value)&&Dt(t,"value",_,p.value,!1),"checked"in d&&(_=d.checked)!==void 0&&_!==t.checked&&Dt(t,"checked",_,p.checked,!1))}return t}function zn(t,e,n){try{typeof t=="function"?t(e):t.current=e}catch(r){E.__e(r,n)}}function Us(t,e,n){var r,s;if(E.unmount&&E.unmount(t),(r=t.ref)&&(r.current&&r.current!==t.__e||zn(r,null,e)),(r=t.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(i){E.__e(i,e)}r.base=r.__P=null,t.__c=void 0}if(r=t.__k)for(s=0;s<r.length;s++)r[s]&&Us(r[s],e,n||typeof t.type!="function");n||t.__e==null||Is(t.__e),t.__=t.__e=t.__d=void 0}function va(t,e,n){return this.constructor(t,n)}function ze(t,e,n){var r,s,i,o;E.__&&E.__(t,e),s=(r=typeof n=="function")?null:n&&n.__k||e.__k,i=[],o=[],Un(e,t=(!r&&n||e).__k=ae(ce,null,[t]),s||Ue,Ue,e.ownerSVGElement!==void 0,!r&&n?[n]:s?null:e.firstChild?ut.call(e.childNodes):null,i,!r&&n?n:s?s.__e:e.firstChild,r,o),$s(i,t,o)}function zs(t,e){ze(t,e,zs)}function wa(t,e,n){var r,s,i,o,l=pe({},t.props);for(i in t.type&&t.type.defaultProps&&(o=t.type.defaultProps),e)i=="key"?r=e[i]:i=="ref"?s=e[i]:l[i]=e[i]===void 0&&o!==void 0?o[i]:e[i];return arguments.length>2&&(l.children=arguments.length>3?ut.call(arguments,2):n),nt(t.type,l,r||t.key,s||t.ref,null)}function Vs(t,e){var n={__c:e="__cC"+Ds++,__:t,Consumer:function(r,s){return r.children(s)},Provider:function(r){var s,i;return this.getChildContext||(s=[],(i={})[e]=this,this.getChildContext=function(){return i},this.shouldComponentUpdate=function(o){this.props.value!==o.value&&s.some(function(l){l.__e=!0,Sn(l)})},this.sub=function(o){s.push(o);var l=o.componentWillUnmount;o.componentWillUnmount=function(){s.splice(s.indexOf(o),1),l&&l.call(o)}}),r.children}};return n.Provider.__=n.Consumer.contextType=n}ut=Os.slice,E={__e:function(t,e,n,r){for(var s,i,o;e=e.__;)if((s=e.__c)&&!s.__)try{if((i=s.constructor)&&i.getDerivedStateFromError!=null&&(s.setState(i.getDerivedStateFromError(t)),o=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(t,r||{}),o=s.__d),o)return s.__E=s}catch(l){t=l}throw t}},Ls=0,ie.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=pe({},this.state),typeof t=="function"&&(t=t(pe({},n),this.props)),t&&pe(n,t),t!=null&&this.__v&&(e&&this._sb.push(e),Sn(this))},ie.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),Sn(this))},ie.prototype.render=ce,Me=[],ks=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Pn=function(t,e){return t.__v.__b-e.__v.__b},kt.__r=0,Ds=0;const ba="modulepreload",Ea=function(t){return"/dl-model/"+t},xr={},D=function(e,n,r){if(!n||n.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(n.map(i=>{if(i=Ea(i),i in xr)return;xr[i]=!0;const o=i.endsWith(".css"),l=o?'[rel="stylesheet"]':"";if(!!r)for(let f=s.length-1;f>=0;f--){const c=s[f];if(c.href===i&&(!o||c.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${l}`))return;const u=document.createElement("link");if(u.rel=o?"stylesheet":ba,o||(u.as="script",u.crossOrigin=""),u.href=i,document.head.appendChild(u),o)return new Promise((f,c)=>{u.addEventListener("load",f),u.addEventListener("error",()=>c(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})};var _e,C,on,Tr,Ve=0,Hs=[],xt=[],Ar=E.__b,Mr=E.__r,Cr=E.diffed,Lr=E.__c,kr=E.unmount;function De(t,e){E.__h&&E.__h(C,t,Ve||e),Ve=0;var n=C.__H||(C.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({__V:xt}),n.__[t]}function $t(t){return Ve=1,Vn(Ys,t)}function Vn(t,e,n){var r=De(_e++,2);if(r.t=t,!r.__c&&(r.__=[n?n(e):Ys(void 0,e),function(l){var a=r.__N?r.__N[0]:r.__[0],u=r.t(a,l);a!==u&&(r.__N=[u,r.__[1]],r.__c.setState({}))}],r.__c=C,!C.u)){var s=function(l,a,u){if(!r.__c.__H)return!0;var f=r.__c.__H.__.filter(function(p){return p.__c});if(f.every(function(p){return!p.__N}))return!i||i.call(this,l,a,u);var c=!1;return f.forEach(function(p){if(p.__N){var d=p.__[0];p.__=p.__N,p.__N=void 0,d!==p.__[0]&&(c=!0)}}),!(!c&&r.__c.props===l)&&(!i||i.call(this,l,a,u))};C.u=!0;var i=C.shouldComponentUpdate,o=C.componentWillUpdate;C.componentWillUpdate=function(l,a,u){if(this.__e){var f=i;i=void 0,s(l,a,u),i=f}o&&o.call(this,l,a,u)},C.shouldComponentUpdate=s}return r.__N||r.__}function He(t,e){var n=De(_e++,3);!E.__s&&Wn(n.__H,e)&&(n.__=t,n.i=e,C.__H.__h.push(n))}function ft(t,e){var n=De(_e++,4);!E.__s&&Wn(n.__H,e)&&(n.__=t,n.i=e,C.__h.push(n))}function it(t){return Ve=5,Ut(function(){return{current:t}},[])}function Ws(t,e,n){Ve=6,ft(function(){return typeof t=="function"?(t(e()),function(){return t(null)}):t?(t.current=e(),function(){return t.current=null}):void 0},n==null?n:n.concat(t))}function Ut(t,e){var n=De(_e++,7);return Wn(n.__H,e)?(n.__V=t(),n.i=e,n.__h=t,n.__V):n.__}function Gs(t,e){return Ve=8,Ut(function(){return t},e)}function Xs(t){var e=C.context[t.__c],n=De(_e++,9);return n.c=t,e?(n.__==null&&(n.__=!0,e.sub(C)),e.props.value):t.__}function Hn(t,e){E.useDebugValue&&E.useDebugValue(e?e(t):t)}function Pa(t){var e=De(_e++,10),n=$t();return e.__=t,C.componentDidCatch||(C.componentDidCatch=function(r,s){e.__&&e.__(r,s),n[1](r)}),[n[0],function(){n[1](void 0)}]}function Ks(){var t=De(_e++,11);if(!t.__){for(var e=C.__v;e!==null&&!e.__m&&e.__!==null;)e=e.__;var n=e.__m||(e.__m=[0,0]);t.__="P"+n[0]+"-"+n[1]++}return t.__}function Sa(){for(var t;t=Hs.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(Tt),t.__H.__h.forEach(xn),t.__H.__h=[]}catch(e){t.__H.__h=[],E.__e(e,t.__v)}}E.__b=function(t){C=null,Ar&&Ar(t)},E.__r=function(t){Mr&&Mr(t),_e=0;var e=(C=t.__c).__H;e&&(on===C?(e.__h=[],C.__h=[],e.__.forEach(function(n){n.__N&&(n.__=n.__N),n.__V=xt,n.__N=n.i=void 0})):(e.__h.forEach(Tt),e.__h.forEach(xn),e.__h=[],_e=0)),on=C},E.diffed=function(t){Cr&&Cr(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(Hs.push(e)!==1&&Tr===E.requestAnimationFrame||((Tr=E.requestAnimationFrame)||xa)(Sa)),e.__H.__.forEach(function(n){n.i&&(n.__H=n.i),n.__V!==xt&&(n.__=n.__V),n.i=void 0,n.__V=xt})),on=C=null},E.__c=function(t,e){e.some(function(n){try{n.__h.forEach(Tt),n.__h=n.__h.filter(function(r){return!r.__||xn(r)})}catch(r){e.some(function(s){s.__h&&(s.__h=[])}),e=[],E.__e(r,n.__v)}}),Lr&&Lr(t,e)},E.unmount=function(t){kr&&kr(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(r){try{Tt(r)}catch(s){e=s}}),n.__H=void 0,e&&E.__e(e,n.__v))};var Dr=typeof requestAnimationFrame=="function";function xa(t){var e,n=function(){clearTimeout(r),Dr&&cancelAnimationFrame(e),setTimeout(t)},r=setTimeout(n,100);Dr&&(e=requestAnimationFrame(n))}function Tt(t){var e=C,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),C=e}function xn(t){var e=C;t.__c=t.__(),C=e}function Wn(t,e){return!t||t.length!==e.length||e.some(function(n,r){return n!==t[r]})}function Ys(t,e){return typeof e=="function"?e(t):e}function qs(t,e){for(var n in e)t[n]=e[n];return t}function Tn(t,e){for(var n in t)if(n!=="__source"&&!(n in e))return!0;for(var r in e)if(r!=="__source"&&t[r]!==e[r])return!0;return!1}function an(t,e){return t===e&&(t!==0||1/t==1/e)||t!=t&&e!=e}function Ot(t){this.props=t}function Zs(t,e){function n(s){var i=this.props.ref,o=i==s.ref;return!o&&i&&(i.call?i(null):i.current=null),e?!e(this.props,s)||!o:Tn(this.props,s)}function r(s){return this.shouldComponentUpdate=n,ae(t,s)}return r.displayName="Memo("+(t.displayName||t.name)+")",r.prototype.isReactComponent=!0,r.__f=!0,r}(Ot.prototype=new ie).isPureReactComponent=!0,Ot.prototype.shouldComponentUpdate=function(t,e){return Tn(this.props,t)||Tn(this.state,e)};var Or=E.__b;E.__b=function(t){t.type&&t.type.__f&&t.ref&&(t.props.ref=t.ref,t.ref=null),Or&&Or(t)};var Ta=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function Qs(t){function e(n){var r=qs({},n);return delete r.ref,t(r,n.ref||null)}return e.$$typeof=Ta,e.render=e,e.prototype.isReactComponent=e.__f=!0,e.displayName="ForwardRef("+(t.displayName||t.name)+")",e}var Ir=function(t,e){return t==null?null:me(me(t).map(e))},Js={map:Ir,forEach:Ir,count:function(t){return t?me(t).length:0},only:function(t){var e=me(t);if(e.length!==1)throw"Children.only";return e[0]},toArray:me},Aa=E.__e;E.__e=function(t,e,n,r){if(t.then){for(var s,i=e;i=i.__;)if((s=i.__c)&&s.__c)return e.__e==null&&(e.__e=n.__e,e.__k=n.__k),s.__c(t,e)}Aa(t,e,n,r)};var Rr=E.unmount;function ei(t,e,n){return t&&(t.__c&&t.__c.__H&&(t.__c.__H.__.forEach(function(r){typeof r.__c=="function"&&r.__c()}),t.__c.__H=null),(t=qs({},t)).__c!=null&&(t.__c.__P===n&&(t.__c.__P=e),t.__c=null),t.__k=t.__k&&t.__k.map(function(r){return ei(r,e,n)})),t}function ti(t,e,n){return t&&(t.__v=null,t.__k=t.__k&&t.__k.map(function(r){return ti(r,e,n)}),t.__c&&t.__c.__P===e&&(t.__e&&n.insertBefore(t.__e,t.__d),t.__c.__e=!0,t.__c.__P=n)),t}function Ce(){this.__u=0,this.t=null,this.__b=null}function ni(t){var e=t.__.__c;return e&&e.__a&&e.__a(t)}function H(t){var e,n,r;function s(i){if(e||(e=t()).then(function(o){n=o.default||o},function(o){r=o}),r)throw r;if(!n)throw e;return ae(n,i)}return s.displayName="Lazy",s.__f=!0,s}function $e(){this.u=null,this.o=null}E.unmount=function(t){var e=t.__c;e&&e.__R&&e.__R(),e&&t.__h===!0&&(t.type=null),Rr&&Rr(t)},(Ce.prototype=new ie).__c=function(t,e){var n=e.__c,r=this;r.t==null&&(r.t=[]),r.t.push(n);var s=ni(r.__v),i=!1,o=function(){i||(i=!0,n.__R=null,s?s(l):l())};n.__R=o;var l=function(){if(!--r.__u){if(r.state.__a){var u=r.state.__a;r.__v.__k[0]=ti(u,u.__c.__P,u.__c.__O)}var f;for(r.setState({__a:r.__b=null});f=r.t.pop();)f.forceUpdate()}},a=e.__h===!0;r.__u++||a||r.setState({__a:r.__b=r.__v.__k[0]}),t.then(o,o)},Ce.prototype.componentWillUnmount=function(){this.t=[]},Ce.prototype.render=function(t,e){if(this.__b){if(this.__v.__k){var n=document.createElement("div"),r=this.__v.__k[0].__c;this.__v.__k[0]=ei(this.__b,n,r.__O=r.__P)}this.__b=null}var s=e.__a&&ae(ce,null,t.fallback);return s&&(s.__h=null),[ae(ce,null,e.__a?null:t.children),s]};var Fr=function(t,e,n){if(++n[1]===n[0]&&t.o.delete(e),t.props.revealOrder&&(t.props.revealOrder[0]!=="t"||!t.o.size))for(n=t.u;n;){for(;n.length>3;)n.pop()();if(n[1]<n[0])break;t.u=n=n[2]}};function Ma(t){return this.getChildContext=function(){return t.context},t.children}function Ca(t){var e=this,n=t.i;e.componentWillUnmount=function(){ze(null,e.l),e.l=null,e.i=null},e.i&&e.i!==n&&e.componentWillUnmount(),t.__v?(e.l||(e.i=n,e.l={nodeType:1,parentNode:n,childNodes:[],appendChild:function(r){this.childNodes.push(r),e.i.appendChild(r)},insertBefore:function(r,s){this.childNodes.push(r),e.i.appendChild(r)},removeChild:function(r){this.childNodes.splice(this.childNodes.indexOf(r)>>>1,1),e.i.removeChild(r)}}),ze(ae(Ma,{context:e.context},t.__v),e.l)):e.l&&e.componentWillUnmount()}function ri(t,e){var n=ae(Ca,{__v:t,i:e});return n.containerInfo=e,n}($e.prototype=new ie).__a=function(t){var e=this,n=ni(e.__v),r=e.o.get(t);return r[0]++,function(s){var i=function(){e.props.revealOrder?(r.push(s),Fr(e,t,r)):s()};n?n(i):i()}},$e.prototype.render=function(t){this.u=null,this.o=new Map;var e=me(t.children);t.revealOrder&&t.revealOrder[0]==="b"&&e.reverse();for(var n=e.length;n--;)this.o.set(e[n],this.u=[1,0,this.u]);return t.children},$e.prototype.componentDidUpdate=$e.prototype.componentDidMount=function(){var t=this;this.o.forEach(function(e,n){Fr(t,n,e)})};var si=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,La=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,ka=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,Da=/[A-Z0-9]/g,Oa=typeof document<"u",Ia=function(t){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(t)};function ii(t,e,n){return e.__k==null&&(e.textContent=""),ze(t,e),typeof n=="function"&&n(),t?t.__c:null}function oi(t,e,n){return zs(t,e),typeof n=="function"&&n(),t?t.__c:null}ie.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(t){Object.defineProperty(ie.prototype,t,{configurable:!0,get:function(){return this["UNSAFE_"+t]},set:function(e){Object.defineProperty(this,t,{configurable:!0,writable:!0,value:e})}})});var Br=E.event;function Ra(){}function Fa(){return this.cancelBubble}function Ba(){return this.defaultPrevented}E.event=function(t){return Br&&(t=Br(t)),t.persist=Ra,t.isPropagationStopped=Fa,t.isDefaultPrevented=Ba,t.nativeEvent=t};var Gn,ja={enumerable:!1,configurable:!0,get:function(){return this.class}},jr=E.vnode;E.vnode=function(t){typeof t.type=="string"&&function(e){var n=e.props,r=e.type,s={};for(var i in n){var o=n[i];if(!(i==="value"&&"defaultValue"in n&&o==null||Oa&&i==="children"&&r==="noscript"||i==="class"||i==="className")){var l=i.toLowerCase();i==="defaultValue"&&"value"in n&&n.value==null?i="value":i==="download"&&o===!0?o="":l==="ondoubleclick"?i="ondblclick":l!=="onchange"||r!=="input"&&r!=="textarea"||Ia(n.type)?l==="onfocus"?i="onfocusin":l==="onblur"?i="onfocusout":ka.test(i)?i=l:r.indexOf("-")===-1&&La.test(i)?i=i.replace(Da,"-$&").toLowerCase():o===null&&(o=void 0):l=i="oninput",l==="oninput"&&s[i=l]&&(i="oninputCapture"),s[i]=o}}r=="select"&&s.multiple&&Array.isArray(s.value)&&(s.value=me(n.children).forEach(function(a){a.props.selected=s.value.indexOf(a.props.value)!=-1})),r=="select"&&s.defaultValue!=null&&(s.value=me(n.children).forEach(function(a){a.props.selected=s.multiple?s.defaultValue.indexOf(a.props.value)!=-1:s.defaultValue==a.props.value})),n.class&&!n.className?(s.class=n.class,Object.defineProperty(s,"className",ja)):(n.className&&!n.class||n.class&&n.className)&&(s.class=s.className=n.className),e.props=s}(t),t.$$typeof=si,jr&&jr(t)};var Nr=E.__r;E.__r=function(t){Nr&&Nr(t),Gn=t.__c};var $r=E.diffed;E.diffed=function(t){$r&&$r(t);var e=t.props,n=t.__e;n!=null&&t.type==="textarea"&&"value"in e&&e.value!==n.value&&(n.value=e.value==null?"":e.value),Gn=null};var ai={ReactCurrentDispatcher:{current:{readContext:function(t){return Gn.__n[t.__c].props.value}}}},Na="17.0.2";function ci(t){return ae.bind(null,t)}function Xn(t){return!!t&&t.$$typeof===si}function li(t){return Xn(t)?wa.apply(null,arguments):t}function ui(t){return!!t.__k&&(ze(null,t),!0)}function fi(t){return t&&(t.base||t.nodeType===1&&t)||null}var pi=function(t,e){return t(e)},di=function(t,e){return t(e)},hi=ce;function Kn(t){t()}function mi(t){return t}function _i(){return[!1,Kn]}var gi=ft;function yi(t,e){var n=e(),r=$t({h:{__:n,v:e}}),s=r[0].h,i=r[1];return ft(function(){s.__=n,s.v=e,an(s.__,e())||i({h:s})},[t,n,e]),He(function(){return an(s.__,s.v())||i({h:s}),t(function(){an(s.__,s.v())||i({h:s})})},[t]),n}var $a={useState:$t,useId:Ks,useReducer:Vn,useEffect:He,useLayoutEffect:ft,useInsertionEffect:gi,useTransition:_i,useDeferredValue:mi,useSyncExternalStore:yi,startTransition:Kn,useRef:it,useImperativeHandle:Ws,useMemo:Ut,useCallback:Gs,useContext:Xs,useDebugValue:Hn,version:"17.0.2",Children:Js,render:ii,hydrate:oi,unmountComponentAtNode:ui,createPortal:ri,createElement:ae,createContext:Vs,createFactory:ci,cloneElement:li,createRef:Rs,Fragment:ce,isValidElement:Xn,findDOMNode:fi,Component:ie,PureComponent:Ot,memo:Zs,forwardRef:Qs,flushSync:di,unstable_batchedUpdates:pi,StrictMode:hi,Suspense:Ce,SuspenseList:$e,lazy:H,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:ai};const Ua=Object.freeze(Object.defineProperty({__proto__:null,Children:Js,Component:ie,Fragment:ce,PureComponent:Ot,StrictMode:hi,Suspense:Ce,SuspenseList:$e,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:ai,cloneElement:li,createContext:Vs,createElement:ae,createFactory:ci,createPortal:ri,createRef:Rs,default:$a,findDOMNode:fi,flushSync:di,forwardRef:Qs,hydrate:oi,isValidElement:Xn,lazy:H,memo:Zs,render:ii,startTransition:Kn,unmountComponentAtNode:ui,unstable_batchedUpdates:pi,useCallback:Gs,useContext:Xs,useDebugValue:Hn,useDeferredValue:mi,useEffect:He,useErrorBoundary:Pa,useId:Ks,useImperativeHandle:Ws,useInsertionEffect:gi,useLayoutEffect:ft,useMemo:Ut,useReducer:Vn,useRef:it,useState:$t,useSyncExternalStore:yi,useTransition:_i,version:Na},Symbol.toStringTag,{value:"Module"})),za=()=>{const t=it(!0);return He(()=>{t.current=!1},[]),t.current},Ur=t=>{let e;const n=new Set,r=(a,u)=>{const f=typeof a=="function"?a(e):a;if(!Object.is(f,e)){const c=e;e=u??typeof f!="object"?f:Object.assign({},e,f),n.forEach(p=>p(e,c))}},s=()=>e,l={setState:r,getState:s,subscribe:a=>(n.add(a),()=>n.delete(a)),destroy:()=>{n.clear()}};return e=t(r,s,l),l},Va=t=>t?Ur(t):Ur;var Be=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function vi(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Ha(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var s=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,s.get?s:{enumerable:!0,get:function(){return t[r]}})}),n}var wi={exports:{}},bi={};const Ei=Ha(Ua);var Pi={exports:{}},Si={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var We=Ei;function Wa(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Ga=typeof Object.is=="function"?Object.is:Wa,Xa=We.useState,Ka=We.useEffect,Ya=We.useLayoutEffect,qa=We.useDebugValue;function Za(t,e){var n=e(),r=Xa({inst:{value:n,getSnapshot:e}}),s=r[0].inst,i=r[1];return Ya(function(){s.value=n,s.getSnapshot=e,cn(s)&&i({inst:s})},[t,n,e]),Ka(function(){return cn(s)&&i({inst:s}),t(function(){cn(s)&&i({inst:s})})},[t]),qa(n),n}function cn(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Ga(t,n)}catch{return!0}}function Qa(t,e){return e()}var Ja=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Qa:Za;Si.useSyncExternalStore=We.useSyncExternalStore!==void 0?We.useSyncExternalStore:Ja;Pi.exports=Si;var ec=Pi.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zt=Ei,tc=ec;function nc(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var rc=typeof Object.is=="function"?Object.is:nc,sc=tc.useSyncExternalStore,ic=zt.useRef,oc=zt.useEffect,ac=zt.useMemo,cc=zt.useDebugValue;bi.useSyncExternalStoreWithSelector=function(t,e,n,r,s){var i=ic(null);if(i.current===null){var o={hasValue:!1,value:null};i.current=o}else o=i.current;i=ac(function(){function a(d){if(!u){if(u=!0,f=d,d=r(d),s!==void 0&&o.hasValue){var h=o.value;if(s(h,d))return c=h}return c=d}if(h=c,rc(f,d))return h;var _=r(d);return s!==void 0&&s(h,_)?h:(f=d,c=_)}var u=!1,f,c,p=n===void 0?null:n;return[function(){return a(e())},p===null?void 0:function(){return a(p())}]},[e,n,r,s]);var l=sc(t,i[0],i[1]);return oc(function(){o.hasValue=!0,o.value=l},[l]),cc(l),l};wi.exports=bi;var lc=wi.exports;const uc=vi(lc),{useSyncExternalStoreWithSelector:fc}=uc;function pc(t,e=t.getState,n){const r=fc(t.subscribe,t.getState,t.getServerState||t.getState,e,n);return Hn(r),r}const zr=t=>{const e=typeof t=="function"?Va(t):t,n=(r,s)=>pc(e,r,s);return Object.assign(n,e),n},Yn=t=>t?zr(t):zr;var xi=Symbol.for("immer-nothing"),Vr=Symbol.for("immer-draftable"),K=Symbol.for("immer-state");function se(t,...e){throw new Error(`[Immer] minified error nr: ${t}. Full error at: https://bit.ly/3cXEKWf`)}var Ge=Object.getPrototypeOf;function Xe(t){return!!t&&!!t[K]}function Le(t){var e;return t?Ti(t)||Array.isArray(t)||!!t[Vr]||!!((e=t.constructor)!=null&&e[Vr])||Ht(t)||Wt(t):!1}var dc=Object.prototype.constructor.toString();function Ti(t){if(!t||typeof t!="object")return!1;const e=Ge(t);if(e===null)return!0;const n=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return n===Object?!0:typeof n=="function"&&Function.toString.call(n)===dc}function ot(t,e){Vt(t)===0?Object.entries(t).forEach(([n,r])=>{e(n,r,t)}):t.forEach((n,r)=>e(r,n,t))}function Vt(t){const e=t[K];return e?e.type_:Array.isArray(t)?1:Ht(t)?2:Wt(t)?3:0}function An(t,e){return Vt(t)===2?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function Ai(t,e,n){const r=Vt(t);r===2?t.set(e,n):r===3?t.add(n):t[e]=n}function hc(t,e){return t===e?t!==0||1/t===1/e:t!==t&&e!==e}function Ht(t){return t instanceof Map}function Wt(t){return t instanceof Set}function Te(t){return t.copy_||t.base_}function Mn(t,e){if(Ht(t))return new Map(t);if(Wt(t))return new Set(t);if(Array.isArray(t))return Array.prototype.slice.call(t);if(!e&&Ti(t))return Ge(t)?{...t}:Object.assign(Object.create(null),t);const n=Object.getOwnPropertyDescriptors(t);delete n[K];let r=Reflect.ownKeys(n);for(let s=0;s<r.length;s++){const i=r[s],o=n[i];o.writable===!1&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(n[i]={configurable:!0,writable:!0,enumerable:o.enumerable,value:t[i]})}return Object.create(Ge(t),n)}function qn(t,e=!1){return Gt(t)||Xe(t)||!Le(t)||(Vt(t)>1&&(t.set=t.add=t.clear=t.delete=mc),Object.freeze(t),e&&ot(t,(n,r)=>qn(r,!0))),t}function mc(){se(2)}function Gt(t){return Object.isFrozen(t)}var _c={};function ke(t){const e=_c[t];return e||se(0,t),e}var at;function Mi(){return at}function gc(t,e){return{drafts_:[],parent_:t,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function Hr(t,e){e&&(ke("Patches"),t.patches_=[],t.inversePatches_=[],t.patchListener_=e)}function Cn(t){Ln(t),t.drafts_.forEach(yc),t.drafts_=null}function Ln(t){t===at&&(at=t.parent_)}function Wr(t){return at=gc(at,t)}function yc(t){const e=t[K];e.type_===0||e.type_===1?e.revoke_():e.revoked_=!0}function Gr(t,e){e.unfinalizedDrafts_=e.drafts_.length;const n=e.drafts_[0];return t!==void 0&&t!==n?(n[K].modified_&&(Cn(e),se(4)),Le(t)&&(t=It(e,t),e.parent_||Rt(e,t)),e.patches_&&ke("Patches").generateReplacementPatches_(n[K].base_,t,e.patches_,e.inversePatches_)):t=It(e,n,[]),Cn(e),e.patches_&&e.patchListener_(e.patches_,e.inversePatches_),t!==xi?t:void 0}function It(t,e,n){if(Gt(e))return e;const r=e[K];if(!r)return ot(e,(s,i)=>Xr(t,r,e,s,i,n)),e;if(r.scope_!==t)return e;if(!r.modified_)return Rt(t,r.base_,!0),r.base_;if(!r.finalized_){r.finalized_=!0,r.scope_.unfinalizedDrafts_--;const s=r.copy_;let i=s,o=!1;r.type_===3&&(i=new Set(s),s.clear(),o=!0),ot(i,(l,a)=>Xr(t,r,s,l,a,n,o)),Rt(t,s,!1),n&&t.patches_&&ke("Patches").generatePatches_(r,n,t.patches_,t.inversePatches_)}return r.copy_}function Xr(t,e,n,r,s,i,o){if(Xe(s)){const l=i&&e&&e.type_!==3&&!An(e.assigned_,r)?i.concat(r):void 0,a=It(t,s,l);if(Ai(n,r,a),Xe(a))t.canAutoFreeze_=!1;else return}else o&&n.add(s);if(Le(s)&&!Gt(s)){if(!t.immer_.autoFreeze_&&t.unfinalizedDrafts_<1)return;It(t,s),(!e||!e.scope_.parent_)&&Rt(t,s)}}function Rt(t,e,n=!1){!t.parent_&&t.immer_.autoFreeze_&&t.canAutoFreeze_&&qn(e,n)}function vc(t,e){const n=Array.isArray(t),r={type_:n?1:0,scope_:e?e.scope_:Mi(),modified_:!1,finalized_:!1,assigned_:{},parent_:e,base_:t,draft_:null,copy_:null,revoke_:null,isManual_:!1};let s=r,i=Zn;n&&(s=[r],i=ct);const{revoke:o,proxy:l}=Proxy.revocable(s,i);return r.draft_=l,r.revoke_=o,l}var Zn={get(t,e){if(e===K)return t;const n=Te(t);if(!An(n,e))return wc(t,n,e);const r=n[e];return t.finalized_||!Le(r)?r:r===ln(t.base_,e)?(un(t),t.copy_[e]=Dn(r,t)):r},has(t,e){return e in Te(t)},ownKeys(t){return Reflect.ownKeys(Te(t))},set(t,e,n){const r=Ci(Te(t),e);if(r!=null&&r.set)return r.set.call(t.draft_,n),!0;if(!t.modified_){const s=ln(Te(t),e),i=s==null?void 0:s[K];if(i&&i.base_===n)return t.copy_[e]=n,t.assigned_[e]=!1,!0;if(hc(n,s)&&(n!==void 0||An(t.base_,e)))return!0;un(t),kn(t)}return t.copy_[e]===n&&(n!==void 0||e in t.copy_)||Number.isNaN(n)&&Number.isNaN(t.copy_[e])||(t.copy_[e]=n,t.assigned_[e]=!0),!0},deleteProperty(t,e){return ln(t.base_,e)!==void 0||e in t.base_?(t.assigned_[e]=!1,un(t),kn(t)):delete t.assigned_[e],t.copy_&&delete t.copy_[e],!0},getOwnPropertyDescriptor(t,e){const n=Te(t),r=Reflect.getOwnPropertyDescriptor(n,e);return r&&{writable:!0,configurable:t.type_!==1||e!=="length",enumerable:r.enumerable,value:n[e]}},defineProperty(){se(11)},getPrototypeOf(t){return Ge(t.base_)},setPrototypeOf(){se(12)}},ct={};ot(Zn,(t,e)=>{ct[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}});ct.deleteProperty=function(t,e){return ct.set.call(this,t,e,void 0)};ct.set=function(t,e,n){return Zn.set.call(this,t[0],e,n,t[0])};function ln(t,e){const n=t[K];return(n?Te(n):t)[e]}function wc(t,e,n){var s;const r=Ci(e,n);return r?"value"in r?r.value:(s=r.get)==null?void 0:s.call(t.draft_):void 0}function Ci(t,e){if(!(e in t))return;let n=Ge(t);for(;n;){const r=Object.getOwnPropertyDescriptor(n,e);if(r)return r;n=Ge(n)}}function kn(t){t.modified_||(t.modified_=!0,t.parent_&&kn(t.parent_))}function un(t){t.copy_||(t.copy_=Mn(t.base_,t.scope_.immer_.useStrictShallowCopy_))}var bc=class{constructor(t){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,n,r)=>{if(typeof e=="function"&&typeof n!="function"){const i=n;n=e;const o=this;return function(a=i,...u){return o.produce(a,f=>n.call(this,f,...u))}}typeof n!="function"&&se(6),r!==void 0&&typeof r!="function"&&se(7);let s;if(Le(e)){const i=Wr(this),o=Dn(e,void 0);let l=!0;try{s=n(o),l=!1}finally{l?Cn(i):Ln(i)}return Hr(i,r),Gr(s,i)}else if(!e||typeof e!="object"){if(s=n(e),s===void 0&&(s=e),s===xi&&(s=void 0),this.autoFreeze_&&qn(s,!0),r){const i=[],o=[];ke("Patches").generateReplacementPatches_(e,s,i,o),r(i,o)}return s}else se(1,e)},this.produceWithPatches=(e,n)=>{if(typeof e=="function")return(o,...l)=>this.produceWithPatches(o,a=>e(a,...l));let r,s;return[this.produce(e,n,(o,l)=>{r=o,s=l}),r,s]},typeof(t==null?void 0:t.autoFreeze)=="boolean"&&this.setAutoFreeze(t.autoFreeze),typeof(t==null?void 0:t.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(t.useStrictShallowCopy)}createDraft(t){Le(t)||se(8),Xe(t)&&(t=Ec(t));const e=Wr(this),n=Dn(t,void 0);return n[K].isManual_=!0,Ln(e),n}finishDraft(t,e){const n=t&&t[K];(!n||!n.isManual_)&&se(9);const{scope_:r}=n;return Hr(r,e),Gr(void 0,r)}setAutoFreeze(t){this.autoFreeze_=t}setUseStrictShallowCopy(t){this.useStrictShallowCopy_=t}applyPatches(t,e){let n;for(n=e.length-1;n>=0;n--){const s=e[n];if(s.path.length===0&&s.op==="replace"){t=s.value;break}}n>-1&&(e=e.slice(n+1));const r=ke("Patches").applyPatches_;return Xe(t)?r(t,e):this.produce(t,s=>r(s,e))}};function Dn(t,e){const n=Ht(t)?ke("MapSet").proxyMap_(t,e):Wt(t)?ke("MapSet").proxySet_(t,e):vc(t,e);return(e?e.scope_:Mi()).drafts_.push(n),n}function Ec(t){return Xe(t)||se(10,t),Li(t)}function Li(t){if(!Le(t)||Gt(t))return t;const e=t[K];let n;if(e){if(!e.modified_)return e.base_;e.finalized_=!0,n=Mn(t,e.scope_.immer_.useStrictShallowCopy_)}else n=Mn(t,!0);return ot(n,(r,s)=>{Ai(n,r,Li(s))}),e&&(e.finalized_=!1),n}var Y=new bc,Pc=Y.produce;Y.produceWithPatches.bind(Y);Y.setAutoFreeze.bind(Y);Y.setUseStrictShallowCopy.bind(Y);Y.applyPatches.bind(Y);Y.createDraft.bind(Y);Y.finishDraft.bind(Y);const ki=t=>({indices:[0,0],_indicesCache:{},setIndex:(e,n)=>{t(r=>{const{indices:s,_indicesCache:i}=r;s[e]=n;const o=s.slice(0,e+1).join(),l=i[o]??[],{length:a}=s;for(let c=0;e+1+c<a;c++)s[e+1+c]=l[c]??0;const u=s.slice(e),f=s.slice(0,e).join();f&&(i[f]=u)})},showFilter:!1,toggleFilter:()=>t(e=>{e.showFilter=!e.showFilter}),searchAll:!1,toggleSearchAll:()=>t(e=>{e.searchAll=!e.searchAll})}),Kr=t=>t==="true";function Di(t,e){return t&&e&&Object.keys(e).forEach(n=>{const r=e[n];typeof r=="object"?(t[n]||(t[n]={}),Di(t[n],r)):t[n]=r}),t}const Sc=(t,e)=>({category:"Adv",setCategory:n=>t(r=>{r.category=n}),advAni:{category:"home",setCategory:n=>t(r=>{r.advAni.category=n}),home:{gender:"Male",setGender:n=>t(r=>{r.advAni.home.gender=n})},weapon:{type:"Sword",setType:n=>t(r=>{r.advAni.weapon.type=n}),gunMode:"Long",setGunMode:n=>t(r=>{r.advAni.weapon.gunMode=n})},genericSkill:{type:"Sword",setType:n=>t(r=>{r.advAni.genericSkill.type=n})},groupByWeapon:{setGroupWeaponType:(n,r)=>t(s=>{s.advAni.groupByWeapon[n]=r})},uniqueOther:{type:"Sword",setType:n=>t(r=>{r.advAni.uniqueOther.type=n}),selected:"",setSelected:n=>t(r=>{r.advAni.uniqueOther.selected=n})}},extraAni:{category:"Dance",setCategory:n=>t(r=>{r.extraAni.category=n})},personalAni:{source:"",setSource:n=>t(r=>{r.personalAni.source=n}),sourceName:"",setSourceName:n=>t(r=>{r.personalAni.sourceName=n})},getCurrentState:()=>{const n=e();return JSON.parse(JSON.stringify(n))},loadState:(n={})=>{t(r=>Di(r,n))}}),Yr={type:"change"},fn={type:"start"},qr={type:"end"};class xc extends Ao{constructor(e,n){super(),this.object=e,this.domElement=n,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new N,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Ie.ROTATE,MIDDLE:Ie.DOLLY,RIGHT:Ie.PAN},this.touches={ONE:Re.ROTATE,TWO:Re.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return l.phi},this.getAzimuthalAngle=function(){return l.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(m){m.addEventListener("keydown",tn),this._domElementKeyEvents=m},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",tn),this._domElementKeyEvents=null},this.saveState=function(){r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=function(){r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(Yr),r.update(),i=s.NONE},this.update=function(){const m=new N,S=new Ne().setFromUnitVectors(e.up,new N(0,1,0)),B=S.clone().invert(),j=new N,ee=new Ne,vt=new N,we=2*Math.PI;return function(){const fr=r.object.position;m.copy(fr).sub(r.target),m.applyQuaternion(S),l.setFromVector3(m),r.autoRotate&&i===s.NONE&&M(O()),r.enableDamping?(l.theta+=a.theta*r.dampingFactor,l.phi+=a.phi*r.dampingFactor):(l.theta+=a.theta,l.phi+=a.phi);let ue=r.minAzimuthAngle,fe=r.maxAzimuthAngle;return isFinite(ue)&&isFinite(fe)&&(ue<-Math.PI?ue+=we:ue>Math.PI&&(ue-=we),fe<-Math.PI?fe+=we:fe>Math.PI&&(fe-=we),ue<=fe?l.theta=Math.max(ue,Math.min(fe,l.theta)):l.theta=l.theta>(ue+fe)/2?Math.max(ue,l.theta):Math.min(fe,l.theta)),l.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,l.phi)),l.makeSafe(),l.radius*=u,l.radius=Math.max(r.minDistance,Math.min(r.maxDistance,l.radius)),r.enableDamping===!0?r.target.addScaledVector(f,r.dampingFactor):r.target.add(f),m.setFromSpherical(l),m.applyQuaternion(B),fr.copy(r.target).add(m),r.object.lookAt(r.target),r.enableDamping===!0?(a.theta*=1-r.dampingFactor,a.phi*=1-r.dampingFactor,f.multiplyScalar(1-r.dampingFactor)):(a.set(0,0,0),f.set(0,0,0)),u=1,c||j.distanceToSquared(r.object.position)>o||8*(1-ee.dot(r.object.quaternion))>o||vt.distanceToSquared(r.target)>0?(r.dispatchEvent(Yr),j.copy(r.object.position),ee.copy(r.object.quaternion),vt.copy(r.target),c=!1,!0):!1}}(),this.dispose=function(){r.domElement.removeEventListener("contextmenu",lr),r.domElement.removeEventListener("pointerdown",ar),r.domElement.removeEventListener("pointercancel",et),r.domElement.removeEventListener("wheel",cr),r.domElement.removeEventListener("pointermove",en),r.domElement.removeEventListener("pointerup",et),r._domElementKeyEvents!==null&&(r._domElementKeyEvents.removeEventListener("keydown",tn),r._domElementKeyEvents=null)};const r=this,s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let i=s.NONE;const o=1e-6,l=new pr,a=new pr;let u=1;const f=new N;let c=!1;const p=new U,d=new U,h=new U,_=new U,w=new U,y=new U,v=new U,g=new U,P=new U,b=[],x={};function O(){return 2*Math.PI/60/60*r.autoRotateSpeed}function A(){return Math.pow(.95,r.zoomSpeed)}function M(m){a.theta-=m}function L(m){a.phi-=m}const ge=function(){const m=new N;return function(B,j){m.setFromMatrixColumn(j,0),m.multiplyScalar(-B),f.add(m)}}(),le=function(){const m=new N;return function(B,j){r.screenSpacePanning===!0?m.setFromMatrixColumn(j,1):(m.setFromMatrixColumn(j,0),m.crossVectors(r.object.up,m)),m.multiplyScalar(B),f.add(m)}}(),W=function(){const m=new N;return function(B,j){const ee=r.domElement;if(r.object.isPerspectiveCamera){const vt=r.object.position;m.copy(vt).sub(r.target);let we=m.length();we*=Math.tan(r.object.fov/2*Math.PI/180),ge(2*B*we/ee.clientHeight,r.object.matrix),le(2*j*we/ee.clientHeight,r.object.matrix)}else r.object.isOrthographicCamera?(ge(B*(r.object.right-r.object.left)/r.object.zoom/ee.clientWidth,r.object.matrix),le(j*(r.object.top-r.object.bottom)/r.object.zoom/ee.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}}();function ye(m){r.object.isPerspectiveCamera?u/=m:r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom*m)),r.object.updateProjectionMatrix(),c=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function Ye(m){r.object.isPerspectiveCamera?u*=m:r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/m)),r.object.updateProjectionMatrix(),c=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function J(m){p.set(m.clientX,m.clientY)}function Jt(m){v.set(m.clientX,m.clientY)}function mt(m){_.set(m.clientX,m.clientY)}function qe(m){d.set(m.clientX,m.clientY),h.subVectors(d,p).multiplyScalar(r.rotateSpeed);const S=r.domElement;M(2*Math.PI*h.x/S.clientHeight),L(2*Math.PI*h.y/S.clientHeight),p.copy(d),r.update()}function ve(m){g.set(m.clientX,m.clientY),P.subVectors(g,v),P.y>0?ye(A()):P.y<0&&Ye(A()),v.copy(g),r.update()}function _t(m){w.set(m.clientX,m.clientY),y.subVectors(w,_).multiplyScalar(r.panSpeed),W(y.x,y.y),_.copy(w),r.update()}function xe(m){m.deltaY<0?Ye(A()):m.deltaY>0&&ye(A()),r.update()}function Ze(m){let S=!1;switch(m.code){case r.keys.UP:m.ctrlKey||m.metaKey||m.shiftKey?L(2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):W(0,r.keyPanSpeed),S=!0;break;case r.keys.BOTTOM:m.ctrlKey||m.metaKey||m.shiftKey?L(-2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):W(0,-r.keyPanSpeed),S=!0;break;case r.keys.LEFT:m.ctrlKey||m.metaKey||m.shiftKey?M(2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):W(r.keyPanSpeed,0),S=!0;break;case r.keys.RIGHT:m.ctrlKey||m.metaKey||m.shiftKey?M(-2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):W(-r.keyPanSpeed,0),S=!0;break}S&&(m.preventDefault(),r.update())}function Oe(){if(b.length===1)p.set(b[0].pageX,b[0].pageY);else{const m=.5*(b[0].pageX+b[1].pageX),S=.5*(b[0].pageY+b[1].pageY);p.set(m,S)}}function Qe(){if(b.length===1)_.set(b[0].pageX,b[0].pageY);else{const m=.5*(b[0].pageX+b[1].pageX),S=.5*(b[0].pageY+b[1].pageY);_.set(m,S)}}function Je(){const m=b[0].pageX-b[1].pageX,S=b[0].pageY-b[1].pageY,B=Math.sqrt(m*m+S*S);v.set(0,B)}function gt(){r.enableZoom&&Je(),r.enablePan&&Qe()}function yt(){r.enableZoom&&Je(),r.enableRotate&&Oe()}function sr(m){if(b.length==1)d.set(m.pageX,m.pageY);else{const B=nn(m),j=.5*(m.pageX+B.x),ee=.5*(m.pageY+B.y);d.set(j,ee)}h.subVectors(d,p).multiplyScalar(r.rotateSpeed);const S=r.domElement;M(2*Math.PI*h.x/S.clientHeight),L(2*Math.PI*h.y/S.clientHeight),p.copy(d)}function ir(m){if(b.length===1)w.set(m.pageX,m.pageY);else{const S=nn(m),B=.5*(m.pageX+S.x),j=.5*(m.pageY+S.y);w.set(B,j)}y.subVectors(w,_).multiplyScalar(r.panSpeed),W(y.x,y.y),_.copy(w)}function or(m){const S=nn(m),B=m.pageX-S.x,j=m.pageY-S.y,ee=Math.sqrt(B*B+j*j);g.set(0,ee),P.set(0,Math.pow(g.y/v.y,r.zoomSpeed)),ye(P.y),v.copy(g)}function go(m){r.enableZoom&&or(m),r.enablePan&&ir(m)}function yo(m){r.enableZoom&&or(m),r.enableRotate&&sr(m)}function ar(m){r.enabled!==!1&&(b.length===0&&(r.domElement.setPointerCapture(m.pointerId),r.domElement.addEventListener("pointermove",en),r.domElement.addEventListener("pointerup",et)),Po(m),m.pointerType==="touch"?bo(m):vo(m))}function en(m){r.enabled!==!1&&(m.pointerType==="touch"?Eo(m):wo(m))}function et(m){So(m),b.length===0&&(r.domElement.releasePointerCapture(m.pointerId),r.domElement.removeEventListener("pointermove",en),r.domElement.removeEventListener("pointerup",et)),r.dispatchEvent(qr),i=s.NONE}function vo(m){let S;switch(m.button){case 0:S=r.mouseButtons.LEFT;break;case 1:S=r.mouseButtons.MIDDLE;break;case 2:S=r.mouseButtons.RIGHT;break;default:S=-1}switch(S){case Ie.DOLLY:if(r.enableZoom===!1)return;Jt(m),i=s.DOLLY;break;case Ie.ROTATE:if(m.ctrlKey||m.metaKey||m.shiftKey){if(r.enablePan===!1)return;mt(m),i=s.PAN}else{if(r.enableRotate===!1)return;J(m),i=s.ROTATE}break;case Ie.PAN:if(m.ctrlKey||m.metaKey||m.shiftKey){if(r.enableRotate===!1)return;J(m),i=s.ROTATE}else{if(r.enablePan===!1)return;mt(m),i=s.PAN}break;default:i=s.NONE}i!==s.NONE&&r.dispatchEvent(fn)}function wo(m){switch(i){case s.ROTATE:if(r.enableRotate===!1)return;qe(m);break;case s.DOLLY:if(r.enableZoom===!1)return;ve(m);break;case s.PAN:if(r.enablePan===!1)return;_t(m);break}}function cr(m){r.enabled===!1||r.enableZoom===!1||i!==s.NONE||(m.preventDefault(),r.dispatchEvent(fn),xe(m),r.dispatchEvent(qr))}function tn(m){r.enabled===!1||r.enablePan===!1||Ze(m)}function bo(m){switch(ur(m),b.length){case 1:switch(r.touches.ONE){case Re.ROTATE:if(r.enableRotate===!1)return;Oe(),i=s.TOUCH_ROTATE;break;case Re.PAN:if(r.enablePan===!1)return;Qe(),i=s.TOUCH_PAN;break;default:i=s.NONE}break;case 2:switch(r.touches.TWO){case Re.DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;gt(),i=s.TOUCH_DOLLY_PAN;break;case Re.DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;yt(),i=s.TOUCH_DOLLY_ROTATE;break;default:i=s.NONE}break;default:i=s.NONE}i!==s.NONE&&r.dispatchEvent(fn)}function Eo(m){switch(ur(m),i){case s.TOUCH_ROTATE:if(r.enableRotate===!1)return;sr(m),r.update();break;case s.TOUCH_PAN:if(r.enablePan===!1)return;ir(m),r.update();break;case s.TOUCH_DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;go(m),r.update();break;case s.TOUCH_DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;yo(m),r.update();break;default:i=s.NONE}}function lr(m){r.enabled!==!1&&m.preventDefault()}function Po(m){b.push(m)}function So(m){delete x[m.pointerId];for(let S=0;S<b.length;S++)if(b[S].pointerId==m.pointerId){b.splice(S,1);return}}function ur(m){let S=x[m.pointerId];S===void 0&&(S=new U,x[m.pointerId]=S),S.set(m.pageX,m.pageY)}function nn(m){const S=m.pointerId===b[0].pointerId?b[1]:b[0];return x[S.pointerId]}r.domElement.addEventListener("contextmenu",lr),r.domElement.addEventListener("pointerdown",ar),r.domElement.addEventListener("pointercancel",et),r.domElement.addEventListener("wheel",cr,{passive:!1}),this.update()}}const Oi="fbx",Ii="animations",Tc="img/textures/matcap",Xt="data";/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/var Zr=function(t){return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))};try{URL.revokeObjectURL(Zr(""))}catch{Zr=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)}}var Z=Uint8Array,Se=Uint16Array,On=Uint32Array,Ri=new Z([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Fi=new Z([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ac=new Z([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Bi=function(t,e){for(var n=new Se(31),r=0;r<31;++r)n[r]=e+=1<<t[r-1];for(var s=new On(n[30]),r=1;r<30;++r)for(var i=n[r];i<n[r+1];++i)s[i]=i-n[r]<<5|r;return[n,s]},ji=Bi(Ri,2),Ni=ji[0],Mc=ji[1];Ni[28]=258,Mc[258]=28;var Cc=Bi(Fi,0),Lc=Cc[0],In=new Se(32768);for(var k=0;k<32768;++k){var be=(k&43690)>>>1|(k&21845)<<1;be=(be&52428)>>>2|(be&13107)<<2,be=(be&61680)>>>4|(be&3855)<<4,In[k]=((be&65280)>>>8|(be&255)<<8)>>>1}var rt=function(t,e,n){for(var r=t.length,s=0,i=new Se(e);s<r;++s)++i[t[s]-1];var o=new Se(e);for(s=0;s<e;++s)o[s]=o[s-1]+i[s-1]<<1;var l;if(n){l=new Se(1<<e);var a=15-e;for(s=0;s<r;++s)if(t[s])for(var u=s<<4|t[s],f=e-t[s],c=o[t[s]-1]++<<f,p=c|(1<<f)-1;c<=p;++c)l[In[c]>>>a]=u}else for(l=new Se(r),s=0;s<r;++s)t[s]&&(l[s]=In[o[t[s]-1]++]>>>15-t[s]);return l},pt=new Z(288);for(var k=0;k<144;++k)pt[k]=8;for(var k=144;k<256;++k)pt[k]=9;for(var k=256;k<280;++k)pt[k]=7;for(var k=280;k<288;++k)pt[k]=8;var $i=new Z(32);for(var k=0;k<32;++k)$i[k]=5;var kc=rt(pt,9,1),Dc=rt($i,5,1),pn=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},ne=function(t,e,n){var r=e/8|0;return(t[r]|t[r+1]<<8)>>(e&7)&n},dn=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(e&7)},Oc=function(t){return(t/8|0)+(t&7&&1)},Ic=function(t,e,n){(e==null||e<0)&&(e=0),(n==null||n>t.length)&&(n=t.length);var r=new(t instanceof Se?Se:t instanceof On?On:Z)(n-e);return r.set(t.subarray(e,n)),r},Rc=function(t,e,n){var r=t.length;if(!r||n&&!n.l&&r<5)return e||new Z(0);var s=!e||n,i=!n||n.i;n||(n={}),e||(e=new Z(r*3));var o=function(Je){var gt=e.length;if(Je>gt){var yt=new Z(Math.max(gt*2,Je));yt.set(e),e=yt}},l=n.f||0,a=n.p||0,u=n.b||0,f=n.l,c=n.d,p=n.m,d=n.n,h=r*8;do{if(!f){n.f=l=ne(t,a,1);var _=ne(t,a+1,3);if(a+=3,_)if(_==1)f=kc,c=Dc,p=9,d=5;else if(_==2){var g=ne(t,a,31)+257,P=ne(t,a+10,15)+4,b=g+ne(t,a+5,31)+1;a+=14;for(var x=new Z(b),O=new Z(19),A=0;A<P;++A)O[Ac[A]]=ne(t,a+A*3,7);a+=P*3;for(var M=pn(O),L=(1<<M)-1,ge=rt(O,M,1),A=0;A<b;){var le=ge[ne(t,a,L)];a+=le&15;var w=le>>>4;if(w<16)x[A++]=w;else{var W=0,ye=0;for(w==16?(ye=3+ne(t,a,3),a+=2,W=x[A-1]):w==17?(ye=3+ne(t,a,7),a+=3):w==18&&(ye=11+ne(t,a,127),a+=7);ye--;)x[A++]=W}}var Ye=x.subarray(0,g),J=x.subarray(g);p=pn(Ye),d=pn(J),f=rt(Ye,p,1),c=rt(J,d,1)}else throw"invalid block type";else{var w=Oc(a)+4,y=t[w-4]|t[w-3]<<8,v=w+y;if(v>r){if(i)throw"unexpected EOF";break}s&&o(u+y),e.set(t.subarray(w,v),u),n.b=u+=y,n.p=a=v*8;continue}if(a>h){if(i)throw"unexpected EOF";break}}s&&o(u+131072);for(var Jt=(1<<p)-1,mt=(1<<d)-1,qe=a;;qe=a){var W=f[dn(t,a)&Jt],ve=W>>>4;if(a+=W&15,a>h){if(i)throw"unexpected EOF";break}if(!W)throw"invalid length/literal";if(ve<256)e[u++]=ve;else if(ve==256){qe=a,f=null;break}else{var _t=ve-254;if(ve>264){var A=ve-257,xe=Ri[A];_t=ne(t,a,(1<<xe)-1)+Ni[A],a+=xe}var Ze=c[dn(t,a)&mt],Oe=Ze>>>4;if(!Ze)throw"invalid distance";a+=Ze&15;var J=Lc[Oe];if(Oe>3){var xe=Fi[Oe];J+=dn(t,a)&(1<<xe)-1,a+=xe}if(a>h){if(i)throw"unexpected EOF";break}s&&o(u+131072);for(var Qe=u+_t;u<Qe;u+=4)e[u]=e[u-J],e[u+1]=e[u+1-J],e[u+2]=e[u+2-J],e[u+3]=e[u+3-J];u=Qe}}n.l=f,n.p=qe,n.b=u,f&&(l=1,n.m=p,n.d=c,n.n=d)}while(!l);return u==e.length?e:Ic(e,0,u)},Fc=new Z(0),Bc=function(t){if((t[0]&15)!=8||t[0]>>>4>7||(t[0]<<8|t[1])%31)throw"invalid zlib data";if(t[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function jc(t,e){return Rc((Bc(t),t.subarray(2,-4)),e)}var Nc=typeof TextDecoder<"u"&&new TextDecoder,$c=0;try{Nc.decode(Fc,{stream:!0}),$c=1}catch{}function Ui(t,e,n){const r=n.length-t-1;if(e>=n[r])return r-1;if(e<=n[t])return t;let s=t,i=r,o=Math.floor((s+i)/2);for(;e<n[o]||e>=n[o+1];)e<n[o]?i=o:s=o,o=Math.floor((s+i)/2);return o}function Uc(t,e,n,r){const s=[],i=[],o=[];s[0]=1;for(let l=1;l<=n;++l){i[l]=e-r[t+1-l],o[l]=r[t+l]-e;let a=0;for(let u=0;u<l;++u){const f=o[u+1],c=i[l-u],p=s[u]/(f+c);s[u]=a+f*p,a=c*p}s[l]=a}return s}function zc(t,e,n,r){const s=Ui(t,r,e),i=Uc(s,r,t,e),o=new jt(0,0,0,0);for(let l=0;l<=t;++l){const a=n[s-t+l],u=i[l],f=a.w*u;o.x+=a.x*f,o.y+=a.y*f,o.z+=a.z*f,o.w+=a.w*u}return o}function Vc(t,e,n,r,s){const i=[];for(let c=0;c<=n;++c)i[c]=0;const o=[];for(let c=0;c<=r;++c)o[c]=i.slice(0);const l=[];for(let c=0;c<=n;++c)l[c]=i.slice(0);l[0][0]=1;const a=i.slice(0),u=i.slice(0);for(let c=1;c<=n;++c){a[c]=e-s[t+1-c],u[c]=s[t+c]-e;let p=0;for(let d=0;d<c;++d){const h=u[d+1],_=a[c-d];l[c][d]=h+_;const w=l[d][c-1]/l[c][d];l[d][c]=p+h*w,p=_*w}l[c][c]=p}for(let c=0;c<=n;++c)o[0][c]=l[c][n];for(let c=0;c<=n;++c){let p=0,d=1;const h=[];for(let _=0;_<=n;++_)h[_]=i.slice(0);h[0][0]=1;for(let _=1;_<=r;++_){let w=0;const y=c-_,v=n-_;c>=_&&(h[d][0]=h[p][0]/l[v+1][y],w=h[d][0]*l[y][v]);const g=y>=-1?1:-y,P=c-1<=v?_-1:n-c;for(let x=g;x<=P;++x)h[d][x]=(h[p][x]-h[p][x-1])/l[v+1][y+x],w+=h[d][x]*l[y+x][v];c<=v&&(h[d][_]=-h[p][_-1]/l[v+1][c],w+=h[d][_]*l[c][v]),o[_][c]=w;const b=p;p=d,d=b}}let f=n;for(let c=1;c<=r;++c){for(let p=0;p<=n;++p)o[c][p]*=f;f*=n-c}return o}function Hc(t,e,n,r,s){const i=s<t?s:t,o=[],l=Ui(t,r,e),a=Vc(l,r,t,i,e),u=[];for(let f=0;f<n.length;++f){const c=n[f].clone(),p=c.w;c.x*=p,c.y*=p,c.z*=p,u[f]=c}for(let f=0;f<=i;++f){const c=u[l-t].clone().multiplyScalar(a[f][0]);for(let p=1;p<=t;++p)c.add(u[l-t+p].clone().multiplyScalar(a[f][p]));o[f]=c}for(let f=i+1;f<=s+1;++f)o[f]=new jt(0,0,0);return o}function Wc(t,e){let n=1;for(let s=2;s<=t;++s)n*=s;let r=1;for(let s=2;s<=e;++s)r*=s;for(let s=2;s<=t-e;++s)r*=s;return n/r}function Gc(t){const e=t.length,n=[],r=[];for(let i=0;i<e;++i){const o=t[i];n[i]=new N(o.x,o.y,o.z),r[i]=o.w}const s=[];for(let i=0;i<e;++i){const o=n[i].clone();for(let l=1;l<=i;++l)o.sub(s[i-l].clone().multiplyScalar(Wc(i,l)*r[l]));s[i]=o.divideScalar(r[0])}return s}function Xc(t,e,n,r,s){const i=Hc(t,e,n,r,s);return Gc(i)}class Kc extends Mo{constructor(e,n,r,s,i){super(),this.degree=e,this.knots=n,this.controlPoints=[],this.startKnot=s||0,this.endKnot=i||this.knots.length-1;for(let o=0;o<r.length;++o){const l=r[o];this.controlPoints[o]=new jt(l.x,l.y,l.z,l.w)}}getPoint(e,n=new N){const r=n,s=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),i=zc(this.degree,this.knots,this.controlPoints,s);return i.w!==1&&i.divideScalar(i.w),r.set(i.x,i.y,i.z)}getTangent(e,n=new N){const r=n,s=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),i=Xc(this.degree,this.knots,this.controlPoints,s,1);return r.copy(i[1]).normalize(),r}}let T,R,z;class Yc extends bn{constructor(e){super(e)}load(e,n,r,s){const i=this,o=i.path===""?Co.extractUrlBase(e):i.path,l=new Lo(this.manager);l.setPath(i.path),l.setResponseType("arraybuffer"),l.setRequestHeader(i.requestHeader),l.setWithCredentials(i.withCredentials),l.load(e,function(a){try{n(i.parse(a,o))}catch(u){s?s(u):console.error(u),i.manager.itemError(e)}},r,s)}parse(e,n){if(tl(e))T=new el().parse(e);else{const s=Wi(e);if(!nl(s))throw new Error("THREE.FBXLoader: Unknown format.");if(Jr(s)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+Jr(s));T=new Jc().parse(s)}const r=new Ke(this.manager).setPath(this.resourcePath||n).setCrossOrigin(this.crossOrigin);return new qc(r,this.manager).parse(T)}}class qc{constructor(e,n){this.textureLoader=e,this.manager=n}parse(){R=this.parseConnections();const e=this.parseImages(),n=this.parseTextures(e),r=this.parseMaterials(n),s=this.parseDeformers(),i=new Zc().parse(s);return this.parseScene(s,i,r),z}parseConnections(){const e=new Map;return"Connections"in T&&T.Connections.connections.forEach(function(r){const s=r[0],i=r[1],o=r[2];e.has(s)||e.set(s,{parents:[],children:[]});const l={ID:i,relationship:o};e.get(s).parents.push(l),e.has(i)||e.set(i,{parents:[],children:[]});const a={ID:s,relationship:o};e.get(i).children.push(a)}),e}parseImages(){const e={},n={};if("Video"in T.Objects){const r=T.Objects.Video;for(const s in r){const i=r[s],o=parseInt(s);if(e[o]=i.RelativeFilename||i.Filename,"Content"in i){const l=i.Content instanceof ArrayBuffer&&i.Content.byteLength>0,a=typeof i.Content=="string"&&i.Content!=="";if(l||a){const u=this.parseImage(r[s]);n[i.RelativeFilename||i.Filename]=u}}}}for(const r in e){const s=e[r];n[s]!==void 0?e[r]=n[s]:e[r]=e[r].split("\\").pop()}return e}parseImage(e){const n=e.Content,r=e.RelativeFilename||e.Filename,s=r.slice(r.lastIndexOf(".")+1).toLowerCase();let i;switch(s){case"bmp":i="image/bmp";break;case"jpg":case"jpeg":i="image/jpeg";break;case"png":i="image/png";break;case"tif":i="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",r),i="image/tga";break;default:console.warn('FBXLoader: Image type "'+s+'" is not supported.');return}if(typeof n=="string")return"data:"+i+";base64,"+n;{const o=new Uint8Array(n);return window.URL.createObjectURL(new Blob([o],{type:i}))}}parseTextures(e){const n=new Map;if("Texture"in T.Objects){const r=T.Objects.Texture;for(const s in r){const i=this.parseTexture(r[s],e);n.set(parseInt(s),i)}}return n}parseTexture(e,n){const r=this.loadTexture(e,n);r.ID=e.id,r.name=e.attrName;const s=e.WrapModeU,i=e.WrapModeV,o=s!==void 0?s.value:0,l=i!==void 0?i.value:0;if(r.wrapS=o===0?dr:hr,r.wrapT=l===0?dr:hr,"Scaling"in e){const a=e.Scaling.value;r.repeat.x=a[0],r.repeat.y=a[1]}if("Translation"in e){const a=e.Translation.value;r.offset.x=a[0],r.offset.y=a[1]}return r}loadTexture(e,n){let r;const s=this.textureLoader.path,i=R.get(e.id).children;i!==void 0&&i.length>0&&n[i[0].ID]!==void 0&&(r=n[i[0].ID],(r.indexOf("blob:")===0||r.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let o;const l=e.FileName.slice(-3).toLowerCase();if(l==="tga"){const a=this.manager.getHandler(".tga");a===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),o=new mr):(a.setPath(this.textureLoader.path),o=a.load(r))}else l==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),o=new mr):o=this.textureLoader.load(r);return this.textureLoader.setPath(s),o}parseMaterials(e){const n=new Map;if("Material"in T.Objects){const r=T.Objects.Material;for(const s in r){const i=this.parseMaterial(r[s],e);i!==null&&n.set(parseInt(s),i)}}return n}parseMaterial(e,n){const r=e.id,s=e.attrName;let i=e.ShadingModel;if(typeof i=="object"&&(i=i.value),!R.has(r))return null;const o=this.parseParameters(e,n,r);let l;switch(i.toLowerCase()){case"phong":l=new rn;break;case"lambert":l=new ko;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',i),l=new rn;break}return l.setValues(o),l.name=s,l}parseParameters(e,n,r){const s={};e.BumpFactor&&(s.bumpScale=e.BumpFactor.value),e.Diffuse?s.color=new $().fromArray(e.Diffuse.value).convertSRGBToLinear():e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(s.color=new $().fromArray(e.DiffuseColor.value).convertSRGBToLinear()),e.DisplacementFactor&&(s.displacementScale=e.DisplacementFactor.value),e.Emissive?s.emissive=new $().fromArray(e.Emissive.value).convertSRGBToLinear():e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(s.emissive=new $().fromArray(e.EmissiveColor.value).convertSRGBToLinear()),e.EmissiveFactor&&(s.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(s.opacity=parseFloat(e.Opacity.value)),s.opacity<1&&(s.transparent=!0),e.ReflectionFactor&&(s.reflectivity=e.ReflectionFactor.value),e.Shininess&&(s.shininess=e.Shininess.value),e.Specular?s.specular=new $().fromArray(e.Specular.value).convertSRGBToLinear():e.SpecularColor&&e.SpecularColor.type==="Color"&&(s.specular=new $().fromArray(e.SpecularColor.value).convertSRGBToLinear());const i=this;return R.get(r).children.forEach(function(o){const l=o.relationship;switch(l){case"Bump":s.bumpMap=i.getTexture(n,o.ID);break;case"Maya|TEX_ao_map":s.aoMap=i.getTexture(n,o.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":s.map=i.getTexture(n,o.ID),s.map!==void 0&&(s.map.colorSpace=Q);break;case"DisplacementColor":s.displacementMap=i.getTexture(n,o.ID);break;case"EmissiveColor":s.emissiveMap=i.getTexture(n,o.ID),s.emissiveMap!==void 0&&(s.emissiveMap.colorSpace=Q);break;case"NormalMap":case"Maya|TEX_normal_map":s.normalMap=i.getTexture(n,o.ID);break;case"ReflectionColor":s.envMap=i.getTexture(n,o.ID),s.envMap!==void 0&&(s.envMap.mapping=Do,s.envMap.colorSpace=Q);break;case"SpecularColor":s.specularMap=i.getTexture(n,o.ID),s.specularMap!==void 0&&(s.specularMap.colorSpace=Q);break;case"TransparentColor":case"TransparencyFactor":s.alphaMap=i.getTexture(n,o.ID),s.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",l);break}}),s}getTexture(e,n){return"LayeredTexture"in T.Objects&&n in T.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),n=R.get(n).children[0].ID),e.get(n)}parseDeformers(){const e={},n={};if("Deformer"in T.Objects){const r=T.Objects.Deformer;for(const s in r){const i=r[s],o=R.get(parseInt(s));if(i.attrType==="Skin"){const l=this.parseSkeleton(o,r);l.ID=s,o.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),l.geometryID=o.parents[0].ID,e[s]=l}else if(i.attrType==="BlendShape"){const l={id:s};l.rawTargets=this.parseMorphTargets(o,r),l.id=s,o.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),n[s]=l}}}return{skeletons:e,morphTargets:n}}parseSkeleton(e,n){const r=[];return e.children.forEach(function(s){const i=n[s.ID];if(i.attrType!=="Cluster")return;const o={ID:s.ID,indices:[],weights:[],transformLink:new I().fromArray(i.TransformLink.a)};"Indexes"in i&&(o.indices=i.Indexes.a,o.weights=i.Weights.a),r.push(o)}),{rawBones:r,bones:[]}}parseMorphTargets(e,n){const r=[];for(let s=0;s<e.children.length;s++){const i=e.children[s],o=n[i.ID],l={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if(o.attrType!=="BlendShapeChannel")return;l.geoID=R.get(parseInt(i.ID)).children.filter(function(a){return a.relationship===void 0})[0].ID,r.push(l)}return r}parseScene(e,n,r){z=new _r;const s=this.parseModels(e.skeletons,n,r),i=T.Objects.Model,o=this;s.forEach(function(a){const u=i[a.ID];o.setLookAtProperties(a,u),R.get(a.ID).parents.forEach(function(c){const p=s.get(c.ID);p!==void 0&&p.add(a)}),a.parent===null&&z.add(a)}),this.bindSkeleton(e.skeletons,n,s),this.createAmbientLight(),z.traverse(function(a){if(a.userData.transformData){a.parent&&(a.userData.transformData.parentMatrix=a.parent.matrix,a.userData.transformData.parentMatrixWorld=a.parent.matrixWorld);const u=Vi(a.userData.transformData);a.applyMatrix4(u),a.updateWorldMatrix()}});const l=new Qc().parse();z.children.length===1&&z.children[0].isGroup&&(z.children[0].animations=l,z=z.children[0]),z.animations=l}parseModels(e,n,r){const s=new Map,i=T.Objects.Model;for(const o in i){const l=parseInt(o),a=i[o],u=R.get(l);let f=this.buildSkeleton(u,e,l,a.attrName);if(!f){switch(a.attrType){case"Camera":f=this.createCamera(u);break;case"Light":f=this.createLight(u);break;case"Mesh":f=this.createMesh(u,n,r);break;case"NurbsCurve":f=this.createCurve(u,n);break;case"LimbNode":case"Root":f=new gr;break;case"Null":default:f=new _r;break}f.name=a.attrName?Ct.sanitizeNodeName(a.attrName):"",f.ID=l}this.getTransformData(f,a),s.set(l,f)}return s}buildSkeleton(e,n,r,s){let i=null;return e.parents.forEach(function(o){for(const l in n){const a=n[l];a.rawBones.forEach(function(u,f){if(u.ID===o.ID){const c=i;i=new gr,i.matrixWorld.copy(u.transformLink),i.name=s?Ct.sanitizeNodeName(s):"",i.ID=r,a.bones[f]=i,c!==null&&i.add(c)}})}}),i}createCamera(e){let n,r;if(e.children.forEach(function(s){const i=T.Objects.NodeAttribute[s.ID];i!==void 0&&(r=i)}),r===void 0)n=new sn;else{let s=0;r.CameraProjectionType!==void 0&&r.CameraProjectionType.value===1&&(s=1);let i=1;r.NearPlane!==void 0&&(i=r.NearPlane.value/1e3);let o=1e3;r.FarPlane!==void 0&&(o=r.FarPlane.value/1e3);let l=window.innerWidth,a=window.innerHeight;r.AspectWidth!==void 0&&r.AspectHeight!==void 0&&(l=r.AspectWidth.value,a=r.AspectHeight.value);const u=l/a;let f=45;r.FieldOfView!==void 0&&(f=r.FieldOfView.value);const c=r.FocalLength?r.FocalLength.value:null;switch(s){case 0:n=new Es(f,u,i,o),c!==null&&n.setFocalLength(c);break;case 1:n=new bs(-l/2,l/2,a/2,-a/2,i,o);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+s+"."),n=new sn;break}}return n}createLight(e){let n,r;if(e.children.forEach(function(s){const i=T.Objects.NodeAttribute[s.ID];i!==void 0&&(r=i)}),r===void 0)n=new sn;else{let s;r.LightType===void 0?s=0:s=r.LightType.value;let i=16777215;r.Color!==void 0&&(i=new $().fromArray(r.Color.value).convertSRGBToLinear());let o=r.Intensity===void 0?1:r.Intensity.value/100;r.CastLightOnObject!==void 0&&r.CastLightOnObject.value===0&&(o=0);let l=0;r.FarAttenuationEnd!==void 0&&(r.EnableFarAttenuation!==void 0&&r.EnableFarAttenuation.value===0?l=0:l=r.FarAttenuationEnd.value);const a=1;switch(s){case 0:n=new En(i,o,l,a);break;case 1:n=new Ps(i,o);break;case 2:let u=Math.PI/3;r.InnerAngle!==void 0&&(u=oe.degToRad(r.InnerAngle.value));let f=0;r.OuterAngle!==void 0&&(f=oe.degToRad(r.OuterAngle.value),f=Math.max(f,1)),n=new Oo(i,o,l,u,f,a);break;default:console.warn("THREE.FBXLoader: Unknown light type "+r.LightType.value+", defaulting to a PointLight."),n=new En(i,o);break}r.CastShadows!==void 0&&r.CastShadows.value===1&&(n.castShadow=!0)}return n}createMesh(e,n,r){let s,i=null,o=null;const l=[];return e.children.forEach(function(a){n.has(a.ID)&&(i=n.get(a.ID)),r.has(a.ID)&&l.push(r.get(a.ID))}),l.length>1?o=l:l.length>0?o=l[0]:(o=new rn({name:bn.DEFAULT_MATERIAL_NAME,color:13421772}),l.push(o)),"color"in i.attributes&&l.forEach(function(a){a.vertexColors=!0}),i.FBX_Deformer?(s=new Io(i,o),s.normalizeSkinWeights()):s=new Ss(i,o),s}createCurve(e,n){const r=e.children.reduce(function(i,o){return n.has(o.ID)&&(i=n.get(o.ID)),i},null),s=new Ro({name:bn.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new Fo(r,s)}getTransformData(e,n){const r={};"InheritType"in n&&(r.inheritType=parseInt(n.InheritType.value)),"RotationOrder"in n?r.eulerOrder=Hi(n.RotationOrder.value):r.eulerOrder="ZYX","Lcl_Translation"in n&&(r.translation=n.Lcl_Translation.value),"PreRotation"in n&&(r.preRotation=n.PreRotation.value),"Lcl_Rotation"in n&&(r.rotation=n.Lcl_Rotation.value),"PostRotation"in n&&(r.postRotation=n.PostRotation.value),"Lcl_Scaling"in n&&(r.scale=n.Lcl_Scaling.value),"ScalingOffset"in n&&(r.scalingOffset=n.ScalingOffset.value),"ScalingPivot"in n&&(r.scalingPivot=n.ScalingPivot.value),"RotationOffset"in n&&(r.rotationOffset=n.RotationOffset.value),"RotationPivot"in n&&(r.rotationPivot=n.RotationPivot.value),e.userData.transformData=r}setLookAtProperties(e,n){"LookAtProperty"in n&&R.get(e.ID).children.forEach(function(s){if(s.relationship==="LookAtProperty"){const i=T.Objects.Model[s.ID];if("Lcl_Translation"in i){const o=i.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(o),z.add(e.target)):e.lookAt(new N().fromArray(o))}}})}bindSkeleton(e,n,r){const s=this.parsePoseNodes();for(const i in e){const o=e[i];R.get(parseInt(o.ID)).parents.forEach(function(a){if(n.has(a.ID)){const u=a.ID;R.get(u).parents.forEach(function(c){r.has(c.ID)&&r.get(c.ID).bind(new Bo(o.bones),s[c.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in T.Objects){const n=T.Objects.Pose;for(const r in n)if(n[r].attrType==="BindPose"&&n[r].NbPoseNodes>0){const s=n[r].PoseNode;Array.isArray(s)?s.forEach(function(i){e[i.Node]=new I().fromArray(i.Matrix.a)}):e[s.Node]=new I().fromArray(s.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in T&&"AmbientColor"in T.GlobalSettings){const e=T.GlobalSettings.AmbientColor.value,n=e[0],r=e[1],s=e[2];if(n!==0||r!==0||s!==0){const i=new $(n,r,s).convertSRGBToLinear();z.add(new xs(i,1))}}}}class Zc{constructor(){this.negativeMaterialIndices=!1}parse(e){const n=new Map;if("Geometry"in T.Objects){const r=T.Objects.Geometry;for(const s in r){const i=R.get(parseInt(s)),o=this.parseGeometry(i,r[s],e);n.set(parseInt(s),o)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),n}parseGeometry(e,n,r){switch(n.attrType){case"Mesh":return this.parseMeshGeometry(e,n,r);case"NurbsCurve":return this.parseNurbsGeometry(n)}}parseMeshGeometry(e,n,r){const s=r.skeletons,i=[],o=e.parents.map(function(c){return T.Objects.Model[c.ID]});if(o.length===0)return;const l=e.children.reduce(function(c,p){return s[p.ID]!==void 0&&(c=s[p.ID]),c},null);e.children.forEach(function(c){r.morphTargets[c.ID]!==void 0&&i.push(r.morphTargets[c.ID])});const a=o[0],u={};"RotationOrder"in a&&(u.eulerOrder=Hi(a.RotationOrder.value)),"InheritType"in a&&(u.inheritType=parseInt(a.InheritType.value)),"GeometricTranslation"in a&&(u.translation=a.GeometricTranslation.value),"GeometricRotation"in a&&(u.rotation=a.GeometricRotation.value),"GeometricScaling"in a&&(u.scale=a.GeometricScaling.value);const f=Vi(u);return this.genGeometry(n,l,i,f)}genGeometry(e,n,r,s){const i=new St;e.attrName&&(i.name=e.attrName);const o=this.parseGeoNode(e,n),l=this.genBuffers(o),a=new Ee(l.vertex,3);if(a.applyMatrix4(s),i.setAttribute("position",a),l.colors.length>0&&i.setAttribute("color",new Ee(l.colors,3)),n&&(i.setAttribute("skinIndex",new jo(l.weightsIndices,4)),i.setAttribute("skinWeight",new Ee(l.vertexWeights,4)),i.FBX_Deformer=n),l.normal.length>0){const u=new No().getNormalMatrix(s),f=new Ee(l.normal,3);f.applyNormalMatrix(u),i.setAttribute("normal",f)}if(l.uvs.forEach(function(u,f){const c=f===0?"uv":`uv${f}`;i.setAttribute(c,new Ee(l.uvs[f],2))}),o.material&&o.material.mappingType!=="AllSame"){let u=l.materialIndex[0],f=0;if(l.materialIndex.forEach(function(c,p){c!==u&&(i.addGroup(f,p-f,u),u=c,f=p)}),i.groups.length>0){const c=i.groups[i.groups.length-1],p=c.start+c.count;p!==l.materialIndex.length&&i.addGroup(p,l.materialIndex.length-p,u)}i.groups.length===0&&i.addGroup(0,l.materialIndex.length,l.materialIndex[0])}return this.addMorphTargets(i,e,r,s),i}parseGeoNode(e,n){const r={};if(r.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],r.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(r.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(r.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(r.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){r.uv=[];let s=0;for(;e.LayerElementUV[s];)e.LayerElementUV[s].UV&&r.uv.push(this.parseUVs(e.LayerElementUV[s])),s++}return r.weightTable={},n!==null&&(r.skeleton=n,n.rawBones.forEach(function(s,i){s.indices.forEach(function(o,l){r.weightTable[o]===void 0&&(r.weightTable[o]=[]),r.weightTable[o].push({id:i,weight:s.weights[l]})})})),r}genBuffers(e){const n={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let r=0,s=0,i=!1,o=[],l=[],a=[],u=[],f=[],c=[];const p=this;return e.vertexIndices.forEach(function(d,h){let _,w=!1;d<0&&(d=d^-1,w=!0);let y=[],v=[];if(o.push(d*3,d*3+1,d*3+2),e.color){const g=wt(h,r,d,e.color);a.push(g[0],g[1],g[2])}if(e.skeleton){if(e.weightTable[d]!==void 0&&e.weightTable[d].forEach(function(g){v.push(g.weight),y.push(g.id)}),v.length>4){i||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),i=!0);const g=[0,0,0,0],P=[0,0,0,0];v.forEach(function(b,x){let O=b,A=y[x];P.forEach(function(M,L,ge){if(O>M){ge[L]=O,O=M;const le=g[L];g[L]=A,A=le}})}),y=g,v=P}for(;v.length<4;)v.push(0),y.push(0);for(let g=0;g<4;++g)f.push(v[g]),c.push(y[g])}if(e.normal){const g=wt(h,r,d,e.normal);l.push(g[0],g[1],g[2])}e.material&&e.material.mappingType!=="AllSame"&&(_=wt(h,r,d,e.material)[0],_<0&&(p.negativeMaterialIndices=!0,_=0)),e.uv&&e.uv.forEach(function(g,P){const b=wt(h,r,d,g);u[P]===void 0&&(u[P]=[]),u[P].push(b[0]),u[P].push(b[1])}),s++,w&&(s>4&&console.warn("THREE.FBXLoader: Polygons with more than four sides are not supported. Make sure to triangulate the geometry during export."),p.genFace(n,e,o,_,l,a,u,f,c,s),r++,s=0,o=[],l=[],a=[],u=[],f=[],c=[])}),n}genFace(e,n,r,s,i,o,l,a,u,f){for(let c=2;c<f;c++)e.vertex.push(n.vertexPositions[r[0]]),e.vertex.push(n.vertexPositions[r[1]]),e.vertex.push(n.vertexPositions[r[2]]),e.vertex.push(n.vertexPositions[r[(c-1)*3]]),e.vertex.push(n.vertexPositions[r[(c-1)*3+1]]),e.vertex.push(n.vertexPositions[r[(c-1)*3+2]]),e.vertex.push(n.vertexPositions[r[c*3]]),e.vertex.push(n.vertexPositions[r[c*3+1]]),e.vertex.push(n.vertexPositions[r[c*3+2]]),n.skeleton&&(e.vertexWeights.push(a[0]),e.vertexWeights.push(a[1]),e.vertexWeights.push(a[2]),e.vertexWeights.push(a[3]),e.vertexWeights.push(a[(c-1)*4]),e.vertexWeights.push(a[(c-1)*4+1]),e.vertexWeights.push(a[(c-1)*4+2]),e.vertexWeights.push(a[(c-1)*4+3]),e.vertexWeights.push(a[c*4]),e.vertexWeights.push(a[c*4+1]),e.vertexWeights.push(a[c*4+2]),e.vertexWeights.push(a[c*4+3]),e.weightsIndices.push(u[0]),e.weightsIndices.push(u[1]),e.weightsIndices.push(u[2]),e.weightsIndices.push(u[3]),e.weightsIndices.push(u[(c-1)*4]),e.weightsIndices.push(u[(c-1)*4+1]),e.weightsIndices.push(u[(c-1)*4+2]),e.weightsIndices.push(u[(c-1)*4+3]),e.weightsIndices.push(u[c*4]),e.weightsIndices.push(u[c*4+1]),e.weightsIndices.push(u[c*4+2]),e.weightsIndices.push(u[c*4+3])),n.color&&(e.colors.push(o[0]),e.colors.push(o[1]),e.colors.push(o[2]),e.colors.push(o[(c-1)*3]),e.colors.push(o[(c-1)*3+1]),e.colors.push(o[(c-1)*3+2]),e.colors.push(o[c*3]),e.colors.push(o[c*3+1]),e.colors.push(o[c*3+2])),n.material&&n.material.mappingType!=="AllSame"&&(e.materialIndex.push(s),e.materialIndex.push(s),e.materialIndex.push(s)),n.normal&&(e.normal.push(i[0]),e.normal.push(i[1]),e.normal.push(i[2]),e.normal.push(i[(c-1)*3]),e.normal.push(i[(c-1)*3+1]),e.normal.push(i[(c-1)*3+2]),e.normal.push(i[c*3]),e.normal.push(i[c*3+1]),e.normal.push(i[c*3+2])),n.uv&&n.uv.forEach(function(p,d){e.uvs[d]===void 0&&(e.uvs[d]=[]),e.uvs[d].push(l[d][0]),e.uvs[d].push(l[d][1]),e.uvs[d].push(l[d][(c-1)*2]),e.uvs[d].push(l[d][(c-1)*2+1]),e.uvs[d].push(l[d][c*2]),e.uvs[d].push(l[d][c*2+1])})}addMorphTargets(e,n,r,s){if(r.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const i=this;r.forEach(function(o){o.rawTargets.forEach(function(l){const a=T.Objects.Geometry[l.geoID];a!==void 0&&i.genMorphGeometry(e,n,a,s,l.name)})})}genMorphGeometry(e,n,r,s,i){const o=n.PolygonVertexIndex!==void 0?n.PolygonVertexIndex.a:[],l=r.Vertices!==void 0?r.Vertices.a:[],a=r.Indexes!==void 0?r.Indexes.a:[],u=e.attributes.position.count*3,f=new Float32Array(u);for(let h=0;h<a.length;h++){const _=a[h]*3;f[_]=l[h*3],f[_+1]=l[h*3+1],f[_+2]=l[h*3+2]}const c={vertexIndices:o,vertexPositions:f},p=this.genBuffers(c),d=new Ee(p.vertex,3);d.name=i||r.attrName,d.applyMatrix4(s),e.morphAttributes.position.push(d)}parseNormals(e){const n=e.MappingInformationType,r=e.ReferenceInformationType,s=e.Normals.a;let i=[];return r==="IndexToDirect"&&("NormalIndex"in e?i=e.NormalIndex.a:"NormalsIndex"in e&&(i=e.NormalsIndex.a)),{dataSize:3,buffer:s,indices:i,mappingType:n,referenceType:r}}parseUVs(e){const n=e.MappingInformationType,r=e.ReferenceInformationType,s=e.UV.a;let i=[];return r==="IndexToDirect"&&(i=e.UVIndex.a),{dataSize:2,buffer:s,indices:i,mappingType:n,referenceType:r}}parseVertexColors(e){const n=e.MappingInformationType,r=e.ReferenceInformationType,s=e.Colors.a;let i=[];r==="IndexToDirect"&&(i=e.ColorIndex.a);for(let o=0,l=new $;o<s.length;o+=4)l.fromArray(s,o).convertSRGBToLinear().toArray(s,o);return{dataSize:4,buffer:s,indices:i,mappingType:n,referenceType:r}}parseMaterialIndices(e){const n=e.MappingInformationType,r=e.ReferenceInformationType;if(n==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:r};const s=e.Materials.a,i=[];for(let o=0;o<s.length;++o)i.push(o);return{dataSize:1,buffer:s,indices:i,mappingType:n,referenceType:r}}parseNurbsGeometry(e){const n=parseInt(e.Order);if(isNaN(n))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new St;const r=n-1,s=e.KnotVector.a,i=[],o=e.Points.a;for(let c=0,p=o.length;c<p;c+=4)i.push(new jt().fromArray(o,c));let l,a;if(e.Form==="Closed")i.push(i[0]);else if(e.Form==="Periodic"){l=r,a=s.length-1-l;for(let c=0;c<r;++c)i.push(i[c])}const f=new Kc(r,s,i,l,a).getPoints(i.length*12);return new St().setFromPoints(f)}}class Qc{parse(){const e=[],n=this.parseClips();if(n!==void 0)for(const r in n){const s=n[r],i=this.addClip(s);e.push(i)}return e}parseClips(){if(T.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const n=this.parseAnimationLayers(e);return this.parseAnimStacks(n)}parseAnimationCurveNodes(){const e=T.Objects.AnimationCurveNode,n=new Map;for(const r in e){const s=e[r];if(s.attrName.match(/S|R|T|DeformPercent/)!==null){const i={id:s.id,attr:s.attrName,curves:{}};n.set(i.id,i)}}return n}parseAnimationCurves(e){const n=T.Objects.AnimationCurve;for(const r in n){const s={id:n[r].id,times:n[r].KeyTime.a.map(rl),values:n[r].KeyValueFloat.a},i=R.get(s.id);if(i!==void 0){const o=i.parents[0].ID,l=i.parents[0].relationship;l.match(/X/)?e.get(o).curves.x=s:l.match(/Y/)?e.get(o).curves.y=s:l.match(/Z/)?e.get(o).curves.z=s:l.match(/DeformPercent/)&&e.has(o)&&(e.get(o).curves.morph=s)}}}parseAnimationLayers(e){const n=T.Objects.AnimationLayer,r=new Map;for(const s in n){const i=[],o=R.get(parseInt(s));o!==void 0&&(o.children.forEach(function(a,u){if(e.has(a.ID)){const f=e.get(a.ID);if(f.curves.x!==void 0||f.curves.y!==void 0||f.curves.z!==void 0){if(i[u]===void 0){const c=R.get(a.ID).parents.filter(function(p){return p.relationship!==void 0})[0].ID;if(c!==void 0){const p=T.Objects.Model[c.toString()];if(p===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",a);return}const d={modelName:p.attrName?Ct.sanitizeNodeName(p.attrName):"",ID:p.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};z.traverse(function(h){h.ID===p.id&&(d.transform=h.matrix,h.userData.transformData&&(d.eulerOrder=h.userData.transformData.eulerOrder))}),d.transform||(d.transform=new I),"PreRotation"in p&&(d.preRotation=p.PreRotation.value),"PostRotation"in p&&(d.postRotation=p.PostRotation.value),i[u]=d}}i[u]&&(i[u][f.attr]=f)}else if(f.curves.morph!==void 0){if(i[u]===void 0){const c=R.get(a.ID).parents.filter(function(y){return y.relationship!==void 0})[0].ID,p=R.get(c).parents[0].ID,d=R.get(p).parents[0].ID,h=R.get(d).parents[0].ID,_=T.Objects.Model[h],w={modelName:_.attrName?Ct.sanitizeNodeName(_.attrName):"",morphName:T.Objects.Deformer[c].attrName};i[u]=w}i[u][f.attr]=f}}}),r.set(parseInt(s),i))}return r}parseAnimStacks(e){const n=T.Objects.AnimationStack,r={};for(const s in n){const i=R.get(parseInt(s)).children;i.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const o=e.get(i[0].ID);r[s]={name:n[s].attrName,layer:o}}return r}addClip(e){let n=[];const r=this;return e.layer.forEach(function(s){n=n.concat(r.generateTracks(s))}),new Ts(e.name,-1,n)}generateTracks(e){const n=[];let r=new N,s=new Ne,i=new N;if(e.transform&&e.transform.decompose(r,s,i),r=r.toArray(),s=new Pe().setFromQuaternion(s,e.eulerOrder).toArray(),i=i.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const o=this.generateVectorTrack(e.modelName,e.T.curves,r,"position");o!==void 0&&n.push(o)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const o=this.generateRotationTrack(e.modelName,e.R.curves,s,e.preRotation,e.postRotation,e.eulerOrder);o!==void 0&&n.push(o)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const o=this.generateVectorTrack(e.modelName,e.S.curves,i,"scale");o!==void 0&&n.push(o)}if(e.DeformPercent!==void 0){const o=this.generateMorphTrack(e);o!==void 0&&n.push(o)}return n}generateVectorTrack(e,n,r,s){const i=this.getTimesForAllAxes(n),o=this.getKeyframeTrackValues(i,n,r);return new $o(e+"."+s,i,o)}generateRotationTrack(e,n,r,s,i,o){n.x!==void 0&&(this.interpolateRotations(n.x),n.x.values=n.x.values.map(oe.degToRad)),n.y!==void 0&&(this.interpolateRotations(n.y),n.y.values=n.y.values.map(oe.degToRad)),n.z!==void 0&&(this.interpolateRotations(n.z),n.z.values=n.z.values.map(oe.degToRad));const l=this.getTimesForAllAxes(n),a=this.getKeyframeTrackValues(l,n,r);s!==void 0&&(s=s.map(oe.degToRad),s.push(o),s=new Pe().fromArray(s),s=new Ne().setFromEuler(s)),i!==void 0&&(i=i.map(oe.degToRad),i.push(o),i=new Pe().fromArray(i),i=new Ne().setFromEuler(i).invert());const u=new Ne,f=new Pe,c=[];for(let p=0;p<a.length;p+=3)f.set(a[p],a[p+1],a[p+2],o),u.setFromEuler(f),s!==void 0&&u.premultiply(s),i!==void 0&&u.multiply(i),u.toArray(c,p/3*4);return new Uo(e+".quaternion",l,c)}generateMorphTrack(e){const n=e.DeformPercent.curves.morph,r=n.values.map(function(i){return i/100}),s=z.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new zo(e.modelName+".morphTargetInfluences["+s+"]",n.times,r)}getTimesForAllAxes(e){let n=[];if(e.x!==void 0&&(n=n.concat(e.x.times)),e.y!==void 0&&(n=n.concat(e.y.times)),e.z!==void 0&&(n=n.concat(e.z.times)),n=n.sort(function(r,s){return r-s}),n.length>1){let r=1,s=n[0];for(let i=1;i<n.length;i++){const o=n[i];o!==s&&(n[r]=o,s=o,r++)}n=n.slice(0,r)}return n}getKeyframeTrackValues(e,n,r){const s=r,i=[];let o=-1,l=-1,a=-1;return e.forEach(function(u){if(n.x&&(o=n.x.times.indexOf(u)),n.y&&(l=n.y.times.indexOf(u)),n.z&&(a=n.z.times.indexOf(u)),o!==-1){const f=n.x.values[o];i.push(f),s[0]=f}else i.push(s[0]);if(l!==-1){const f=n.y.values[l];i.push(f),s[1]=f}else i.push(s[1]);if(a!==-1){const f=n.z.values[a];i.push(f),s[2]=f}else i.push(s[2])}),i}interpolateRotations(e){for(let n=1;n<e.values.length;n++){const r=e.values[n-1],s=e.values[n]-r,i=Math.abs(s);if(i>=180){const o=i/180,l=s/o;let a=r+l;const u=e.times[n-1],c=(e.times[n]-u)/o;let p=u+c;const d=[],h=[];for(;p<e.times[n];)d.push(p),p+=c,h.push(a),a+=l;e.times=es(e.times,n,d),e.values=es(e.values,n,h)}}}}class Jc{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,n){this.currentProp=e,this.currentPropName=n}parse(e){this.currentIndent=0,this.allNodes=new zi,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const n=this,r=e.split(/[\r\n]+/);return r.forEach(function(s,i){const o=s.match(/^[\s\t]*;/),l=s.match(/^[\s\t]*$/);if(o||l)return;const a=s.match("^\\t{"+n.currentIndent+"}(\\w+):(.*){",""),u=s.match("^\\t{"+n.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),f=s.match("^\\t{"+(n.currentIndent-1)+"}}");a?n.parseNodeBegin(s,a):u?n.parseNodeProperty(s,u,r[++i]):f?n.popStack():s.match(/^[^\s\t}]/)&&n.parseNodePropertyContinued(s)}),this.allNodes}parseNodeBegin(e,n){const r=n[1].trim().replace(/^"/,"").replace(/"$/,""),s=n[2].split(",").map(function(a){return a.trim().replace(/^"/,"").replace(/"$/,"")}),i={name:r},o=this.parseNodeAttr(s),l=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(r,i):r in l?(r==="PoseNode"?l.PoseNode.push(i):l[r].id!==void 0&&(l[r]={},l[r][l[r].id]=l[r]),o.id!==""&&(l[r][o.id]=i)):typeof o.id=="number"?(l[r]={},l[r][o.id]=i):r!=="Properties70"&&(r==="PoseNode"?l[r]=[i]:l[r]=i),typeof o.id=="number"&&(i.id=o.id),o.name!==""&&(i.attrName=o.name),o.type!==""&&(i.attrType=o.type),this.pushStack(i)}parseNodeAttr(e){let n=e[0];e[0]!==""&&(n=parseInt(e[0]),isNaN(n)&&(n=e[0]));let r="",s="";return e.length>1&&(r=e[1].replace(/^(\w+)::/,""),s=e[2]),{id:n,name:r,type:s}}parseNodeProperty(e,n,r){let s=n[1].replace(/^"/,"").replace(/"$/,"").trim(),i=n[2].replace(/^"/,"").replace(/"$/,"").trim();s==="Content"&&i===","&&(i=r.replace(/"/g,"").replace(/,$/,"").trim());const o=this.getCurrentNode();if(o.name==="Properties70"){this.parseNodeSpecialProperty(e,s,i);return}if(s==="C"){const a=i.split(",").slice(1),u=parseInt(a[0]),f=parseInt(a[1]);let c=i.split(",").slice(3);c=c.map(function(p){return p.trim().replace(/^"/,"")}),s="connections",i=[u,f],il(i,c),o[s]===void 0&&(o[s]=[])}s==="Node"&&(o.id=i),s in o&&Array.isArray(o[s])?o[s].push(i):s!=="a"?o[s]=i:o.a=i,this.setCurrentProp(o,s),s==="a"&&i.slice(-1)!==","&&(o.a=mn(i))}parseNodePropertyContinued(e){const n=this.getCurrentNode();n.a+=e,e.slice(-1)!==","&&(n.a=mn(n.a))}parseNodeSpecialProperty(e,n,r){const s=r.split('",').map(function(f){return f.trim().replace(/^\"/,"").replace(/\s/,"_")}),i=s[0],o=s[1],l=s[2],a=s[3];let u=s[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":u=parseFloat(u);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":u=mn(u);break}this.getPrevNode()[i]={type:o,type2:l,flag:a,value:u},this.setCurrentProp(this.getPrevNode(),i)}}class el{parse(e){const n=new Qr(e);n.skip(23);const r=n.getUint32();if(r<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+r);const s=new zi;for(;!this.endOfContent(n);){const i=this.parseNode(n,r);i!==null&&s.add(i.name,i)}return s}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,n){const r={},s=n>=7500?e.getUint64():e.getUint32(),i=n>=7500?e.getUint64():e.getUint32();n>=7500?e.getUint64():e.getUint32();const o=e.getUint8(),l=e.getString(o);if(s===0)return null;const a=[];for(let p=0;p<i;p++)a.push(this.parseProperty(e));const u=a.length>0?a[0]:"",f=a.length>1?a[1]:"",c=a.length>2?a[2]:"";for(r.singleProperty=i===1&&e.getOffset()===s;s>e.getOffset();){const p=this.parseNode(e,n);p!==null&&this.parseSubNode(l,r,p)}return r.propertyList=a,typeof u=="number"&&(r.id=u),f!==""&&(r.attrName=f),c!==""&&(r.attrType=c),l!==""&&(r.name=l),r}parseSubNode(e,n,r){if(r.singleProperty===!0){const s=r.propertyList[0];Array.isArray(s)?(n[r.name]=r,r.a=s):n[r.name]=s}else if(e==="Connections"&&r.name==="C"){const s=[];r.propertyList.forEach(function(i,o){o!==0&&s.push(i)}),n.connections===void 0&&(n.connections=[]),n.connections.push(s)}else if(r.name==="Properties70")Object.keys(r).forEach(function(i){n[i]=r[i]});else if(e==="Properties70"&&r.name==="P"){let s=r.propertyList[0],i=r.propertyList[1];const o=r.propertyList[2],l=r.propertyList[3];let a;s.indexOf("Lcl ")===0&&(s=s.replace("Lcl ","Lcl_")),i.indexOf("Lcl ")===0&&(i=i.replace("Lcl ","Lcl_")),i==="Color"||i==="ColorRGB"||i==="Vector"||i==="Vector3D"||i.indexOf("Lcl_")===0?a=[r.propertyList[4],r.propertyList[5],r.propertyList[6]]:a=r.propertyList[4],n[s]={type:i,type2:o,flag:l,value:a}}else n[r.name]===void 0?typeof r.id=="number"?(n[r.name]={},n[r.name][r.id]=r):n[r.name]=r:r.name==="PoseNode"?(Array.isArray(n[r.name])||(n[r.name]=[n[r.name]]),n[r.name].push(r)):n[r.name][r.id]===void 0&&(n[r.name][r.id]=r)}parseProperty(e){const n=e.getString(1);let r;switch(n){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return r=e.getUint32(),e.getArrayBuffer(r);case"S":return r=e.getUint32(),e.getString(r);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const s=e.getUint32(),i=e.getUint32(),o=e.getUint32();if(i===0)switch(n){case"b":case"c":return e.getBooleanArray(s);case"d":return e.getFloat64Array(s);case"f":return e.getFloat32Array(s);case"i":return e.getInt32Array(s);case"l":return e.getInt64Array(s)}const l=jc(new Uint8Array(e.getArrayBuffer(o))),a=new Qr(l.buffer);switch(n){case"b":case"c":return a.getBooleanArray(s);case"d":return a.getFloat64Array(s);case"f":return a.getFloat32Array(s);case"i":return a.getInt32Array(s);case"l":return a.getInt64Array(s)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+n)}}}class Qr{constructor(e,n){this.dv=new DataView(e),this.offset=0,this.littleEndian=n!==void 0?n:!0,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const n=[];for(let r=0;r<e;r++)n.push(this.getBoolean());return n}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const n=[];for(let r=0;r<e;r++)n.push(this.getInt32());return n}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,n;return this.littleEndian?(e=this.getUint32(),n=this.getUint32()):(n=this.getUint32(),e=this.getUint32()),n&2147483648?(n=~n&4294967295,e=~e&4294967295,e===4294967295&&(n=n+1&4294967295),e=e+1&4294967295,-(n*4294967296+e)):n*4294967296+e}getInt64Array(e){const n=[];for(let r=0;r<e;r++)n.push(this.getInt64());return n}getUint64(){let e,n;return this.littleEndian?(e=this.getUint32(),n=this.getUint32()):(n=this.getUint32(),e=this.getUint32()),n*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const n=[];for(let r=0;r<e;r++)n.push(this.getFloat32());return n}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const n=[];for(let r=0;r<e;r++)n.push(this.getFloat64());return n}getArrayBuffer(e){const n=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,n}getString(e){const n=this.offset;let r=new Uint8Array(this.dv.buffer,n,e);this.skip(e);const s=r.indexOf(0);return s>=0&&(r=new Uint8Array(this.dv.buffer,n,s)),this._textDecoder.decode(r)}}class zi{add(e,n){this[e]=n}}function tl(t){const e="Kaydara FBX Binary  \0";return t.byteLength>=e.length&&e===Wi(t,0,e.length)}function nl(t){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let n=0;function r(s){const i=t[s-1];return t=t.slice(n+s),n++,i}for(let s=0;s<e.length;++s)if(r(1)===e[s])return!1;return!0}function Jr(t){const e=/FBXVersion: (\d+)/,n=t.match(e);if(n)return parseInt(n[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function rl(t){return t/46186158e3}const sl=[];function wt(t,e,n,r){let s;switch(r.mappingType){case"ByPolygonVertex":s=t;break;case"ByPolygon":s=e;break;case"ByVertice":s=n;break;case"AllSame":s=r.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+r.mappingType)}r.referenceType==="IndexToDirect"&&(s=r.indices[s]);const i=s*r.dataSize,o=i+r.dataSize;return ol(sl,r.buffer,i,o)}const hn=new Pe,Fe=new N;function Vi(t){const e=new I,n=new I,r=new I,s=new I,i=new I,o=new I,l=new I,a=new I,u=new I,f=new I,c=new I,p=new I,d=t.inheritType?t.inheritType:0;if(t.translation&&e.setPosition(Fe.fromArray(t.translation)),t.preRotation){const L=t.preRotation.map(oe.degToRad);L.push(t.eulerOrder||Pe.DEFAULT_ORDER),n.makeRotationFromEuler(hn.fromArray(L))}if(t.rotation){const L=t.rotation.map(oe.degToRad);L.push(t.eulerOrder||Pe.DEFAULT_ORDER),r.makeRotationFromEuler(hn.fromArray(L))}if(t.postRotation){const L=t.postRotation.map(oe.degToRad);L.push(t.eulerOrder||Pe.DEFAULT_ORDER),s.makeRotationFromEuler(hn.fromArray(L)),s.invert()}t.scale&&i.scale(Fe.fromArray(t.scale)),t.scalingOffset&&l.setPosition(Fe.fromArray(t.scalingOffset)),t.scalingPivot&&o.setPosition(Fe.fromArray(t.scalingPivot)),t.rotationOffset&&a.setPosition(Fe.fromArray(t.rotationOffset)),t.rotationPivot&&u.setPosition(Fe.fromArray(t.rotationPivot)),t.parentMatrixWorld&&(c.copy(t.parentMatrix),f.copy(t.parentMatrixWorld));const h=n.clone().multiply(r).multiply(s),_=new I;_.extractRotation(f);const w=new I;w.copyPosition(f);const y=w.clone().invert().multiply(f),v=_.clone().invert().multiply(y),g=i,P=new I;if(d===0)P.copy(_).multiply(h).multiply(v).multiply(g);else if(d===1)P.copy(_).multiply(v).multiply(h).multiply(g);else{const ge=new I().scale(new N().setFromMatrixScale(c)).clone().invert(),le=v.clone().multiply(ge);P.copy(_).multiply(h).multiply(le).multiply(g)}const b=u.clone().invert(),x=o.clone().invert();let O=e.clone().multiply(a).multiply(u).multiply(n).multiply(r).multiply(s).multiply(b).multiply(l).multiply(o).multiply(i).multiply(x);const A=new I().copyPosition(O),M=f.clone().multiply(A);return p.copyPosition(M),O=p.clone().multiply(P),O.premultiply(f.invert()),O}function Hi(t){t=t||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return t===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[t]}function mn(t){return t.split(",").map(function(n){return parseFloat(n)})}function Wi(t,e,n){return e===void 0&&(e=0),n===void 0&&(n=t.byteLength),new TextDecoder().decode(new Uint8Array(t,e,n))}function il(t,e){for(let n=0,r=t.length,s=e.length;n<s;n++,r++)t[r]=e[n]}function ol(t,e,n,r){for(let s=n,i=0;s<r;s++,i++)t[i]=e[s];return t}function es(t,e,n){return t.slice(0,e).concat(n).concat(t.slice(e))}const Gi=t=>t&&new Promise(e=>{new Yc().load(t,e)}),Xi=t=>t&&new Promise(e=>{new Ke().load(t,e)}),al=["px.png","nx.png","py.png","ny.png","pz.png","nz.png"],cl=t=>t&&new Promise(e=>{new Vo().setPath(`${t}/`).load(al,e)}),ll=["c100007_01","c100007_05","c100007_09","c100034_01","c100035_01","c100036_01","c100037_01","c100041_01"],ul=async t=>await(await fetch(t)).json(),Kt=async t=>(await ul(t)).data,fl=(...t)=>e=>t.reduce((n,r)=>r(n),e),pl=t=>[...new Set(t)],de=t=>t==="false"?!1:!!t,Ki=(t,e,n)=>{if(!e.length)return;const r=e.pop(),s=e.reduce((i,o)=>i==null?void 0:i[o],t);s&&(s[r]=n)};function Qn(t){return!!/[0-9A-Fa-f]{6}/.test(t)}function At(t){return Qn(t)&&!t.startsWith("#")?new $(`#${t}`):new $(t)}async function dl(t=100){return await new Promise(e=>setTimeout(e,t))}function Yi(t,e="="){const[n,...r]=t.split(e),s=r.join(e);return[n,s]}const hl=t=>t.startsWith("w302"),ts=([t,...e])=>`${t.toUpperCase()}${e.join("")}`;function ml(t){return t==="smith"?"dragon":t.endsWith("h")?"story":ll.includes(t)?"spAdventurer":{c:"adventurer",b:"boss",d:"dragon",e:"enemy",h:"high boss",o:"object",r:"raid boss",w:"weapon"}[t[0]]??"other"}function _l(t=Bl){const e=new Ho(t);return e.outputColorSpace=Q,e}function gl(t={}){const{fov:e,aspect:n,near:r,far:s}={...Nl,...t};return new Es(e,n,r,s)}async function yl(t){if(t.startsWith("img:")){const e=t.replace("img:",""),n=await Xi(e);return n.colorSpace=Q,n.center.set(.5,0),n}if(t.startsWith("sky:")){const e=t.replace("sky:",""),n=await cl(e);return n.colorSpace=Q,n}if(t==="transparent")return null;if(Qn(t)){const e=t.startsWith("#")?t:`#${t}`;return new $(e)}}function vl(t){var e,n,r,s;(n=(e=t.map)==null?void 0:e.dispose)==null||n.call(e),(s=(r=t.userData.backupMap)==null?void 0:r.dispose)==null||s.call(r),t.dispose()}const qi=t=>{const e=new Ke().load(t);return e.colorSpace=Q,e};function wl(t){const e=[],n=[];return t.traverse(r=>{r.isMesh&&e.push(r),r.isBone&&n.push(r)}),[e,n]}function bl(t){var n,r;if(!t)return;[t.material].flat().forEach(s=>{var i,o,l,a,u,f;(o=(i=s.map)==null?void 0:i.dispose)==null||o.call(i),(u=(a=(l=s.userData)==null?void 0:l.backupMap)==null?void 0:a.dispose)==null||u.call(a),(f=s.dispose)==null||f.call(s)}),(r=(n=t.geometry)==null?void 0:n.dispose)==null||r.call(n)}const El=()=>{const t=new Date,e=t.toDateString().replaceAll(" ","_"),n=t.toLocaleTimeString().replaceAll(":","-").replaceAll(" ","");return`${e}_${n}`},Zi=t=>t?t.split("/").reduce((n,r)=>{const[s,i]=r.split("=");return s&&i&&(n[s]=i),n},{}):{},Pl=`
varying vec3 vViewPosition;

struct BlinnPhongMaterial {

	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;

};

void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {

	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;

	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );

	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;

}

void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {

	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );

}

#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
`,Sl=`
#ifdef USE_MATCAP

	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks
	vec4 matcapColor = texture2D( matcap, uv );

	#ifdef MATCAP_BLENDING_MULTIPLY

		outgoingLight *= matcapColor.rgb;

	#elif defined( MATCAP_BLENDING_ADD )

		outgoingLight += matcapColor.rgb;

	#endif

#endif
`,bt={defines:{TOON:!0,MATCAP:!0,MATCAP_BLENDING_ADD:!0},uniforms:$n.merge([tt.toon.uniforms,tt.phong.uniforms,tt.matcap.uniforms]),vertexShader:tt.phong.vertexShader.replace("#include <envmap_pars_vertex>","").replace("#include <envmap_vertex>",""),fragmentShader:tt.phong.fragmentShader.replace("#include <common>",`
					#ifdef USE_MATCAP
						uniform sampler2D matcap;
					#endif

					#include <common>
				`).replace("#include <envmap_common_pars_fragment>",`
					#include <gradientmap_pars_fragment>
				`).replace("#include <envmap_pars_fragment>","").replace("#include <lights_phong_pars_fragment>",Pl).replace("#include <envmap_fragment>",`
					${Sl}
				`)};class Qi extends st{constructor(e){super(),this._matcapCombine=yr,this.emissiveIntensity=1,this.normalMapType=Wo,this.combine=vr,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.lights=!0,this.vertexShader=bt.vertexShader,this.fragmentShader=bt.fragmentShader,this.defines=Object.assign({},bt.defines),Object.defineProperty(this,"matcapCombine",{get:function(){return this._matcapCombine},set:function(r){switch(this._matcapCombine=r,r){case vr:this.defines.MATCAP_BLENDING_MULTIPLY=!0,delete this.defines.MATCAP_BLENDING_ADD;break;default:case yr:this.defines.MATCAP_BLENDING_ADD=!0,delete this.defines.MATCAP_BLENDING_MULTIPLY;break}}}),this.uniforms=$n.clone(bt.uniforms);const n=["specular","shininess","opacity","diffuse","map","matcap","gradientMap","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveMap","bumpMap","bumpScale","normalMap","normalScale","displacemantBias","displacemantMap","displacemantScale","specularMap","alphaMap","envMap","reflectivity","refractionRatio"];for(const r of n)Object.defineProperty(this,r,{get:function(){return this.uniforms[r].value},set:function(s){this.uniforms[r].value=s}});Object.defineProperty(this,"color",Object.getOwnPropertyDescriptor(this,"diffuse")),this.setValues(e)}copy(e){return super.copy(e),this.matcapCombine=e.matcapCombine,this.emissiveIntensity=e.emissiveIntensity,this.normalMapType=e.normalMapType,this.combine=e.combine,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}Qi.prototype.isMMDToonMaterial=!0;const xl=["color","emissive","specular"],Tl=["wireframe","metalness","opacity","roughness","shininess","transparent","emissiveIntensity","transmission","thickness","ior"],Ji=["type","flatShading","showTexture","gradientMap","matcap"],Al=[...xl,...Tl,...Ji],Ml=["transparent","opacity","wireframe","showTexture","color"],Cl={Basic:[],Toon:["emissive","emissiveIntensity","gradientMap"],Lambert:["emissive","emissiveIntensity"],Phong:["emissive","emissiveIntensity","specular","shininess","flatShading"],Standard:["emissive","emissiveIntensity","metalness","roughness","flatShading"],Physical:["emissive","emissiveIntensity","metalness","roughness","flatShading","transmission","thickness","ior"],Matcap:["flatShading","matcap"],MMDToon:["emissive","emissiveIntensity","specular","shininess","matcap","gradientMap","flatShading"]},G=t=>`${t}`,_n=t=>Qn(t)?`${t.startsWith("#")?"":"#"}${t}`:t,Ll=t=>Array.isArray(t)?t.join(","):t,Jn={wireframe:{name:"Wireframe",type:"boolean",default:!1,valueMap:de,toString:G},showTexture:{name:"Texture",type:"boolean",default:!0,valueMap:de,toString:G},transparent:{name:"Transparent",type:"boolean",default:!1,valueMap:de,toString:G},flatShading:{name:"Flat Shading",type:"boolean",default:!1,valueMap:de,toString:G},color:{name:"Color",type:"color",default:"#ffffff",valueMap:At,toString:_n},emissive:{name:"Emissive",type:"color",default:"#000000",valueMap:At,toString:_n},opacity:{name:"Opacity",type:"percentage",default:1,min:0,max:1,valueMap:parseFloat,toString:G},emissiveIntensity:{name:"Emissive Intensity",type:"percentage",default:1,min:0,max:1,valueMap:parseFloat,toString:G},specular:{name:"Specular",type:"color",default:"#111111",valueMap:At,toString:_n},metalness:{name:"Metalness",type:"percentage",default:0,min:0,max:1,valueMap:parseFloat,toString:G},roughness:{name:"Roughness",type:"percentage",default:1,min:0,max:1,valueMap:parseFloat,toString:G},shininess:{name:"Shininess",type:"number",default:30,min:1,max:100,valueMap:parseFloat,toString:G},gradientMap:{name:"Gradient Map",type:"select",default:"none",valueMap:eo,toString:Ll},matcap:{name:"Matcap",type:"select",default:"matcap_fresnel.jpg",valueMap:to,toString:G},transmission:{name:"Transmission",type:"number",default:1,min:0,max:1,valueMap:parseFloat,toString:G},thickness:{name:"Thickness",type:"number",default:.01,min:0,max:10,valueMap:parseFloat,toString:G},ior:{name:"Index-of-refraction",type:"number",default:1.5,min:1,max:2.333,valueMap:parseFloat,toString:G}},kl=Object.fromEntries(Object.entries(Jn).map(([t,{default:e}])=>[t,e])),Ae={...kl,type:"Basic"},Dl=Object.fromEntries(Object.entries(Jn).map(([t,{valueMap:e}])=>[t,e])),Ol=Object.fromEntries(Object.entries(Jn).map(([t,{toString:e}])=>[t,e])),gn=t=>[...Ml,...Cl[t]],Il=(t,e={})=>{if(t==="MMDToon")return new Qi(e);const n=`Mesh${t}Material`;return new As[n](e)},ns=(t,{matType:e="Basic",texturePath:n="",force:r=!1}={})=>{t.forEach(s=>{const i=[s.material].flat(),o=Array.isArray(s.material);if(!r&&!n){const l=`isMesh${e}Material`;if(!i.some(u=>!u[l]))return}i.forEach((l,a)=>{var c,p,d,h;const u=n?new Ke().load(n):i[a].map;n&&(u.colorSpace=Q);const f=Il(e);if(f.name=l.name,f.map=u,f.userData.backupMap=l.userData.backupMap,n&&((p=(c=l.map)==null?void 0:c.dispose)==null||p.call(c),(h=(d=l.userData.backupMap)==null?void 0:d.dispose)==null||h.call(d)),l.dispose(),o){s.material[a]=f;return}s.material=f})})},Rl=t=>Array.isArray(t)?t:t.split(",").map(e=>parseInt(e));function eo(t){const e=Rl(t),n=e.length;if(n<2)return null;const r=Uint8Array.from(e),s=new Go(r,n,1,Xo);return s.minFilter=s.magFilter=Ko,s.generateMipmaps=!1,s}const Fl=t=>t.includes("/")||t.includes(":")?t:`${Tc}/${t}`;function to(t){const e=Fl(t);return e?qi(e):null}const Bl={alpha:!0,antialias:!0},jl="#cccccc",Nl={type:"Perspective",fov:45,aspect:1,far:300,near:.01},$l="c100001_01",je={enabled:!0,size:5,color:"#000000",opacity:1},Ul={noBackground:!0,fileName:"screenshot",frameRate:30},zl={frameRate:30,fileName:"ani",appendDate:!0},rs=1,Rn=30,Vl={directional:{color:"#ffffff",intensity:.8,position:[1,0,2]},ambient:{color:"#444444",intensity:1},point:{color:"#ffffff",intensity:1}},yn={"No Mapping":Yo,Linear:qo,Reinhard:Zo,Cineon:Qo,"ACES Filmic":Jo},dt={addEventListener(t,e){if(!e)return;this._listeners??(this._listeners={});const n=this._listeners;return t=t.toLowerCase(),n[t]??(n[t]=[]),n[t].includes(e)||n[t].push(e),e},hasEventListener(t,e){var n,r;return t=t.toLowerCase(),!!((r=(n=this._listeners)==null?void 0:n[t])!=null&&r.includes(e))},removeEventListener(t,e){var s;t=t.toLowerCase();const n=(s=this._listeners)==null?void 0:s[t];if(!n)return;const r=n.indexOf(e);r!==-1&&n.splice(r,1)},dispatchEvent(t){var s,i;const e=(s=t.type)==null?void 0:s.toLowerCase(),n=(i=this._listeners)==null?void 0:i[e];if(!n)return;t.target=this,[...n].forEach(o=>o.call(this,t))},addCountedEventListener(t,e,n=1){const r=this;function s(i){e.call(r,i),n--,n===0&&r.removeEventListener(t,s)}this.addEventListener(t,s)}},Hl={face1:[2,1],face2:[0,0],face3:[1,0],face4:[2,0],face5:[3,0],face6:[0,-1],face7:[1,-1],face8:[2,-1],face9:[3,-1]},no={},Wl=async()=>{const t=await Kt(`${Xt}/face-offset.json`);Object.assign(no,t)},ss=t=>no[t]||[0,0],Fn={},Gl=async()=>{const t=await Kt(`${Xt}/camera-position.json`);Object.assign(Fn,t)},Xl=t=>Fn[t]??Fn[t[0]],Bn={},Kl=async()=>{const t=await Kt(`${Xt}/control-position.json`);Object.assign(Bn,t)},Yl=t=>Bn[t]??Bn[t[0]],is=t=>Hl[`face${t}`],ql=(t,e)=>{const n={x:0,y:0};if(t!==e){const[r,s]=is(e),[i,o]=is(t);n.x=i-r,n.y=o-s}return[n.x,n.y]},Zl=(t,e)=>{const n={x:0,y:0};if(t!==e){const[r,s]=ss(e),[i,o]=ss(t);n.x=i-r,n.y=o-s}return[n.x,n.y]},Yt=t=>new Proxy(Object.assign(t,dt),{get(e,n){return e[n]},set(e,n,r){return e[n]=r,e.dispatchEvent({type:"change",propName:n,value:r}),!0}}),ro=/mEye_[0-9]/m,so=/mMouth_[0-9]/m,Ql=/[0-9]{2}/,io=["eye","mouth"];function Jl(t){const{type:e,meshes:n}=t;return e==="adventurer"?eu(t):n.some(({name:s})=>s.match(/mEye|mMouth/))?tu(t):t}function eu(t){const{meshes:e,id:n}=t,r=u=>`${Oi}/${u}/${u}.png`,s=e.find(({name:u})=>u==="mBodyAll"),i={eyeIdx:2,eyeBaseIdx:2,mouthIdx:2,mouthBaseIdx:2,eyeTexture:n,mouthTexture:n},o={type:"uv",reset:function(){this.eyeIdx=this.eyeBaseIdx,this.mouthIdx=this.mouthBaseIdx}},l=u=>([f,c])=>{var v;if(!s)return;const p=`mt${ts(u)}CH`,d=(v=s.geometry.groups)==null?void 0:v.find(g=>{var P;return((P=s.material[g.materialIndex])==null?void 0:P.name)===p});if(!d)return;const{start:h,count:_}=d,w=h+_,y=s.geometry.attributes.uv;for(let g=h;g<w;g++){const P=y.getX(g)+.25*f,b=y.getY(g)+.25*c;y.setXY(g,P,b)}y.needsUpdate=!0},a=u=>f=>{var h,_;if(!s)return;const c=`mt${ts(u)}CH`,p=(_=(h=s.material).find)==null?void 0:_.call(h,({name:w})=>w===c);if(!p)return;const d=r(f);p.map.dispose(),p.map=qi(d),p.needsUpdate=!0};return io.forEach(u=>{Object.defineProperties(o,{[`${u}Idx`]:{get(){return i[`${u}Idx`]},set(f){const c=parseInt(f),p=this[`${u}Idx`];i[`${u}Idx`]=c;const d=ql(c,p);l(u)(d)}},[`${u}BaseIdx`]:{get(){return i[`${u}BaseIdx`]},set(f){i[`${u}BaseIdx`]=f,this[`${u}Idx`]=f}},[`${u}Texture`]:{get(){return i[`${u}Texture`]},set(f){const c=this[`${u}Texture`];i[`${u}Texture`]=f,a(u)(f);const p=Zl(f,c);l(u)(p)}}})}),t.face=Yt(o),t}function tu(t){const{meshes:e}=t,[n,r]=nu(e);[...n,...r].forEach(a=>a.frustumCulled=!1);const s={eye:n,mouth:r},i={eyeIdx:"",eyeBaseIdx:"",mouthIdx:"",mouthBaseIdx:""},o={eyeList:n,mouthList:r,type:"meshes",reset:function(){this.eyeIdx=this.eyeBaseIdx,this.mouthIdx=this.mouthBaseIdx}},l=a=>u=>{s[a].forEach(f=>{const{name:c}=f,p=Ql.exec(c)[0];f.visible=parseInt(p)===u})};return io.forEach(a=>Object.defineProperties(o,{[`${a}Idx`]:{get(){return i[`${a}Idx`]},set(u){const f=parseInt(u);l(a)(f),i[`${a}Idx`]=`${f}`}},[`${a}BaseIdx`]:{get(){return i[`${a}BaseIdx`]},set(u){i[`${a}BaseIdx`]=u,this[`${a}Idx`]=u}}})),o.eyeBaseIdx=rs,o.mouthBaseIdx=rs,t.face=Yt(o),t}function nu(t){const e=t.filter(({name:r})=>r.match(ro)),n=t.filter(({name:r})=>r.match(so));return[e,n]}function ru(t){const{model:e,uniqueId:n}=t,[r,s]=wl(e);return Object.defineProperty(s,"list",{value:pl(s.map(({name:i})=>i))}),Object.defineProperty(r,"visible",{get(){return this.filter(({visible:i})=>i)}}),s.forEach(i=>{i.name=`${n}|${i.name}`}),Object.defineProperties(t,{meshes:{get(){return r}},bones:{get(){return s}}})}const oo={},su=async()=>{const t=await Kt(`${Xt}/model-parts.json`);Object.assign(oo,t)},iu=t=>oo[t],ou=/mParts([A-Za-z]+)/,os=/mParts[A-Za-z]+_([A-Za-z]*)/;function au(t){const{meshes:e,id:n}=t,r=iu(n),s=[],i=[];if(e.forEach(u=>{var c;let{name:f}=u;if(f!=null&&f.match){if((f.includes("Effect")||f.includes("Extension"))&&(u.visible=!1),(c=r==null?void 0:r.custom)!=null&&c[f]&&(f=u.name=r.custom[f]),f.match(/mParts/)){s.push(u);return}!f.match(ro)&&!f.match(so)&&i.push(u)}}),!s.length&&i.length<2)return t;const o=Object.defineProperties({},{list:{get(){return Object.keys(this)},enumerable:!1},reset:{value:function(){this.list.forEach(u=>this[u].reset())},enumerable:!1},others:{get(){return i},enumerable:!1}});if(t.parts=o,!s.length)return t;const l=new Set(s.map(({name:u})=>{var f;return(f=ou.exec(u))==null?void 0:f[1]}).sort((u,f)=>u>f?1:-1)),a=u=>s.filter(({name:f})=>f.includes(`mParts${u}`)).sort((f,c)=>f.name>c.name?1:-1);return l.forEach(u=>{var w;const f=r==null?void 0:r[u],c=((w=f==null?void 0:f.name)==null?void 0:w.replaceAll(" ","_"))??u,p=f==null?void 0:f.options,d=a(u);d.forEach(y=>y.frustumCulled=!1);const h=d.map(({name:y})=>{var g;const v=((g=os.exec(y))==null?void 0:g[1])??"default";return(p==null?void 0:p[v])??v}),_=(f==null?void 0:f.default)??h[0];o[c]={_meshes:d,list:h,default:_??h[0]},Object.defineProperties(o[c],{current:{get(){var b;const y=d.filter(({visible:x})=>x).length;if(y===0)return"None";if(y!==1)return"custom";const g=(b=d.find(({visible:x})=>x).name.match(os))==null?void 0:b[1];return(p==null?void 0:p[g??"default"])??g??"default"},set(y){if(y.toLowerCase()==="none"){this._meshes.forEach((g,P)=>{g.visible=!1});return}if(!this.list.includes(y))return;const v=this.list.indexOf(y);this._meshes.forEach((g,P)=>{g.visible=P===v})}},index:{get(){return this.current==="custom"?NaN:this.list.indexOf(this.current)},set(y){this._meshes.forEach((v,g)=>{v.visible=g===Number(y)})}},reset:{value:function(){this.current=this.default}}})}),o.reset(),t.parts=o,t}const cu=t=>e=>{const n=e.meshes,r={...Ae,...t},{type:s}=r;ns(n,{force:!0,matType:s});let i={type:s,showTexture:!0},o=gn(s);const l={get code(){const{type:a,propList:u}=this,f=[];return a!==Ae.type&&f.push(`type=${a}`),u.forEach(p=>{const d=Ol[p],h=d(this[p]),_=d(Ae[p]);h!==_&&f.push(`${p}=${h}`)}),f.join("/").replaceAll("#","")},set code(a){const u=Object.keys(Ae),f={...Ae,...Zi(a)};u.forEach(c=>{this[c]=f[c]})},toString(){const{code:a}=this;return a?`mat=(${a})`:""},get list(){return n.flatMap(({material:a})=>a)},get propList(){return o},set type(a){if(this.type===a)return;o=gn(a),ns(n,{matType:a}),i.type=a;const u={...i};i={showTexture:u.showTexture},o.forEach(f=>this[f]=u[f]),i=u},set flatShading(a){const u=de(a);u!==this.flatShading&&(i.flatShading=u,this.propList.includes("flatShading")&&this.list.forEach(f=>{f.flatShading=u,f.needsUpdate=!0}))},set gradientMap(a){var c,p;if(a===this.gradientMap||(i.gradientMap=a,!this.propList.includes("gradientMap")))return;const u=(c=this.list[0])==null?void 0:c.gradientMap;(p=u==null?void 0:u.dispose)==null||p.call(u);const f=a==="none"?null:eo(a);this.list.forEach(d=>{d.gradientMap=f,d.needsUpdate=!0})},set showTexture(a){const u=de(a);if(this.showTexture===u)return;i.showTexture=u;const f=u?c=>{c.map=c.userData.backupMap,c.userData.backupMap=null,c.needsUpdate=!0}:c=>{c.userData.backupMap=c.map,c.map=null,c.needsUpdate=!0};this.list.forEach(f)},set matcap(a){var c,p;if(i.matcap===a||(i.matcap=a,!this.propList.includes("matcap")))return;const u=(c=this.list[0])==null?void 0:c.matcap;(p=u==null?void 0:u.dispose)==null||p.call(u);const f=to(a);this.list.forEach(d=>{d.matcap=f,d.needsUpdate=!0})}};return Al.forEach(a=>Object.defineProperty(l,a,{get(){return i[a]},...!Ji.includes(a)&&{set(u){u!==this[a]&&(i[a]=u,this.propList.includes(a)&&this.list.forEach(f=>f[a]=Dl[a](u)))}}})),gn(s).forEach(a=>l[a]=r[a]),i={...Ae,...i},e.material=Yt(l),e},lu=`uniform float opacity;\r
uniform vec3 color;\r
\r
void main() {\r
	gl_FragColor = vec4( color, opacity );\r
}\r
`,uu=`uniform float size;\r
\r
#include <skinning_pars_vertex>\r
\r
void main() {\r
	#include <skinbase_vertex>\r
	\r
    vec3 transformed = position + normal * 0.0005 * size;\r
        \r
	#include <skinning_vertex>\r
	#include <project_vertex>\r
}`,fu=t=>new st({side:ea,transparent:!0,depthFunc:ta,vertexShader:uu,fragmentShader:lu,uniforms:t});function pu(t,e){const{material:n}=t,r=Array.isArray(t.material);[n].flat().forEach(vl),t.material=r?new Array(t.material.length).fill(e):e}function du(t,e){const n=fu(e),r=[],s=["Eff","Extension"];return t.forEach(i=>{const{name:o}=i;if(s.some(a=>o.includes(a)))return;const l=i.clone();l.name=`outline-${i.name}`,pu(l,n),i.isSkinnedMesh&&l.bind(i.skeleton,i.bindMatrix),i.add(l),r.push(l)}),r}const hu={size:parseFloat,opacity:parseFloat,color:At},mu=t=>e=>{const n={...je,...t},r=e.meshes,s={size:{value:n.size},opacity:{value:n.opacity},color:{value:new $(n.color)}},i=du(r,s),o={...n,enabled:!0},l={get propList(){return["enabled","color","size","opacity"]},get enabled(){return o.enabled},set enabled(a){const u=de(a);i.forEach(f=>f.visible=u),o.enabled=u},get code(){if(!this.enabled)return"none";const a=[];return Object.keys(je).forEach(u=>{const f=this[u];f!==je[u]&&a.push(`${u}=${f}`)}),a.join("/").replaceAll("#","")},set code(a){if(a==="none"){this.enabled=!1;return}const u=Object.keys(je),f={...je,...Zi(a)};u.forEach(c=>{this[c]=f[c]})},toString(){const{code:a}=this;return a?`ol=(${a})`:""}};return["size","opacity","color"].forEach(a=>Object.defineProperty(l,a,{get(){return o[a]},set(u){u!==this[a]&&(o[a]=u,s[a].value=hu[a](u))}})),l.enabled=n.enabled,e.outline=Yt(l),e},_u=["push","pop","shift","unshift","splice","reverse","sort"];class he extends Array{constructor(...e){super(...e),Object.assign(this,dt),_u.forEach(n=>{Object.defineProperty(this,n,{value:(...r)=>{Array.prototype[n].call(this,...r),this.dispatchEvent({type:"change",method:n,args:r})},enumerable:!1})})}remove(e){const n=this.indexOf(e);n!==-1&&this.splice(n,1)}}const as={chainName:"",chainCode:"",chainLength:0,aniIdx:0,clipDuration:0,clipTimeScale:1,action:null,aniAction:[],aniActionPointer:0};function ao(t){return t.split(">").map(gu)}function gu(t){const[e,...n]=t.split("&"),r=yu(n);return{aniName:e,...r}}function yu(t){const e={},n=[],r={r:{name:"reps",map:parseInt},ts:{name:"timeScale",map:parseFloat},dur:{name:"duration",map:vu}};return t.forEach(s=>{const[i,o]=Yi(s);if(i.startsWith("@")){const u=wu(o.replace(/[()]/g,""));u.time=parseFloat(i.slice(1)),n.push(u);return}if(!r[i])return;const{name:l,map:a}=r[i];e[l]=a(o)}),e.aniAction=n.filter(({time:s})=>s<=100&&s>=0).sort((s,i)=>s.time-i.time),e}function vu(t){if(!t)return[0,100];const e=t.split("-").slice(0,2).map(parseFloat),n=e.length===2?e:[0,e[0]];return n.some(r=>r>100||r<0)||n[0]>n[1]?[0,100]:n}function wu(t){return t.split("/").reduce((n,r)=>{const[s,i]=Yi(r);return{...n,...bu(s,i)}},{})}const cs={ei:{name:"face.eyeIdx",valueMap:parseInt},mi:{name:"face.mouthIdx",valueMap:parseInt},et:{name:"face.eyeTexture"},mt:{name:"face.mouthTexture"}};function bu(t,e){if(t in cs){const{name:s,valueMap:i}=cs[t];return{[s]:(i==null?void 0:i(e))??e}}let n=t,r=e;return t.startsWith("att")&&n.replace("att","attachment"),t.startsWith("parts")&&(n+="index",r=parseInt(e)),{[n]:r}}const Eu=t=>`${Ii}/${t}.json`;function Pu(t,e){if(t.startsWith("fbx:"))return Su(t);if(t.startsWith("ex:")){const[,r]=t.split(":"),s=e==null?void 0:e.find(({uuid:i})=>r===i);return Promise.resolve(s.clone())}const n=Eu(t);return new Promise(r=>fetch(n).then(s=>s.json()).then(s=>Ts.parse(s)).then(r))}async function Su(t){const e=t.replace("fbx:",""),[n,r]=e.split("+"),{animations:s}=await Gi(n);return r?s.find(({name:i})=>i===r):s[0]}function xu(t,e=null){return Promise.all(t.map(n=>Pu(n,e)))}function Tu(t,e=[]){return t.map((n,r)=>{const s=e[r];if(!s||s[0]===0&&s[1]===100)return n;const i=n.duration*Rn,[o,l]=s.map(a=>Math.round(a*i/100));return na.subclip(n,n.name,o,l,Rn)})}async function Au(t,e=null){const n=ao(t),r=n.map(({aniName:u})=>u),s=n.map(({duration:u})=>u),i=n.map(({aniName:u,duration:f,...c})=>({...c})),o=await xu(r,e),l=Tu(o,s);return{code:t,clips:l,mod:i,get duration(){return i.some(({timeScale:f})=>f===0)?1/0:l.map((f,c)=>f.duration/Math.abs(i[c].timeScale??1)*(i[c].reps??1)).reduce((f,c)=>f+c,0)}}}const Mu=/[a-z][0-9]{6}/;function Cu(t){const{model:e,uniqueId:n,bones:r,id:s,viewer:i}=t,o=i.userData.ani,l=new ra(e),a=(r==null?void 0:r.list)??[],u={...dt,mixer:l,chain:{},current:{...as},toString(){var p;const c=(p=this.chain.default)==null?void 0:p.code;return c?`ani=${c}`:""},async addChain(c,{name:p="default",autoplay:d=!0}={}){var _;if(!c||((_=this.chain[p])==null?void 0:_.code)===c)return;l.stopAllAction();const h=await Au(c,o);h.clips.forEach(w=>{w.tracks=w.tracks.reduce((y,v)=>{let g=v.name.split(".")[0];return Mu.test(g)&&(v.name.replace(g,s),g=s),a.includes(g)&&(v.name=`${n}|${v.name}`,y.push(v)),y},[])}),this.chain[p]=h,l.addEventListener("finished",f),d&&this.play(p)},play(c=this.current.chainName||"default"){const p=this.chain[c];p&&(this.current.chainName=c,this.current.chainCode=p.code,this.current.chainLength=p.clips.length,this.aniIdx=0)},pause(){this.current.action&&(this.current.action.paused=!0)},resume(){this.current.action&&(this.current.action.paused=!1)},stop(){l.stopAllAction()},reset(){const c=this.current.chainName;this.stop(),this.current={...as},this.chain[c]=void 0},update(c){var w;l.update(c);const{current:p}=this,{action:d,aniAction:h,clipDuration:_}=p;if(!(!h[p.aniActionPointer]||!d))for(;(d==null?void 0:d.time)>((w=h[p.aniActionPointer])==null?void 0:w.time)*_/100;)this.applyAniAction(h[p.aniActionPointer]),this.current.aniActionPointer++},applyAniAction(c){t.dispatchEvent({type:"aniAction",id:n,aniAction:c});const{time:p,...d}=c;Object.entries(d).forEach(([h,_])=>{const w=h.split(".");Ki(t,w,_)})},nextFrame(c=1,p=Rn){if(!this.isPaused)return;const{clipTimeScale:d,clipDuration:h,action:_}=this.current,w=c*d/p;if(_.time+=w,_.time>=h){const y=_.time-h;f(),this.pause(),this.current.action.time+=y*this.current.clipTimeScale}},setTime(c){const{clipDuration:p,action:d}=this.current;!p||c>p||(d.time=c)},get isPaused(){var c;return(c=this.current.action)==null?void 0:c.paused},get aniIdx(){return this.current.aniIdx},set aniIdx(c){if(c>=this.current.chainLength)return;this.current.aniIdx=c,this.current.aniActionPointer=0;const p={type:c===0?"chainStart":"chainMove",index:c,uniqueId:n,chainName:this.current.chainName};this.dispatchEvent(p),l.stopAllAction();const d=this.chain[this.current.chainName],h=d.mod[c],{timeScale:_,reps:w,aniAction:y}=h,v=d.clips[c],g=l.clipAction(v);g.timeScale=_??1,g.setLoop(sa,w??1),this.current.clipDuration=v.duration,this.current.action=g,this.current.aniAction=y,this.current.aniActionPointer=0,this.current.clipTimeScale=_??1,g.play()}};function f(){const{aniIdx:c,chainLength:p}=u.current,d=(c+1)%p;if(d===0){u.dispatchEvent({type:"ChainFinished",chainName:u.current.chainName});const{face:h}=t;h&&(h.eyeIdx=h.eyeBaseIdx,h.mouthIdx=h.mouthBaseIdx)}u.aniIdx=d}return t.animation=u,t.addEventListener("TimeUpdated",({dt:c})=>u.update(c)),t}function Lu(t){const{model:e,bones:n,uniqueId:r}=t,s={};return Object.defineProperty(s,"list",{get(){return Object.values(this).flat()}}),Object.defineProperty(s,"traverse",{value:function(f){this.list.forEach(c=>{var p,d;f(c),(d=(p=c.attachment)==null?void 0:p.traverse)==null||d.call(p,f)})}}),Object.assign(t,{attachment:s,parent:null,parentBone:"",attach:(f,c="root")=>{s[c]=s[c]??new he;const p=c==="root"?e:n.find(({name:d})=>d===`${r}|${c}`);p!=null&&p.add&&(f.detach(),p.add(f.model),s[c].push(f),f.parent=t,f.parentBone=c,t.dispatchEvent({type:"AttachmentChanged"}))},remove:(f,c="")=>{var d,h,_;const p=c||Object.keys(s).find(w=>s[w].indexOf(f)!==-1);p&&((h=(d=s[p]).remove)==null||h.call(d,f),(_=f.model.parent)==null||_.remove(f.model),t.dispatchEvent({type:"AttachmentChanged"}))},detach:()=>{var p;(p=e.parent)==null||p.remove(e);const{parent:f,parentBone:c}=t;f&&(f.remove(t,c),t.parent=t.parentBone=null)},attachTo:(f,c="root")=>{var p;t.detach(),(p=f==null?void 0:f.attach)==null||p.call(f,t,c)}})}function ku(t){const{material:e,id:n}=t,r=Ft.source.fbx,s=ls(n);hl(n)&&async function(){const a=l(s),u=new Ke().load(a);u.colorSpace=Q,u.name=s,e.list.forEach(f=>f.map=f.map??u)}();let i=s;Object.defineProperty(t,"texture",{get(){return i},set(a){if(!a){this.texture=s;return}if(a===i)return;const u=l(a),[,f]=o(a),[,c]=o(this.texture),p=e.list.filter(d=>{var h,_,w,y;return((_=(h=d.map)==null?void 0:h.name)==null?void 0:_.includes(c))||((y=(w=d.userData.backupMap)==null?void 0:w.name)==null?void 0:y.includes(c))});p.length&&(async function(){const d=await Xi(u);d.name=f,d.colorSpace=Q,p.forEach(h=>{var _,w,y,v;h.map&&((w=(_=h.map).dispose)==null||w.call(_),h.map=d),h.userData.backupMap&&((v=(y=h.userData.backupMap).dispose)==null||v.call(y),h.userData.backupMap=d)})}(),i=a)}});function o(a){const[u,f]=a.split(">"),c=u||n,p=f||ls(c);return[c,p]}function l(a){const[u,f]=o(a);return`${r}/${u}/${f}.png`}return t}const ls=t=>t.match(/_[0-9]{2}/)||t.startsWith("h")?t:`>${t}_01`,Du=`uniform float uTime;\r
uniform float uSpread;\r
uniform float uThreshold;\r
uniform float uSpeed;\r
uniform float uParticleSize;\r
uniform float uAuraSize;\r
\r
attribute float aRandom;\r
\r
varying float vIsParticle;\r
varying float vRandom;\r
\r
#include <skinning_pars_vertex>\r
void main() {\r
    #include <skinbase_vertex>\r
\r
    vec3 transformed = position + normal * 0.005 * uSpread;\r
\r
    #include <skinning_vertex>\r
\r
    vec3 objectNormal = normal;\r
\r
	#include <skinnormal_vertex>\r
    \r
    vec4 viewPosition = viewMatrix * modelMatrix * vec4(transformed, 1.0);\r
    float yDisplacement = fract( uTime * uSpeed + aRandom ) * 0.1;\r
    viewPosition.y += yDisplacement;\r
    viewPosition.x += sin( uTime * aRandom * uSpeed + aRandom ) * 0.02;\r
    \r
    gl_Position = projectionMatrix * viewPosition;\r
    \r
    objectNormal.z *= objectNormal.z > 0.7 ? -1.0 : 1.0;\r
    vIsParticle = objectNormal.z - uThreshold;\r
\r
    gl_PointSize = vIsParticle > 0.0 ? uParticleSize : uAuraSize;\r
    gl_PointSize /= -viewPosition.z;\r
\r
    vRandom = aRandom;\r
}\r
`,Ou=`uniform sampler2D uTexture;\r
\r
uniform float uTime;\r
uniform float uParticleOpacity;\r
uniform float uAuraOpacity;\r
uniform vec3 uColor;\r
uniform vec3 uColor2;\r
\r
varying float vRandom;\r
varying float vIsParticle;\r
\r
void main(){\r
    vec4 textureColor = texture2D( uTexture, gl_PointCoord );\r
    textureColor.a = length( textureColor.rgb ) ;\r
    textureColor.a *= abs( 1.0 - fract( uTime + vRandom ) ) * 0.5;\r
    textureColor.rgb = mix( uColor, uColor2,  textureColor.a * 2.0 );\r
    textureColor.a *= vIsParticle > 0.0 ? uParticleOpacity * 4.0 : uAuraOpacity;\r
\r
    gl_FragColor = textureColor;\r
    gl_FragColor /= vIsParticle > 0.0 ? 2.0 : 4.0;\r
}\r
`,Mt=[{name:"time",uName:"uTime",defaultValue:0,valueMap:Number},{name:"speed",uName:"uSpeed",defaultValue:1,valueMap:Number},{name:"particleOpacity",uName:"uParticleOpacity",defaultValue:.3,valueMap:Number},{name:"auraOpacity",uName:"uAuraOpacity",defaultValue:.3,valueMap:Number},{name:"particleSize",uName:"uParticleSize",defaultValue:10,valueMap:Number},{name:"auraSize",uName:"uAuraSize",defaultValue:100,valueMap:Number},{name:"spread",uName:"uSpread",defaultValue:5,valueMap:Number},{name:"threshold",uName:"uThreshold",defaultValue:.3,valueMap:Number},{name:"texture",uName:"uTexture",defaultValue:"img/textures/particle/cloud.png",valueMap:t=>new Ke().load(t)},{name:"color",uName:"uColor",defaultValue:"#ffffff",valueMap:t=>new $(t)},{name:"color2",uName:"uColor2",defaultValue:"#33ffff",valueMap:t=>new $(t)}],Iu={aura:["visible",...Mt.slice(1).map(({name:t})=>t)]},Ru=(t="aura")=>(e,n={})=>{if(e!=null&&e.length&&t==="aura")return Bu(e,n)};function Fu(t){return new st({vertexShader:Du,fragmentShader:Ou,uniforms:t,transparent:!0,blending:aa,depthWrite:!1,side:ca})}function Bu(t,e){const n=Mt.map(a=>{const{uName:u,defaultValue:f,valueMap:c}=a,p=(c==null?void 0:c(f))??f;return[u,{value:p}]}),r=Object.fromEntries(n),s=Fu(r),i=[];t.forEach(a=>{const{name:u}=a.geometry;if(u.startsWith("mEye")||u.startsWith("mMouth"))return;const f=a.geometry.clone(),c=f.attributes.position.count,p=new Float32Array(c).fill(0).map(()=>Math.random()-.5);f.setAttribute("aRandom",new ia(p,1)),f.deleteAttribute("color"),f.deleteAttribute("uv");const d=new oa(f,s);d.name="aura",a.isSkinnedMesh&&(d.type="SkinnedMesh",d.isSkinnedMesh=!0,d.skeleton=a.skeleton,d.bindMatrix=a.bindMatrix,d.bindMatrixInverse=a.bindMatrixInverse,d.bindMode=a.bindMode,d.bind=a.bind,d.clone=a.clone,d.initBones=a.initBones,d.normalizeSkinWeights=a.normalizeSkinWeights,d.pose=a.pose,d.updateMatrixWorld=a.updateMatrixWorld),a.add(d),i.push(d)});const o={visible:!0},l={name:"aura",onDispose:()=>{},get list(){return i},get propList(){return Iu.aura},get visible(){return o.visible},set visible(a){const u=de(a);this.list.forEach(f=>f.visible=u),o.visible=u},dispose(){this.onDispose(),this.list.forEach(a=>{var u,f,c,p,d;(u=a.parent)==null||u.remove(a),(c=(f=a.material).dispose)==null||c.call(f),(d=(p=a.geometry).dispose)==null||d.call(p)})},set code(a){a.split("/").forEach(f=>{const[c,p]=f.split("=");Mt.map(({name:d})=>d).includes(c)&&(this[c]=p)})}};return Mt.forEach(a=>{const{name:u,uName:f,defaultValue:c,valueMap:p}=a;o[u]=c,Object.defineProperty(l,u,{get(){return o[u]},set(d){o[u]=d,r[f].value=(p==null?void 0:p(d))??d}})}),l.onTimeUpdate=({time:a})=>l.time=a,Object.entries(e).forEach(([a,u])=>l[a]=u),l}function ju(t){const{meshes:e}=t,n={list:new he,dispose(){this.list.forEach(r=>{var s;return(s=r.dispose)==null?void 0:s.call(r)})},add(r="aura",s={}){const i=Ru(r)(e,s);return i.onDispose=()=>this.list.remove(i),this.list.push(i),t.addEventListener("TimeUpdated",i.onTimeUpdate),i}};return t.particle=n,t}const Nu=t=>{var l,a;if(t.dispatchEvent({type:"dispose"}),!t)return;const{model:e,meshes:n,outline:r,particle:s,viewer:i}=t;s==null||s.list.forEach(u=>u.dispose()),(l=e.parent)!=null&&l.isScene&&(e.parent.remove(e),i.loadedModel.remove(t)),(a=t.detach)==null||a.call(t),[n.reverse(),r==null?void 0:r.all].flat().forEach(bl)};function $u(t){const{x:e,y:n,z:r}=t;return[e,n,r].map(s=>s||"").join()}const Uu={position:",,",rotation:",,",scale:"1,1,1"},zu={position:"pos",rotation:"rot",scale:"scl"};function Vu(t){return Object.assign(t,{...t.isDLModel&&{toString(){const{id:e,animation:n,outline:r,material:s}=this,i=Object.entries(Uu).map(([o,l])=>{const a=$u(this[o]);return a===l?"":`${zu[o]}=${a}`});return[`id=${e}`,...i,n,r,s].filter(o=>`${o}`).join("/")}},dispose(){const{attachment:e,parent:n,parentBone:r}=this;e.list.forEach(s=>s.dispose()),n==null||n.remove(this,r),this.dispatchEvent({type:"dispose"}),Nu(this)}})}let er=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,n)=>(n&=63,n<36?e+=n.toString(36):n<62?e+=(n-26).toString(36).toUpperCase():n>62?e+="-":e+="_",e),"");function Hu(t,e){const{id:n,material:r,outline:s,viewer:i}=e,o=[ru,au,Lu,mu(s),cu(r),ku,Jl,Cu,ju,Vu],l={...dt,isDLModel:!0,model:t,id:n,uniqueId:er(),type:ml(n),viewer:i,userData:{},_time:0,update(a){var u;this._time+=a,(u=this.attachment)==null||u.list.forEach(f=>{var c;return(c=f.update)==null?void 0:c.call(f,a)}),this.dispatchEvent({type:"TimeUpdated",dt:a,time:this._time})},set scale(a){var f;if((f=a.includes)!=null&&f.call(a,",")){const[c,p,d]=a.split(",").map(h=>h?parseFloat(h):1);this.model.scale.set(c,p,d);return}const u=Number(a)||1;this.model.scale.set(u,u,u)},get scale(){const{scale:a}=this.model,{x:u,y:f,z:c}=a;return u===f&&u===c?u:[u,f,c].join(",")},set visible(a){this.model.visible=de(a)}};return["position","rotation","visible"].forEach(a=>Object.defineProperty(l,a,{get(){return this.model[a]},enumerable:!0})),t.userData.container=l,fl(...o)(l)}const Wu={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class qt{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const Gu=new bs(-1,1,1,-1,0,1),tr=new St;tr.setAttribute("position",new Ee([-1,3,0,-1,-1,0,3,-1,0],3));tr.setAttribute("uv",new Ee([0,2,0,0,2,0],2));class Xu{constructor(e){this._mesh=new Ss(tr,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,Gu)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class co extends qt{constructor(e,n){super(),this.textureID=n!==void 0?n:"tDiffuse",e instanceof st?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=$n.clone(e.uniforms),this.material=new st({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new Xu(this.material)}render(e,n,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(n),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}const Ku=Object.freeze(Object.defineProperty({__proto__:null,ShaderPass:co},Symbol.toStringTag,{value:"Module"}));class us extends qt{constructor(e,n){super(),this.scene=e,this.camera=n,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,n,r){const s=e.getContext(),i=e.state;i.buffers.color.setMask(!1),i.buffers.depth.setMask(!1),i.buffers.color.setLocked(!0),i.buffers.depth.setLocked(!0);let o,l;this.inverse?(o=0,l=1):(o=1,l=0),i.buffers.stencil.setTest(!0),i.buffers.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),i.buffers.stencil.setFunc(s.ALWAYS,o,4294967295),i.buffers.stencil.setClear(l),i.buffers.stencil.setLocked(!0),e.setRenderTarget(r),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),i.buffers.color.setLocked(!1),i.buffers.depth.setLocked(!1),i.buffers.stencil.setLocked(!1),i.buffers.stencil.setFunc(s.EQUAL,1,4294967295),i.buffers.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),i.buffers.stencil.setLocked(!0)}}class Yu extends qt{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class qu{constructor(e,n){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),n===void 0){const r=e.getSize(new U);this._width=r.width,this._height=r.height,n=new Ms(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:la}),n.texture.name="EffectComposer.rt1"}else this._width=n.width,this._height=n.height;this.renderTarget1=n,this.renderTarget2=n.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new co(Wu),this.copyPass.material.blending=ua,this.clock=new Cs}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,n){this.passes.splice(n,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const n=this.passes.indexOf(e);n!==-1&&this.passes.splice(n,1)}isLastEnabledPass(e){for(let n=e+1;n<this.passes.length;n++)if(this.passes[n].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const n=this.renderer.getRenderTarget();let r=!1;for(let s=0,i=this.passes.length;s<i;s++){const o=this.passes[s];if(o.enabled!==!1){if(o.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(s),o.render(this.renderer,this.writeBuffer,this.readBuffer,e,r),o.needsSwap){if(r){const l=this.renderer.getContext(),a=this.renderer.state.buffers.stencil;a.setFunc(l.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),a.setFunc(l.EQUAL,1,4294967295)}this.swapBuffers()}us!==void 0&&(o instanceof us?r=!0:o instanceof Yu&&(r=!1))}}this.renderer.setRenderTarget(n)}reset(e){if(e===void 0){const n=this.renderer.getSize(new U);this._pixelRatio=this.renderer.getPixelRatio(),this._width=n.width,this._height=n.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,n){this._width=e,this._height=n;const r=this._width*this._pixelRatio,s=this._height*this._pixelRatio;this.renderTarget1.setSize(r,s),this.renderTarget2.setSize(r,s);for(let i=0;i<this.passes.length;i++)this.passes[i].setSize(r,s)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class Zu extends qt{constructor(e,n,r,s,i){super(),this.scene=e,this.camera=n,this.overrideMaterial=r,this.clearColor=s,this.clearAlpha=i!==void 0?i:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new $}render(e,n,r){const s=e.autoClear;e.autoClear=!1;let i,o;this.overrideMaterial!==void 0&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),i=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:r),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,i),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=o),e.autoClear=s}}function fs({renderer:t,scene:e,camera:n}){const r=Qu(),s=new qu(t,r),i=new Zu(e,n);return s.addPass(i),s}const Qu=()=>new Ms(800,600,{minFilter:wr,magFilter:wr,format:fa,colorSpace:Q}),vn={bloom:ef,pixel:nf,afterimage:cf,sobel:rf,halftone:sf,dotscreen:of,bokeh:af,smaa:tf};async function Ju(t,e){var r;t=t.toLowerCase();const n=await((r=vn[t])==null?void 0:r.call(vn,e));return n.type=t,n.name=nr[t].name,n}function Zt(t,e){Object.defineProperty(t,"propList",{value:e}),e.forEach(n=>{Object.defineProperty(t,n,{get(){return this.uniforms[n].value},set(r){this.uniforms[n].value=r}})})}async function ef({resolution:t=new U(800,600),strength:e=.3,radius:n=.5,threshold:r=.8}={}){const{UnrealBloomPass:s}=await D(()=>import("./b9dfa772-UnrealBloomPass.js"),["assets/b9dfa772-UnrealBloomPass.js","assets/65e4a706-three.js"]),i=new s(t,e,n,r);return Object.defineProperty(i,"propList",{value:["radius","strength","threshold"],writable:!1}),i}async function tf({renderer:t}){const{SMAAPass:e}=await D(()=>import("./f9f56548-SMAAPass.js"),["assets/f9f56548-SMAAPass.js","assets/65e4a706-three.js"]),n=new U;t.getSize(n);const r=new e(n.x,n.y);return Object.defineProperty(r,"propList",{value:[],writable:!1}),r}async function nf({scene:t,camera:e}){const{RenderPixelatedPass:n}=await D(()=>import("./fad39c54-RenderPixelatedPass.js"),["assets/fad39c54-RenderPixelatedPass.js","assets/65e4a706-three.js"]),r=new n(5,t,e);return Object.defineProperty(r,"propList",{value:["size"],writable:!1}),Object.defineProperty(r,"size",{get(){return this.pixelSize},set(s){this.setPixelSize(s)}}),r}async function rf({renderer:t}){const{ShaderPass:e}=await D(()=>Promise.resolve().then(()=>Ku),void 0),{SobelOperatorShader:n}=await D(()=>import("./5bf8933b-SobelOperatorShader.js"),["assets/5bf8933b-SobelOperatorShader.js","assets/65e4a706-three.js"]),r=new U;t.getSize(r),r.multiplyScalar(window.devicePixelRatio);const s=new e(n);return s.uniforms.resolution.value.x=r.x,s.uniforms.resolution.value.y=r.y,Object.defineProperty(s,"propList",{value:[],writable:!1}),s}async function sf({renderer:t}){const{HalftonePass:e}=await D(()=>import("./fd235294-HalftonePass.js"),["assets/fd235294-HalftonePass.js","assets/65e4a706-three.js"]),n=new U;t.getSize(n);const r=new e(n.x,n.y,{radius:4});return Zt(r,["greyscale","radius","scatter","shape"]),r}async function of(){const{DotScreenPass:t}=await D(()=>import("./de4fafd1-DotScreenPass.js"),["assets/de4fafd1-DotScreenPass.js","assets/65e4a706-three.js"]),e=new t;return Zt(e,["scale","center"]),e}async function af({scene:t,camera:e}){const{BokehPass:n}=await D(()=>import("./82e4f406-BokehPass.js"),["assets/82e4f406-BokehPass.js","assets/65e4a706-three.js"]),r=new n(t,e,{});return Zt(r,["focus","aperture","aspect"]),r}async function cf(){const{AfterimagePass:t}=await D(()=>import("./ba26f99c-AfterimagePass.js"),["assets/ba26f99c-AfterimagePass.js","assets/65e4a706-three.js"]),e=new t(.7);return Zt(e,["damp"]),e}function lf(t){const{name:e,type:n}=t,r=nr[n].propList??[],s={};return r.forEach(o=>{Object.defineProperty(s,o,{get(){return t[o]},set(l){t[o]=l},enumerable:!0})}),{target:t,name:e,type:n,params:s,id:er()}}const nr={bloom:{name:"Bloom",propList:["enabled","radius","strength","threshold"]},pixel:{name:"Pixelate",propList:["enabled","size"]},afterimage:{name:"Afterimage",propList:["enabled","damp"]},sobel:{name:"Sobel",propList:["enabled"]},halftone:{name:"Halftone",propList:["enabled","greyscale","radius","scatter","shape"]},dotscreen:{name:"Dot Screen",propList:["enabled","scale"]},bokeh:{name:"Bokeh",propList:["enabled","focus","aperture","aspect"]},smaa:{name:"SMAA",propList:["enabled"]}},Ep=Object.entries(nr).map(([t,{name:e}])=>({value:t,label:e}));var lo={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(Be,function(){var n=function(){function r(d){return o.appendChild(d.dom),d}function s(d){for(var h=0;h<o.children.length;h++)o.children[h].style.display=h===d?"block":"none";i=d}var i=0,o=document.createElement("div");o.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",o.addEventListener("click",function(d){d.preventDefault(),s(++i%o.children.length)},!1);var l=(performance||Date).now(),a=l,u=0,f=r(new n.Panel("FPS","#0ff","#002")),c=r(new n.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var p=r(new n.Panel("MB","#f08","#201"));return s(0),{REVISION:16,dom:o,addPanel:r,showPanel:s,begin:function(){l=(performance||Date).now()},end:function(){u++;var d=(performance||Date).now();if(c.update(d-l,200),d>a+1e3&&(f.update(1e3*u/(d-a),100),a=d,u=0,p)){var h=performance.memory;p.update(h.usedJSHeapSize/1048576,h.jsHeapSizeLimit/1048576)}return d},update:function(){l=this.end()},domElement:o,setMode:s}};return n.Panel=function(r,s,i){var o=1/0,l=0,a=Math.round,u=a(window.devicePixelRatio||1),f=80*u,c=48*u,p=3*u,d=2*u,h=3*u,_=15*u,w=74*u,y=30*u,v=document.createElement("canvas");v.width=f,v.height=c,v.style.cssText="width:80px;height:48px";var g=v.getContext("2d");return g.font="bold "+9*u+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=i,g.fillRect(0,0,f,c),g.fillStyle=s,g.fillText(r,p,d),g.fillRect(h,_,w,y),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(h,_,w,y),{dom:v,update:function(P,b){o=Math.min(o,P),l=Math.max(l,P),g.fillStyle=i,g.globalAlpha=1,g.fillRect(0,0,f,_),g.fillStyle=s,g.fillText(a(P)+" "+r+" ("+a(o)+"-"+a(l)+")",p,d),g.drawImage(v,h+u,_,w-u,y,h,_,w-u,y),g.fillRect(h+w-u,_,u,y),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(h+w-u,_,u,a((1-P/b)*y))}}},n})})(lo);var uf=lo.exports;const ff=vi(uf);var uo={exports:{}};(function(t,e){(function(n,r){r()})(Be,function(){function n(u,f){return typeof f>"u"?f={autoBom:!1}:typeof f!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),f={autoBom:!f}),f.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(u.type)?new Blob(["\uFEFF",u],{type:u.type}):u}function r(u,f,c){var p=new XMLHttpRequest;p.open("GET",u),p.responseType="blob",p.onload=function(){a(p.response,f,c)},p.onerror=function(){console.error("could not download file")},p.send()}function s(u){var f=new XMLHttpRequest;f.open("HEAD",u,!1);try{f.send()}catch{}return 200<=f.status&&299>=f.status}function i(u){try{u.dispatchEvent(new MouseEvent("click"))}catch{var f=document.createEvent("MouseEvents");f.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),u.dispatchEvent(f)}}var o=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof Be=="object"&&Be.global===Be?Be:void 0,l=o.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),a=o.saveAs||(typeof window!="object"||window!==o?function(){}:"download"in HTMLAnchorElement.prototype&&!l?function(u,f,c){var p=o.URL||o.webkitURL,d=document.createElement("a");f=f||u.name||"download",d.download=f,d.rel="noopener",typeof u=="string"?(d.href=u,d.origin===location.origin?i(d):s(d.href)?r(u,f,c):i(d,d.target="_blank")):(d.href=p.createObjectURL(u),setTimeout(function(){p.revokeObjectURL(d.href)},4e4),setTimeout(function(){i(d)},0))}:"msSaveOrOpenBlob"in navigator?function(u,f,c){if(f=f||u.name||"download",typeof u!="string")navigator.msSaveOrOpenBlob(n(u,c),f);else if(s(u))r(u,f,c);else{var p=document.createElement("a");p.href=u,p.target="_blank",setTimeout(function(){i(p)})}}:function(u,f,c,p){if(p=p||open("","_blank"),p&&(p.document.title=p.document.body.innerText="downloading..."),typeof u=="string")return r(u,f,c);var d=u.type==="application/octet-stream",h=/constructor/i.test(o.HTMLElement)||o.safari,_=/CriOS\/[\d]+/.test(navigator.userAgent);if((_||d&&h||l)&&typeof FileReader<"u"){var w=new FileReader;w.onloadend=function(){var g=w.result;g=_?g:g.replace(/^data:[^;]*;/,"data:attachment/file;"),p?p.location.href=g:location=g,p=null},w.readAsDataURL(u)}else{var y=o.URL||o.webkitURL,v=y.createObjectURL(u);p?p.location=v:location.href=v,p=null,setTimeout(function(){y.revokeObjectURL(v)},4e4)}});o.saveAs=a.saveAs=a,t.exports=a})})(uo);var rr=uo.exports;const pf=["video/mp4;codecs=h264","video/webm;codecs=h264","video/webm;codecs=vp9","video/webm;codecs=vp8","video/webm"],Et=pf.filter(MediaRecorder.isTypeSupported);function df(t){if(!Et.length)return;const e=[],n=Et[0],r={settings:{...zl,mimeType:n},get supportedMimeTypes(){return Et},get mimeType(){return this.settings.mimeType},set mimeType(s){Et.includes(s)&&(this.settings.mimeType=s)},start(){if(this.recorder)return;const{fileName:s,frameRate:i,mimeType:o}=this.settings,l=t.captureStream(i||30),a=l.getTracks()[0],u=new MediaRecorder(l,{mimeType:o});u.onstart=()=>e.length=0,u.ondataavailable=({data:f})=>e.push(f),u.onstop=()=>{a.stop(),this.recorder=void 0;const f=this.settings.mimeType.includes("webm")?"webm":"mp4",c=new Blob(e,{type:`video/${f}`}),p=this.settings.appendDate?`_${El()}`:"",d=`${s||"ani"}${p}.${f}`;rr.saveAs(c,d)},u.start(),this.recorder=u},get state(){var s;return((s=this.recorder)==null?void 0:s.state)??"idle"}};return["pause","resume","stop"].forEach(s=>{Object.defineProperty(r,s,{value:()=>{var i;return(i=r.recorder)==null?void 0:i[s]()}})}),r}function hf(t){let e=1,n=!1,r=!1;const s=()=>{t.stats.begin(),t.controls.update();const u=n?-e:e,f=t.clock.getDelta()*u;r||t.update(f),t.render(),t.stats.end()};let i=!1;const o=()=>{i||(t.render(),i=!0,setTimeout(()=>i=!1,50))};let l="";return{start(){l!=="active"&&(t.renderer.setAnimationLoop(s),t.controls.removeEventListener("change",o),l="active")},stop(){l!=="inactive"&&(t.renderer.setAnimationLoop(null),t.controls.addEventListener("change",o),l="inactive")},pause(){r=!0},resume(){r=!1},get state(){return l},get timeScale(){return e},set timeScale(u){const f=parseFloat(u);e=isNaN(f)?1:Math.abs(f)},get reverse(){return n},set reverse(u){n=!!u},get paused(){return r},set paused(u){r=!!u}}}const mf=async t=>{const{zip:e}=await D(()=>import("./a0291a37-browser.js"),[]);return new Promise(n=>e(t,{},(r,s)=>n(new Blob([s]))))},_f=t=>{const e=t.indexOf(",");return t.slice(e+1,1/0)},gf=async t=>{if(t=await t,t instanceof Blob&&(t=await t.arrayBuffer()),t instanceof ArrayBuffer)return new Uint8Array(t);if(typeof t=="string"){const e=t.startsWith("data")?_f(t):t,n=window.atob(e);return Uint8Array.from(n,r=>r.charCodeAt(0))}};async function yf(t){const e=await Promise.all(t.map(({data:r})=>gf(r))),n=Object.fromEntries(t.map(({name:r},s)=>[r,[e[s],{level:0,consume:!0}]]));return mf(n)}async function vf(t,e){const n=t.length.toString().length,r=t.map((s,i)=>{const o=i.toString().padStart(n,"0");return{name:`${e||"ss"}_${o}.png`,data:s}});return yf(r)}function wf(t,e){const n=document.createElement("a");n.style.display="none",n.href=t,n.download=e,document.body.appendChild(n),n.click(),document.body.removeChild(n)}async function jn(t,e="frames"){const n=await vf(t,e);rr.saveAs(n,`${e}.zip`)}function bf(t){const{canvas:e,scene:n}=t;return{settings:Ul,downloadFrame(s=1){const{noBackground:i,fileName:o}=this.settings,l=i&&!t.postProcessing.enabled;let a=null;const u=()=>[n.background,a]=[a,n.background];if(t.loop.state==="inactive"||s===1){l&&u(),t.render();const d=e.toDataURL();l&&u(),wf(d,`${o}.png`),t.render();return}let f=0;const c=[];l&&t.addCountedEventListener("beforeRender",u);function p(){const d=e.toDataURL("image/png");c.push(d),++f===s&&(l&&t.addCountedEventListener("beforeRender",u),jn(c,o))}t.addCountedEventListener("afterRender",p,s)},getFrame(){let s;const{noBackground:i}=this.settings;if(i&&!t.postProcessing.enabled){let l=null;[n.background,l]=[l,n.background],t.render(),s=e.toDataURL("image/png"),[n.background,l]=[l,n.background],t.render()}else t.render(),s=e.toDataURL("image/png");return s},getAllFrames(s){var h,_;const i=s==null?void 0:s.animation.current.chainName;if(!i||s.animation.chain[i].duration===1/0)return;console.info("main thread locked");const l=t.loop.state;t.loop.stop(),(_=(h=s.face)==null?void 0:h.reset)==null||_.call(h),s.animation.stop();const a=[],{frameRate:u,noBackground:f}=this.settings,c=1/(u||30);let p=null,d=!0;for(f&&([n.background,p]=[p,n.background]),s.animation.addCountedEventListener("chainFinished",()=>d=!1),s.animation.play();d;){t.update(c);const w=e.toDataURL();a.push(w)}return console.info("main thread unlocked"),f&&([n.background,p]=[p,n.background]),l==="active"&&t.loop.start(),a},downloadAllFrames(s=0){const i=t.model[s],o=this.getAllFrames(i),{fileName:l}=this.settings;jn(o,l)},getAllFramesAsArrayBuffer(s){var g,P;const i=s==null?void 0:s.animation.current.chainName;if(!i||s.animation.chain[i].duration===1/0)return;console.info("main thread locked");const l=t.renderer.getContext(),a=t.loop.state;(P=(g=s.face)==null?void 0:g.reset)==null||P.call(g),t.loop.stop(),s.animation.stop();const u=[],{frameRate:f,noBackground:c}=this.settings,p=1/(f||30),{width:d,height:h}=e,w=d*h*4;let y=null,v=!0;for(c&&([n.background,y]=[y,n.background]),s.animation.addCountedEventListener("chainFinished",()=>v=!1),s.animation.play();v;){t.update(p);const b=new Uint8Array(w);l.readPixels(0,0,d,h,l.RGBA,l.UNSIGNED_BYTE,b);const x=Ef(b,{width:d,height:h});u.push(x.buffer)}return console.info("main thread unlocked"),c&&([n.background,y]=[y,n.background]),a==="active"&&t.loop.start(),u}}}function Ef(t,{width:e,height:n}){const r=n/2|0,s=e*4,i=new Uint8Array(e*4);for(let o=0;o<r;++o){const l=o*s,a=(n-o-1)*s;i.set(t.subarray(l,l+s)),t.copyWithin(l,a,a+s),t.set(i,a)}return t}const Pf=()=>Promise.all([Wl(),Gl(),Kl(),su()]),Sf={directional:Ps,ambient:xs,point:En},xf={directional:pa,point:da},Tf=t=>{var a,u;const e=Sf[t];if(!e)return null;const n=Vl[t],{color:r,intensity:s,...i}=n,o=new e(r,s);o.name=(u=(a=o.type)==null?void 0:a.replace)==null?void 0:u.call(a,"Light","");const l=xf[t];return l&&(o.helper=new l(o),Object.defineProperty(o,"showHelper",{get(){return o.helper.visible},set(f){o.helper.visible=!!f,o.helper.update()}}),o.showHelper=!1),Object.defineProperty(o,"colorCode",{get(){return"#"+this.color.getHexString()},set(f){var c,p;this.color=new $(f),(p=(c=this.helper)==null?void 0:c.update)==null||p.call(c)}}),Object.entries(i).forEach(([f,c])=>{o[f].isVector3?o[f].set(...c):o[f]=c}),o};function Af(t){const e={list:new he,add:n=>{const r=Tf(n);if(r)return t.scene.add(r),r.helper&&(t.scene.add(r.helper),r.helper.update()),e.list.push(r),r.remove=()=>{var s,i,o,l,a;e.list.remove(r),r.helper&&((s=r.parent)==null||s.remove(r.helper),(o=(i=r.helper).dispose)==null||o.call(i)),(l=r.parent)==null||l.remove(r),(a=r.dispose)==null||a.call(r)},r}};return e}const ps={"<":">","(":")","[":"]","{":"}"},Mf=t=>{let e="";const n=[],r=[];for(const s of t){if(n.length){e+=s;const i=n.at(-1);s===ps[i]&&n.pop();continue}if(s==="/"){e&&r.push(e),e="";continue}e+=s,s in ps&&n.push(s)}return e&&r.push(e),r},fo=t=>Mf(t).reduce((n,r)=>{const[s,...i]=r.split("="),o=i==null?void 0:i.join("=");return s&&o&&n.push([s,o]),n},[]),Cf={mat:{keys:["material","code"],valueMap:t=>t.slice(1,-1)},ol:{keys:["outline","code"],valueMap:t=>t.slice(1,-1)},ei:{keys:["face","eyeBaseIdx"]},et:{keys:["face","eyeTexture"]},mi:{keys:["face","mouthBaseIdx"]},mt:{keys:["face","mouthTexture"]},tx:{keys:["texture"]},scl:{keys:["scale"]}};async function Lf(t){const e=fo(t),n=Object.fromEntries(e),{id:r}=n,s=await this.loadDLModel(r);return await kf(s,n),s}async function kf(t,e){const{ani:n,...r}=e;Object.entries(r).forEach(([s,i])=>{const o=Cf[s];if(!o)return;const{keys:l,valueMap:a}=o,u=(a==null?void 0:a(i))??i;Ki(t,l,u)}),n&&await t.animation.addChain(n)}const Bt=class Bt{constructor(){te(this,"userData",{ani:new he});te(this,"dataLoaded",!1);te(this,"initData",async()=>{await Pf(),this.dataLoaded=!0,this.dispatchEvent({type:"dataLoaded"})});te(this,"_background","");te(this,"model",new he);te(this,"loadedModel",new he);te(this,"loadModelFromCode",Lf);te(this,"settings",{outline:je,material:Ae});te(this,"viewport",{width:0,height:0,set(e,n){this.width=e,this.height=n}});Object.assign(this,dt);const e=new ha;this.scene=e,this.background=jl,this.clock=new Cs;const n=gl();this.camera=n;const r=Af(this);r.add("directional"),r.add("ambient"),this.light=r;const s=_l();this.renderer=s,this.canvas=s.domElement,this.screenshot=bf(this),this.record=df(this.canvas),this.controls=new xc(this.camera,this.canvas),this.postProcessing={enabled:!1,passes:new he,composer:fs({renderer:s,scene:e,camera:n}),async addPass(i,o={}){const l=await Ju(i,{...o,renderer:s,scene:e,camera:n});this.composer.addPass(l);const a=lf(l),{passes:u}=this,f=this;return a.remove=()=>{u.remove(a),f.refresh()},u.push(a),l},async refresh(){this.composer=fs({renderer:s,scene:e,camera:n});const i=this.passes.map(({type:l,params:a})=>({type:l,params:Object.entries(a)}));this.passes.length=0;const{length:o}=i;for(let l=0;l<o;l++){const{type:a,params:u}=i[l],f=await this.addPass(a);u.forEach(([c,p])=>void(f[c]=p))}},updatePasses(i){this.passes.length=0,this.passes.splice(0,0,...i),this.refresh()}},this.stats=new ff,this.loop=hf(this),this.loop.start(),console.info("%cDragalia Lost Model Viewer","color:yellow;background-color:black;font-size:1.5rem;text-shadow: 0 0 0.5rem white")}get background(){return this._background}set background(e){var r,s;if(this._background===e)return;this._background="loading",(s=(r=this.scene.background)==null?void 0:r.dispose)==null||s.call(r);const n=this;(async function(){n.scene.background=await yl(e),n._background=e,e.startsWith("img:")&&n.updateBgAspectRatio()})()}get toneMapping(){var n;const{toneMapping:e}=this.renderer;return((n=Object.entries(yn).find(([,r])=>r===e))==null?void 0:n[0])??"Unknown"}set toneMapping(e){const n=yn[e]?e:"No Mapping";this.renderer.toneMapping=yn[n]}get pixelRatio(){return this.renderer.getPixelRatio()}set pixelRatio(e){this.renderer.setPixelRatio(e),this.postProcessing.composer.setPixelRatio(e)}get unusedModel(){return this.loadedModel.filter(e=>!this.model.includes(e))}async loadDLModel(e=$l){this.dataLoaded||await new Promise(o=>this.addCountedEventListener("dataLoaded",o));const n=Bt.getModelPath(e),r=await Gi(n);r.name=e;const s={id:e,outline:this.settings.outline,material:this.settings.material,viewer:this},i=Hu(r,s);return this.loadedModel.push(i),i.addEventListener("dispose",()=>this.loadedModel.remove(i)),i}add(e){var n;(n=e.detach)==null||n.call(e),this.model.push(e),this.scene.add(e.model),e.parent=this}remove(e){this.model.remove(e),this.scene.remove(e.model)}disposeAllModels(){this.loadedModel.forEach(e=>{var n;return(n=e.dispose)==null?void 0:n.call(e)}),this.model.length=0}static getModelPath(e){return`${this.source.fbx}/${e}/${e}.fbx`}async setViewport(e,n){var o;await dl(200);const r=e??window.innerWidth,s=n??window.innerHeight;this.viewport.set(r,s),this.renderer.setSize(r,s);const i=r/s;return this.camera.aspect=i,this.camera.updateProjectionMatrix(),(o=this.postProcessing.composer)==null||o.setSize(r,s),this.background.startsWith("img:")&&this.updateBgAspectRatio(),this}updateBgAspectRatio(){if(!this.background.startsWith("img:"))return;const{width:e,height:n}=this.viewport,r=e/n,{background:s}=this.scene,{naturalWidth:i,naturalHeight:o}=s.image,l=i/o,a=r/l,u=r>l?[1,1/a]:[a,1];s.repeat.set(...u)}update(e){var n;(n=this.animation)==null||n.update(e),this.model.forEach(r=>{var s;return(s=r.update)==null?void 0:s.call(r,e)}),this.loop.state==="inactive"&&this.render(),this.dispatchEvent({type:"timeUpdate",dt:e})}stopAll(){this.model.forEach(e=>{var n,r;return(r=(n=e.animation)==null?void 0:n.stop)==null?void 0:r.call(n)})}playAll(){this.model.forEach(e=>{var n,r;return(r=(n=e.animation)==null?void 0:n.play)==null?void 0:r.call(n)})}render(){this.dispatchEvent({type:"beforeRender"}),this.postProcessing.enabled?this.postProcessing.composer.render():this.renderer.render(this.scene,this.camera),this.dispatchEvent({type:"afterRender"})}toString(){return"Dragalia Lost Model Viewer"}dispose(){var e,n,r;this.model.forEach(s=>s.dispose()),(n=(e=this.scene.background)==null?void 0:e.dispose)==null||n.call(e),(r=this.renderer.renderLists)==null||r.dispose(),this.renderer.dispose()}};te(Bt,"source",{fbx:Oi,ani:Ii});let Ft=Bt;var X={fullscreenEnabled:0,fullscreenElement:1,requestFullscreen:2,exitFullscreen:3,fullscreenchange:4,fullscreenerror:5,fullscreen:6},ds=["webkitFullscreenEnabled","webkitFullscreenElement","webkitRequestFullscreen","webkitExitFullscreen","webkitfullscreenchange","webkitfullscreenerror","-webkit-full-screen"],hs=["mozFullScreenEnabled","mozFullScreenElement","mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozfullscreenerror","-moz-full-screen"],ms=["msFullscreenEnabled","msFullscreenElement","msRequestFullscreen","msExitFullscreen","MSFullscreenChange","MSFullscreenError","-ms-fullscreen"],V=typeof window<"u"&&typeof window.document<"u"?window.document:{},q="fullscreenEnabled"in V&&Object.keys(X)||ds[0]in V&&ds||hs[0]in V&&hs||ms[0]in V&&ms||[],Df={requestFullscreen:function(t){return t[q[X.requestFullscreen]]()},requestFullscreenFunction:function(t){return t[q[X.requestFullscreen]]},get exitFullscreen(){return V[q[X.exitFullscreen]].bind(V)},get fullscreenPseudoClass(){return":"+q[X.fullscreen]},addEventListener:function(t,e,n){return V.addEventListener(q[X[t]],e,n)},removeEventListener:function(t,e,n){return V.removeEventListener(q[X[t]],e,n)},get fullscreenEnabled(){return!!V[q[X.fullscreenEnabled]]},set fullscreenEnabled(t){},get fullscreenElement(){return V[q[X.fullscreenElement]]},set fullscreenElement(t){},get onfullscreenchange(){return V[("on"+q[X.fullscreenchange]).toLowerCase()]},set onfullscreenchange(t){return V[("on"+q[X.fullscreenchange]).toLowerCase()]=t},get onfullscreenerror(){return V[("on"+q[X.fullscreenerror]).toLowerCase()]},set onfullscreenerror(t){return V[("on"+q[X.fullscreenerror]).toLowerCase()]=t}};const Pt=Df,F=new Ft;F.initData();F.setViewport();F.userData.specialCapture={frameRate:30,duration:5,program:"rotate"};window.addEventListener("resize",()=>F.setViewport());F.canvas.addEventListener("dblclick",Of);window.viewer=F;window.model=F.model;window.getFrame=F.screenshot.getFrame;window.downloadFrames=jn;window.saveAs=rr.saveAs;window.THREE=As;window.makeGif=async t=>{const{makeGif:e}=await D(()=>import("./cda3c7b3-index.js"),[]);return await e(t)};function Of(){Pt.fullscreenEnabled&&(Pt.fullscreenElement?Pt.exitFullscreen():Pt.requestFullscreen(F.canvas))}function If(){try{return window.self!==window.top}catch{return!0}}let _s="";const po=If(),Rf=po?!1:!window.location.hash.includes("showSettings=false"),Ff=po?!1:!window.location.hash.includes("showAC=false"),Bf=t=>({showSettings:Rf,toggleSettings:()=>t(e=>{e.showSettings=!e.showSettings}),loadingMsg:"",setLoadingMsg:e=>t(n=>{n.loadingMsg=e}),showTimeControl:Ff,toggleTimeControl:()=>t(e=>{e.showTimeControl=!e.showTimeControl}),showFrameRate:!1,toggleFrameRate:()=>t(e=>{e.showFrameRate=!e.showFrameRate}),sidebar:{open:!0,toggle:()=>t(e=>{e.sidebar.open=!e.sidebar.open}),settings:{tab:"Model",setTab:e=>t(n=>{n.sidebar.settings.tab=e})},modal:{mode:"",handleSelect:void 0,open:(e,n)=>{_s=F.loop.state,F.loop.stop(),t(r=>{r.sidebar.modal.mode=e,r.sidebar.modal.handleSelect=n})},close:()=>{_s==="active"&&F.loop.start(),t(e=>{e.sidebar.modal.mode="",e.sidebar.modal.handleSelect=void 0})}},manageMode:"single",setManageMode:e=>t(n=>{n.sidebar.manageMode=e})},chainMaker:{target:null,setTarget:e=>t(n=>{n.chainMaker.target=e})},dock:{mode:"",handleSelect:void 0,open:(e="",n)=>t(r=>{r.dock.mode=e,r.dock.handleSelect=n}),close:()=>t(e=>{e.dock.mode="",e.dock.handleSelect=void 0})}});var jf=0;function re(t,e,n,r,s,i){var o,l,a={};for(l in e)l=="ref"?o=e[l]:a[l]=e[l];var u={type:t,props:a,key:n,ref:o,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:--jf,__source:s,__self:i};if(typeof t=="function"&&(o=t.defaultProps))for(l in o)a[l]===void 0&&(a[l]=o[l]);return E.vnode&&E.vnode(u),u}const Nf=H(()=>D(()=>import("./5019fe12-index.js"),["assets/5019fe12-index.js","assets/1a1c4d02-TabBar.js","assets/aad32a0c-ButtonBase.js","assets/5ee18604-Gallery.js","assets/8fbf263d-Popover.js","assets/ddbaae94-createSvgIcon.js","assets/f2e1e7ff-Box.js","assets/713fe822-DialogTitle.js","assets/2385aa70-ColorPicker.js","assets/6a6591bd-ColorButton.js","assets/ee4f7fa1-Button.js","assets/a4b8921d-ColorPicker.css","assets/9eceb903-file2dataURL.js","assets/65e4a706-three.js","assets/aa80096d-index.css"])),$f=H(()=>D(()=>import("./be8833d7-index.js"),["assets/be8833d7-index.js","assets/b53b779d-lists.js","assets/ddbaae94-createSvgIcon.js","assets/aad32a0c-ButtonBase.js","assets/5ee18604-Gallery.js","assets/8fbf263d-Popover.js","assets/f2e1e7ff-Box.js","assets/713fe822-DialogTitle.js","assets/c6e7e94b-Close.js","assets/4341b07e-lists.css","assets/1973af67-filterConfig.js","assets/e1983230-GlowToggle.js","assets/eb519626-GlowToggle.css","assets/ea114570-filterConfig.css","assets/3e32f735-styles.js","assets/6d95f099-styles.css","assets/2ff56570-styles.css","assets/32ddfa65-index.js","assets/65e4a706-three.js"])),Uf=H(()=>D(()=>import("./11269ea9-index.js"),["assets/11269ea9-index.js","assets/b53b779d-lists.js","assets/ddbaae94-createSvgIcon.js","assets/aad32a0c-ButtonBase.js","assets/5ee18604-Gallery.js","assets/8fbf263d-Popover.js","assets/f2e1e7ff-Box.js","assets/713fe822-DialogTitle.js","assets/c6e7e94b-Close.js","assets/4341b07e-lists.css","assets/404f9d2e-Stretcher.js","assets/c7840dc6-Stretcher.css","assets/1a1c4d02-TabBar.js","assets/ee4f7fa1-Button.js","assets/0809c028-ModelIcon.js","assets/cd6a8b52-aniFunction.js","assets/e1741a9e-Selector.js","assets/e1983230-GlowToggle.js","assets/eb519626-GlowToggle.css","assets/88a094c7-Selector.css","assets/a34c0c8e-useKey.js","assets/9eceb903-file2dataURL.js","assets/6743b84d-useToggleState.js","assets/e3e2afb3-Check.js","assets/65e4a706-three.js","assets/f4526f3c-index.css","assets/2ff56570-styles.css"])),zf=H(()=>D(()=>import("./51f51d47-index.js"),["assets/51f51d47-index.js","assets/63673f50-AddWeapon.js","assets/b53b779d-lists.js","assets/ddbaae94-createSvgIcon.js","assets/aad32a0c-ButtonBase.js","assets/5ee18604-Gallery.js","assets/8fbf263d-Popover.js","assets/f2e1e7ff-Box.js","assets/713fe822-DialogTitle.js","assets/c6e7e94b-Close.js","assets/4341b07e-lists.css","assets/1973af67-filterConfig.js","assets/e1983230-GlowToggle.js","assets/eb519626-GlowToggle.css","assets/ea114570-filterConfig.css","assets/32ddfa65-index.js","assets/6743b84d-useToggleState.js","assets/0809c028-ModelIcon.js","assets/45b642d6-AddWeapon.css","assets/2ff56570-styles.css","assets/65e4a706-three.js"])),Vf=H(()=>D(()=>import("./4918decd-ColorSelect.js"),["assets/4918decd-ColorSelect.js","assets/2385aa70-ColorPicker.js","assets/6a6591bd-ColorButton.js","assets/ee4f7fa1-Button.js","assets/aad32a0c-ButtonBase.js","assets/a4b8921d-ColorPicker.css","assets/713fe822-DialogTitle.js","assets/65e4a706-three.js"])),Hf=H(()=>D(()=>import("./ca01eb20-index.js"),["assets/ca01eb20-index.js","assets/3c7d3207-FaceSelect.js","assets/a34c0c8e-useKey.js","assets/be945891-FacePartSelector.js","assets/e1741a9e-Selector.js","assets/e1983230-GlowToggle.js","assets/eb519626-GlowToggle.css","assets/88a094c7-Selector.css","assets/fd6b175b-MeshMouthSelect.js","assets/f2e1e7ff-Box.js","assets/aad32a0c-ButtonBase.js","assets/713fe822-DialogTitle.js","assets/ee4f7fa1-Button.js","assets/7f49998c-MeshMouthSelect.css","assets/febe3778-FaceSelect.css","assets/65e4a706-three.js"])),Wf=H(()=>D(()=>import("./a4cc6694-index.js"),["assets/a4cc6694-index.js","assets/5835c77d-FaceTexture.js","assets/6743b84d-useToggleState.js","assets/b53b779d-lists.js","assets/ddbaae94-createSvgIcon.js","assets/aad32a0c-ButtonBase.js","assets/5ee18604-Gallery.js","assets/8fbf263d-Popover.js","assets/f2e1e7ff-Box.js","assets/713fe822-DialogTitle.js","assets/c6e7e94b-Close.js","assets/4341b07e-lists.css","assets/be945891-FacePartSelector.js","assets/e1741a9e-Selector.js","assets/e1983230-GlowToggle.js","assets/eb519626-GlowToggle.css","assets/88a094c7-Selector.css","assets/1973af67-filterConfig.js","assets/ea114570-filterConfig.css","assets/3e32f735-styles.js","assets/6d95f099-styles.css","assets/2ff56570-styles.css","assets/65e4a706-three.js"])),Gf=H(()=>D(()=>import("./5303d9c4-index.js"),["assets/5303d9c4-index.js","assets/a34c0c8e-useKey.js","assets/404f9d2e-Stretcher.js","assets/c7840dc6-Stretcher.css","assets/97c75a0e-BoneManager.js","assets/0809c028-ModelIcon.js","assets/849dbd69-Accordion.js","assets/6743b84d-useToggleState.js","assets/ddbaae94-createSvgIcon.js","assets/aad32a0c-ButtonBase.js","assets/09fd7fc3-Accordion.css","assets/1973af67-filterConfig.js","assets/5ee18604-Gallery.js","assets/8fbf263d-Popover.js","assets/f2e1e7ff-Box.js","assets/713fe822-DialogTitle.js","assets/e1983230-GlowToggle.js","assets/eb519626-GlowToggle.css","assets/b53b779d-lists.js","assets/c6e7e94b-Close.js","assets/4341b07e-lists.css","assets/ea114570-filterConfig.css","assets/6a6591bd-ColorButton.js","assets/ee4f7fa1-Button.js","assets/3263e411-SkipPrevious.js","assets/3c7d3207-FaceSelect.js","assets/be945891-FacePartSelector.js","assets/e1741a9e-Selector.js","assets/88a094c7-Selector.css","assets/fd6b175b-MeshMouthSelect.js","assets/7f49998c-MeshMouthSelect.css","assets/febe3778-FaceSelect.css","assets/5835c77d-FaceTexture.js","assets/3e32f735-styles.js","assets/6d95f099-styles.css","assets/2ff56570-styles.css","assets/63673f50-AddWeapon.js","assets/32ddfa65-index.js","assets/45b642d6-AddWeapon.css","assets/1b0aec99-BoneManager.css","assets/65e4a706-three.js","assets/98b9a174-index.css"])),gs=H(()=>D(()=>import("./e6b18c2e-index.js"),["assets/e6b18c2e-index.js","assets/fd6b175b-MeshMouthSelect.js","assets/f2e1e7ff-Box.js","assets/aad32a0c-ButtonBase.js","assets/713fe822-DialogTitle.js","assets/ee4f7fa1-Button.js","assets/7f49998c-MeshMouthSelect.css","assets/65e4a706-three.js","assets/045f3dd6-index.css"])),Xf=H(()=>D(()=>import("./41e34f70-index.js"),["assets/41e34f70-index.js","assets/a34c0c8e-useKey.js","assets/849dbd69-Accordion.js","assets/6743b84d-useToggleState.js","assets/ddbaae94-createSvgIcon.js","assets/aad32a0c-ButtonBase.js","assets/09fd7fc3-Accordion.css","assets/0809c028-ModelIcon.js","assets/ee4f7fa1-Button.js","assets/e3e2afb3-Check.js","assets/713fe822-DialogTitle.js","assets/f2e1e7ff-Box.js","assets/65e4a706-three.js","assets/79f787e2-index.css","assets/2ff56570-styles.css"])),ys={background:Nf,model:$f,animation:Uf,weapon:zf,color:Vf,face:Hf,faceTexture:Wf,attachment:Gf,target:Xf,eye:({onSelect:t})=>re(gs,{part:"eye",onSelect:t}),mouth:({onSelect:t})=>re(gs,{part:"mouth",onSelect:t})},Kf=(t,e)=>({Component:void 0,props:void 0,openModal:(n,r)=>t(s=>{s.props=r,s.Component=n}),close:()=>t(n=>{n.Component=void 0}),onClose:void 0,reset:()=>t(n=>{n.Component=n.props=n.onClose=void 0}),getInput:async n=>{if(!ys[n])return null;const{close:r,reset:s}=e(),i=new Promise((o,l)=>{const a=(...u)=>o(u);t(u=>{u.onClose=()=>{l(),r()},u.props={onSelect:a,onAfterSelect:r},u.Component=ys[n]})});try{return await i}catch{return null}finally{s()}},inputModel:()=>e().getInput("model"),inputAni:()=>e().getInput("animation"),inputColor:async()=>{const n=await e().getInput("color");return n==null?void 0:n[0]},inputTarget:()=>e().getInput("target"),inputEye:()=>e().getInput("eye"),inputMouth:()=>e().getInput("mouth")}),Yf=t=>({activeModel:void 0,setActiveModel:e=>t({activeModel:e})}),qf=t=>({open:!1,toggle:()=>t(e=>({open:!e.open})),target:null,setTarget:e=>{e&&(e.userData.chain||(e.userData.chain=new he),t({target:e}))}}),Zf=t=>(e,n,r)=>t(s=>e(Pc(s)),n,r),ht=t=>Yn(Zf(t)),Nn=ht(Bf),Pp=ht(ki),Sp=ht(ki),Qf=ht(Sc),xp=ht(Kf),Tp=Yn(Yf),Ap=Yn(qf);function Jf(){return new Worker("/dl-model/assets/fetchWorker-371b1d98.js")}const ep=t=>{const e=new Jf;return new Promise(n=>{e.addEventListener("message",r=>{e.terminate(),n(r.data)}),e.postMessage(t)})};function ho(){return new Worker("/dl-model/assets/dbWorker-7a44bd92.js")}const mo=(t,e)=>{const n=new ho;return new Promise(r=>{n.addEventListener("message",()=>{r(),n.terminate()}),n.postMessage({type:"put",store:e,value:t})})};function tp(){return new Worker("/dl-model/assets/searchWorker-266b9caf.js")}async function np(t,e="",n=["name"]){if(!e||!n.length)return t;const r=new tp;return new Promise(s=>{r.addEventListener("message",i=>{r.terminate(),s(i.data)}),r.postMessage({fullList:t,query:e,keys:n})})}const Mp=async t=>{const e=Object.values(t).flat();await mo(e,"model"),console.info("Model DB Initialized")},Cp=t=>Qt({type:"get",store:"model",value:t}),Lp=t=>Qt({type:"search",store:"model",index:"name",value:t}),kp=async t=>{const n=(await Qt({type:"getByKeyRange",store:"model",value:"c100000_00-c199999_99"})).filter(({id:r})=>!r.endsWith("h"));return np(n,t)},rp=()=>Qt({type:"getMap",store:"model",index:"name"}),Qt=t=>{const e=new ho;return new Promise(n=>{e.addEventListener("message",r=>{e.terminate(),n(r.data)}),e.postMessage(t)})},lt={},sp=async()=>{if(Object.keys(lt).length)return;const t="ani-personal",e=(await ep([t]))[t];Object.assign(lt,e)},_o=sp(),Dp=t=>lt[t],ip=t=>{var e;return((e=lt[t])==null?void 0:e[0])??(t.startsWith("c")?{name:"Bob",code:"CMN_MWM_03"}:null)},Op=async()=>{const t=await rp();await _o;const e=Object.entries(lt).flatMap(([n,r])=>{const s=t.get(n);return r.map(i=>({...i,user:n,fullName:`${s} ${i.name}`}))});await mo(e,"animation")},op="cccccc",ap="c100001_01",vs=(t,e="Unknown")=>{const n=ao(t),{length:r}=n,s=n.map((i,o)=>{const{aniName:l,reps:a=1,timeScale:u=1,duration:f=[0,100],aniAction:c}=i,p=r>1?e+` #${o+1}`:e;return{id:er(),name:p,aniName:l,reps:a,timeScale:u,duration:f,aniAction:c}});return he.from(s)},ws={ts:{key:"timeScale",defaultValue:1},r:{key:"reps",defaultValue:1}},cp={"face.eyeIdx":"ei","face.mouthIdx":"mi"},Ip=t=>t.map(lp).join(">"),lp=t=>{const{aniName:e}=t,n=up(t),r=fp(t),s=pp(t);return`${e}${n}${r}${s}`},up=t=>{const e=[];return Object.keys(ws).forEach(n=>{const{key:r,defaultValue:s}=ws[n];t[r]&&t[r]!==s&&e.push(`&${n}=${t[r]}`)}),e.join("")},fp=t=>{const{duration:e=[0,100]}=t,[n,r]=e;return n!==0?`&dur=${n}-${r}`:r===100?"":`&dur=${r}`},pp=t=>{const{aniAction:e}=t;return e.length?"&"+e.map(r=>{const{time:s,...i}=r,o=Object.entries(i).map(([l,a])=>`${cp[l]??l}=${a}`);return`@${s}=(${o.join("/")})`}).join("&"):""};function dp(t){if(!(t!=null&&t.userData))return;const{type:e,id:n}=t,{name:r}=t.userData;t.userData.aniSelectState={category:e==="adventurer"?"Adv":"Personal",personalAni:{source:n,sourceName:r}}}function wn(){const t=decodeURI(window.location.hash),e=fo(t),n=Object.fromEntries(e);hp(n),mp(t)}function hp(t){const{bg:e=op,showAC:n="true",showSettings:r="true"}=t;F.background=e,Nn.setState({showTimeControl:Kr(n)}),Nn.setState({showSettings:Kr(r)})}async function mp(t){F.disposeAllModels(),setTimeout(async()=>{const e=t.includes("id=")?t:t+`/id=${ap}`,n=await F.loadModelFromCode(e);F.add(n);const r=n.type==="adventurer"?"Adv":"Personal";Qf.getState().setCategory(r),dp(n);const{id:s}=n;if(!t.includes("camPos=")){const o=Xl(s);F.camera.position.set(...o)}const i=Yl(s);if(F.controls.target.set(...i),t.includes("ani=")){const o=n.animation.current.chainCode??"";o&&(n.userData.chain=vs(o,"init"))}else{const o=ip(s);if(o){const{code:l,name:a}=o;n.animation.addChain(l),n.userData.chain=vs(l,a)}}})}const _p=H(()=>D(()=>import("./c40adaf2-index.js"),["assets/c40adaf2-index.js","assets/ddbaae94-createSvgIcon.js","assets/aad32a0c-ButtonBase.js","assets/97c75a0e-BoneManager.js","assets/0809c028-ModelIcon.js","assets/849dbd69-Accordion.js","assets/6743b84d-useToggleState.js","assets/09fd7fc3-Accordion.css","assets/1973af67-filterConfig.js","assets/5ee18604-Gallery.js","assets/8fbf263d-Popover.js","assets/f2e1e7ff-Box.js","assets/713fe822-DialogTitle.js","assets/e1983230-GlowToggle.js","assets/eb519626-GlowToggle.css","assets/b53b779d-lists.js","assets/c6e7e94b-Close.js","assets/4341b07e-lists.css","assets/ea114570-filterConfig.css","assets/6a6591bd-ColorButton.js","assets/ee4f7fa1-Button.js","assets/3263e411-SkipPrevious.js","assets/a34c0c8e-useKey.js","assets/3c7d3207-FaceSelect.js","assets/be945891-FacePartSelector.js","assets/e1741a9e-Selector.js","assets/88a094c7-Selector.css","assets/fd6b175b-MeshMouthSelect.js","assets/7f49998c-MeshMouthSelect.css","assets/febe3778-FaceSelect.css","assets/5835c77d-FaceTexture.js","assets/3e32f735-styles.js","assets/6d95f099-styles.css","assets/2ff56570-styles.css","assets/63673f50-AddWeapon.js","assets/32ddfa65-index.js","assets/45b642d6-AddWeapon.css","assets/1b0aec99-BoneManager.css","assets/1a1c4d02-TabBar.js","assets/cd6a8b52-aniFunction.js","assets/65e4a706-three.js","assets/0f03617c-index.css"])),gp=H(()=>D(()=>import("./2e1d2a74-index.js"),["assets/2e1d2a74-index.js","assets/6743b84d-useToggleState.js","assets/e1983230-GlowToggle.js","assets/eb519626-GlowToggle.css","assets/ee4f7fa1-Button.js","assets/aad32a0c-ButtonBase.js","assets/8fbf263d-Popover.js","assets/3263e411-SkipPrevious.js","assets/ddbaae94-createSvgIcon.js","assets/c6e7e94b-Close.js","assets/65e4a706-three.js","assets/0a450c69-index.css"]));function yp(){const t=za(),e=it(),n=it(),{loadingMsg:r,showTimeControl:s,showSettings:i,showFrameRate:o}=Nn();return He(()=>(t&&_o.then(wn),window.addEventListener("hashchange",wn),()=>window.removeEventListener("hashchange",wn))),He(()=>{e.current.appendChild(F.canvas),F.stats.dom.style.position="",n.current.appendChild(F.stats.dom)},[]),re(ce,{children:[i&&re(Ce,{fallback:null,children:re(_p,{})}),re("div",{className:"mount",ref:l=>e.current=l}),re("div",{className:"stats",style:{display:o?"unset":"none"},ref:l=>n.current=l}),r&&re("div",{className:"loading-msg",children:r}),s&&re(Ce,{fallback:null,children:re(gp,{})})]})}ze(re(yp,{}),document.getElementById("app"));export{ys as $,ss as A,Oi as B,Wu as C,Ce as D,ls as E,Xu as F,Vs as G,Ws as H,Pc as I,ri as J,$a as K,Yc as L,H as M,Qf as N,Js as O,qt as P,Dp as Q,Ua as R,di as S,Gs as T,Yn as U,Ap as V,vs as W,ft as X,vi as Y,ae as Z,it as _,xp as a,ip as a0,Xl as a1,Yl as a2,yn as a3,Vn as a4,pi as a5,nr as a6,Ep as a7,Nl as a8,rr as a9,ts as aa,vf as ab,yf as ac,Ip as ad,er as ae,ep as af,Mp as ag,_o as ah,Op as ai,Be as aj,Ei as ak,Ot as al,ie as am,np as b,Pp as c,mo as d,Qt as e,D as f,pl as g,$t as h,kp as i,Xn as j,Qs as k,ce as l,Nn as m,za as n,re as o,He as p,Xs as q,Cp as r,Lp as s,dp as t,Tp as u,F as v,Sp as w,Zs as x,Ut as y,li as z};
