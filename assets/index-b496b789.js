var Si=Object.defineProperty;var Ai=(t,e,n)=>e in t?Si(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var te=(t,e,n)=>(Ai(t,typeof e!="symbol"?e+"":e,n),n);import{E as Ti,V as N,M as Ie,T as Re,Q as Be,S as gr,a as B,b as Bt,C as Mi,L as Ci,c as Li,F as Oi,d as Xe,R as _r,e as yr,f as vr,g as en,h as ki,i as U,s as Q,j as Di,k as O,G as br,B as wr,P as Ot,O as tn,l as Co,m as Lo,n as bn,o as ie,p as Ii,D as Oo,q as Ri,r as ko,t as Fi,u as $i,v as ji,A as Do,w as At,x as we,U as Bi,y as Ni,z as Io,H as Ee,I as Ui,J as zi,N as Vi,K as Hi,W as Wi,X as Bn,Y as et,Z as st,_ as Er,$ as Gi,a0 as Pr,a1 as Xi,a2 as Ki,a3 as Yi,a4 as Ro,a5 as qi,a6 as Zi,a7 as Qi,a8 as Ji,a9 as ea,aa as ta,ab as na,ac as ra,ad as oa,ae as sa,af as ia,ag as aa,ah as ca,ai as la,aj as Fo,ak as $o,al as xr,am as ua,an as fa,ao as pa,ap as da}from"./f81b78b9-three.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();var pt,E,jo,Ue,Me,Sr,Bo,No,kt={},Uo=[],ha=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function de(t,e){for(var n in e)t[n]=e[n];return t}function zo(t){var e=t.parentNode;e&&e.removeChild(t)}function ce(t,e,n){var r,o,s,i={};for(s in e)s=="key"?r=e[s]:s=="ref"?o=e[s]:i[s]=e[s];if(arguments.length>2&&(i.children=arguments.length>3?pt.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(s in t.defaultProps)i[s]===void 0&&(i[s]=t.defaultProps[s]);return nt(t,i,r,o,null)}function nt(t,e,n,r,o){var s={type:t,props:e,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:o??++jo};return o==null&&E.vnode!=null&&E.vnode(s),s}function Vo(){return{current:null}}function le(t){return t.children}function ma(t,e,n,r,o){var s;for(s in n)s==="children"||s==="key"||s in e||Dt(t,s,null,n[s],r);for(s in e)o&&typeof e[s]!="function"||s==="children"||s==="key"||s==="value"||s==="checked"||n[s]===e[s]||Dt(t,s,e[s],n[s],r)}function Ar(t,e,n){e[0]==="-"?t.setProperty(e,n??""):t[e]=n==null?"":typeof n!="number"||ha.test(e)?n:n+"px"}function Dt(t,e,n,r,o){var s;e:if(e==="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof r=="string"&&(t.style.cssText=r=""),r)for(e in r)n&&e in n||Ar(t.style,e,"");if(n)for(e in n)r&&n[e]===r[e]||Ar(t.style,e,n[e])}else if(e[0]==="o"&&e[1]==="n")s=e!==(e=e.replace(/Capture$/,"")),e=e.toLowerCase()in t?e.toLowerCase().slice(2):e.slice(2),t.l||(t.l={}),t.l[e+s]=n,n?r||t.addEventListener(e,s?Mr:Tr,s):t.removeEventListener(e,s?Mr:Tr,s);else if(e!=="dangerouslySetInnerHTML"){if(o)e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!=="width"&&e!=="height"&&e!=="href"&&e!=="list"&&e!=="form"&&e!=="tabIndex"&&e!=="download"&&e in t)try{t[e]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&e.indexOf("-")==-1?t.removeAttribute(e):t.setAttribute(e,n))}}function Tr(t){Ue=!0;try{return this.l[t.type+!1](E.event?E.event(t):t)}finally{Ue=!1}}function Mr(t){Ue=!0;try{return this.l[t.type+!0](E.event?E.event(t):t)}finally{Ue=!1}}function se(t,e){this.props=t,this.context=e}function it(t,e){if(e==null)return t.__?it(t.__,t.__.__k.indexOf(t)+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?it(t):null}function Ho(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return Ho(t)}}function ga(t){Ue?setTimeout(t):Bo(t)}function wn(t){(!t.__d&&(t.__d=!0)&&Me.push(t)&&!It.__r++||Sr!==E.debounceRendering)&&((Sr=E.debounceRendering)||ga)(It)}function It(){var t,e,n,r,o,s,i,u;for(Me.sort(function(c,l){return c.__v.__b-l.__v.__b});t=Me.shift();)t.__d&&(e=Me.length,r=void 0,o=void 0,i=(s=(n=t).__v).__e,(u=n.__P)&&(r=[],(o=de({},s)).__v=s.__v+1,Nn(u,s,o,n.__n,u.ownerSVGElement!==void 0,s.__h!=null?[i]:null,r,i??it(s),s.__h),Yo(r,s),s.__e!=i&&Ho(s)),Me.length>e&&Me.sort(function(c,l){return c.__v.__b-l.__v.__b}));It.__r=0}function Wo(t,e,n,r,o,s,i,u,c,l){var a,f,p,d,h,g,y,v=r&&r.__k||Uo,b=v.length;for(n.__k=[],a=0;a<e.length;a++)if((d=n.__k[a]=(d=e[a])==null||typeof d=="boolean"?null:typeof d=="string"||typeof d=="number"||typeof d=="bigint"?nt(null,d,null,null,d):Array.isArray(d)?nt(le,{children:d},null,null,null):d.__b>0?nt(d.type,d.props,d.key,d.ref?d.ref:null,d.__v):d)!=null){if(d.__=n,d.__b=n.__b+1,(p=v[a])===null||p&&d.key==p.key&&d.type===p.type)v[a]=void 0;else for(f=0;f<b;f++){if((p=v[f])&&d.key==p.key&&d.type===p.type){v[f]=void 0;break}p=null}Nn(t,d,p=p||kt,o,s,i,u,c,l),h=d.__e,(f=d.ref)&&p.ref!=f&&(y||(y=[]),p.ref&&y.push(p.ref,null,d),y.push(f,d.__c||h,d)),h!=null?(g==null&&(g=h),typeof d.type=="function"&&d.__k===p.__k?d.__d=c=Go(d,c,t):c=Xo(t,d,p,v,h,c),typeof n.type=="function"&&(n.__d=c)):c&&p.__e==c&&c.parentNode!=t&&(c=it(p))}for(n.__e=g,a=b;a--;)v[a]!=null&&(typeof n.type=="function"&&v[a].__e!=null&&v[a].__e==n.__d&&(n.__d=Ko(r).nextSibling),Zo(v[a],v[a]));if(y)for(a=0;a<y.length;a++)qo(y[a],y[++a],y[++a])}function Go(t,e,n){for(var r,o=t.__k,s=0;o&&s<o.length;s++)(r=o[s])&&(r.__=t,e=typeof r.type=="function"?Go(r,e,n):Xo(n,r,r,o,r.__e,e));return e}function ge(t,e){return e=e||[],t==null||typeof t=="boolean"||(Array.isArray(t)?t.some(function(n){ge(n,e)}):e.push(t)),e}function Xo(t,e,n,r,o,s){var i,u,c;if(e.__d!==void 0)i=e.__d,e.__d=void 0;else if(n==null||o!=s||o.parentNode==null)e:if(s==null||s.parentNode!==t)t.appendChild(o),i=null;else{for(u=s,c=0;(u=u.nextSibling)&&c<r.length;c+=1)if(u==o)break e;t.insertBefore(o,s),i=s}return i!==void 0?i:o.nextSibling}function Ko(t){var e,n,r;if(t.type==null||typeof t.type=="string")return t.__e;if(t.__k){for(e=t.__k.length-1;e>=0;e--)if((n=t.__k[e])&&(r=Ko(n)))return r}return null}function Nn(t,e,n,r,o,s,i,u,c){var l,a,f,p,d,h,g,y,v,b,_,P,w,T,R,A=e.type;if(e.constructor!==void 0)return null;n.__h!=null&&(c=n.__h,u=e.__e=n.__e,e.__h=null,s=[u]),(l=E.__b)&&l(e);try{e:if(typeof A=="function"){if(y=e.props,v=(l=A.contextType)&&r[l.__c],b=l?v?v.props.value:l.__:r,n.__c?g=(a=e.__c=n.__c).__=a.__E:("prototype"in A&&A.prototype.render?e.__c=a=new A(y,b):(e.__c=a=new se(y,b),a.constructor=A,a.render=ya),v&&v.sub(a),a.props=y,a.state||(a.state={}),a.context=b,a.__n=r,f=a.__d=!0,a.__h=[],a._sb=[]),a.__s==null&&(a.__s=a.state),A.getDerivedStateFromProps!=null&&(a.__s==a.state&&(a.__s=de({},a.__s)),de(a.__s,A.getDerivedStateFromProps(y,a.__s))),p=a.props,d=a.state,a.__v=e,f)A.getDerivedStateFromProps==null&&a.componentWillMount!=null&&a.componentWillMount(),a.componentDidMount!=null&&a.__h.push(a.componentDidMount);else{if(A.getDerivedStateFromProps==null&&y!==p&&a.componentWillReceiveProps!=null&&a.componentWillReceiveProps(y,b),!a.__e&&a.shouldComponentUpdate!=null&&a.shouldComponentUpdate(y,a.__s,b)===!1||e.__v===n.__v){for(e.__v!==n.__v&&(a.props=y,a.state=a.__s,a.__d=!1),e.__e=n.__e,e.__k=n.__k,e.__k.forEach(function(F){F&&(F.__=e)}),_=0;_<a._sb.length;_++)a.__h.push(a._sb[_]);a._sb=[],a.__h.length&&i.push(a);break e}a.componentWillUpdate!=null&&a.componentWillUpdate(y,a.__s,b),a.componentDidUpdate!=null&&a.__h.push(function(){a.componentDidUpdate(p,d,h)})}if(a.context=b,a.props=y,a.__P=t,P=E.__r,w=0,"prototype"in A&&A.prototype.render){for(a.state=a.__s,a.__d=!1,P&&P(e),l=a.render(a.props,a.state,a.context),T=0;T<a._sb.length;T++)a.__h.push(a._sb[T]);a._sb=[]}else do a.__d=!1,P&&P(e),l=a.render(a.props,a.state,a.context),a.state=a.__s;while(a.__d&&++w<25);a.state=a.__s,a.getChildContext!=null&&(r=de(de({},r),a.getChildContext())),f||a.getSnapshotBeforeUpdate==null||(h=a.getSnapshotBeforeUpdate(p,d)),R=l!=null&&l.type===le&&l.key==null?l.props.children:l,Wo(t,Array.isArray(R)?R:[R],e,n,r,o,s,i,u,c),a.base=e.__e,e.__h=null,a.__h.length&&i.push(a),g&&(a.__E=a.__=null),a.__e=!1}else s==null&&e.__v===n.__v?(e.__k=n.__k,e.__e=n.__e):e.__e=_a(n.__e,e,n,r,o,s,i,c);(l=E.diffed)&&l(e)}catch(F){e.__v=null,(c||s!=null)&&(e.__e=u,e.__h=!!c,s[s.indexOf(u)]=null),E.__e(F,e,n)}}function Yo(t,e){E.__c&&E.__c(e,t),t.some(function(n){try{t=n.__h,n.__h=[],t.some(function(r){r.call(n)})}catch(r){E.__e(r,n.__v)}})}function _a(t,e,n,r,o,s,i,u){var c,l,a,f=n.props,p=e.props,d=e.type,h=0;if(d==="svg"&&(o=!0),s!=null){for(;h<s.length;h++)if((c=s[h])&&"setAttribute"in c==!!d&&(d?c.localName===d:c.nodeType===3)){t=c,s[h]=null;break}}if(t==null){if(d===null)return document.createTextNode(p);t=o?document.createElementNS("http://www.w3.org/2000/svg",d):document.createElement(d,p.is&&p),s=null,u=!1}if(d===null)f===p||u&&t.data===p||(t.data=p);else{if(s=s&&pt.call(t.childNodes),l=(f=n.props||kt).dangerouslySetInnerHTML,a=p.dangerouslySetInnerHTML,!u){if(s!=null)for(f={},h=0;h<t.attributes.length;h++)f[t.attributes[h].name]=t.attributes[h].value;(a||l)&&(a&&(l&&a.__html==l.__html||a.__html===t.innerHTML)||(t.innerHTML=a&&a.__html||""))}if(ma(t,p,f,o,u),a)e.__k=[];else if(h=e.props.children,Wo(t,Array.isArray(h)?h:[h],e,n,r,o&&d!=="foreignObject",s,i,s?s[0]:n.__k&&it(n,0),u),s!=null)for(h=s.length;h--;)s[h]!=null&&zo(s[h]);u||("value"in p&&(h=p.value)!==void 0&&(h!==t.value||d==="progress"&&!h||d==="option"&&h!==f.value)&&Dt(t,"value",h,f.value,!1),"checked"in p&&(h=p.checked)!==void 0&&h!==t.checked&&Dt(t,"checked",h,f.checked,!1))}return t}function qo(t,e,n){try{typeof t=="function"?t(e):t.current=e}catch(r){E.__e(r,n)}}function Zo(t,e,n){var r,o;if(E.unmount&&E.unmount(t),(r=t.ref)&&(r.current&&r.current!==t.__e||qo(r,null,e)),(r=t.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(s){E.__e(s,e)}r.base=r.__P=null,t.__c=void 0}if(r=t.__k)for(o=0;o<r.length;o++)r[o]&&Zo(r[o],e,n||typeof t.type!="function");n||t.__e==null||zo(t.__e),t.__=t.__e=t.__d=void 0}function ya(t,e,n){return this.constructor(t,n)}function ze(t,e,n){var r,o,s;E.__&&E.__(t,e),o=(r=typeof n=="function")?null:n&&n.__k||e.__k,s=[],Nn(e,t=(!r&&n||e).__k=ce(le,null,[t]),o||kt,kt,e.ownerSVGElement!==void 0,!r&&n?[n]:o?null:e.firstChild?pt.call(e.childNodes):null,s,!r&&n?n:o?o.__e:e.firstChild,r),Yo(s,t)}function Qo(t,e){ze(t,e,Qo)}function va(t,e,n){var r,o,s,i=de({},t.props);for(s in e)s=="key"?r=e[s]:s=="ref"?o=e[s]:i[s]=e[s];return arguments.length>2&&(i.children=arguments.length>3?pt.call(arguments,2):n),nt(t.type,i,r||t.key,o||t.ref,null)}function Jo(t,e){var n={__c:e="__cC"+No++,__:t,Consumer:function(r,o){return r.children(o)},Provider:function(r){var o,s;return this.getChildContext||(o=[],(s={})[e]=this,this.getChildContext=function(){return s},this.shouldComponentUpdate=function(i){this.props.value!==i.value&&o.some(function(u){u.__e=!0,wn(u)})},this.sub=function(i){o.push(i);var u=i.componentWillUnmount;i.componentWillUnmount=function(){o.splice(o.indexOf(i),1),u&&u.call(i)}}),r.children}};return n.Provider.__=n.Consumer.contextType=n}pt=Uo.slice,E={__e:function(t,e,n,r){for(var o,s,i;e=e.__;)if((o=e.__c)&&!o.__)try{if((s=o.constructor)&&s.getDerivedStateFromError!=null&&(o.setState(s.getDerivedStateFromError(t)),i=o.__d),o.componentDidCatch!=null&&(o.componentDidCatch(t,r||{}),i=o.__d),i)return o.__E=o}catch(u){t=u}throw t}},jo=0,Ue=!1,se.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=de({},this.state),typeof t=="function"&&(t=t(de({},n),this.props)),t&&de(n,t),t!=null&&this.__v&&(e&&this._sb.push(e),wn(this))},se.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),wn(this))},se.prototype.render=le,Me=[],Bo=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,It.__r=0,No=0;const ba="modulepreload",wa=function(t){return"/dl-model/"+t},Cr={},L=function(e,n,r){if(!n||n.length===0)return e();const o=document.getElementsByTagName("link");return Promise.all(n.map(s=>{if(s=wa(s),s in Cr)return;Cr[s]=!0;const i=s.endsWith(".css"),u=i?'[rel="stylesheet"]':"";if(!!r)for(let a=o.length-1;a>=0;a--){const f=o[a];if(f.href===s&&(!i||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${u}`))return;const l=document.createElement("link");if(l.rel=i?"stylesheet":ba,i||(l.as="script",l.crossOrigin=""),l.href=s,document.head.appendChild(l),i)return new Promise((a,f)=>{l.addEventListener("load",a),l.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e())};var xe,M,nn,Lr,Ve=0,es=[],Tt=[],Or=E.__b,kr=E.__r,Dr=E.diffed,Ir=E.__c,Rr=E.unmount;function Oe(t,e){E.__h&&E.__h(M,t,Ve||e),Ve=0;var n=M.__H||(M.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({__V:Tt}),n.__[t]}function Nt(t){return Ve=1,Un(ss,t)}function Un(t,e,n){var r=Oe(xe++,2);if(r.t=t,!r.__c&&(r.__=[n?n(e):ss(void 0,e),function(s){var i=r.__N?r.__N[0]:r.__[0],u=r.t(i,s);i!==u&&(r.__N=[u,r.__[1]],r.__c.setState({}))}],r.__c=M,!M.u)){M.u=!0;var o=M.shouldComponentUpdate;M.shouldComponentUpdate=function(s,i,u){if(!r.__c.__H)return!0;var c=r.__c.__H.__.filter(function(a){return a.__c});if(c.every(function(a){return!a.__N}))return!o||o.call(this,s,i,u);var l=!1;return c.forEach(function(a){if(a.__N){var f=a.__[0];a.__=a.__N,a.__N=void 0,f!==a.__[0]&&(l=!0)}}),!(!l&&r.__c.props===s)&&(!o||o.call(this,s,i,u))}}return r.__N||r.__}function He(t,e){var n=Oe(xe++,3);!E.__s&&Vn(n.__H,e)&&(n.__=t,n.i=e,M.__H.__h.push(n))}function dt(t,e){var n=Oe(xe++,4);!E.__s&&Vn(n.__H,e)&&(n.__=t,n.i=e,M.__h.push(n))}function at(t){return Ve=5,Ut(function(){return{current:t}},[])}function ts(t,e,n){Ve=6,dt(function(){return typeof t=="function"?(t(e()),function(){return t(null)}):t?(t.current=e(),function(){return t.current=null}):void 0},n==null?n:n.concat(t))}function Ut(t,e){var n=Oe(xe++,7);return Vn(n.__H,e)?(n.__V=t(),n.i=e,n.__h=t,n.__V):n.__}function ns(t,e){return Ve=8,Ut(function(){return t},e)}function rs(t){var e=M.context[t.__c],n=Oe(xe++,9);return n.c=t,e?(n.__==null&&(n.__=!0,e.sub(M)),e.props.value):t.__}function zn(t,e){E.useDebugValue&&E.useDebugValue(e?e(t):t)}function Ea(t){var e=Oe(xe++,10),n=Nt();return e.__=t,M.componentDidCatch||(M.componentDidCatch=function(r,o){e.__&&e.__(r,o),n[1](r)}),[n[0],function(){n[1](void 0)}]}function os(){var t=Oe(xe++,11);if(!t.__){for(var e=M.__v;e!==null&&!e.__m&&e.__!==null;)e=e.__;var n=e.__m||(e.__m=[0,0]);t.__="P"+n[0]+"-"+n[1]++}return t.__}function Pa(){for(var t;t=es.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(Mt),t.__H.__h.forEach(En),t.__H.__h=[]}catch(e){t.__H.__h=[],E.__e(e,t.__v)}}E.__b=function(t){M=null,Or&&Or(t)},E.__r=function(t){kr&&kr(t),xe=0;var e=(M=t.__c).__H;e&&(nn===M?(e.__h=[],M.__h=[],e.__.forEach(function(n){n.__N&&(n.__=n.__N),n.__V=Tt,n.__N=n.i=void 0})):(e.__h.forEach(Mt),e.__h.forEach(En),e.__h=[])),nn=M},E.diffed=function(t){Dr&&Dr(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(es.push(e)!==1&&Lr===E.requestAnimationFrame||((Lr=E.requestAnimationFrame)||xa)(Pa)),e.__H.__.forEach(function(n){n.i&&(n.__H=n.i),n.__V!==Tt&&(n.__=n.__V),n.i=void 0,n.__V=Tt})),nn=M=null},E.__c=function(t,e){e.some(function(n){try{n.__h.forEach(Mt),n.__h=n.__h.filter(function(r){return!r.__||En(r)})}catch(r){e.some(function(o){o.__h&&(o.__h=[])}),e=[],E.__e(r,n.__v)}}),Ir&&Ir(t,e)},E.unmount=function(t){Rr&&Rr(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(r){try{Mt(r)}catch(o){e=o}}),n.__H=void 0,e&&E.__e(e,n.__v))};var Fr=typeof requestAnimationFrame=="function";function xa(t){var e,n=function(){clearTimeout(r),Fr&&cancelAnimationFrame(e),setTimeout(t)},r=setTimeout(n,100);Fr&&(e=requestAnimationFrame(n))}function Mt(t){var e=M,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),M=e}function En(t){var e=M;t.__c=t.__(),M=e}function Vn(t,e){return!t||t.length!==e.length||e.some(function(n,r){return n!==t[r]})}function ss(t,e){return typeof e=="function"?e(t):e}function is(t,e){for(var n in e)t[n]=e[n];return t}function Pn(t,e){for(var n in t)if(n!=="__source"&&!(n in e))return!0;for(var r in e)if(r!=="__source"&&t[r]!==e[r])return!0;return!1}function rn(t,e){return t===e&&(t!==0||1/t==1/e)||t!=t&&e!=e}function Rt(t){this.props=t}function as(t,e){function n(o){var s=this.props.ref,i=s==o.ref;return!i&&s&&(s.call?s(null):s.current=null),e?!e(this.props,o)||!i:Pn(this.props,o)}function r(o){return this.shouldComponentUpdate=n,ce(t,o)}return r.displayName="Memo("+(t.displayName||t.name)+")",r.prototype.isReactComponent=!0,r.__f=!0,r}(Rt.prototype=new se).isPureReactComponent=!0,Rt.prototype.shouldComponentUpdate=function(t,e){return Pn(this.props,t)||Pn(this.state,e)};var $r=E.__b;E.__b=function(t){t.type&&t.type.__f&&t.ref&&(t.props.ref=t.ref,t.ref=null),$r&&$r(t)};var Sa=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function cs(t){function e(n){var r=is({},n);return delete r.ref,t(r,n.ref||null)}return e.$$typeof=Sa,e.render=e,e.prototype.isReactComponent=e.__f=!0,e.displayName="ForwardRef("+(t.displayName||t.name)+")",e}var jr=function(t,e){return t==null?null:ge(ge(t).map(e))},ls={map:jr,forEach:jr,count:function(t){return t?ge(t).length:0},only:function(t){var e=ge(t);if(e.length!==1)throw"Children.only";return e[0]},toArray:ge},Aa=E.__e;E.__e=function(t,e,n,r){if(t.then){for(var o,s=e;s=s.__;)if((o=s.__c)&&o.__c)return e.__e==null&&(e.__e=n.__e,e.__k=n.__k),o.__c(t,e)}Aa(t,e,n,r)};var Br=E.unmount;function us(t,e,n){return t&&(t.__c&&t.__c.__H&&(t.__c.__H.__.forEach(function(r){typeof r.__c=="function"&&r.__c()}),t.__c.__H=null),(t=is({},t)).__c!=null&&(t.__c.__P===n&&(t.__c.__P=e),t.__c=null),t.__k=t.__k&&t.__k.map(function(r){return us(r,e,n)})),t}function fs(t,e,n){return t&&(t.__v=null,t.__k=t.__k&&t.__k.map(function(r){return fs(r,e,n)}),t.__c&&t.__c.__P===e&&(t.__e&&n.insertBefore(t.__e,t.__d),t.__c.__e=!0,t.__c.__P=n)),t}function Ce(){this.__u=0,this.t=null,this.__b=null}function ps(t){var e=t.__.__c;return e&&e.__a&&e.__a(t)}function H(t){var e,n,r;function o(s){if(e||(e=t()).then(function(i){n=i.default||i},function(i){r=i}),r)throw r;if(!n)throw e;return ce(n,s)}return o.displayName="Lazy",o.__f=!0,o}function Ne(){this.u=null,this.o=null}E.unmount=function(t){var e=t.__c;e&&e.__R&&e.__R(),e&&t.__h===!0&&(t.type=null),Br&&Br(t)},(Ce.prototype=new se).__c=function(t,e){var n=e.__c,r=this;r.t==null&&(r.t=[]),r.t.push(n);var o=ps(r.__v),s=!1,i=function(){s||(s=!0,n.__R=null,o?o(u):u())};n.__R=i;var u=function(){if(!--r.__u){if(r.state.__a){var l=r.state.__a;r.__v.__k[0]=fs(l,l.__c.__P,l.__c.__O)}var a;for(r.setState({__a:r.__b=null});a=r.t.pop();)a.forceUpdate()}},c=e.__h===!0;r.__u++||c||r.setState({__a:r.__b=r.__v.__k[0]}),t.then(i,i)},Ce.prototype.componentWillUnmount=function(){this.t=[]},Ce.prototype.render=function(t,e){if(this.__b){if(this.__v.__k){var n=document.createElement("div"),r=this.__v.__k[0].__c;this.__v.__k[0]=us(this.__b,n,r.__O=r.__P)}this.__b=null}var o=e.__a&&ce(le,null,t.fallback);return o&&(o.__h=null),[ce(le,null,e.__a?null:t.children),o]};var Nr=function(t,e,n){if(++n[1]===n[0]&&t.o.delete(e),t.props.revealOrder&&(t.props.revealOrder[0]!=="t"||!t.o.size))for(n=t.u;n;){for(;n.length>3;)n.pop()();if(n[1]<n[0])break;t.u=n=n[2]}};function Ta(t){return this.getChildContext=function(){return t.context},t.children}function Ma(t){var e=this,n=t.i;e.componentWillUnmount=function(){ze(null,e.l),e.l=null,e.i=null},e.i&&e.i!==n&&e.componentWillUnmount(),t.__v?(e.l||(e.i=n,e.l={nodeType:1,parentNode:n,childNodes:[],appendChild:function(r){this.childNodes.push(r),e.i.appendChild(r)},insertBefore:function(r,o){this.childNodes.push(r),e.i.appendChild(r)},removeChild:function(r){this.childNodes.splice(this.childNodes.indexOf(r)>>>1,1),e.i.removeChild(r)}}),ze(ce(Ta,{context:e.context},t.__v),e.l)):e.l&&e.componentWillUnmount()}function ds(t,e){var n=ce(Ma,{__v:t,i:e});return n.containerInfo=e,n}(Ne.prototype=new se).__a=function(t){var e=this,n=ps(e.__v),r=e.o.get(t);return r[0]++,function(o){var s=function(){e.props.revealOrder?(r.push(o),Nr(e,t,r)):o()};n?n(s):s()}},Ne.prototype.render=function(t){this.u=null,this.o=new Map;var e=ge(t.children);t.revealOrder&&t.revealOrder[0]==="b"&&e.reverse();for(var n=e.length;n--;)this.o.set(e[n],this.u=[1,0,this.u]);return t.children},Ne.prototype.componentDidUpdate=Ne.prototype.componentDidMount=function(){var t=this;this.o.forEach(function(e,n){Nr(t,n,e)})};var hs=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,Ca=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,La=typeof document<"u",Oa=function(t){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/i:/fil|che|ra/i).test(t)};function ms(t,e,n){return e.__k==null&&(e.textContent=""),ze(t,e),typeof n=="function"&&n(),t?t.__c:null}function gs(t,e,n){return Qo(t,e),typeof n=="function"&&n(),t?t.__c:null}se.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(t){Object.defineProperty(se.prototype,t,{configurable:!0,get:function(){return this["UNSAFE_"+t]},set:function(e){Object.defineProperty(this,t,{configurable:!0,writable:!0,value:e})}})});var Ur=E.event;function ka(){}function Da(){return this.cancelBubble}function Ia(){return this.defaultPrevented}E.event=function(t){return Ur&&(t=Ur(t)),t.persist=ka,t.isPropagationStopped=Da,t.isDefaultPrevented=Ia,t.nativeEvent=t};var _s,zr={configurable:!0,get:function(){return this.class}},Vr=E.vnode;E.vnode=function(t){var e=t.type,n=t.props,r=n;if(typeof e=="string"){var o=e.indexOf("-")===-1;for(var s in r={},n){var i=n[s];La&&s==="children"&&e==="noscript"||s==="value"&&"defaultValue"in n&&i==null||(s==="defaultValue"&&"value"in n&&n.value==null?s="value":s==="download"&&i===!0?i="":/ondoubleclick/i.test(s)?s="ondblclick":/^onchange(textarea|input)/i.test(s+e)&&!Oa(n.type)?s="oninput":/^onfocus$/i.test(s)?s="onfocusin":/^onblur$/i.test(s)?s="onfocusout":/^on(Ani|Tra|Tou|BeforeInp|Compo)/.test(s)?s=s.toLowerCase():o&&Ca.test(s)?s=s.replace(/[A-Z0-9]/g,"-$&").toLowerCase():i===null&&(i=void 0),/^oninput$/i.test(s)&&(s=s.toLowerCase(),r[s]&&(s="oninputCapture")),r[s]=i)}e=="select"&&r.multiple&&Array.isArray(r.value)&&(r.value=ge(n.children).forEach(function(u){u.props.selected=r.value.indexOf(u.props.value)!=-1})),e=="select"&&r.defaultValue!=null&&(r.value=ge(n.children).forEach(function(u){u.props.selected=r.multiple?r.defaultValue.indexOf(u.props.value)!=-1:r.defaultValue==u.props.value})),t.props=r,n.class!=n.className&&(zr.enumerable="className"in n,n.className!=null&&(r.class=n.className),Object.defineProperty(r,"className",zr))}t.$$typeof=hs,Vr&&Vr(t)};var Hr=E.__r;E.__r=function(t){Hr&&Hr(t),_s=t.__c};var ys={ReactCurrentDispatcher:{current:{readContext:function(t){return _s.__n[t.__c].props.value}}}},Ra="17.0.2";function vs(t){return ce.bind(null,t)}function Hn(t){return!!t&&t.$$typeof===hs}function bs(t){return Hn(t)?va.apply(null,arguments):t}function ws(t){return!!t.__k&&(ze(null,t),!0)}function Es(t){return t&&(t.base||t.nodeType===1&&t)||null}var Ps=function(t,e){return t(e)},xs=function(t,e){return t(e)},Ss=le;function Wn(t){t()}function As(t){return t}function Ts(){return[!1,Wn]}var Ms=dt;function Cs(t,e){var n=e(),r=Nt({h:{__:n,v:e}}),o=r[0].h,s=r[1];return dt(function(){o.__=n,o.v=e,rn(o.__,e())||s({h:o})},[t,n,e]),He(function(){return rn(o.__,o.v())||s({h:o}),t(function(){rn(o.__,o.v())||s({h:o})})},[t]),n}var Fa={useState:Nt,useId:os,useReducer:Un,useEffect:He,useLayoutEffect:dt,useInsertionEffect:Ms,useTransition:Ts,useDeferredValue:As,useSyncExternalStore:Cs,startTransition:Wn,useRef:at,useImperativeHandle:ts,useMemo:Ut,useCallback:ns,useContext:rs,useDebugValue:zn,version:"17.0.2",Children:ls,render:ms,hydrate:gs,unmountComponentAtNode:ws,createPortal:ds,createElement:ce,createContext:Jo,createFactory:vs,cloneElement:bs,createRef:Vo,Fragment:le,isValidElement:Hn,findDOMNode:Es,Component:se,PureComponent:Rt,memo:as,forwardRef:cs,flushSync:xs,unstable_batchedUpdates:Ps,StrictMode:Ss,Suspense:Ce,SuspenseList:Ne,lazy:H,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:ys};const $a=Object.freeze(Object.defineProperty({__proto__:null,Children:ls,Component:se,Fragment:le,PureComponent:Rt,StrictMode:Ss,Suspense:Ce,SuspenseList:Ne,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:ys,cloneElement:bs,createContext:Jo,createElement:ce,createFactory:vs,createPortal:ds,createRef:Vo,default:Fa,findDOMNode:Es,flushSync:xs,forwardRef:cs,hydrate:gs,isValidElement:Hn,lazy:H,memo:as,render:ms,startTransition:Wn,unmountComponentAtNode:ws,unstable_batchedUpdates:Ps,useCallback:ns,useContext:rs,useDebugValue:zn,useDeferredValue:As,useEffect:He,useErrorBoundary:Ea,useId:os,useImperativeHandle:ts,useInsertionEffect:Ms,useLayoutEffect:dt,useMemo:Ut,useReducer:Un,useRef:at,useState:Nt,useSyncExternalStore:Cs,useTransition:Ts,version:Ra},Symbol.toStringTag,{value:"Module"})),ja=()=>{const t=at(!0);return He(()=>{t.current=!1},[]),t.current},Wr=t=>{let e;const n=new Set,r=(c,l)=>{const a=typeof c=="function"?c(e):c;if(!Object.is(a,e)){const f=e;e=l??typeof a!="object"?a:Object.assign({},e,a),n.forEach(p=>p(e,f))}},o=()=>e,u={setState:r,getState:o,subscribe:c=>(n.add(c),()=>n.delete(c)),destroy:()=>{var c;((c={BASE_URL:"/dl-model/",MODE:"production",DEV:!1,PROD:!0,SSR:!1})==null?void 0:c.MODE)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}};return e=t(r,o,u),u},Ba=t=>t?Wr(t):Wr;var $e=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Na(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Ua(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){if(this instanceof r){var o=[null];o.push.apply(o,arguments);var s=Function.bind.apply(e,o);return new s}return e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var o=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,o.get?o:{enumerable:!0,get:function(){return t[r]}})}),n}var xn={},za={get exports(){return xn},set exports(t){xn=t}},Ls={};const Os=Ua($a);var Sn={},Va={get exports(){return Sn},set exports(t){Sn=t}},ks={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var We=Os;function Ha(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Wa=typeof Object.is=="function"?Object.is:Ha,Ga=We.useState,Xa=We.useEffect,Ka=We.useLayoutEffect,Ya=We.useDebugValue;function qa(t,e){var n=e(),r=Ga({inst:{value:n,getSnapshot:e}}),o=r[0].inst,s=r[1];return Ka(function(){o.value=n,o.getSnapshot=e,on(o)&&s({inst:o})},[t,n,e]),Xa(function(){return on(o)&&s({inst:o}),t(function(){on(o)&&s({inst:o})})},[t]),Ya(n),n}function on(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Wa(t,n)}catch{return!0}}function Za(t,e){return e()}var Qa=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Za:qa;ks.useSyncExternalStore=We.useSyncExternalStore!==void 0?We.useSyncExternalStore:Qa;(function(t){t.exports=ks})(Va);/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zt=Os,Ja=Sn;function ec(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var tc=typeof Object.is=="function"?Object.is:ec,nc=Ja.useSyncExternalStore,rc=zt.useRef,oc=zt.useEffect,sc=zt.useMemo,ic=zt.useDebugValue;Ls.useSyncExternalStoreWithSelector=function(t,e,n,r,o){var s=rc(null);if(s.current===null){var i={hasValue:!1,value:null};s.current=i}else i=s.current;s=sc(function(){function c(d){if(!l){if(l=!0,a=d,d=r(d),o!==void 0&&i.hasValue){var h=i.value;if(o(h,d))return f=h}return f=d}if(h=f,tc(a,d))return h;var g=r(d);return o!==void 0&&o(h,g)?h:(a=d,f=g)}var l=!1,a,f,p=n===void 0?null:n;return[function(){return c(e())},p===null?void 0:function(){return c(p())}]},[e,n,r,o]);var u=nc(t,s[0],s[1]);return oc(function(){i.hasValue=!0,i.value=u},[u]),ic(u),u};(function(t){t.exports=Ls})(za);const ac=Na(xn),{useSyncExternalStoreWithSelector:cc}=ac;function lc(t,e=t.getState,n){const r=cc(t.subscribe,t.getState,t.getServerState||t.getState,e,n);return zn(r),r}const Gr=t=>{var e;((e={BASE_URL:"/dl-model/",MODE:"production",DEV:!1,PROD:!0,SSR:!1})==null?void 0:e.MODE)!=="production"&&typeof t!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const n=typeof t=="function"?Ba(t):t,r=(o,s)=>lc(n,o,s);return Object.assign(r,n),r},Gn=t=>t?Gr(t):Gr;function oe(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];throw Error("[Immer] minified error nr: "+t+(n.length?" "+n.map(function(o){return"'"+o+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function Ge(t){return!!t&&!!t[K]}function Le(t){var e;return!!t&&(function(n){if(!n||typeof n!="object")return!1;var r=Object.getPrototypeOf(n);if(r===null)return!0;var o=Object.hasOwnProperty.call(r,"constructor")&&r.constructor;return o===Object||typeof o=="function"&&Function.toString.call(o)===_c}(t)||Array.isArray(t)||!!t[eo]||!!(!((e=t.constructor)===null||e===void 0)&&e[eo])||Xn(t)||Kn(t))}function ct(t,e,n){n===void 0&&(n=!1),Ke(t)===0?(n?Object.keys:Jn)(t).forEach(function(r){n&&typeof r=="symbol"||e(r,t[r],t)}):t.forEach(function(r,o){return e(o,r,t)})}function Ke(t){var e=t[K];return e?e.i>3?e.i-4:e.i:Array.isArray(t)?1:Xn(t)?2:Kn(t)?3:0}function An(t,e){return Ke(t)===2?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function uc(t,e){return Ke(t)===2?t.get(e):t[e]}function Ds(t,e,n){var r=Ke(t);r===2?t.set(e,n):r===3?t.add(n):t[e]=n}function fc(t,e){return t===e?t!==0||1/t==1/e:t!=t&&e!=e}function Xn(t){return mc&&t instanceof Map}function Kn(t){return gc&&t instanceof Set}function Ae(t){return t.o||t.t}function Yn(t){if(Array.isArray(t))return Array.prototype.slice.call(t);var e=yc(t);delete e[K];for(var n=Jn(e),r=0;r<n.length;r++){var o=n[r],s=e[o];s.writable===!1&&(s.writable=!0,s.configurable=!0),(s.get||s.set)&&(e[o]={configurable:!0,writable:!0,enumerable:s.enumerable,value:t[o]})}return Object.create(Object.getPrototypeOf(t),e)}function qn(t,e){return e===void 0&&(e=!1),Zn(t)||Ge(t)||!Le(t)||(Ke(t)>1&&(t.set=t.add=t.clear=t.delete=pc),Object.freeze(t),e&&ct(t,function(n,r){return qn(r,!0)},!0)),t}function pc(){oe(2)}function Zn(t){return t==null||typeof t!="object"||Object.isFrozen(t)}function ae(t){var e=vc[t];return e||oe(18,t),e}function Xr(){return lt}function sn(t,e){e&&(ae("Patches"),t.u=[],t.s=[],t.v=e)}function Ft(t){Tn(t),t.p.forEach(dc),t.p=null}function Tn(t){t===lt&&(lt=t.l)}function Kr(t){return lt={p:[],l:lt,h:t,m:!0,_:0}}function dc(t){var e=t[K];e.i===0||e.i===1?e.j():e.O=!0}function an(t,e){e._=e.p.length;var n=e.p[0],r=t!==void 0&&t!==n;return e.h.g||ae("ES5").S(e,t,r),r?(n[K].P&&(Ft(e),oe(4)),Le(t)&&(t=$t(e,t),e.l||jt(e,t)),e.u&&ae("Patches").M(n[K].t,t,e.u,e.s)):t=$t(e,n,[]),Ft(e),e.u&&e.v(e.u,e.s),t!==Is?t:void 0}function $t(t,e,n){if(Zn(e))return e;var r=e[K];if(!r)return ct(e,function(u,c){return Yr(t,r,e,u,c,n)},!0),e;if(r.A!==t)return e;if(!r.P)return jt(t,r.t,!0),r.t;if(!r.I){r.I=!0,r.A._--;var o=r.i===4||r.i===5?r.o=Yn(r.k):r.o,s=o,i=!1;r.i===3&&(s=new Set(o),o.clear(),i=!0),ct(s,function(u,c){return Yr(t,r,o,u,c,n,i)}),jt(t,o,!1),n&&t.u&&ae("Patches").N(r,n,t.u,t.s)}return r.o}function Yr(t,e,n,r,o,s,i){if(Ge(o)){var u=$t(t,o,s&&e&&e.i!==3&&!An(e.R,r)?s.concat(r):void 0);if(Ds(n,r,u),!Ge(u))return;t.m=!1}else i&&n.add(o);if(Le(o)&&!Zn(o)){if(!t.h.D&&t._<1)return;$t(t,o),e&&e.A.l||jt(t,o)}}function jt(t,e,n){n===void 0&&(n=!1),!t.l&&t.h.D&&t.m&&qn(e,n)}function cn(t,e){var n=t[K];return(n?Ae(n):t)[e]}function qr(t,e){if(e in t)for(var n=Object.getPrototypeOf(t);n;){var r=Object.getOwnPropertyDescriptor(n,e);if(r)return r;n=Object.getPrototypeOf(n)}}function Mn(t){t.P||(t.P=!0,t.l&&Mn(t.l))}function ln(t){t.o||(t.o=Yn(t.t))}function Cn(t,e,n){var r=Xn(e)?ae("MapSet").F(e,n):Kn(e)?ae("MapSet").T(e,n):t.g?function(o,s){var i=Array.isArray(o),u={i:i?1:0,A:s?s.A:Xr(),P:!1,I:!1,R:{},l:s,t:o,k:null,o:null,j:null,C:!1},c=u,l=Ln;i&&(c=[u],l=tt);var a=Proxy.revocable(c,l),f=a.revoke,p=a.proxy;return u.k=p,u.j=f,p}(e,n):ae("ES5").J(e,n);return(n?n.A:Xr()).p.push(r),r}function hc(t){return Ge(t)||oe(22,t),function e(n){if(!Le(n))return n;var r,o=n[K],s=Ke(n);if(o){if(!o.P&&(o.i<4||!ae("ES5").K(o)))return o.t;o.I=!0,r=Zr(n,s),o.I=!1}else r=Zr(n,s);return ct(r,function(i,u){o&&uc(o.t,i)===u||Ds(r,i,e(u))}),s===3?new Set(r):r}(t)}function Zr(t,e){switch(e){case 2:return new Map(t);case 3:return Array.from(t)}return Yn(t)}var Qr,lt,Qn=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",mc=typeof Map<"u",gc=typeof Set<"u",Jr=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",Is=Qn?Symbol.for("immer-nothing"):((Qr={})["immer-nothing"]=!0,Qr),eo=Qn?Symbol.for("immer-draftable"):"__$immer_draftable",K=Qn?Symbol.for("immer-state"):"__$immer_state",_c=""+Object.prototype.constructor,Jn=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Object.getOwnPropertyNames,yc=Object.getOwnPropertyDescriptors||function(t){var e={};return Jn(t).forEach(function(n){e[n]=Object.getOwnPropertyDescriptor(t,n)}),e},vc={},Ln={get:function(t,e){if(e===K)return t;var n=Ae(t);if(!An(n,e))return function(o,s,i){var u,c=qr(s,i);return c?"value"in c?c.value:(u=c.get)===null||u===void 0?void 0:u.call(o.k):void 0}(t,n,e);var r=n[e];return t.I||!Le(r)?r:r===cn(t.t,e)?(ln(t),t.o[e]=Cn(t.A.h,r,t)):r},has:function(t,e){return e in Ae(t)},ownKeys:function(t){return Reflect.ownKeys(Ae(t))},set:function(t,e,n){var r=qr(Ae(t),e);if(r!=null&&r.set)return r.set.call(t.k,n),!0;if(!t.P){var o=cn(Ae(t),e),s=o==null?void 0:o[K];if(s&&s.t===n)return t.o[e]=n,t.R[e]=!1,!0;if(fc(n,o)&&(n!==void 0||An(t.t,e)))return!0;ln(t),Mn(t)}return t.o[e]===n&&(n!==void 0||e in t.o)||Number.isNaN(n)&&Number.isNaN(t.o[e])||(t.o[e]=n,t.R[e]=!0),!0},deleteProperty:function(t,e){return cn(t.t,e)!==void 0||e in t.t?(t.R[e]=!1,ln(t),Mn(t)):delete t.R[e],t.o&&delete t.o[e],!0},getOwnPropertyDescriptor:function(t,e){var n=Ae(t),r=Reflect.getOwnPropertyDescriptor(n,e);return r&&{writable:!0,configurable:t.i!==1||e!=="length",enumerable:r.enumerable,value:n[e]}},defineProperty:function(){oe(11)},getPrototypeOf:function(t){return Object.getPrototypeOf(t.t)},setPrototypeOf:function(){oe(12)}},tt={};ct(Ln,function(t,e){tt[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}}),tt.deleteProperty=function(t,e){return tt.set.call(this,t,e,void 0)},tt.set=function(t,e,n){return Ln.set.call(this,t[0],e,n,t[0])};var bc=function(){function t(n){var r=this;this.g=Jr,this.D=!0,this.produce=function(o,s,i){if(typeof o=="function"&&typeof s!="function"){var u=s;s=o;var c=r;return function(g){var y=this;g===void 0&&(g=u);for(var v=arguments.length,b=Array(v>1?v-1:0),_=1;_<v;_++)b[_-1]=arguments[_];return c.produce(g,function(P){var w;return(w=s).call.apply(w,[y,P].concat(b))})}}var l;if(typeof s!="function"&&oe(6),i!==void 0&&typeof i!="function"&&oe(7),Le(o)){var a=Kr(r),f=Cn(r,o,void 0),p=!0;try{l=s(f),p=!1}finally{p?Ft(a):Tn(a)}return typeof Promise<"u"&&l instanceof Promise?l.then(function(g){return sn(a,i),an(g,a)},function(g){throw Ft(a),g}):(sn(a,i),an(l,a))}if(!o||typeof o!="object"){if((l=s(o))===void 0&&(l=o),l===Is&&(l=void 0),r.D&&qn(l,!0),i){var d=[],h=[];ae("Patches").M(o,l,d,h),i(d,h)}return l}oe(21,o)},this.produceWithPatches=function(o,s){if(typeof o=="function")return function(l){for(var a=arguments.length,f=Array(a>1?a-1:0),p=1;p<a;p++)f[p-1]=arguments[p];return r.produceWithPatches(l,function(d){return o.apply(void 0,[d].concat(f))})};var i,u,c=r.produce(o,s,function(l,a){i=l,u=a});return typeof Promise<"u"&&c instanceof Promise?c.then(function(l){return[l,i,u]}):[c,i,u]},typeof(n==null?void 0:n.useProxies)=="boolean"&&this.setUseProxies(n.useProxies),typeof(n==null?void 0:n.autoFreeze)=="boolean"&&this.setAutoFreeze(n.autoFreeze)}var e=t.prototype;return e.createDraft=function(n){Le(n)||oe(8),Ge(n)&&(n=hc(n));var r=Kr(this),o=Cn(this,n,void 0);return o[K].C=!0,Tn(r),o},e.finishDraft=function(n,r){var o=n&&n[K],s=o.A;return sn(s,r),an(void 0,s)},e.setAutoFreeze=function(n){this.D=n},e.setUseProxies=function(n){n&&!Jr&&oe(20),this.g=n},e.applyPatches=function(n,r){var o;for(o=r.length-1;o>=0;o--){var s=r[o];if(s.path.length===0&&s.op==="replace"){n=s.value;break}}o>-1&&(r=r.slice(o+1));var i=ae("Patches").$;return Ge(n)?i(n,r):this.produce(n,function(u){return i(u,r)})},t}(),Y=new bc,wc=Y.produce;Y.produceWithPatches.bind(Y);Y.setAutoFreeze.bind(Y);Y.setUseProxies.bind(Y);Y.applyPatches.bind(Y);Y.createDraft.bind(Y);Y.finishDraft.bind(Y);const Ec=wc,Rs=t=>({indices:[0,0],_indicesCache:{},setIndex:(e,n)=>{t(r=>{const{indices:o,_indicesCache:s}=r;o[e]=n;const i=o.slice(0,e+1).join(),u=s[i]??[],{length:c}=o;for(let f=0;e+1+f<c;f++)o[e+1+f]=u[f]??0;const l=o.slice(e),a=o.slice(0,e).join();a&&(s[a]=l)})},showFilter:!1,toggleFilter:()=>t(e=>{e.showFilter=!e.showFilter}),searchAll:!1,toggleSearchAll:()=>t(e=>{e.searchAll=!e.searchAll})}),to=t=>t==="true";function Fs(t,e){return t&&e&&Object.keys(e).forEach(n=>{const r=e[n];typeof r=="object"?(t[n]||(t[n]={}),Fs(t[n],r)):t[n]=r}),t}const Pc=(t,e)=>({category:"Adv",setCategory:n=>t(r=>{r.category=n}),advAni:{category:"home",setCategory:n=>t(r=>{r.advAni.category=n}),home:{gender:"Male",setGender:n=>t(r=>{r.advAni.home.gender=n})},weapon:{type:"Sword",setType:n=>t(r=>{r.advAni.weapon.type=n}),gunMode:"Long",setGunMode:n=>t(r=>{r.advAni.weapon.gunMode=n})},genericSkill:{type:"Sword",setType:n=>t(r=>{r.advAni.genericSkill.type=n})},groupByWeapon:{setGroupWeaponType:(n,r)=>t(o=>{o.advAni.groupByWeapon[n]=r})},uniqueOther:{type:"Sword",setType:n=>t(r=>{r.advAni.uniqueOther.type=n}),selected:"",setSelected:n=>t(r=>{r.advAni.uniqueOther.selected=n})}},extraAni:{category:"Dance",setCategory:n=>t(r=>{r.extraAni.category=n})},personalAni:{source:"",setSource:n=>t(r=>{r.personalAni.source=n}),sourceName:"",setSourceName:n=>t(r=>{r.personalAni.sourceName=n})},getCurrentState:()=>{const n=e();return JSON.parse(JSON.stringify(n))},loadState:(n={})=>{t(r=>Fs(r,n))}}),no={type:"change"},un={type:"start"},ro={type:"end"};class xc extends Ti{constructor(e,n){super(),this.object=e,this.domElement=n,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new N,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Ie.ROTATE,MIDDLE:Ie.DOLLY,RIGHT:Ie.PAN},this.touches={ONE:Re.ROTATE,TWO:Re.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return u.phi},this.getAzimuthalAngle=function(){return u.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(m){m.addEventListener("keydown",Qt),this._domElementKeyEvents=m},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",Qt),this._domElementKeyEvents=null},this.saveState=function(){r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=function(){r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(no),r.update(),s=o.NONE},this.update=function(){const m=new N,x=new Be().setFromUnitVectors(e.up,new N(0,1,0)),$=x.clone().invert(),j=new N,ee=new Be,De=2*Math.PI;return function(){const mr=r.object.position;m.copy(mr).sub(r.target),m.applyQuaternion(x),u.setFromVector3(m),r.autoRotate&&s===o.NONE&&F(R()),r.enableDamping?(u.theta+=c.theta*r.dampingFactor,u.phi+=c.phi*r.dampingFactor):(u.theta+=c.theta,u.phi+=c.phi);let fe=r.minAzimuthAngle,pe=r.maxAzimuthAngle;return isFinite(fe)&&isFinite(pe)&&(fe<-Math.PI?fe+=De:fe>Math.PI&&(fe-=De),pe<-Math.PI?pe+=De:pe>Math.PI&&(pe-=De),fe<=pe?u.theta=Math.max(fe,Math.min(pe,u.theta)):u.theta=u.theta>(fe+pe)/2?Math.max(fe,u.theta):Math.min(pe,u.theta)),u.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,u.phi)),u.makeSafe(),u.radius*=l,u.radius=Math.max(r.minDistance,Math.min(r.maxDistance,u.radius)),r.enableDamping===!0?r.target.addScaledVector(a,r.dampingFactor):r.target.add(a),m.setFromSpherical(u),m.applyQuaternion($),mr.copy(r.target).add(m),r.object.lookAt(r.target),r.enableDamping===!0?(c.theta*=1-r.dampingFactor,c.phi*=1-r.dampingFactor,a.multiplyScalar(1-r.dampingFactor)):(c.set(0,0,0),a.set(0,0,0)),l=1,f||j.distanceToSquared(r.object.position)>i||8*(1-ee.dot(r.object.quaternion))>i?(r.dispatchEvent(no),j.copy(r.object.position),ee.copy(r.object.quaternion),f=!1,!0):!1}}(),this.dispose=function(){r.domElement.removeEventListener("contextmenu",pr),r.domElement.removeEventListener("pointerdown",lr),r.domElement.removeEventListener("pointercancel",ur),r.domElement.removeEventListener("wheel",fr),r.domElement.removeEventListener("pointermove",qt),r.domElement.removeEventListener("pointerup",Zt),r._domElementKeyEvents!==null&&(r._domElementKeyEvents.removeEventListener("keydown",Qt),r._domElementKeyEvents=null)};const r=this,o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let s=o.NONE;const i=1e-6,u=new gr,c=new gr;let l=1;const a=new N;let f=!1;const p=new B,d=new B,h=new B,g=new B,y=new B,v=new B,b=new B,_=new B,P=new B,w=[],T={};function R(){return 2*Math.PI/60/60*r.autoRotateSpeed}function A(){return Math.pow(.95,r.zoomSpeed)}function F(m){c.theta-=m}function I(m){c.phi-=m}const _e=function(){const m=new N;return function($,j){m.setFromMatrixColumn(j,0),m.multiplyScalar(-$),a.add(m)}}(),ue=function(){const m=new N;return function($,j){r.screenSpacePanning===!0?m.setFromMatrixColumn(j,1):(m.setFromMatrixColumn(j,0),m.crossVectors(r.object.up,m)),m.multiplyScalar($),a.add(m)}}(),W=function(){const m=new N;return function($,j){const ee=r.domElement;if(r.object.isPerspectiveCamera){const De=r.object.position;m.copy(De).sub(r.target);let wt=m.length();wt*=Math.tan(r.object.fov/2*Math.PI/180),_e(2*$*wt/ee.clientHeight,r.object.matrix),ue(2*j*wt/ee.clientHeight,r.object.matrix)}else r.object.isOrthographicCamera?(_e($*(r.object.right-r.object.left)/r.object.zoom/ee.clientWidth,r.object.matrix),ue(j*(r.object.top-r.object.bottom)/r.object.zoom/ee.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}}();function ye(m){r.object.isPerspectiveCamera?l/=m:r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom*m)),r.object.updateProjectionMatrix(),f=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function Ye(m){r.object.isPerspectiveCamera?l*=m:r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/m)),r.object.updateProjectionMatrix(),f=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function J(m){p.set(m.clientX,m.clientY)}function Yt(m){b.set(m.clientX,m.clientY)}function _t(m){g.set(m.clientX,m.clientY)}function qe(m){d.set(m.clientX,m.clientY),h.subVectors(d,p).multiplyScalar(r.rotateSpeed);const x=r.domElement;F(2*Math.PI*h.x/x.clientHeight),I(2*Math.PI*h.y/x.clientHeight),p.copy(d),r.update()}function ve(m){_.set(m.clientX,m.clientY),P.subVectors(_,b),P.y>0?ye(A()):P.y<0&&Ye(A()),b.copy(_),r.update()}function yt(m){y.set(m.clientX,m.clientY),v.subVectors(y,g).multiplyScalar(r.panSpeed),W(v.x,v.y),g.copy(y),r.update()}function Se(m){m.deltaY<0?Ye(A()):m.deltaY>0&&ye(A()),r.update()}function Ze(m){let x=!1;switch(m.code){case r.keys.UP:m.ctrlKey||m.metaKey||m.shiftKey?I(2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):W(0,r.keyPanSpeed),x=!0;break;case r.keys.BOTTOM:m.ctrlKey||m.metaKey||m.shiftKey?I(-2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):W(0,-r.keyPanSpeed),x=!0;break;case r.keys.LEFT:m.ctrlKey||m.metaKey||m.shiftKey?F(2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):W(r.keyPanSpeed,0),x=!0;break;case r.keys.RIGHT:m.ctrlKey||m.metaKey||m.shiftKey?F(-2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):W(-r.keyPanSpeed,0),x=!0;break}x&&(m.preventDefault(),r.update())}function ke(){if(w.length===1)p.set(w[0].pageX,w[0].pageY);else{const m=.5*(w[0].pageX+w[1].pageX),x=.5*(w[0].pageY+w[1].pageY);p.set(m,x)}}function Qe(){if(w.length===1)g.set(w[0].pageX,w[0].pageY);else{const m=.5*(w[0].pageX+w[1].pageX),x=.5*(w[0].pageY+w[1].pageY);g.set(m,x)}}function Je(){const m=w[0].pageX-w[1].pageX,x=w[0].pageY-w[1].pageY,$=Math.sqrt(m*m+x*x);b.set(0,$)}function vt(){r.enableZoom&&Je(),r.enablePan&&Qe()}function bt(){r.enableZoom&&Je(),r.enableRotate&&ke()}function ir(m){if(w.length==1)d.set(m.pageX,m.pageY);else{const $=Jt(m),j=.5*(m.pageX+$.x),ee=.5*(m.pageY+$.y);d.set(j,ee)}h.subVectors(d,p).multiplyScalar(r.rotateSpeed);const x=r.domElement;F(2*Math.PI*h.x/x.clientHeight),I(2*Math.PI*h.y/x.clientHeight),p.copy(d)}function ar(m){if(w.length===1)y.set(m.pageX,m.pageY);else{const x=Jt(m),$=.5*(m.pageX+x.x),j=.5*(m.pageY+x.y);y.set($,j)}v.subVectors(y,g).multiplyScalar(r.panSpeed),W(v.x,v.y),g.copy(y)}function cr(m){const x=Jt(m),$=m.pageX-x.x,j=m.pageY-x.y,ee=Math.sqrt($*$+j*j);_.set(0,ee),P.set(0,Math.pow(_.y/b.y,r.zoomSpeed)),ye(P.y),b.copy(_)}function yi(m){r.enableZoom&&cr(m),r.enablePan&&ar(m)}function vi(m){r.enableZoom&&cr(m),r.enableRotate&&ir(m)}function lr(m){r.enabled!==!1&&(w.length===0&&(r.domElement.setPointerCapture(m.pointerId),r.domElement.addEventListener("pointermove",qt),r.domElement.addEventListener("pointerup",Zt)),xi(m),m.pointerType==="touch"?Ei(m):bi(m))}function qt(m){r.enabled!==!1&&(m.pointerType==="touch"?Pi(m):wi(m))}function Zt(m){dr(m),w.length===0&&(r.domElement.releasePointerCapture(m.pointerId),r.domElement.removeEventListener("pointermove",qt),r.domElement.removeEventListener("pointerup",Zt)),r.dispatchEvent(ro),s=o.NONE}function ur(m){dr(m)}function bi(m){let x;switch(m.button){case 0:x=r.mouseButtons.LEFT;break;case 1:x=r.mouseButtons.MIDDLE;break;case 2:x=r.mouseButtons.RIGHT;break;default:x=-1}switch(x){case Ie.DOLLY:if(r.enableZoom===!1)return;Yt(m),s=o.DOLLY;break;case Ie.ROTATE:if(m.ctrlKey||m.metaKey||m.shiftKey){if(r.enablePan===!1)return;_t(m),s=o.PAN}else{if(r.enableRotate===!1)return;J(m),s=o.ROTATE}break;case Ie.PAN:if(m.ctrlKey||m.metaKey||m.shiftKey){if(r.enableRotate===!1)return;J(m),s=o.ROTATE}else{if(r.enablePan===!1)return;_t(m),s=o.PAN}break;default:s=o.NONE}s!==o.NONE&&r.dispatchEvent(un)}function wi(m){switch(s){case o.ROTATE:if(r.enableRotate===!1)return;qe(m);break;case o.DOLLY:if(r.enableZoom===!1)return;ve(m);break;case o.PAN:if(r.enablePan===!1)return;yt(m);break}}function fr(m){r.enabled===!1||r.enableZoom===!1||s!==o.NONE||(m.preventDefault(),r.dispatchEvent(un),Se(m),r.dispatchEvent(ro))}function Qt(m){r.enabled===!1||r.enablePan===!1||Ze(m)}function Ei(m){switch(hr(m),w.length){case 1:switch(r.touches.ONE){case Re.ROTATE:if(r.enableRotate===!1)return;ke(),s=o.TOUCH_ROTATE;break;case Re.PAN:if(r.enablePan===!1)return;Qe(),s=o.TOUCH_PAN;break;default:s=o.NONE}break;case 2:switch(r.touches.TWO){case Re.DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;vt(),s=o.TOUCH_DOLLY_PAN;break;case Re.DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;bt(),s=o.TOUCH_DOLLY_ROTATE;break;default:s=o.NONE}break;default:s=o.NONE}s!==o.NONE&&r.dispatchEvent(un)}function Pi(m){switch(hr(m),s){case o.TOUCH_ROTATE:if(r.enableRotate===!1)return;ir(m),r.update();break;case o.TOUCH_PAN:if(r.enablePan===!1)return;ar(m),r.update();break;case o.TOUCH_DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;yi(m),r.update();break;case o.TOUCH_DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;vi(m),r.update();break;default:s=o.NONE}}function pr(m){r.enabled!==!1&&m.preventDefault()}function xi(m){w.push(m)}function dr(m){delete T[m.pointerId];for(let x=0;x<w.length;x++)if(w[x].pointerId==m.pointerId){w.splice(x,1);return}}function hr(m){let x=T[m.pointerId];x===void 0&&(x=new B,T[m.pointerId]=x),x.set(m.pageX,m.pageY)}function Jt(m){const x=m.pointerId===w[0].pointerId?w[1]:w[0];return T[x.pointerId]}r.domElement.addEventListener("contextmenu",pr),r.domElement.addEventListener("pointerdown",lr),r.domElement.addEventListener("pointercancel",ur),r.domElement.addEventListener("wheel",fr,{passive:!1}),this.update()}}const $s="fbx",js="animations",Sc="img/textures/matcap",Vt="data";/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/var oo=function(t){return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))};try{URL.revokeObjectURL(oo(""))}catch{oo=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)}}var Z=Uint8Array,Pe=Uint16Array,On=Uint32Array,Bs=new Z([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Ns=new Z([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ac=new Z([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Us=function(t,e){for(var n=new Pe(31),r=0;r<31;++r)n[r]=e+=1<<t[r-1];for(var o=new On(n[30]),r=1;r<30;++r)for(var s=n[r];s<n[r+1];++s)o[s]=s-n[r]<<5|r;return[n,o]},zs=Us(Bs,2),Vs=zs[0],Tc=zs[1];Vs[28]=258,Tc[258]=28;var Mc=Us(Ns,0),Cc=Mc[0],kn=new Pe(32768);for(var C=0;C<32768;++C){var be=(C&43690)>>>1|(C&21845)<<1;be=(be&52428)>>>2|(be&13107)<<2,be=(be&61680)>>>4|(be&3855)<<4,kn[C]=((be&65280)>>>8|(be&255)<<8)>>>1}var rt=function(t,e,n){for(var r=t.length,o=0,s=new Pe(e);o<r;++o)++s[t[o]-1];var i=new Pe(e);for(o=0;o<e;++o)i[o]=i[o-1]+s[o-1]<<1;var u;if(n){u=new Pe(1<<e);var c=15-e;for(o=0;o<r;++o)if(t[o])for(var l=o<<4|t[o],a=e-t[o],f=i[t[o]-1]++<<a,p=f|(1<<a)-1;f<=p;++f)u[kn[f]>>>c]=l}else for(u=new Pe(r),o=0;o<r;++o)t[o]&&(u[o]=kn[i[t[o]-1]++]>>>15-t[o]);return u},ht=new Z(288);for(var C=0;C<144;++C)ht[C]=8;for(var C=144;C<256;++C)ht[C]=9;for(var C=256;C<280;++C)ht[C]=7;for(var C=280;C<288;++C)ht[C]=8;var Hs=new Z(32);for(var C=0;C<32;++C)Hs[C]=5;var Lc=rt(ht,9,1),Oc=rt(Hs,5,1),fn=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},ne=function(t,e,n){var r=e/8|0;return(t[r]|t[r+1]<<8)>>(e&7)&n},pn=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(e&7)},kc=function(t){return(t/8|0)+(t&7&&1)},Dc=function(t,e,n){(e==null||e<0)&&(e=0),(n==null||n>t.length)&&(n=t.length);var r=new(t instanceof Pe?Pe:t instanceof On?On:Z)(n-e);return r.set(t.subarray(e,n)),r},Ic=function(t,e,n){var r=t.length;if(!r||n&&!n.l&&r<5)return e||new Z(0);var o=!e||n,s=!n||n.i;n||(n={}),e||(e=new Z(r*3));var i=function(Je){var vt=e.length;if(Je>vt){var bt=new Z(Math.max(vt*2,Je));bt.set(e),e=bt}},u=n.f||0,c=n.p||0,l=n.b||0,a=n.l,f=n.d,p=n.m,d=n.n,h=r*8;do{if(!a){n.f=u=ne(t,c,1);var g=ne(t,c+1,3);if(c+=3,g)if(g==1)a=Lc,f=Oc,p=9,d=5;else if(g==2){var _=ne(t,c,31)+257,P=ne(t,c+10,15)+4,w=_+ne(t,c+5,31)+1;c+=14;for(var T=new Z(w),R=new Z(19),A=0;A<P;++A)R[Ac[A]]=ne(t,c+A*3,7);c+=P*3;for(var F=fn(R),I=(1<<F)-1,_e=rt(R,F,1),A=0;A<w;){var ue=_e[ne(t,c,I)];c+=ue&15;var y=ue>>>4;if(y<16)T[A++]=y;else{var W=0,ye=0;for(y==16?(ye=3+ne(t,c,3),c+=2,W=T[A-1]):y==17?(ye=3+ne(t,c,7),c+=3):y==18&&(ye=11+ne(t,c,127),c+=7);ye--;)T[A++]=W}}var Ye=T.subarray(0,_),J=T.subarray(_);p=fn(Ye),d=fn(J),a=rt(Ye,p,1),f=rt(J,d,1)}else throw"invalid block type";else{var y=kc(c)+4,v=t[y-4]|t[y-3]<<8,b=y+v;if(b>r){if(s)throw"unexpected EOF";break}o&&i(l+v),e.set(t.subarray(y,b),l),n.b=l+=v,n.p=c=b*8;continue}if(c>h){if(s)throw"unexpected EOF";break}}o&&i(l+131072);for(var Yt=(1<<p)-1,_t=(1<<d)-1,qe=c;;qe=c){var W=a[pn(t,c)&Yt],ve=W>>>4;if(c+=W&15,c>h){if(s)throw"unexpected EOF";break}if(!W)throw"invalid length/literal";if(ve<256)e[l++]=ve;else if(ve==256){qe=c,a=null;break}else{var yt=ve-254;if(ve>264){var A=ve-257,Se=Bs[A];yt=ne(t,c,(1<<Se)-1)+Vs[A],c+=Se}var Ze=f[pn(t,c)&_t],ke=Ze>>>4;if(!Ze)throw"invalid distance";c+=Ze&15;var J=Cc[ke];if(ke>3){var Se=Ns[ke];J+=pn(t,c)&(1<<Se)-1,c+=Se}if(c>h){if(s)throw"unexpected EOF";break}o&&i(l+131072);for(var Qe=l+yt;l<Qe;l+=4)e[l]=e[l-J],e[l+1]=e[l+1-J],e[l+2]=e[l+2-J],e[l+3]=e[l+3-J];l=Qe}}n.l=a,n.p=qe,n.b=l,a&&(u=1,n.m=p,n.d=f,n.n=d)}while(!u);return l==e.length?e:Dc(e,0,l)},Rc=new Z(0),Fc=function(t){if((t[0]&15)!=8||t[0]>>>4>7||(t[0]<<8|t[1])%31)throw"invalid zlib data";if(t[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function $c(t,e){return Ic((Fc(t),t.subarray(2,-4)),e)}var jc=typeof TextDecoder<"u"&&new TextDecoder,Bc=0;try{jc.decode(Rc,{stream:!0}),Bc=1}catch{}function Ws(t,e,n){const r=n.length-t-1;if(e>=n[r])return r-1;if(e<=n[t])return t;let o=t,s=r,i=Math.floor((o+s)/2);for(;e<n[i]||e>=n[i+1];)e<n[i]?s=i:o=i,i=Math.floor((o+s)/2);return i}function Nc(t,e,n,r){const o=[],s=[],i=[];o[0]=1;for(let u=1;u<=n;++u){s[u]=e-r[t+1-u],i[u]=r[t+u]-e;let c=0;for(let l=0;l<u;++l){const a=i[l+1],f=s[u-l],p=o[l]/(a+f);o[l]=c+a*p,c=f*p}o[u]=c}return o}function Uc(t,e,n,r){const o=Ws(t,r,e),s=Nc(o,r,t,e),i=new Bt(0,0,0,0);for(let u=0;u<=t;++u){const c=n[o-t+u],l=s[u],a=c.w*l;i.x+=c.x*a,i.y+=c.y*a,i.z+=c.z*a,i.w+=c.w*l}return i}function zc(t,e,n,r,o){const s=[];for(let f=0;f<=n;++f)s[f]=0;const i=[];for(let f=0;f<=r;++f)i[f]=s.slice(0);const u=[];for(let f=0;f<=n;++f)u[f]=s.slice(0);u[0][0]=1;const c=s.slice(0),l=s.slice(0);for(let f=1;f<=n;++f){c[f]=e-o[t+1-f],l[f]=o[t+f]-e;let p=0;for(let d=0;d<f;++d){const h=l[d+1],g=c[f-d];u[f][d]=h+g;const y=u[d][f-1]/u[f][d];u[d][f]=p+h*y,p=g*y}u[f][f]=p}for(let f=0;f<=n;++f)i[0][f]=u[f][n];for(let f=0;f<=n;++f){let p=0,d=1;const h=[];for(let g=0;g<=n;++g)h[g]=s.slice(0);h[0][0]=1;for(let g=1;g<=r;++g){let y=0;const v=f-g,b=n-g;f>=g&&(h[d][0]=h[p][0]/u[b+1][v],y=h[d][0]*u[v][b]);const _=v>=-1?1:-v,P=f-1<=b?g-1:n-f;for(let T=_;T<=P;++T)h[d][T]=(h[p][T]-h[p][T-1])/u[b+1][v+T],y+=h[d][T]*u[v+T][b];f<=b&&(h[d][g]=-h[p][g-1]/u[b+1][f],y+=h[d][g]*u[f][b]),i[g][f]=y;const w=p;p=d,d=w}}let a=n;for(let f=1;f<=r;++f){for(let p=0;p<=n;++p)i[f][p]*=a;a*=n-f}return i}function Vc(t,e,n,r,o){const s=o<t?o:t,i=[],u=Ws(t,r,e),c=zc(u,r,t,s,e),l=[];for(let a=0;a<n.length;++a){const f=n[a].clone(),p=f.w;f.x*=p,f.y*=p,f.z*=p,l[a]=f}for(let a=0;a<=s;++a){const f=l[u-t].clone().multiplyScalar(c[a][0]);for(let p=1;p<=t;++p)f.add(l[u-t+p].clone().multiplyScalar(c[a][p]));i[a]=f}for(let a=s+1;a<=o+1;++a)i[a]=new Bt(0,0,0);return i}function Hc(t,e){let n=1;for(let o=2;o<=t;++o)n*=o;let r=1;for(let o=2;o<=e;++o)r*=o;for(let o=2;o<=t-e;++o)r*=o;return n/r}function Wc(t){const e=t.length,n=[],r=[];for(let s=0;s<e;++s){const i=t[s];n[s]=new N(i.x,i.y,i.z),r[s]=i.w}const o=[];for(let s=0;s<e;++s){const i=n[s].clone();for(let u=1;u<=s;++u)i.sub(o[s-u].clone().multiplyScalar(Hc(s,u)*r[u]));o[s]=i.divideScalar(r[0])}return o}function Gc(t,e,n,r,o){const s=Vc(t,e,n,r,o);return Wc(s)}class Xc extends Mi{constructor(e,n,r,o,s){super(),this.degree=e,this.knots=n,this.controlPoints=[],this.startKnot=o||0,this.endKnot=s||this.knots.length-1;for(let i=0;i<r.length;++i){const u=r[i];this.controlPoints[i]=new Bt(u.x,u.y,u.z,u.w)}}getPoint(e,n=new N){const r=n,o=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),s=Uc(this.degree,this.knots,this.controlPoints,o);return s.w!==1&&s.divideScalar(s.w),r.set(s.x,s.y,s.z)}getTangent(e,n=new N){const r=n,o=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),s=Gc(this.degree,this.knots,this.controlPoints,o,1);return r.copy(s[1]).normalize(),r}}let S,k,z;class Kc extends Ci{constructor(e){super(e)}load(e,n,r,o){const s=this,i=s.path===""?Li.extractUrlBase(e):s.path,u=new Oi(this.manager);u.setPath(s.path),u.setResponseType("arraybuffer"),u.setRequestHeader(s.requestHeader),u.setWithCredentials(s.withCredentials),u.load(e,function(c){try{n(s.parse(c,i))}catch(l){o?o(l):console.error(l),s.manager.itemError(e)}},r,o)}parse(e,n){if(el(e))S=new Jc().parse(e);else{const o=Ys(e);if(!tl(o))throw new Error("THREE.FBXLoader: Unknown format.");if(io(o)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+io(o));S=new Qc().parse(o)}const r=new Xe(this.manager).setPath(this.resourcePath||n).setCrossOrigin(this.crossOrigin);return new Yc(r,this.manager).parse(S)}}class Yc{constructor(e,n){this.textureLoader=e,this.manager=n}parse(){k=this.parseConnections();const e=this.parseImages(),n=this.parseTextures(e),r=this.parseMaterials(n),o=this.parseDeformers(),s=new qc().parse(o);return this.parseScene(o,s,r),z}parseConnections(){const e=new Map;return"Connections"in S&&S.Connections.connections.forEach(function(r){const o=r[0],s=r[1],i=r[2];e.has(o)||e.set(o,{parents:[],children:[]});const u={ID:s,relationship:i};e.get(o).parents.push(u),e.has(s)||e.set(s,{parents:[],children:[]});const c={ID:o,relationship:i};e.get(s).children.push(c)}),e}parseImages(){const e={},n={};if("Video"in S.Objects){const r=S.Objects.Video;for(const o in r){const s=r[o],i=parseInt(o);if(e[i]=s.RelativeFilename||s.Filename,"Content"in s){const u=s.Content instanceof ArrayBuffer&&s.Content.byteLength>0,c=typeof s.Content=="string"&&s.Content!=="";if(u||c){const l=this.parseImage(r[o]);n[s.RelativeFilename||s.Filename]=l}}}}for(const r in e){const o=e[r];n[o]!==void 0?e[r]=n[o]:e[r]=e[r].split("\\").pop()}return e}parseImage(e){const n=e.Content,r=e.RelativeFilename||e.Filename,o=r.slice(r.lastIndexOf(".")+1).toLowerCase();let s;switch(o){case"bmp":s="image/bmp";break;case"jpg":case"jpeg":s="image/jpeg";break;case"png":s="image/png";break;case"tif":s="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",r),s="image/tga";break;default:console.warn('FBXLoader: Image type "'+o+'" is not supported.');return}if(typeof n=="string")return"data:"+s+";base64,"+n;{const i=new Uint8Array(n);return window.URL.createObjectURL(new Blob([i],{type:s}))}}parseTextures(e){const n=new Map;if("Texture"in S.Objects){const r=S.Objects.Texture;for(const o in r){const s=this.parseTexture(r[o],e);n.set(parseInt(o),s)}}return n}parseTexture(e,n){const r=this.loadTexture(e,n);r.ID=e.id,r.name=e.attrName;const o=e.WrapModeU,s=e.WrapModeV,i=o!==void 0?o.value:0,u=s!==void 0?s.value:0;if(r.wrapS=i===0?_r:yr,r.wrapT=u===0?_r:yr,"Scaling"in e){const c=e.Scaling.value;r.repeat.x=c[0],r.repeat.y=c[1]}if("Translation"in e){const c=e.Translation.value;r.offset.x=c[0],r.offset.y=c[1]}return r}loadTexture(e,n){let r;const o=this.textureLoader.path,s=k.get(e.id).children;s!==void 0&&s.length>0&&n[s[0].ID]!==void 0&&(r=n[s[0].ID],(r.indexOf("blob:")===0||r.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let i;const u=e.FileName.slice(-3).toLowerCase();if(u==="tga"){const c=this.manager.getHandler(".tga");c===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),i=new vr):(c.setPath(this.textureLoader.path),i=c.load(r))}else u==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),i=new vr):i=this.textureLoader.load(r);return this.textureLoader.setPath(o),i}parseMaterials(e){const n=new Map;if("Material"in S.Objects){const r=S.Objects.Material;for(const o in r){const s=this.parseMaterial(r[o],e);s!==null&&n.set(parseInt(o),s)}}return n}parseMaterial(e,n){const r=e.id,o=e.attrName;let s=e.ShadingModel;if(typeof s=="object"&&(s=s.value),!k.has(r))return null;const i=this.parseParameters(e,n,r);let u;switch(s.toLowerCase()){case"phong":u=new en;break;case"lambert":u=new ki;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',s),u=new en;break}return u.setValues(i),u.name=o,u}parseParameters(e,n,r){const o={};e.BumpFactor&&(o.bumpScale=e.BumpFactor.value),e.Diffuse?o.color=new U().fromArray(e.Diffuse.value):e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(o.color=new U().fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(o.displacementScale=e.DisplacementFactor.value),e.Emissive?o.emissive=new U().fromArray(e.Emissive.value):e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(o.emissive=new U().fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(o.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(o.opacity=parseFloat(e.Opacity.value)),o.opacity<1&&(o.transparent=!0),e.ReflectionFactor&&(o.reflectivity=e.ReflectionFactor.value),e.Shininess&&(o.shininess=e.Shininess.value),e.Specular?o.specular=new U().fromArray(e.Specular.value):e.SpecularColor&&e.SpecularColor.type==="Color"&&(o.specular=new U().fromArray(e.SpecularColor.value));const s=this;return k.get(r).children.forEach(function(i){const u=i.relationship;switch(u){case"Bump":o.bumpMap=s.getTexture(n,i.ID);break;case"Maya|TEX_ao_map":o.aoMap=s.getTexture(n,i.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":o.map=s.getTexture(n,i.ID),o.map!==void 0&&(o.map.encoding=Q);break;case"DisplacementColor":o.displacementMap=s.getTexture(n,i.ID);break;case"EmissiveColor":o.emissiveMap=s.getTexture(n,i.ID),o.emissiveMap!==void 0&&(o.emissiveMap.encoding=Q);break;case"NormalMap":case"Maya|TEX_normal_map":o.normalMap=s.getTexture(n,i.ID);break;case"ReflectionColor":o.envMap=s.getTexture(n,i.ID),o.envMap!==void 0&&(o.envMap.mapping=Di,o.envMap.encoding=Q);break;case"SpecularColor":o.specularMap=s.getTexture(n,i.ID),o.specularMap!==void 0&&(o.specularMap.encoding=Q);break;case"TransparentColor":case"TransparencyFactor":o.alphaMap=s.getTexture(n,i.ID),o.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",u);break}}),o}getTexture(e,n){return"LayeredTexture"in S.Objects&&n in S.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),n=k.get(n).children[0].ID),e.get(n)}parseDeformers(){const e={},n={};if("Deformer"in S.Objects){const r=S.Objects.Deformer;for(const o in r){const s=r[o],i=k.get(parseInt(o));if(s.attrType==="Skin"){const u=this.parseSkeleton(i,r);u.ID=o,i.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),u.geometryID=i.parents[0].ID,e[o]=u}else if(s.attrType==="BlendShape"){const u={id:o};u.rawTargets=this.parseMorphTargets(i,r),u.id=o,i.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),n[o]=u}}}return{skeletons:e,morphTargets:n}}parseSkeleton(e,n){const r=[];return e.children.forEach(function(o){const s=n[o.ID];if(s.attrType!=="Cluster")return;const i={ID:o.ID,indices:[],weights:[],transformLink:new O().fromArray(s.TransformLink.a)};"Indexes"in s&&(i.indices=s.Indexes.a,i.weights=s.Weights.a),r.push(i)}),{rawBones:r,bones:[]}}parseMorphTargets(e,n){const r=[];for(let o=0;o<e.children.length;o++){const s=e.children[o],i=n[s.ID],u={name:i.attrName,initialWeight:i.DeformPercent,id:i.id,fullWeights:i.FullWeights.a};if(i.attrType!=="BlendShapeChannel")return;u.geoID=k.get(parseInt(s.ID)).children.filter(function(c){return c.relationship===void 0})[0].ID,r.push(u)}return r}parseScene(e,n,r){z=new br;const o=this.parseModels(e.skeletons,n,r),s=S.Objects.Model,i=this;o.forEach(function(c){const l=s[c.ID];i.setLookAtProperties(c,l),k.get(c.ID).parents.forEach(function(f){const p=o.get(f.ID);p!==void 0&&p.add(c)}),c.parent===null&&z.add(c)}),this.bindSkeleton(e.skeletons,n,o),this.createAmbientLight(),z.traverse(function(c){if(c.userData.transformData){c.parent&&(c.userData.transformData.parentMatrix=c.parent.matrix,c.userData.transformData.parentMatrixWorld=c.parent.matrixWorld);const l=Xs(c.userData.transformData);c.applyMatrix4(l),c.updateWorldMatrix()}});const u=new Zc().parse();z.children.length===1&&z.children[0].isGroup&&(z.children[0].animations=u,z=z.children[0]),z.animations=u}parseModels(e,n,r){const o=new Map,s=S.Objects.Model;for(const i in s){const u=parseInt(i),c=s[i],l=k.get(u);let a=this.buildSkeleton(l,e,u,c.attrName);if(!a){switch(c.attrType){case"Camera":a=this.createCamera(l);break;case"Light":a=this.createLight(l);break;case"Mesh":a=this.createMesh(l,n,r);break;case"NurbsCurve":a=this.createCurve(l,n);break;case"LimbNode":case"Root":a=new wr;break;case"Null":default:a=new br;break}a.name=c.attrName?Ot.sanitizeNodeName(c.attrName):"",a.ID=u}this.getTransformData(a,c),o.set(u,a)}return o}buildSkeleton(e,n,r,o){let s=null;return e.parents.forEach(function(i){for(const u in n){const c=n[u];c.rawBones.forEach(function(l,a){if(l.ID===i.ID){const f=s;s=new wr,s.matrixWorld.copy(l.transformLink),s.name=o?Ot.sanitizeNodeName(o):"",s.ID=r,c.bones[a]=s,f!==null&&s.add(f)}})}}),s}createCamera(e){let n,r;if(e.children.forEach(function(o){const s=S.Objects.NodeAttribute[o.ID];s!==void 0&&(r=s)}),r===void 0)n=new tn;else{let o=0;r.CameraProjectionType!==void 0&&r.CameraProjectionType.value===1&&(o=1);let s=1;r.NearPlane!==void 0&&(s=r.NearPlane.value/1e3);let i=1e3;r.FarPlane!==void 0&&(i=r.FarPlane.value/1e3);let u=window.innerWidth,c=window.innerHeight;r.AspectWidth!==void 0&&r.AspectHeight!==void 0&&(u=r.AspectWidth.value,c=r.AspectHeight.value);const l=u/c;let a=45;r.FieldOfView!==void 0&&(a=r.FieldOfView.value);const f=r.FocalLength?r.FocalLength.value:null;switch(o){case 0:n=new Lo(a,l,s,i),f!==null&&n.setFocalLength(f);break;case 1:n=new Co(-u/2,u/2,c/2,-c/2,s,i);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+o+"."),n=new tn;break}}return n}createLight(e){let n,r;if(e.children.forEach(function(o){const s=S.Objects.NodeAttribute[o.ID];s!==void 0&&(r=s)}),r===void 0)n=new tn;else{let o;r.LightType===void 0?o=0:o=r.LightType.value;let s=16777215;r.Color!==void 0&&(s=new U().fromArray(r.Color.value));let i=r.Intensity===void 0?1:r.Intensity.value/100;r.CastLightOnObject!==void 0&&r.CastLightOnObject.value===0&&(i=0);let u=0;r.FarAttenuationEnd!==void 0&&(r.EnableFarAttenuation!==void 0&&r.EnableFarAttenuation.value===0?u=0:u=r.FarAttenuationEnd.value);const c=1;switch(o){case 0:n=new bn(s,i,u,c);break;case 1:n=new Oo(s,i);break;case 2:let l=Math.PI/3;r.InnerAngle!==void 0&&(l=ie.degToRad(r.InnerAngle.value));let a=0;r.OuterAngle!==void 0&&(a=ie.degToRad(r.OuterAngle.value),a=Math.max(a,1)),n=new Ii(s,i,u,l,a,c);break;default:console.warn("THREE.FBXLoader: Unknown light type "+r.LightType.value+", defaulting to a PointLight."),n=new bn(s,i);break}r.CastShadows!==void 0&&r.CastShadows.value===1&&(n.castShadow=!0)}return n}createMesh(e,n,r){let o,s=null,i=null;const u=[];return e.children.forEach(function(c){n.has(c.ID)&&(s=n.get(c.ID)),r.has(c.ID)&&u.push(r.get(c.ID))}),u.length>1?i=u:u.length>0?i=u[0]:(i=new en({color:13421772}),u.push(i)),"color"in s.attributes&&u.forEach(function(c){c.vertexColors=!0}),s.FBX_Deformer?(o=new Ri(s,i),o.normalizeSkinWeights()):o=new ko(s,i),o}createCurve(e,n){const r=e.children.reduce(function(s,i){return n.has(i.ID)&&(s=n.get(i.ID)),s},null),o=new Fi({color:3342591,linewidth:1});return new $i(r,o)}getTransformData(e,n){const r={};"InheritType"in n&&(r.inheritType=parseInt(n.InheritType.value)),"RotationOrder"in n?r.eulerOrder=Ks(n.RotationOrder.value):r.eulerOrder="ZYX","Lcl_Translation"in n&&(r.translation=n.Lcl_Translation.value),"PreRotation"in n&&(r.preRotation=n.PreRotation.value),"Lcl_Rotation"in n&&(r.rotation=n.Lcl_Rotation.value),"PostRotation"in n&&(r.postRotation=n.PostRotation.value),"Lcl_Scaling"in n&&(r.scale=n.Lcl_Scaling.value),"ScalingOffset"in n&&(r.scalingOffset=n.ScalingOffset.value),"ScalingPivot"in n&&(r.scalingPivot=n.ScalingPivot.value),"RotationOffset"in n&&(r.rotationOffset=n.RotationOffset.value),"RotationPivot"in n&&(r.rotationPivot=n.RotationPivot.value),e.userData.transformData=r}setLookAtProperties(e,n){"LookAtProperty"in n&&k.get(e.ID).children.forEach(function(o){if(o.relationship==="LookAtProperty"){const s=S.Objects.Model[o.ID];if("Lcl_Translation"in s){const i=s.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(i),z.add(e.target)):e.lookAt(new N().fromArray(i))}}})}bindSkeleton(e,n,r){const o=this.parsePoseNodes();for(const s in e){const i=e[s];k.get(parseInt(i.ID)).parents.forEach(function(c){if(n.has(c.ID)){const l=c.ID;k.get(l).parents.forEach(function(f){r.has(f.ID)&&r.get(f.ID).bind(new ji(i.bones),o[f.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in S.Objects){const n=S.Objects.Pose;for(const r in n)if(n[r].attrType==="BindPose"&&n[r].NbPoseNodes>0){const o=n[r].PoseNode;Array.isArray(o)?o.forEach(function(s){e[s.Node]=new O().fromArray(s.Matrix.a)}):e[o.Node]=new O().fromArray(o.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in S&&"AmbientColor"in S.GlobalSettings){const e=S.GlobalSettings.AmbientColor.value,n=e[0],r=e[1],o=e[2];if(n!==0||r!==0||o!==0){const s=new U(n,r,o);z.add(new Do(s,1))}}}}class qc{constructor(){this.negativeMaterialIndices=!1}parse(e){const n=new Map;if("Geometry"in S.Objects){const r=S.Objects.Geometry;for(const o in r){const s=k.get(parseInt(o)),i=this.parseGeometry(s,r[o],e);n.set(parseInt(o),i)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),n}parseGeometry(e,n,r){switch(n.attrType){case"Mesh":return this.parseMeshGeometry(e,n,r);case"NurbsCurve":return this.parseNurbsGeometry(n)}}parseMeshGeometry(e,n,r){const o=r.skeletons,s=[],i=e.parents.map(function(f){return S.Objects.Model[f.ID]});if(i.length===0)return;const u=e.children.reduce(function(f,p){return o[p.ID]!==void 0&&(f=o[p.ID]),f},null);e.children.forEach(function(f){r.morphTargets[f.ID]!==void 0&&s.push(r.morphTargets[f.ID])});const c=i[0],l={};"RotationOrder"in c&&(l.eulerOrder=Ks(c.RotationOrder.value)),"InheritType"in c&&(l.inheritType=parseInt(c.InheritType.value)),"GeometricTranslation"in c&&(l.translation=c.GeometricTranslation.value),"GeometricRotation"in c&&(l.rotation=c.GeometricRotation.value),"GeometricScaling"in c&&(l.scale=c.GeometricScaling.value);const a=Xs(l);return this.genGeometry(n,u,s,a)}genGeometry(e,n,r,o){const s=new At;e.attrName&&(s.name=e.attrName);const i=this.parseGeoNode(e,n),u=this.genBuffers(i),c=new we(u.vertex,3);if(c.applyMatrix4(o),s.setAttribute("position",c),u.colors.length>0&&s.setAttribute("color",new we(u.colors,3)),n&&(s.setAttribute("skinIndex",new Bi(u.weightsIndices,4)),s.setAttribute("skinWeight",new we(u.vertexWeights,4)),s.FBX_Deformer=n),u.normal.length>0){const l=new Ni().getNormalMatrix(o),a=new we(u.normal,3);a.applyNormalMatrix(l),s.setAttribute("normal",a)}if(u.uvs.forEach(function(l,a){let f="uv"+(a+1).toString();a===0&&(f="uv"),s.setAttribute(f,new we(u.uvs[a],2))}),i.material&&i.material.mappingType!=="AllSame"){let l=u.materialIndex[0],a=0;if(u.materialIndex.forEach(function(f,p){f!==l&&(s.addGroup(a,p-a,l),l=f,a=p)}),s.groups.length>0){const f=s.groups[s.groups.length-1],p=f.start+f.count;p!==u.materialIndex.length&&s.addGroup(p,u.materialIndex.length-p,l)}s.groups.length===0&&s.addGroup(0,u.materialIndex.length,u.materialIndex[0])}return this.addMorphTargets(s,e,r,o),s}parseGeoNode(e,n){const r={};if(r.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],r.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(r.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(r.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(r.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){r.uv=[];let o=0;for(;e.LayerElementUV[o];)e.LayerElementUV[o].UV&&r.uv.push(this.parseUVs(e.LayerElementUV[o])),o++}return r.weightTable={},n!==null&&(r.skeleton=n,n.rawBones.forEach(function(o,s){o.indices.forEach(function(i,u){r.weightTable[i]===void 0&&(r.weightTable[i]=[]),r.weightTable[i].push({id:s,weight:o.weights[u]})})})),r}genBuffers(e){const n={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let r=0,o=0,s=!1,i=[],u=[],c=[],l=[],a=[],f=[];const p=this;return e.vertexIndices.forEach(function(d,h){let g,y=!1;d<0&&(d=d^-1,y=!0);let v=[],b=[];if(i.push(d*3,d*3+1,d*3+2),e.color){const _=Et(h,r,d,e.color);c.push(_[0],_[1],_[2])}if(e.skeleton){if(e.weightTable[d]!==void 0&&e.weightTable[d].forEach(function(_){b.push(_.weight),v.push(_.id)}),b.length>4){s||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),s=!0);const _=[0,0,0,0],P=[0,0,0,0];b.forEach(function(w,T){let R=w,A=v[T];P.forEach(function(F,I,_e){if(R>F){_e[I]=R,R=F;const ue=_[I];_[I]=A,A=ue}})}),v=_,b=P}for(;b.length<4;)b.push(0),v.push(0);for(let _=0;_<4;++_)a.push(b[_]),f.push(v[_])}if(e.normal){const _=Et(h,r,d,e.normal);u.push(_[0],_[1],_[2])}e.material&&e.material.mappingType!=="AllSame"&&(g=Et(h,r,d,e.material)[0],g<0&&(p.negativeMaterialIndices=!0,g=0)),e.uv&&e.uv.forEach(function(_,P){const w=Et(h,r,d,_);l[P]===void 0&&(l[P]=[]),l[P].push(w[0]),l[P].push(w[1])}),o++,y&&(o>4&&console.warn("THREE.FBXLoader: Polygons with more than four sides are not supported. Make sure to triangulate the geometry during export."),p.genFace(n,e,i,g,u,c,l,a,f,o),r++,o=0,i=[],u=[],c=[],l=[],a=[],f=[])}),n}genFace(e,n,r,o,s,i,u,c,l,a){for(let f=2;f<a;f++)e.vertex.push(n.vertexPositions[r[0]]),e.vertex.push(n.vertexPositions[r[1]]),e.vertex.push(n.vertexPositions[r[2]]),e.vertex.push(n.vertexPositions[r[(f-1)*3]]),e.vertex.push(n.vertexPositions[r[(f-1)*3+1]]),e.vertex.push(n.vertexPositions[r[(f-1)*3+2]]),e.vertex.push(n.vertexPositions[r[f*3]]),e.vertex.push(n.vertexPositions[r[f*3+1]]),e.vertex.push(n.vertexPositions[r[f*3+2]]),n.skeleton&&(e.vertexWeights.push(c[0]),e.vertexWeights.push(c[1]),e.vertexWeights.push(c[2]),e.vertexWeights.push(c[3]),e.vertexWeights.push(c[(f-1)*4]),e.vertexWeights.push(c[(f-1)*4+1]),e.vertexWeights.push(c[(f-1)*4+2]),e.vertexWeights.push(c[(f-1)*4+3]),e.vertexWeights.push(c[f*4]),e.vertexWeights.push(c[f*4+1]),e.vertexWeights.push(c[f*4+2]),e.vertexWeights.push(c[f*4+3]),e.weightsIndices.push(l[0]),e.weightsIndices.push(l[1]),e.weightsIndices.push(l[2]),e.weightsIndices.push(l[3]),e.weightsIndices.push(l[(f-1)*4]),e.weightsIndices.push(l[(f-1)*4+1]),e.weightsIndices.push(l[(f-1)*4+2]),e.weightsIndices.push(l[(f-1)*4+3]),e.weightsIndices.push(l[f*4]),e.weightsIndices.push(l[f*4+1]),e.weightsIndices.push(l[f*4+2]),e.weightsIndices.push(l[f*4+3])),n.color&&(e.colors.push(i[0]),e.colors.push(i[1]),e.colors.push(i[2]),e.colors.push(i[(f-1)*3]),e.colors.push(i[(f-1)*3+1]),e.colors.push(i[(f-1)*3+2]),e.colors.push(i[f*3]),e.colors.push(i[f*3+1]),e.colors.push(i[f*3+2])),n.material&&n.material.mappingType!=="AllSame"&&(e.materialIndex.push(o),e.materialIndex.push(o),e.materialIndex.push(o)),n.normal&&(e.normal.push(s[0]),e.normal.push(s[1]),e.normal.push(s[2]),e.normal.push(s[(f-1)*3]),e.normal.push(s[(f-1)*3+1]),e.normal.push(s[(f-1)*3+2]),e.normal.push(s[f*3]),e.normal.push(s[f*3+1]),e.normal.push(s[f*3+2])),n.uv&&n.uv.forEach(function(p,d){e.uvs[d]===void 0&&(e.uvs[d]=[]),e.uvs[d].push(u[d][0]),e.uvs[d].push(u[d][1]),e.uvs[d].push(u[d][(f-1)*2]),e.uvs[d].push(u[d][(f-1)*2+1]),e.uvs[d].push(u[d][f*2]),e.uvs[d].push(u[d][f*2+1])})}addMorphTargets(e,n,r,o){if(r.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const s=this;r.forEach(function(i){i.rawTargets.forEach(function(u){const c=S.Objects.Geometry[u.geoID];c!==void 0&&s.genMorphGeometry(e,n,c,o,u.name)})})}genMorphGeometry(e,n,r,o,s){const i=n.PolygonVertexIndex!==void 0?n.PolygonVertexIndex.a:[],u=r.Vertices!==void 0?r.Vertices.a:[],c=r.Indexes!==void 0?r.Indexes.a:[],l=e.attributes.position.count*3,a=new Float32Array(l);for(let h=0;h<c.length;h++){const g=c[h]*3;a[g]=u[h*3],a[g+1]=u[h*3+1],a[g+2]=u[h*3+2]}const f={vertexIndices:i,vertexPositions:a},p=this.genBuffers(f),d=new we(p.vertex,3);d.name=s||r.attrName,d.applyMatrix4(o),e.morphAttributes.position.push(d)}parseNormals(e){const n=e.MappingInformationType,r=e.ReferenceInformationType,o=e.Normals.a;let s=[];return r==="IndexToDirect"&&("NormalIndex"in e?s=e.NormalIndex.a:"NormalsIndex"in e&&(s=e.NormalsIndex.a)),{dataSize:3,buffer:o,indices:s,mappingType:n,referenceType:r}}parseUVs(e){const n=e.MappingInformationType,r=e.ReferenceInformationType,o=e.UV.a;let s=[];return r==="IndexToDirect"&&(s=e.UVIndex.a),{dataSize:2,buffer:o,indices:s,mappingType:n,referenceType:r}}parseVertexColors(e){const n=e.MappingInformationType,r=e.ReferenceInformationType,o=e.Colors.a;let s=[];return r==="IndexToDirect"&&(s=e.ColorIndex.a),{dataSize:4,buffer:o,indices:s,mappingType:n,referenceType:r}}parseMaterialIndices(e){const n=e.MappingInformationType,r=e.ReferenceInformationType;if(n==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:r};const o=e.Materials.a,s=[];for(let i=0;i<o.length;++i)s.push(i);return{dataSize:1,buffer:o,indices:s,mappingType:n,referenceType:r}}parseNurbsGeometry(e){const n=parseInt(e.Order);if(isNaN(n))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new At;const r=n-1,o=e.KnotVector.a,s=[],i=e.Points.a;for(let f=0,p=i.length;f<p;f+=4)s.push(new Bt().fromArray(i,f));let u,c;if(e.Form==="Closed")s.push(s[0]);else if(e.Form==="Periodic"){u=r,c=o.length-1-u;for(let f=0;f<r;++f)s.push(s[f])}const a=new Xc(r,o,s,u,c).getPoints(s.length*12);return new At().setFromPoints(a)}}class Zc{parse(){const e=[],n=this.parseClips();if(n!==void 0)for(const r in n){const o=n[r],s=this.addClip(o);e.push(s)}return e}parseClips(){if(S.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const n=this.parseAnimationLayers(e);return this.parseAnimStacks(n)}parseAnimationCurveNodes(){const e=S.Objects.AnimationCurveNode,n=new Map;for(const r in e){const o=e[r];if(o.attrName.match(/S|R|T|DeformPercent/)!==null){const s={id:o.id,attr:o.attrName,curves:{}};n.set(s.id,s)}}return n}parseAnimationCurves(e){const n=S.Objects.AnimationCurve;for(const r in n){const o={id:n[r].id,times:n[r].KeyTime.a.map(nl),values:n[r].KeyValueFloat.a},s=k.get(o.id);if(s!==void 0){const i=s.parents[0].ID,u=s.parents[0].relationship;u.match(/X/)?e.get(i).curves.x=o:u.match(/Y/)?e.get(i).curves.y=o:u.match(/Z/)?e.get(i).curves.z=o:u.match(/d|DeformPercent/)&&e.has(i)&&(e.get(i).curves.morph=o)}}}parseAnimationLayers(e){const n=S.Objects.AnimationLayer,r=new Map;for(const o in n){const s=[],i=k.get(parseInt(o));i!==void 0&&(i.children.forEach(function(c,l){if(e.has(c.ID)){const a=e.get(c.ID);if(a.curves.x!==void 0||a.curves.y!==void 0||a.curves.z!==void 0){if(s[l]===void 0){const f=k.get(c.ID).parents.filter(function(p){return p.relationship!==void 0})[0].ID;if(f!==void 0){const p=S.Objects.Model[f.toString()];if(p===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",c);return}const d={modelName:p.attrName?Ot.sanitizeNodeName(p.attrName):"",ID:p.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};z.traverse(function(h){h.ID===p.id&&(d.transform=h.matrix,h.userData.transformData&&(d.eulerOrder=h.userData.transformData.eulerOrder))}),d.transform||(d.transform=new O),"PreRotation"in p&&(d.preRotation=p.PreRotation.value),"PostRotation"in p&&(d.postRotation=p.PostRotation.value),s[l]=d}}s[l]&&(s[l][a.attr]=a)}else if(a.curves.morph!==void 0){if(s[l]===void 0){const f=k.get(c.ID).parents.filter(function(v){return v.relationship!==void 0})[0].ID,p=k.get(f).parents[0].ID,d=k.get(p).parents[0].ID,h=k.get(d).parents[0].ID,g=S.Objects.Model[h],y={modelName:g.attrName?Ot.sanitizeNodeName(g.attrName):"",morphName:S.Objects.Deformer[f].attrName};s[l]=y}s[l][a.attr]=a}}}),r.set(parseInt(o),s))}return r}parseAnimStacks(e){const n=S.Objects.AnimationStack,r={};for(const o in n){const s=k.get(parseInt(o)).children;s.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const i=e.get(s[0].ID);r[o]={name:n[o].attrName,layer:i}}return r}addClip(e){let n=[];const r=this;return e.layer.forEach(function(o){n=n.concat(r.generateTracks(o))}),new Io(e.name,-1,n)}generateTracks(e){const n=[];let r=new N,o=new Be,s=new N;if(e.transform&&e.transform.decompose(r,o,s),r=r.toArray(),o=new Ee().setFromQuaternion(o,e.eulerOrder).toArray(),s=s.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const i=this.generateVectorTrack(e.modelName,e.T.curves,r,"position");i!==void 0&&n.push(i)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const i=this.generateRotationTrack(e.modelName,e.R.curves,o,e.preRotation,e.postRotation,e.eulerOrder);i!==void 0&&n.push(i)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const i=this.generateVectorTrack(e.modelName,e.S.curves,s,"scale");i!==void 0&&n.push(i)}if(e.DeformPercent!==void 0){const i=this.generateMorphTrack(e);i!==void 0&&n.push(i)}return n}generateVectorTrack(e,n,r,o){const s=this.getTimesForAllAxes(n),i=this.getKeyframeTrackValues(s,n,r);return new Ui(e+"."+o,s,i)}generateRotationTrack(e,n,r,o,s,i){n.x!==void 0&&(this.interpolateRotations(n.x),n.x.values=n.x.values.map(ie.degToRad)),n.y!==void 0&&(this.interpolateRotations(n.y),n.y.values=n.y.values.map(ie.degToRad)),n.z!==void 0&&(this.interpolateRotations(n.z),n.z.values=n.z.values.map(ie.degToRad));const u=this.getTimesForAllAxes(n),c=this.getKeyframeTrackValues(u,n,r);o!==void 0&&(o=o.map(ie.degToRad),o.push(i),o=new Ee().fromArray(o),o=new Be().setFromEuler(o)),s!==void 0&&(s=s.map(ie.degToRad),s.push(i),s=new Ee().fromArray(s),s=new Be().setFromEuler(s).invert());const l=new Be,a=new Ee,f=[];for(let p=0;p<c.length;p+=3)a.set(c[p],c[p+1],c[p+2],i),l.setFromEuler(a),o!==void 0&&l.premultiply(o),s!==void 0&&l.multiply(s),l.toArray(f,p/3*4);return new zi(e+".quaternion",u,f)}generateMorphTrack(e){const n=e.DeformPercent.curves.morph,r=n.values.map(function(s){return s/100}),o=z.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new Vi(e.modelName+".morphTargetInfluences["+o+"]",n.times,r)}getTimesForAllAxes(e){let n=[];if(e.x!==void 0&&(n=n.concat(e.x.times)),e.y!==void 0&&(n=n.concat(e.y.times)),e.z!==void 0&&(n=n.concat(e.z.times)),n=n.sort(function(r,o){return r-o}),n.length>1){let r=1,o=n[0];for(let s=1;s<n.length;s++){const i=n[s];i!==o&&(n[r]=i,o=i,r++)}n=n.slice(0,r)}return n}getKeyframeTrackValues(e,n,r){const o=r,s=[];let i=-1,u=-1,c=-1;return e.forEach(function(l){if(n.x&&(i=n.x.times.indexOf(l)),n.y&&(u=n.y.times.indexOf(l)),n.z&&(c=n.z.times.indexOf(l)),i!==-1){const a=n.x.values[i];s.push(a),o[0]=a}else s.push(o[0]);if(u!==-1){const a=n.y.values[u];s.push(a),o[1]=a}else s.push(o[1]);if(c!==-1){const a=n.z.values[c];s.push(a),o[2]=a}else s.push(o[2])}),s}interpolateRotations(e){for(let n=1;n<e.values.length;n++){const r=e.values[n-1],o=e.values[n]-r,s=Math.abs(o);if(s>=180){const i=s/180,u=o/i;let c=r+u;const l=e.times[n-1],f=(e.times[n]-l)/i;let p=l+f;const d=[],h=[];for(;p<e.times[n];)d.push(p),p+=f,h.push(c),c+=u;e.times=ao(e.times,n,d),e.values=ao(e.values,n,h)}}}}class Qc{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,n){this.currentProp=e,this.currentPropName=n}parse(e){this.currentIndent=0,this.allNodes=new Gs,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const n=this,r=e.split(/[\r\n]+/);return r.forEach(function(o,s){const i=o.match(/^[\s\t]*;/),u=o.match(/^[\s\t]*$/);if(i||u)return;const c=o.match("^\\t{"+n.currentIndent+"}(\\w+):(.*){",""),l=o.match("^\\t{"+n.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),a=o.match("^\\t{"+(n.currentIndent-1)+"}}");c?n.parseNodeBegin(o,c):l?n.parseNodeProperty(o,l,r[++s]):a?n.popStack():o.match(/^[^\s\t}]/)&&n.parseNodePropertyContinued(o)}),this.allNodes}parseNodeBegin(e,n){const r=n[1].trim().replace(/^"/,"").replace(/"$/,""),o=n[2].split(",").map(function(c){return c.trim().replace(/^"/,"").replace(/"$/,"")}),s={name:r},i=this.parseNodeAttr(o),u=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(r,s):r in u?(r==="PoseNode"?u.PoseNode.push(s):u[r].id!==void 0&&(u[r]={},u[r][u[r].id]=u[r]),i.id!==""&&(u[r][i.id]=s)):typeof i.id=="number"?(u[r]={},u[r][i.id]=s):r!=="Properties70"&&(r==="PoseNode"?u[r]=[s]:u[r]=s),typeof i.id=="number"&&(s.id=i.id),i.name!==""&&(s.attrName=i.name),i.type!==""&&(s.attrType=i.type),this.pushStack(s)}parseNodeAttr(e){let n=e[0];e[0]!==""&&(n=parseInt(e[0]),isNaN(n)&&(n=e[0]));let r="",o="";return e.length>1&&(r=e[1].replace(/^(\w+)::/,""),o=e[2]),{id:n,name:r,type:o}}parseNodeProperty(e,n,r){let o=n[1].replace(/^"/,"").replace(/"$/,"").trim(),s=n[2].replace(/^"/,"").replace(/"$/,"").trim();o==="Content"&&s===","&&(s=r.replace(/"/g,"").replace(/,$/,"").trim());const i=this.getCurrentNode();if(i.name==="Properties70"){this.parseNodeSpecialProperty(e,o,s);return}if(o==="C"){const c=s.split(",").slice(1),l=parseInt(c[0]),a=parseInt(c[1]);let f=s.split(",").slice(3);f=f.map(function(p){return p.trim().replace(/^"/,"")}),o="connections",s=[l,a],ol(s,f),i[o]===void 0&&(i[o]=[])}o==="Node"&&(i.id=s),o in i&&Array.isArray(i[o])?i[o].push(s):o!=="a"?i[o]=s:i.a=s,this.setCurrentProp(i,o),o==="a"&&s.slice(-1)!==","&&(i.a=hn(s))}parseNodePropertyContinued(e){const n=this.getCurrentNode();n.a+=e,e.slice(-1)!==","&&(n.a=hn(n.a))}parseNodeSpecialProperty(e,n,r){const o=r.split('",').map(function(a){return a.trim().replace(/^\"/,"").replace(/\s/,"_")}),s=o[0],i=o[1],u=o[2],c=o[3];let l=o[4];switch(i){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=hn(l);break}this.getPrevNode()[s]={type:i,type2:u,flag:c,value:l},this.setCurrentProp(this.getPrevNode(),s)}}class Jc{parse(e){const n=new so(e);n.skip(23);const r=n.getUint32();if(r<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+r);const o=new Gs;for(;!this.endOfContent(n);){const s=this.parseNode(n,r);s!==null&&o.add(s.name,s)}return o}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,n){const r={},o=n>=7500?e.getUint64():e.getUint32(),s=n>=7500?e.getUint64():e.getUint32();n>=7500?e.getUint64():e.getUint32();const i=e.getUint8(),u=e.getString(i);if(o===0)return null;const c=[];for(let p=0;p<s;p++)c.push(this.parseProperty(e));const l=c.length>0?c[0]:"",a=c.length>1?c[1]:"",f=c.length>2?c[2]:"";for(r.singleProperty=s===1&&e.getOffset()===o;o>e.getOffset();){const p=this.parseNode(e,n);p!==null&&this.parseSubNode(u,r,p)}return r.propertyList=c,typeof l=="number"&&(r.id=l),a!==""&&(r.attrName=a),f!==""&&(r.attrType=f),u!==""&&(r.name=u),r}parseSubNode(e,n,r){if(r.singleProperty===!0){const o=r.propertyList[0];Array.isArray(o)?(n[r.name]=r,r.a=o):n[r.name]=o}else if(e==="Connections"&&r.name==="C"){const o=[];r.propertyList.forEach(function(s,i){i!==0&&o.push(s)}),n.connections===void 0&&(n.connections=[]),n.connections.push(o)}else if(r.name==="Properties70")Object.keys(r).forEach(function(s){n[s]=r[s]});else if(e==="Properties70"&&r.name==="P"){let o=r.propertyList[0],s=r.propertyList[1];const i=r.propertyList[2],u=r.propertyList[3];let c;o.indexOf("Lcl ")===0&&(o=o.replace("Lcl ","Lcl_")),s.indexOf("Lcl ")===0&&(s=s.replace("Lcl ","Lcl_")),s==="Color"||s==="ColorRGB"||s==="Vector"||s==="Vector3D"||s.indexOf("Lcl_")===0?c=[r.propertyList[4],r.propertyList[5],r.propertyList[6]]:c=r.propertyList[4],n[o]={type:s,type2:i,flag:u,value:c}}else n[r.name]===void 0?typeof r.id=="number"?(n[r.name]={},n[r.name][r.id]=r):n[r.name]=r:r.name==="PoseNode"?(Array.isArray(n[r.name])||(n[r.name]=[n[r.name]]),n[r.name].push(r)):n[r.name][r.id]===void 0&&(n[r.name][r.id]=r)}parseProperty(e){const n=e.getString(1);let r;switch(n){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return r=e.getUint32(),e.getArrayBuffer(r);case"S":return r=e.getUint32(),e.getString(r);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const o=e.getUint32(),s=e.getUint32(),i=e.getUint32();if(s===0)switch(n){case"b":case"c":return e.getBooleanArray(o);case"d":return e.getFloat64Array(o);case"f":return e.getFloat32Array(o);case"i":return e.getInt32Array(o);case"l":return e.getInt64Array(o)}const u=$c(new Uint8Array(e.getArrayBuffer(i))),c=new so(u.buffer);switch(n){case"b":case"c":return c.getBooleanArray(o);case"d":return c.getFloat64Array(o);case"f":return c.getFloat32Array(o);case"i":return c.getInt32Array(o);case"l":return c.getInt64Array(o)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+n)}}}class so{constructor(e,n){this.dv=new DataView(e),this.offset=0,this.littleEndian=n!==void 0?n:!0,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const n=[];for(let r=0;r<e;r++)n.push(this.getBoolean());return n}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const n=[];for(let r=0;r<e;r++)n.push(this.getInt32());return n}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,n;return this.littleEndian?(e=this.getUint32(),n=this.getUint32()):(n=this.getUint32(),e=this.getUint32()),n&2147483648?(n=~n&4294967295,e=~e&4294967295,e===4294967295&&(n=n+1&4294967295),e=e+1&4294967295,-(n*4294967296+e)):n*4294967296+e}getInt64Array(e){const n=[];for(let r=0;r<e;r++)n.push(this.getInt64());return n}getUint64(){let e,n;return this.littleEndian?(e=this.getUint32(),n=this.getUint32()):(n=this.getUint32(),e=this.getUint32()),n*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const n=[];for(let r=0;r<e;r++)n.push(this.getFloat32());return n}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const n=[];for(let r=0;r<e;r++)n.push(this.getFloat64());return n}getArrayBuffer(e){const n=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,n}getString(e){const n=this.offset;let r=new Uint8Array(this.dv.buffer,n,e);this.skip(e);const o=r.indexOf(0);return o>=0&&(r=new Uint8Array(this.dv.buffer,n,o)),this._textDecoder.decode(r)}}class Gs{add(e,n){this[e]=n}}function el(t){const e="Kaydara FBX Binary  \0";return t.byteLength>=e.length&&e===Ys(t,0,e.length)}function tl(t){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let n=0;function r(o){const s=t[o-1];return t=t.slice(n+o),n++,s}for(let o=0;o<e.length;++o)if(r(1)===e[o])return!1;return!0}function io(t){const e=/FBXVersion: (\d+)/,n=t.match(e);if(n)return parseInt(n[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function nl(t){return t/46186158e3}const rl=[];function Et(t,e,n,r){let o;switch(r.mappingType){case"ByPolygonVertex":o=t;break;case"ByPolygon":o=e;break;case"ByVertice":o=n;break;case"AllSame":o=r.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+r.mappingType)}r.referenceType==="IndexToDirect"&&(o=r.indices[o]);const s=o*r.dataSize,i=s+r.dataSize;return sl(rl,r.buffer,s,i)}const dn=new Ee,Fe=new N;function Xs(t){const e=new O,n=new O,r=new O,o=new O,s=new O,i=new O,u=new O,c=new O,l=new O,a=new O,f=new O,p=new O,d=t.inheritType?t.inheritType:0;if(t.translation&&e.setPosition(Fe.fromArray(t.translation)),t.preRotation){const I=t.preRotation.map(ie.degToRad);I.push(t.eulerOrder||Ee.DEFAULT_ORDER),n.makeRotationFromEuler(dn.fromArray(I))}if(t.rotation){const I=t.rotation.map(ie.degToRad);I.push(t.eulerOrder||Ee.DEFAULT_ORDER),r.makeRotationFromEuler(dn.fromArray(I))}if(t.postRotation){const I=t.postRotation.map(ie.degToRad);I.push(t.eulerOrder||Ee.DEFAULT_ORDER),o.makeRotationFromEuler(dn.fromArray(I)),o.invert()}t.scale&&s.scale(Fe.fromArray(t.scale)),t.scalingOffset&&u.setPosition(Fe.fromArray(t.scalingOffset)),t.scalingPivot&&i.setPosition(Fe.fromArray(t.scalingPivot)),t.rotationOffset&&c.setPosition(Fe.fromArray(t.rotationOffset)),t.rotationPivot&&l.setPosition(Fe.fromArray(t.rotationPivot)),t.parentMatrixWorld&&(f.copy(t.parentMatrix),a.copy(t.parentMatrixWorld));const h=n.clone().multiply(r).multiply(o),g=new O;g.extractRotation(a);const y=new O;y.copyPosition(a);const v=y.clone().invert().multiply(a),b=g.clone().invert().multiply(v),_=s,P=new O;if(d===0)P.copy(g).multiply(h).multiply(b).multiply(_);else if(d===1)P.copy(g).multiply(b).multiply(h).multiply(_);else{const _e=new O().scale(new N().setFromMatrixScale(f)).clone().invert(),ue=b.clone().multiply(_e);P.copy(g).multiply(h).multiply(ue).multiply(_)}const w=l.clone().invert(),T=i.clone().invert();let R=e.clone().multiply(c).multiply(l).multiply(n).multiply(r).multiply(o).multiply(w).multiply(u).multiply(i).multiply(s).multiply(T);const A=new O().copyPosition(R),F=a.clone().multiply(A);return p.copyPosition(F),R=p.clone().multiply(P),R.premultiply(a.invert()),R}function Ks(t){t=t||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return t===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[t]}function hn(t){return t.split(",").map(function(n){return parseFloat(n)})}function Ys(t,e,n){return e===void 0&&(e=0),n===void 0&&(n=t.byteLength),new TextDecoder().decode(new Uint8Array(t,e,n))}function ol(t,e){for(let n=0,r=t.length,o=e.length;n<o;n++,r++)t[r]=e[n]}function sl(t,e,n,r){for(let o=n,s=0;o<r;o++,s++)t[s]=e[o];return t}function ao(t,e,n){return t.slice(0,e).concat(n).concat(t.slice(e))}const qs=t=>t&&new Promise(e=>{new Kc().load(t,e)}),Zs=t=>t&&new Promise(e=>{new Xe().load(t,e)}),il=["px.png","nx.png","py.png","ny.png","pz.png","nz.png"],al=t=>t&&new Promise(e=>{new Hi().setPath(`${t}/`).load(il,e)}),cl=["c100007_01","c100007_05","c100007_09","c100034_01","c100035_01","c100036_01","c100037_01","c100041_01"],ll=async t=>await(await fetch(t)).json(),Ht=async t=>(await ll(t)).data,ul=(...t)=>e=>t.reduce((n,r)=>r(n),e),fl=t=>[...new Set(t)],he=t=>t==="false"?!1:!!t,Qs=(t,e,n)=>{if(!e.length)return;const r=e.pop(),o=e.reduce((s,i)=>s==null?void 0:s[i],t);o&&(o[r]=n)};function er(t){return!!/[0-9A-Fa-f]{6}/.test(t)}function Ct(t){return er(t)&&!t.startsWith("#")?new U(`#${t}`):new U(t)}async function pl(t=100){return await new Promise(e=>setTimeout(e,t))}function Js(t,e="="){const[n,...r]=t.split(e),o=r.join(e);return[n,o]}const dl=t=>t.startsWith("w302"),co=([t,...e])=>`${t.toUpperCase()}${e.join("")}`;function hl(t){return t==="smith"?"dragon":t.endsWith("h")?"story":cl.includes(t)?"spAdventurer":{c:"adventurer",b:"boss",d:"dragon",e:"enemy",h:"high boss",o:"object",r:"raid boss",w:"weapon"}[t[0]]??"other"}function ml(t=Fl){const e=new Wi(t);return e.outputEncoding=Q,e}function gl(t={}){const{fov:e,aspect:n,near:r,far:o}={...jl,...t};return new Lo(e,n,r,o)}async function _l(t){if(t.startsWith("img:")){const e=t.replace("img:",""),n=await Zs(e);return n.encoding=Q,n.center.set(.5,0),n}if(t.startsWith("sky:")){const e=t.replace("sky:",""),n=await al(e);return n.encoding=Q,n}if(t==="transparent")return null;if(er(t)){const e=t.startsWith("#")?t:`#${t}`;return new U(e)}}function yl(t){var e,n,r,o;(n=(e=t.map)==null?void 0:e.dispose)==null||n.call(e),(o=(r=t.userData.backupMap)==null?void 0:r.dispose)==null||o.call(r),t.dispose()}const ei=t=>{const e=new Xe().load(t);return e.encoding=Q,e};function vl(t){const e=[],n=[];return t.traverse(r=>{r.isMesh&&e.push(r),r.isBone&&n.push(r)}),[e,n]}function bl(t){var n,r;if(!t)return;[t.material].flat().forEach(o=>{var s,i,u,c,l,a;(i=(s=o.map)==null?void 0:s.dispose)==null||i.call(s),(l=(c=(u=o.userData)==null?void 0:u.backupMap)==null?void 0:c.dispose)==null||l.call(c),(a=o.dispose)==null||a.call(o)}),(r=(n=t.geometry)==null?void 0:n.dispose)==null||r.call(n)}const wl=()=>{const t=new Date,e=t.toDateString().replaceAll(" ","_"),n=t.toLocaleTimeString().replaceAll(":","-").replaceAll(" ","");return`${e}_${n}`},ti=t=>t?t.split("/").reduce((n,r)=>{const[o,s]=r.split("=");return o&&s&&(n[o]=s),n},{}):{},El=`
varying vec3 vViewPosition;

struct BlinnPhongMaterial {

	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;

};

void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {

	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;

	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );

	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;

}

void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {

	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );

}

#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
`,Pl=`
#ifdef USE_MATCAP

	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks
	vec4 matcapColor = texture2D( matcap, uv );

	#ifdef MATCAP_BLENDING_MULTIPLY

		outgoingLight *= matcapColor.rgb;

	#elif defined( MATCAP_BLENDING_ADD )

		outgoingLight += matcapColor.rgb;

	#endif

#endif
`,Pt={defines:{TOON:!0,MATCAP:!0,MATCAP_BLENDING_ADD:!0},uniforms:Bn.merge([et.toon.uniforms,et.phong.uniforms,et.matcap.uniforms]),vertexShader:et.phong.vertexShader.replace("#include <envmap_pars_vertex>","").replace("#include <envmap_vertex>",""),fragmentShader:et.phong.fragmentShader.replace("#include <common>",`
					#ifdef USE_MATCAP
						uniform sampler2D matcap;
					#endif

					#include <common>
				`).replace("#include <envmap_common_pars_fragment>",`
					#include <gradientmap_pars_fragment>
				`).replace("#include <envmap_pars_fragment>","").replace("#include <lights_phong_pars_fragment>",El).replace("#include <envmap_fragment>",`
					${Pl}
				`)};class ni extends st{constructor(e){super(),this._matcapCombine=Er,this.emissiveIntensity=1,this.normalMapType=Gi,this.combine=Pr,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.lights=!0,this.vertexShader=Pt.vertexShader,this.fragmentShader=Pt.fragmentShader,this.defines=Object.assign({},Pt.defines),Object.defineProperty(this,"matcapCombine",{get:function(){return this._matcapCombine},set:function(r){switch(this._matcapCombine=r,r){case Pr:this.defines.MATCAP_BLENDING_MULTIPLY=!0,delete this.defines.MATCAP_BLENDING_ADD;break;default:case Er:this.defines.MATCAP_BLENDING_ADD=!0,delete this.defines.MATCAP_BLENDING_MULTIPLY;break}}}),this.uniforms=Bn.clone(Pt.uniforms);const n=["specular","shininess","opacity","diffuse","map","matcap","gradientMap","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveMap","bumpMap","bumpScale","normalMap","normalScale","displacemantBias","displacemantMap","displacemantScale","specularMap","alphaMap","envMap","reflectivity","refractionRatio"];for(const r of n)Object.defineProperty(this,r,{get:function(){return this.uniforms[r].value},set:function(o){this.uniforms[r].value=o}});Object.defineProperty(this,"color",Object.getOwnPropertyDescriptor(this,"diffuse")),this.setValues(e)}copy(e){return super.copy(e),this.matcapCombine=e.matcapCombine,this.emissiveIntensity=e.emissiveIntensity,this.normalMapType=e.normalMapType,this.combine=e.combine,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}ni.prototype.isMMDToonMaterial=!0;const xl=["color","emissive","specular"],Sl=["wireframe","metalness","opacity","roughness","shininess","transparent","emissiveIntensity","transmission","thickness","ior"],ri=["type","flatShading","showTexture","gradientMap","matcap"],Al=[...xl,...Sl,...ri],Tl=["transparent","opacity","wireframe","showTexture","color"],Ml={Basic:[],Toon:["emissive","emissiveIntensity","gradientMap"],Lambert:["emissive","emissiveIntensity"],Phong:["emissive","emissiveIntensity","specular","shininess","flatShading"],Standard:["emissive","emissiveIntensity","metalness","roughness","flatShading"],Physical:["emissive","emissiveIntensity","metalness","roughness","flatShading","transmission","thickness","ior"],Matcap:["flatShading","matcap"],MMDToon:["emissive","emissiveIntensity","specular","shininess","matcap","gradientMap","flatShading"]},G=t=>`${t}`,mn=t=>er(t)?`${t.startsWith("#")?"":"#"}${t}`:t,Cl=t=>Array.isArray(t)?t.join(","):t,tr={wireframe:{name:"Wireframe",type:"boolean",default:!1,valueMap:he,toString:G},showTexture:{name:"Texture",type:"boolean",default:!0,valueMap:he,toString:G},transparent:{name:"Transparent",type:"boolean",default:!1,valueMap:he,toString:G},flatShading:{name:"Flat Shading",type:"boolean",default:!1,valueMap:he,toString:G},color:{name:"Color",type:"color",default:"#ffffff",valueMap:Ct,toString:mn},emissive:{name:"Emissive",type:"color",default:"#000000",valueMap:Ct,toString:mn},opacity:{name:"Opacity",type:"percentage",default:1,min:0,max:1,valueMap:parseFloat,toString:G},emissiveIntensity:{name:"Emissive Intensity",type:"percentage",default:1,min:0,max:1,valueMap:parseFloat,toString:G},specular:{name:"Specular",type:"color",default:"#111111",valueMap:Ct,toString:mn},metalness:{name:"Metalness",type:"percentage",default:0,min:0,max:1,valueMap:parseFloat,toString:G},roughness:{name:"Roughness",type:"percentage",default:1,min:0,max:1,valueMap:parseFloat,toString:G},shininess:{name:"Shininess",type:"number",default:30,min:1,max:100,valueMap:parseFloat,toString:G},gradientMap:{name:"Gradient Map",type:"select",default:"none",valueMap:oi,toString:Cl},matcap:{name:"Matcap",type:"select",default:"matcap_fresnel.jpg",valueMap:si,toString:G},transmission:{name:"Transmission",type:"number",default:1,min:0,max:1,valueMap:parseFloat,toString:G},thickness:{name:"Thickness",type:"number",default:.01,min:0,max:10,valueMap:parseFloat,toString:G},ior:{name:"Index-of-refraction",type:"number",default:1.5,min:1,max:2.333,valueMap:parseFloat,toString:G}},Ll=Object.fromEntries(Object.entries(tr).map(([t,{default:e}])=>[t,e])),Te={...Ll,type:"Basic"},Ol=Object.fromEntries(Object.entries(tr).map(([t,{valueMap:e}])=>[t,e])),kl=Object.fromEntries(Object.entries(tr).map(([t,{toString:e}])=>[t,e])),gn=t=>[...Tl,...Ml[t]],Dl=(t,e={})=>{if(t==="MMDToon")return new ni(e);const n=`Mesh${t}Material`;return new Ro[n](e)},lo=(t,{matType:e="Basic",texturePath:n="",force:r=!1}={})=>{t.forEach(o=>{const s=[o.material].flat(),i=Array.isArray(o.material);if(!r&&!n){const u=`isMesh${e}Material`;if(!s.some(l=>!l[u]))return}s.forEach((u,c)=>{var f,p,d,h;const l=n?new Xe().load(n):s[c].map;n&&(l.encoding=Q);const a=Dl(e);if(a.name=u.name,a.map=l,a.userData.backupMap=u.userData.backupMap,n&&((p=(f=u.map)==null?void 0:f.dispose)==null||p.call(f),(h=(d=u.userData.backupMap)==null?void 0:d.dispose)==null||h.call(d)),u.dispose(),i){o.material[c]=a;return}o.material=a})})},Il=t=>Array.isArray(t)?t:t.split(",").map(e=>parseInt(e));function oi(t){const e=Il(t),n=e.length;if(n<2)return null;const r=Uint8Array.from(e),o=new Xi(r,n,1,Ki);return o.minFilter=o.magFilter=Yi,o.generateMipmaps=!1,o}const Rl=t=>t.includes("/")||t.includes(":")?t:`${Sc}/${t}`;function si(t){const e=Rl(t);return e?ei(e):null}const Fl={alpha:!0,antialias:!0},$l="#cccccc",jl={type:"Perspective",fov:45,aspect:1,far:300,near:.01},Bl="c100001_01",je={enabled:!0,size:5,color:"#000000",opacity:1},Nl={noBackground:!0,fileName:"screenshot",frameRate:30},Ul={frameRate:30,fileName:"ani",appendDate:!0},uo=1,Dn=30,zl={directional:{color:"#ffffff",intensity:.8,position:[1,0,2]},ambient:{color:"#444444",intensity:1},point:{color:"#ffffff",intensity:1}},_n={"No Mapping":qi,Linear:Zi,Reinhard:Qi,Cineon:Ji,"ACES Filmic":ea},mt={addEventListener(t,e){if(!e)return;this._listeners??(this._listeners={});const n=this._listeners;return t=t.toLowerCase(),n[t]??(n[t]=[]),n[t].includes(e)||n[t].push(e),e},hasEventListener(t,e){var n,r;return t=t.toLowerCase(),!!((r=(n=this._listeners)==null?void 0:n[t])!=null&&r.includes(e))},removeEventListener(t,e){var o;t=t.toLowerCase();const n=(o=this._listeners)==null?void 0:o[t];if(!n)return;const r=n.indexOf(e);r!==-1&&n.splice(r,1)},dispatchEvent(t){var o,s;const e=(o=t.type)==null?void 0:o.toLowerCase(),n=(s=this._listeners)==null?void 0:s[e];if(!n)return;t.target=this,[...n].forEach(i=>i.call(this,t))},addCountedEventListener(t,e,n=1){const r=this;function o(s){e.call(r,s),n--,n===0&&r.removeEventListener(t,o)}this.addEventListener(t,o)}},Vl={face1:[2,1],face2:[0,0],face3:[1,0],face4:[2,0],face5:[3,0],face6:[0,-1],face7:[1,-1],face8:[2,-1],face9:[3,-1]},ii={},Hl=async()=>{const t=await Ht(`${Vt}/face-offset.json`);Object.assign(ii,t)},fo=t=>ii[t]||[0,0],In={},Wl=async()=>{const t=await Ht(`${Vt}/camera-position.json`);Object.assign(In,t)},Gl=t=>In[t]??In[t[0]],Rn={},Xl=async()=>{const t=await Ht(`${Vt}/control-position.json`);Object.assign(Rn,t)},Kl=t=>Rn[t]??Rn[t[0]],po=t=>Vl[`face${t}`],Yl=(t,e)=>{const n={x:0,y:0};if(t!==e){const[r,o]=po(e),[s,i]=po(t);n.x=s-r,n.y=i-o}return[n.x,n.y]},ql=(t,e)=>{const n={x:0,y:0};if(t!==e){const[r,o]=fo(e),[s,i]=fo(t);n.x=s-r,n.y=i-o}return[n.x,n.y]},Wt=t=>new Proxy(Object.assign(t,mt),{get(e,n){return e[n]},set(e,n,r){return e[n]=r,e.dispatchEvent({type:"change",propName:n,value:r}),!0}}),ai=/mEye_[0-9]/m,ci=/mMouth_[0-9]/m,Zl=/[0-9]{2}/,li=["eye","mouth"];function Ql(t){const{type:e,meshes:n}=t;return e==="adventurer"?Jl(t):n.some(({name:o})=>o.match(/mEye|mMouth/))?eu(t):t}function Jl(t){const{meshes:e,id:n}=t,r=l=>`${$s}/${l}/${l}.png`,o=e.find(({name:l})=>l==="mBodyAll"),s={eyeIdx:2,eyeBaseIdx:2,mouthIdx:2,mouthBaseIdx:2,eyeTexture:n,mouthTexture:n},i={type:"uv",reset:function(){this.eyeIdx=this.eyeBaseIdx,this.mouthIdx=this.mouthBaseIdx}},u=l=>([a,f])=>{var b;if(!o)return;const p=`mt${co(l)}CH`,d=(b=o.geometry.groups)==null?void 0:b.find(_=>{var P;return((P=o.material[_.materialIndex])==null?void 0:P.name)===p});if(!d)return;const{start:h,count:g}=d,y=h+g,v=o.geometry.attributes.uv;for(let _=h;_<y;_++){const P=v.getX(_)+.25*a,w=v.getY(_)+.25*f;v.setXY(_,P,w)}v.needsUpdate=!0},c=l=>a=>{var h,g;if(!o)return;const f=`mt${co(l)}CH`,p=(g=(h=o.material).find)==null?void 0:g.call(h,({name:y})=>y===f);if(!p)return;const d=r(a);p.map.dispose(),p.map=ei(d),p.needsUpdate=!0};return li.forEach(l=>{Object.defineProperties(i,{[`${l}Idx`]:{get(){return s[`${l}Idx`]},set(a){const f=parseInt(a),p=this[`${l}Idx`];s[`${l}Idx`]=f;const d=Yl(f,p);u(l)(d)}},[`${l}BaseIdx`]:{get(){return s[`${l}BaseIdx`]},set(a){s[`${l}BaseIdx`]=a,this[`${l}Idx`]=a}},[`${l}Texture`]:{get(){return s[`${l}Texture`]},set(a){const f=this[`${l}Texture`];s[`${l}Texture`]=a,c(l)(a);const p=ql(a,f);u(l)(p)}}})}),t.face=Wt(i),t}function eu(t){const{meshes:e}=t,[n,r]=tu(e);[...n,...r].forEach(c=>c.frustumCulled=!1);const o={eye:n,mouth:r},s={eyeIdx:"",eyeBaseIdx:"",mouthIdx:"",mouthBaseIdx:""},i={eyeList:n,mouthList:r,type:"meshes",reset:function(){this.eyeIdx=this.eyeBaseIdx,this.mouthIdx=this.mouthBaseIdx}},u=c=>l=>{o[c].forEach(a=>{const{name:f}=a,p=Zl.exec(f)[0];a.visible=parseInt(p)===l})};return li.forEach(c=>Object.defineProperties(i,{[`${c}Idx`]:{get(){return s[`${c}Idx`]},set(l){const a=parseInt(l);u(c)(a),s[`${c}Idx`]=`${a}`}},[`${c}BaseIdx`]:{get(){return s[`${c}BaseIdx`]},set(l){s[`${c}BaseIdx`]=l,this[`${c}Idx`]=l}}})),i.eyeBaseIdx=uo,i.mouthBaseIdx=uo,t.face=Wt(i),t}function tu(t){const e=t.filter(({name:r})=>r.match(ai)),n=t.filter(({name:r})=>r.match(ci));return[e,n]}function nu(t){const{model:e,uniqueId:n}=t,[r,o]=vl(e);return Object.defineProperty(o,"list",{value:fl(o.map(({name:s})=>s))}),Object.defineProperty(r,"visible",{get(){return this.filter(({visible:s})=>s)}}),o.forEach(s=>{s.name=`${n}|${s.name}`}),Object.defineProperties(t,{meshes:{get(){return r}},bones:{get(){return o}}})}const ui={},ru=async()=>{const t=await Ht(`${Vt}/model-parts.json`);Object.assign(ui,t)},ou=t=>ui[t],su=/mParts([A-Za-z]+)/,ho=/mParts[A-Za-z]+_([A-Za-z]*)/;function iu(t){const{meshes:e,id:n}=t,r=ou(n),o=[],s=[];if(e.forEach(l=>{var f;let{name:a}=l;if(a!=null&&a.match){if((a.includes("Effect")||a.includes("Extension"))&&(l.visible=!1),(f=r==null?void 0:r.custom)!=null&&f[a]&&(a=l.name=r.custom[a]),a.match(/mParts/)){o.push(l);return}!a.match(ai)&&!a.match(ci)&&s.push(l)}}),!o.length&&s.length<2)return t;const i=Object.defineProperties({},{list:{get(){return Object.keys(this)},enumerable:!1},reset:{value:function(){this.list.forEach(l=>this[l].reset())},enumerable:!1},others:{get(){return s},enumerable:!1}});if(t.parts=i,!o.length)return t;const u=new Set(o.map(({name:l})=>{var a;return(a=su.exec(l))==null?void 0:a[1]}).sort((l,a)=>l>a?1:-1)),c=l=>o.filter(({name:a})=>a.includes(`mParts${l}`)).sort((a,f)=>a.name>f.name?1:-1);return u.forEach(l=>{var y;const a=r==null?void 0:r[l],f=((y=a==null?void 0:a.name)==null?void 0:y.replaceAll(" ","_"))??l,p=a==null?void 0:a.options,d=c(l);d.forEach(v=>v.frustumCulled=!1);const h=d.map(({name:v})=>{var _;const b=((_=ho.exec(v))==null?void 0:_[1])??"default";return(p==null?void 0:p[b])??b}),g=(a==null?void 0:a.default)??h[0];i[f]={_meshes:d,list:h,default:g??h[0]},Object.defineProperties(i[f],{current:{get(){var w;const v=d.filter(({visible:T})=>T).length;if(v===0)return"None";if(v!==1)return"custom";const _=(w=d.find(({visible:T})=>T).name.match(ho))==null?void 0:w[1];return(p==null?void 0:p[_??"default"])??_??"default"},set(v){if(v.toLowerCase()==="none"){this._meshes.forEach((_,P)=>{_.visible=!1});return}if(!this.list.includes(v))return;const b=this.list.indexOf(v);this._meshes.forEach((_,P)=>{_.visible=P===b})}},index:{get(){return this.current==="custom"?NaN:this.list.indexOf(this.current)},set(v){this._meshes.forEach((b,_)=>{b.visible=_===Number(v)})}},reset:{value:function(){this.current=this.default}}})}),i.reset(),t.parts=i,t}const au=t=>e=>{const n=e.meshes,r={...Te,...t},{type:o}=r;lo(n,{force:!0,matType:o});let s={type:o,showTexture:!0},i=gn(o);const u={get code(){const{type:c,propList:l}=this,a=[];return c!==Te.type&&a.push(`type=${c}`),l.forEach(p=>{const d=kl[p],h=d(this[p]),g=d(Te[p]);h!==g&&a.push(`${p}=${h}`)}),a.join("/").replaceAll("#","")},set code(c){const l=Object.keys(Te),a={...Te,...ti(c)};l.forEach(f=>{this[f]=a[f]})},toString(){const{code:c}=this;return c?`mat=(${c})`:""},get list(){return n.flatMap(({material:c})=>c)},get propList(){return i},set type(c){if(this.type===c)return;i=gn(c),lo(n,{matType:c}),s.type=c;const l={...s};s={showTexture:l.showTexture},i.forEach(a=>this[a]=l[a]),s=l},set flatShading(c){const l=he(c);l!==this.flatShading&&(s.flatShading=l,this.propList.includes("flatShading")&&this.list.forEach(a=>{a.flatShading=l,a.needsUpdate=!0}))},set gradientMap(c){var f,p;if(c===this.gradientMap||(s.gradientMap=c,!this.propList.includes("gradientMap")))return;const l=(f=this.list[0])==null?void 0:f.gradientMap;(p=l==null?void 0:l.dispose)==null||p.call(l);const a=c==="none"?null:oi(c);this.list.forEach(d=>{d.gradientMap=a,d.needsUpdate=!0})},set showTexture(c){const l=he(c);if(this.showTexture===l)return;s.showTexture=l;const a=l?f=>{f.map=f.userData.backupMap,f.userData.backupMap=null,f.needsUpdate=!0}:f=>{f.userData.backupMap=f.map,f.map=null,f.needsUpdate=!0};this.list.forEach(a)},set matcap(c){var f,p;if(s.matcap===c||(s.matcap=c,!this.propList.includes("matcap")))return;const l=(f=this.list[0])==null?void 0:f.matcap;(p=l==null?void 0:l.dispose)==null||p.call(l);const a=si(c);this.list.forEach(d=>{d.matcap=a,d.needsUpdate=!0})}};return Al.forEach(c=>Object.defineProperty(u,c,{get(){return s[c]},...!ri.includes(c)&&{set(l){l!==this[c]&&(s[c]=l,this.propList.includes(c)&&this.list.forEach(a=>a[c]=Ol[c](l)))}}})),gn(o).forEach(c=>u[c]=r[c]),s={...Te,...s},e.material=Wt(u),e},cu=`uniform float opacity;\r
uniform vec3 color;\r
\r
void main() {\r
	gl_FragColor = vec4( color, opacity );\r
}\r
`,lu=`uniform float size;\r
\r
#include <skinning_pars_vertex>\r
\r
void main() {\r
	#include <skinbase_vertex>\r
	\r
    vec3 transformed = position + normal * 0.0005 * size;\r
        \r
	#include <skinning_vertex>\r
	#include <project_vertex>\r
}`,uu=t=>new st({side:ta,transparent:!0,depthFunc:na,vertexShader:lu,fragmentShader:cu,uniforms:t});function fu(t,e){const{material:n}=t,r=Array.isArray(t.material);[n].flat().forEach(yl),t.material=r?new Array(t.material.length).fill(e):e}function pu(t,e){const n=uu(e),r=[],o=["Eff","Extension"];return t.forEach(s=>{const{name:i}=s;if(o.some(c=>i.includes(c)))return;const u=s.clone();u.name=`outline-${s.name}`,fu(u,n),s.isSkinnedMesh&&u.bind(s.skeleton,s.bindMatrix),s.add(u),r.push(u)}),r}const du={size:parseFloat,opacity:parseFloat,color:Ct},hu=t=>e=>{const n={...je,...t},r=e.meshes,o={size:{value:n.size},opacity:{value:n.opacity},color:{value:new U(n.color)}},s=pu(r,o),i={...n,enabled:!0},u={get propList(){return["enabled","color","size","opacity"]},get enabled(){return i.enabled},set enabled(c){const l=he(c);s.forEach(a=>a.visible=l),i.enabled=l},get code(){if(!this.enabled)return"none";const c=[];return Object.keys(je).forEach(l=>{const a=this[l];a!==je[l]&&c.push(`${l}=${a}`)}),c.join("/").replaceAll("#","")},set code(c){if(c==="none"){this.enabled=!1;return}const l=Object.keys(je),a={...je,...ti(c)};l.forEach(f=>{this[f]=a[f]})},toString(){const{code:c}=this;return c?`ol=(${c})`:""}};return["size","opacity","color"].forEach(c=>Object.defineProperty(u,c,{get(){return i[c]},set(l){l!==this[c]&&(i[c]=l,o[c].value=du[c](l))}})),u.enabled=n.enabled,e.outline=Wt(u),e},mu=["push","pop","shift","unshift","splice","reverse","sort"];class me extends Array{constructor(...e){super(...e),Object.assign(this,mt),mu.forEach(n=>{Object.defineProperty(this,n,{value:(...r)=>{Array.prototype[n].call(this,...r),this.dispatchEvent({type:"change",method:n,args:r})},enumerable:!1})})}remove(e){const n=this.indexOf(e);n!==-1&&this.splice(n,1)}}const mo={chainName:"",chainCode:"",chainLength:0,aniIdx:0,clipDuration:0,clipTimeScale:1,action:null,aniAction:[],aniActionPointer:0};function fi(t){return t.split(">").map(gu)}function gu(t){const[e,...n]=t.split("&"),r=_u(n);return{aniName:e,...r}}function _u(t){const e={},n=[],r={r:{name:"reps",map:parseInt},ts:{name:"timeScale",map:parseFloat},dur:{name:"duration",map:yu}};return t.forEach(o=>{const[s,i]=Js(o);if(s.startsWith("@")){const l=vu(i.replace(/[()]/g,""));l.time=parseFloat(s.slice(1)),n.push(l);return}if(!r[s])return;const{name:u,map:c}=r[s];e[u]=c(i)}),e.aniAction=n.filter(({time:o})=>o<=100&&o>=0).sort((o,s)=>o.time-s.time),e}function yu(t){if(!t)return[0,100];const e=t.split("-").slice(0,2).map(parseFloat),n=e.length===2?e:[0,e[0]];return n.some(r=>r>100||r<0)||n[0]>n[1]?[0,100]:n}function vu(t){return t.split("/").reduce((n,r)=>{const[o,s]=Js(r);return{...n,...bu(o,s)}},{})}const go={ei:{name:"face.eyeIdx",valueMap:parseInt},mi:{name:"face.mouthIdx",valueMap:parseInt},et:{name:"face.eyeTexture"},mt:{name:"face.mouthTexture"}};function bu(t,e){if(t in go){const{name:o,valueMap:s}=go[t];return{[o]:(s==null?void 0:s(e))??e}}let n=t,r=e;return t.startsWith("att")&&n.replace("att","attachment"),t.startsWith("parts")&&(n+="index",r=parseInt(e)),{[n]:r}}const wu=t=>`${js}/${t}.json`;function Eu(t,e){if(t.startsWith("fbx:"))return Pu(t);if(t.startsWith("ex:")){const[,r]=t.split(":"),o=e==null?void 0:e.find(({uuid:s})=>r===s);return Promise.resolve(o.clone())}const n=wu(t);return new Promise(r=>fetch(n).then(o=>o.json()).then(o=>Io.parse(o)).then(r))}async function Pu(t){const e=t.replace("fbx:",""),[n,r]=e.split("+"),{animations:o}=await qs(n);return r?o.find(({name:s})=>s===r):o[0]}function xu(t,e=null){return Promise.all(t.map(n=>Eu(n,e)))}function Su(t,e=[]){return t.map((n,r)=>{const o=e[r];if(!o||o[0]===0&&o[1]===100)return n;const s=n.duration*Dn,[i,u]=o.map(c=>Math.round(c*s/100));return ra.subclip(n,n.name,i,u,Dn)})}async function Au(t,e=null){const n=fi(t),r=n.map(({aniName:l})=>l),o=n.map(({duration:l})=>l),s=n.map(({aniName:l,duration:a,...f})=>({...f})),i=await xu(r,e),u=Su(i,o);return{code:t,clips:u,mod:s,get duration(){return s.some(({timeScale:a})=>a===0)?1/0:u.map((a,f)=>a.duration/Math.abs(s[f].timeScale??1)*(s[f].reps??1)).reduce((a,f)=>a+f,0)}}}const Tu=/[a-z][0-9]{6}/;function Mu(t){const{model:e,uniqueId:n,bones:r,id:o,viewer:s}=t,i=s.userData.ani,u=new oa(e),c=(r==null?void 0:r.list)??[],l={...mt,mixer:u,chain:{},current:{...mo},toString(){var p;const f=(p=this.chain.default)==null?void 0:p.code;return f?`ani=${f}`:""},async addChain(f,{name:p="default",autoplay:d=!0}={}){var g;if(!f||((g=this.chain[p])==null?void 0:g.code)===f)return;u.stopAllAction();const h=await Au(f,i);h.clips.forEach(y=>{y.tracks=y.tracks.reduce((v,b)=>{let _=b.name.split(".")[0];return Tu.test(_)&&(b.name.replace(_,o),_=o),c.includes(_)&&(b.name=`${n}|${b.name}`,v.push(b)),v},[])}),this.chain[p]=h,u.addEventListener("finished",a),d&&this.play(p)},play(f=this.current.chainName||"default"){const p=this.chain[f];p&&(this.current.chainName=f,this.current.chainCode=p.code,this.current.chainLength=p.clips.length,this.aniIdx=0)},pause(){this.current.action&&(this.current.action.paused=!0)},resume(){this.current.action&&(this.current.action.paused=!1)},stop(){u.stopAllAction()},reset(){const f=this.current.chainName;this.stop(),this.current={...mo},this.chain[f]=void 0},update(f){var y;u.update(f);const{current:p}=this,{action:d,aniAction:h,clipDuration:g}=p;if(!(!h[p.aniActionPointer]||!d))for(;(d==null?void 0:d.time)>((y=h[p.aniActionPointer])==null?void 0:y.time)*g/100;)this.applyAniAction(h[p.aniActionPointer]),this.current.aniActionPointer++},applyAniAction(f){t.dispatchEvent({type:"aniAction",id:n,aniAction:f});const{time:p,...d}=f;Object.entries(d).forEach(([h,g])=>{const y=h.split(".");Qs(t,y,g)})},nextFrame(f=1,p=Dn){if(!this.isPaused)return;const{clipTimeScale:d,clipDuration:h,action:g}=this.current,y=f*d/p;if(g.time+=y,g.time>=h){const v=g.time-h;a(),this.pause(),this.current.action.time+=v*this.current.clipTimeScale}},setTime(f){const{clipDuration:p,action:d}=this.current;!p||f>p||(d.time=f)},get isPaused(){var f;return(f=this.current.action)==null?void 0:f.paused},get aniIdx(){return this.current.aniIdx},set aniIdx(f){if(f>=this.current.chainLength)return;this.current.aniIdx=f,this.current.aniActionPointer=0;const p={type:f===0?"chainStart":"chainMove",index:f,uniqueId:n,chainName:this.current.chainName};this.dispatchEvent(p),u.stopAllAction();const d=this.chain[this.current.chainName],h=d.mod[f],{timeScale:g,reps:y,aniAction:v}=h,b=d.clips[f],_=u.clipAction(b);_.timeScale=g??1,_.setLoop(sa,y??1),this.current.clipDuration=b.duration,this.current.action=_,this.current.aniAction=v,this.current.aniActionPointer=0,this.current.clipTimeScale=g??1,_.play()}};function a(){const{aniIdx:f,chainLength:p}=l.current,d=(f+1)%p;if(d===0){l.dispatchEvent({type:"ChainFinished",chainName:l.current.chainName});const{face:h}=t;h&&(h.eyeIdx=h.eyeBaseIdx,h.mouthIdx=h.mouthBaseIdx)}l.aniIdx=d}return t.animation=l,t.addEventListener("TimeUpdated",({dt:f})=>l.update(f)),t}function Cu(t){const{model:e,bones:n,uniqueId:r}=t,o={};return Object.defineProperty(o,"list",{get(){return Object.values(this).flat()}}),Object.defineProperty(o,"traverse",{value:function(a){this.list.forEach(f=>{var p,d;a(f),(d=(p=f.attachment)==null?void 0:p.traverse)==null||d.call(p,a)})}}),Object.assign(t,{attachment:o,parent:null,parentBone:"",attach:(a,f="root")=>{o[f]=o[f]??new me;const p=f==="root"?e:n.find(({name:d})=>d===`${r}|${f}`);p!=null&&p.add&&(a.detach(),p.add(a.model),o[f].push(a),a.parent=t,a.parentBone=f,t.dispatchEvent({type:"AttachmentChanged"}))},remove:(a,f="")=>{var d,h,g;const p=f||Object.keys(o).find(y=>o[y].indexOf(a)!==-1);p&&((h=(d=o[p]).remove)==null||h.call(d,a),(g=a.model.parent)==null||g.remove(a.model),t.dispatchEvent({type:"AttachmentChanged"}))},detach:()=>{var p;(p=e.parent)==null||p.remove(e);const{parent:a,parentBone:f}=t;a&&(a.remove(t,f),t.parent=t.parentBone=null)},attachTo:(a,f="root")=>{var p;t.detach(),(p=a==null?void 0:a.attach)==null||p.call(a,t,f)}})}function Lu(t){const{material:e,id:n}=t,r=ot.source.fbx,o=_o(n);dl(n)&&async function(){const c=u(o),l=new Xe().load(c);l.encoding=Q,l.name=o,e.list.forEach(a=>a.map=a.map??l)}();let s=o;Object.defineProperty(t,"texture",{get(){return s},set(c){if(!c){this.texture=o;return}if(c===s)return;const l=u(c),[,a]=i(c),[,f]=i(this.texture),p=e.list.filter(d=>{var h,g,y,v;return((g=(h=d.map)==null?void 0:h.name)==null?void 0:g.includes(f))||((v=(y=d.userData.backupMap)==null?void 0:y.name)==null?void 0:v.includes(f))});p.length&&(async function(){const d=await Zs(l);d.name=a,d.encoding=Q,p.forEach(h=>{var g,y,v,b;h.map&&((y=(g=h.map).dispose)==null||y.call(g),h.map=d),h.userData.backupMap&&((b=(v=h.userData.backupMap).dispose)==null||b.call(v),h.userData.backupMap=d)})}(),s=c)}});function i(c){const[l,a]=c.split(">"),f=l||n,p=a||_o(f);return[f,p]}function u(c){const[l,a]=i(c);return`${r}/${l}/${a}.png`}return t}const _o=t=>t.match(/_[0-9]{2}/)||t.startsWith("h")?t:`>${t}_01`,Ou=`uniform float uTime;\r
uniform float uSpread;\r
uniform float uThreshold;\r
uniform float uSpeed;\r
uniform float uParticleSize;\r
uniform float uAuraSize;\r
\r
attribute float aRandom;\r
\r
varying float vIsParticle;\r
varying float vRandom;\r
\r
#include <skinning_pars_vertex>\r
void main() {\r
    #include <skinbase_vertex>\r
\r
    vec3 transformed = position + normal * 0.005 * uSpread;\r
\r
    #include <skinning_vertex>\r
\r
    vec3 objectNormal = normal;\r
\r
	#include <skinnormal_vertex>\r
    \r
    vec4 viewPosition = viewMatrix * modelMatrix * vec4(transformed, 1.0);\r
    float yDisplacement = fract( uTime * uSpeed + aRandom ) * 0.1;\r
    viewPosition.y += yDisplacement;\r
    viewPosition.x += sin( uTime * aRandom * uSpeed + aRandom ) * 0.02;\r
    \r
    gl_Position = projectionMatrix * viewPosition;\r
    \r
    objectNormal.z *= objectNormal.z > 0.7 ? -1.0 : 1.0;\r
    vIsParticle = objectNormal.z - uThreshold;\r
\r
    gl_PointSize = vIsParticle > 0.0 ? uParticleSize : uAuraSize;\r
    gl_PointSize /= -viewPosition.z;\r
\r
    vRandom = aRandom;\r
}\r
`,ku=`uniform sampler2D uTexture;\r
\r
uniform float uTime;\r
uniform float uParticleOpacity;\r
uniform float uAuraOpacity;\r
uniform vec3 uColor;\r
uniform vec3 uColor2;\r
\r
varying float vRandom;\r
varying float vIsParticle;\r
\r
void main(){\r
    vec4 textureColor = texture2D( uTexture, gl_PointCoord );\r
    textureColor.a = length( textureColor.rgb ) ;\r
    textureColor.a *= abs( 1.0 - fract( uTime + vRandom ) ) * 0.5;\r
    textureColor.rgb = mix( uColor, uColor2,  textureColor.a * 2.0 );\r
    textureColor.a *= vIsParticle > 0.0 ? uParticleOpacity * 4.0 : uAuraOpacity;\r
\r
    gl_FragColor = textureColor;\r
    gl_FragColor /= vIsParticle > 0.0 ? 2.0 : 4.0;\r
}\r
`,Lt=[{name:"time",uName:"uTime",defaultValue:0,valueMap:Number},{name:"speed",uName:"uSpeed",defaultValue:1,valueMap:Number},{name:"particleOpacity",uName:"uParticleOpacity",defaultValue:.3,valueMap:Number},{name:"auraOpacity",uName:"uAuraOpacity",defaultValue:.3,valueMap:Number},{name:"particleSize",uName:"uParticleSize",defaultValue:10,valueMap:Number},{name:"auraSize",uName:"uAuraSize",defaultValue:100,valueMap:Number},{name:"spread",uName:"uSpread",defaultValue:5,valueMap:Number},{name:"threshold",uName:"uThreshold",defaultValue:.3,valueMap:Number},{name:"texture",uName:"uTexture",defaultValue:"img/textures/particle/cloud.png",valueMap:t=>new Xe().load(t)},{name:"color",uName:"uColor",defaultValue:"#ffffff",valueMap:t=>new U(t)},{name:"color2",uName:"uColor2",defaultValue:"#33ffff",valueMap:t=>new U(t)}],Du={aura:["visible",...Lt.slice(1).map(({name:t})=>t)]},Iu=(t="aura")=>(e,n={})=>{if(e!=null&&e.length&&t==="aura")return Fu(e,n)};function Ru(t){return new st({vertexShader:Ou,fragmentShader:ku,uniforms:t,transparent:!0,blending:ca,depthWrite:!1,side:la})}function Fu(t,e){const n=Lt.map(c=>{const{uName:l,defaultValue:a,valueMap:f}=c,p=(f==null?void 0:f(a))??a;return[l,{value:p}]}),r=Object.fromEntries(n),o=Ru(r),s=[];t.forEach(c=>{const{name:l}=c.geometry;if(l.startsWith("mEye")||l.startsWith("mMouth"))return;const a=c.geometry.clone(),f=a.attributes.position.count,p=new Float32Array(f).fill(0).map(()=>Math.random()-.5);a.setAttribute("aRandom",new ia(p,1)),a.deleteAttribute("color"),a.deleteAttribute("uv");const d=new aa(a,o);d.name="aura",c.isSkinnedMesh&&(d.type="SkinnedMesh",d.isSkinnedMesh=!0,d.skeleton=c.skeleton,d.bindMatrix=c.bindMatrix,d.bindMatrixInverse=c.bindMatrixInverse,d.bindMode=c.bindMode,d.bind=c.bind,d.clone=c.clone,d.initBones=c.initBones,d.normalizeSkinWeights=c.normalizeSkinWeights,d.pose=c.pose,d.updateMatrixWorld=c.updateMatrixWorld),c.add(d),s.push(d)});const i={visible:!0},u={name:"aura",onDispose:()=>{},get list(){return s},get propList(){return Du.aura},get visible(){return i.visible},set visible(c){const l=he(c);this.list.forEach(a=>a.visible=l),i.visible=l},dispose(){this.onDispose(),this.list.forEach(c=>{var l,a,f,p,d;(l=c.parent)==null||l.remove(c),(f=(a=c.material).dispose)==null||f.call(a),(d=(p=c.geometry).dispose)==null||d.call(p)})},set code(c){c.split("/").forEach(a=>{const[f,p]=a.split("=");Lt.map(({name:d})=>d).includes(f)&&(this[f]=p)})}};return Lt.forEach(c=>{const{name:l,uName:a,defaultValue:f,valueMap:p}=c;i[l]=f,Object.defineProperty(u,l,{get(){return i[l]},set(d){i[l]=d,r[a].value=(p==null?void 0:p(d))??d}})}),u.onTimeUpdate=({time:c})=>u.time=c,Object.entries(e).forEach(([c,l])=>u[c]=l),u}function $u(t){const{meshes:e}=t,n={list:new me,dispose(){this.list.forEach(r=>{var o;return(o=r.dispose)==null?void 0:o.call(r)})},add(r="aura",o={}){const s=Iu(r)(e,o);return s.onDispose=()=>this.list.remove(s),this.list.push(s),t.addEventListener("TimeUpdated",s.onTimeUpdate),s}};return t.particle=n,t}const ju=t=>{var u,c;if(t.dispatchEvent({type:"dispose"}),!t)return;const{model:e,meshes:n,outline:r,particle:o,viewer:s}=t;o==null||o.list.forEach(l=>l.dispose()),(u=e.parent)!=null&&u.isScene&&(e.parent.remove(e),s.loadedModel.remove(t)),(c=t.detach)==null||c.call(t),[n.reverse(),r==null?void 0:r.all].flat().forEach(bl)};function Bu(t){const{x:e,y:n,z:r}=t;return[e,n,r].map(o=>o||"").join()}const Nu={position:",,",rotation:",,",scale:"1,1,1"},Uu={position:"pos",rotation:"rot",scale:"scl"};function zu(t){return Object.assign(t,{...t.isDLModel&&{toString(){const{id:e,animation:n,outline:r,material:o}=this,s=Object.entries(Nu).map(([i,u])=>{const c=Bu(this[i]);return c===u?"":`${Uu[i]}=${c}`});return[`id=${e}`,...s,n,r,o].filter(i=>`${i}`).join("/")}},dispose(){const{attachment:e,parent:n,parentBone:r}=this;e.list.forEach(o=>o.dispose()),n==null||n.remove(this,r),this.dispatchEvent({type:"dispose"}),ju(this)}})}let nr=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,n)=>(n&=63,n<36?e+=n.toString(36):n<62?e+=(n-26).toString(36).toUpperCase():n>62?e+="-":e+="_",e),"");function Vu(t,e){const{id:n,material:r,outline:o,viewer:s}=e,i=[nu,iu,Cu,hu(o),au(r),Lu,Ql,Mu,$u,zu],u={...mt,isDLModel:!0,model:t,id:n,uniqueId:nr(),type:hl(n),viewer:s,userData:{},_time:0,update(c){var l;this._time+=c,(l=this.attachment)==null||l.list.forEach(a=>{var f;return(f=a.update)==null?void 0:f.call(a,c)}),this.dispatchEvent({type:"TimeUpdated",dt:c,time:this._time})},set scale(c){var a;if((a=c.includes)!=null&&a.call(c,",")){const[f,p,d]=c.split(",").map(h=>h?parseFloat(h):1);this.model.scale.set(f,p,d);return}const l=Number(c)||1;this.model.scale.set(l,l,l)},get scale(){const{scale:c}=this.model,{x:l,y:a,z:f}=c;return l===a&&l===f?l:[l,a,f].join(",")},set visible(c){this.model.visible=he(c)}};return["position","rotation","visible"].forEach(c=>Object.defineProperty(u,c,{get(){return this.model[c]},enumerable:!0})),t.userData.container=u,ul(...i)(u)}const Hu={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );
			gl_FragColor.a *= opacity;


		}`};class Gt{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const Wu=new Co(-1,1,1,-1,0,1),rr=new At;rr.setAttribute("position",new we([-1,3,0,-1,-1,0,3,-1,0],3));rr.setAttribute("uv",new we([0,2,0,0,2,0],2));class Gu{constructor(e){this._mesh=new ko(rr,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,Wu)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class pi extends Gt{constructor(e,n){super(),this.textureID=n!==void 0?n:"tDiffuse",e instanceof st?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=Bn.clone(e.uniforms),this.material=new st({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new Gu(this.material)}render(e,n,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(n),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}const Xu=Object.freeze(Object.defineProperty({__proto__:null,ShaderPass:pi},Symbol.toStringTag,{value:"Module"}));class yo extends Gt{constructor(e,n){super(),this.scene=e,this.camera=n,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,n,r){const o=e.getContext(),s=e.state;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0);let i,u;this.inverse?(i=0,u=1):(i=1,u=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(o.REPLACE,o.REPLACE,o.REPLACE),s.buffers.stencil.setFunc(o.ALWAYS,i,4294967295),s.buffers.stencil.setClear(u),s.buffers.stencil.setLocked(!0),e.setRenderTarget(r),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(o.EQUAL,1,4294967295),s.buffers.stencil.setOp(o.KEEP,o.KEEP,o.KEEP),s.buffers.stencil.setLocked(!0)}}class Ku extends Gt{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class Yu{constructor(e,n){if(this.renderer=e,n===void 0){const r=e.getSize(new B);this._pixelRatio=e.getPixelRatio(),this._width=r.width,this._height=r.height,n=new Fo(this._width*this._pixelRatio,this._height*this._pixelRatio),n.texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=n.width,this._height=n.height;this.renderTarget1=n,this.renderTarget2=n.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new pi(Hu),this.clock=new $o}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,n){this.passes.splice(n,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const n=this.passes.indexOf(e);n!==-1&&this.passes.splice(n,1)}isLastEnabledPass(e){for(let n=e+1;n<this.passes.length;n++)if(this.passes[n].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const n=this.renderer.getRenderTarget();let r=!1;for(let o=0,s=this.passes.length;o<s;o++){const i=this.passes[o];if(i.enabled!==!1){if(i.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(o),i.render(this.renderer,this.writeBuffer,this.readBuffer,e,r),i.needsSwap){if(r){const u=this.renderer.getContext(),c=this.renderer.state.buffers.stencil;c.setFunc(u.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),c.setFunc(u.EQUAL,1,4294967295)}this.swapBuffers()}yo!==void 0&&(i instanceof yo?r=!0:i instanceof Ku&&(r=!1))}}this.renderer.setRenderTarget(n)}reset(e){if(e===void 0){const n=this.renderer.getSize(new B);this._pixelRatio=this.renderer.getPixelRatio(),this._width=n.width,this._height=n.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,n){this._width=e,this._height=n;const r=this._width*this._pixelRatio,o=this._height*this._pixelRatio;this.renderTarget1.setSize(r,o),this.renderTarget2.setSize(r,o);for(let s=0;s<this.passes.length;s++)this.passes[s].setSize(r,o)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class qu extends Gt{constructor(e,n,r,o,s){super(),this.scene=e,this.camera=n,this.overrideMaterial=r,this.clearColor=o,this.clearAlpha=s!==void 0?s:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new U}render(e,n,r){const o=e.autoClear;e.autoClear=!1;let s,i;this.overrideMaterial!==void 0&&(i=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),s=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:r),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,s),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=i),e.autoClear=o}}function vo({renderer:t,scene:e,camera:n}){const r=Zu(),o=new Yu(t,r),s=new qu(e,n);return o.addPass(s),o}const Zu=()=>new Fo(800,600,{minFilter:xr,magFilter:xr,format:ua,encoding:Q}),yn={bloom:Ju,pixel:tf,afterimage:af,sobel:nf,halftone:rf,dotscreen:of,bokeh:sf,smaa:ef};async function Qu(t,e){var r;t=t.toLowerCase();const n=await((r=yn[t])==null?void 0:r.call(yn,e));return n.type=t,n.name=or[t].name,n}function Xt(t,e){Object.defineProperty(t,"propList",{value:e}),e.forEach(n=>{Object.defineProperty(t,n,{get(){return this.uniforms[n].value},set(r){this.uniforms[n].value=r}})})}async function Ju({resolution:t=new B(800,600),strength:e=.3,radius:n=.5,threshold:r=.8}={}){const{UnrealBloomPass:o}=await L(()=>import("./2eb522b4-UnrealBloomPass.js"),["assets/2eb522b4-UnrealBloomPass.js","assets/f81b78b9-three.js"]),s=new o(t,e,n,r);return Object.defineProperty(s,"propList",{value:["radius","strength","threshold"],writable:!1}),s}async function ef({renderer:t}){const{SMAAPass:e}=await L(()=>import("./fe44f727-SMAAPass.js"),["assets/fe44f727-SMAAPass.js","assets/f81b78b9-three.js"]),n=new B;t.getSize(n);const r=new e(n.x,n.y);return Object.defineProperty(r,"propList",{value:[],writable:!1}),r}async function tf({scene:t,camera:e}){const{RenderPixelatedPass:n}=await L(()=>import("./705e7757-RenderPixelatedPass.js"),["assets/705e7757-RenderPixelatedPass.js","assets/f81b78b9-three.js"]),r=new n(5,t,e);return Object.defineProperty(r,"propList",{value:["size"],writable:!1}),Object.defineProperty(r,"size",{get(){return this.pixelSize},set(o){this.setPixelSize(o)}}),r}async function nf({renderer:t}){const{ShaderPass:e}=await L(()=>Promise.resolve().then(()=>Xu),void 0),{SobelOperatorShader:n}=await L(()=>import("./54d4dbb6-SobelOperatorShader.js"),["assets/54d4dbb6-SobelOperatorShader.js","assets/f81b78b9-three.js"]),r=new B;t.getSize(r),r.multiplyScalar(window.devicePixelRatio);const o=new e(n);return o.uniforms.resolution.value.x=r.x,o.uniforms.resolution.value.y=r.y,Object.defineProperty(o,"propList",{value:[],writable:!1}),o}async function rf({renderer:t}){const{HalftonePass:e}=await L(()=>import("./089afb53-HalftonePass.js"),["assets/089afb53-HalftonePass.js","assets/f81b78b9-three.js"]),n=new B;t.getSize(n);const r=new e(n.x,n.y,{radius:4});return Xt(r,["greyscale","radius","scatter","shape"]),r}async function of(){const{DotScreenPass:t}=await L(()=>import("./ac0f93a9-DotScreenPass.js"),["assets/ac0f93a9-DotScreenPass.js","assets/f81b78b9-three.js"]),e=new t;return Xt(e,["scale","center"]),e}async function sf({scene:t,camera:e}){const{BokehPass:n}=await L(()=>import("./abba363c-BokehPass.js"),["assets/abba363c-BokehPass.js","assets/f81b78b9-three.js"]),r=new n(t,e,{});return Xt(r,["focus","aperture","aspect"]),r}async function af(){const{AfterimagePass:t}=await L(()=>import("./6dcb2aeb-AfterimagePass.js"),["assets/6dcb2aeb-AfterimagePass.js","assets/f81b78b9-three.js"]),e=new t(.7);return Xt(e,["damp"]),e}function cf(t){const{name:e,type:n}=t,r=or[n].propList??[],o={};return r.forEach(i=>{Object.defineProperty(o,i,{get(){return t[i]},set(u){t[i]=u},enumerable:!0})}),{target:t,name:e,type:n,params:o,id:nr()}}const or={bloom:{name:"Bloom",propList:["enabled","radius","strength","threshold"]},pixel:{name:"Pixelate",propList:["enabled","size"]},afterimage:{name:"Afterimage",propList:["enabled","damp"]},sobel:{name:"Sobel",propList:["enabled"]},halftone:{name:"Halftone",propList:["enabled","greyscale","radius","scatter","shape"]},dotscreen:{name:"Dot Screen",propList:["enabled","scale"]},bokeh:{name:"Bokeh",propList:["enabled","focus","aperture","aspect"]},smaa:{name:"SMAA",propList:["enabled"]}};Object.entries(or).map(([t,{name:e}])=>({value:t,label:e}));var Fn={},lf={get exports(){return Fn},set exports(t){Fn=t}};(function(t,e){(function(n,r){t.exports=r()})($e,function(){var n=function(){function r(d){return i.appendChild(d.dom),d}function o(d){for(var h=0;h<i.children.length;h++)i.children[h].style.display=h===d?"block":"none";s=d}var s=0,i=document.createElement("div");i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",function(d){d.preventDefault(),o(++s%i.children.length)},!1);var u=(performance||Date).now(),c=u,l=0,a=r(new n.Panel("FPS","#0ff","#002")),f=r(new n.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var p=r(new n.Panel("MB","#f08","#201"));return o(0),{REVISION:16,dom:i,addPanel:r,showPanel:o,begin:function(){u=(performance||Date).now()},end:function(){l++;var d=(performance||Date).now();if(f.update(d-u,200),d>c+1e3&&(a.update(1e3*l/(d-c),100),c=d,l=0,p)){var h=performance.memory;p.update(h.usedJSHeapSize/1048576,h.jsHeapSizeLimit/1048576)}return d},update:function(){u=this.end()},domElement:i,setMode:o}};return n.Panel=function(r,o,s){var i=1/0,u=0,c=Math.round,l=c(window.devicePixelRatio||1),a=80*l,f=48*l,p=3*l,d=2*l,h=3*l,g=15*l,y=74*l,v=30*l,b=document.createElement("canvas");b.width=a,b.height=f,b.style.cssText="width:80px;height:48px";var _=b.getContext("2d");return _.font="bold "+9*l+"px Helvetica,Arial,sans-serif",_.textBaseline="top",_.fillStyle=s,_.fillRect(0,0,a,f),_.fillStyle=o,_.fillText(r,p,d),_.fillRect(h,g,y,v),_.fillStyle=s,_.globalAlpha=.9,_.fillRect(h,g,y,v),{dom:b,update:function(P,w){i=Math.min(i,P),u=Math.max(u,P),_.fillStyle=s,_.globalAlpha=1,_.fillRect(0,0,a,g),_.fillStyle=o,_.fillText(c(P)+" "+r+" ("+c(i)+"-"+c(u)+")",p,d),_.drawImage(b,h+l,g,y-l,v,h,g,y-l,v),_.fillRect(h+y-l,g,l,v),_.fillStyle=s,_.globalAlpha=.9,_.fillRect(h+y-l,g,l,c((1-P/w)*v))}}},n})})(lf);var ut={},uf={get exports(){return ut},set exports(t){ut=t}};(function(t,e){(function(n,r){r()})($e,function(){function n(l,a){return typeof a>"u"?a={autoBom:!1}:typeof a!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),a={autoBom:!a}),a.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(l.type)?new Blob(["\uFEFF",l],{type:l.type}):l}function r(l,a,f){var p=new XMLHttpRequest;p.open("GET",l),p.responseType="blob",p.onload=function(){c(p.response,a,f)},p.onerror=function(){console.error("could not download file")},p.send()}function o(l){var a=new XMLHttpRequest;a.open("HEAD",l,!1);try{a.send()}catch{}return 200<=a.status&&299>=a.status}function s(l){try{l.dispatchEvent(new MouseEvent("click"))}catch{var a=document.createEvent("MouseEvents");a.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),l.dispatchEvent(a)}}var i=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof $e=="object"&&$e.global===$e?$e:void 0,u=i.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),c=i.saveAs||(typeof window!="object"||window!==i?function(){}:"download"in HTMLAnchorElement.prototype&&!u?function(l,a,f){var p=i.URL||i.webkitURL,d=document.createElement("a");a=a||l.name||"download",d.download=a,d.rel="noopener",typeof l=="string"?(d.href=l,d.origin===location.origin?s(d):o(d.href)?r(l,a,f):s(d,d.target="_blank")):(d.href=p.createObjectURL(l),setTimeout(function(){p.revokeObjectURL(d.href)},4e4),setTimeout(function(){s(d)},0))}:"msSaveOrOpenBlob"in navigator?function(l,a,f){if(a=a||l.name||"download",typeof l!="string")navigator.msSaveOrOpenBlob(n(l,f),a);else if(o(l))r(l,a,f);else{var p=document.createElement("a");p.href=l,p.target="_blank",setTimeout(function(){s(p)})}}:function(l,a,f,p){if(p=p||open("","_blank"),p&&(p.document.title=p.document.body.innerText="downloading..."),typeof l=="string")return r(l,a,f);var d=l.type==="application/octet-stream",h=/constructor/i.test(i.HTMLElement)||i.safari,g=/CriOS\/[\d]+/.test(navigator.userAgent);if((g||d&&h||u)&&typeof FileReader<"u"){var y=new FileReader;y.onloadend=function(){var _=y.result;_=g?_:_.replace(/^data:[^;]*;/,"data:attachment/file;"),p?p.location.href=_:location=_,p=null},y.readAsDataURL(l)}else{var v=i.URL||i.webkitURL,b=v.createObjectURL(l);p?p.location=b:location.href=b,p=null,setTimeout(function(){v.revokeObjectURL(b)},4e4)}});i.saveAs=c.saveAs=c,t.exports=c})})(uf);const ff=["video/mp4;codecs=h264","video/webm;codecs=h264","video/webm;codecs=vp9","video/webm;codecs=vp8","video/webm"],xt=ff.filter(MediaRecorder.isTypeSupported);function pf(t){if(!xt.length)return;const e=[],n=xt[0],r={settings:{...Ul,mimeType:n},get supportedMimeTypes(){return xt},get mimeType(){return this.settings.mimeType},set mimeType(o){xt.includes(o)&&(this.settings.mimeType=o)},start(){if(this.recorder)return;const{fileName:o,frameRate:s,mimeType:i}=this.settings,u=t.captureStream(s||30),c=u.getTracks()[0],l=new MediaRecorder(u,{mimeType:i});l.onstart=()=>e.length=0,l.ondataavailable=({data:a})=>e.push(a),l.onstop=()=>{c.stop(),this.recorder=void 0;const a=this.settings.mimeType.includes("webm")?"webm":"mp4",f=new Blob(e,{type:`video/${a}`}),p=this.settings.appendDate?`_${wl()}`:"",d=`${o||"ani"}${p}.${a}`;ut.saveAs(f,d)},l.start(),this.recorder=l},get state(){var o;return((o=this.recorder)==null?void 0:o.state)??"idle"}};return["pause","resume","stop"].forEach(o=>{Object.defineProperty(r,o,{value:()=>{var s;return(s=r.recorder)==null?void 0:s[o]()}})}),r}function df(t){let e=1,n=!1,r=!1;const o=()=>{t.stats.begin(),t.controls.update();const l=n?-e:e,a=t.clock.getDelta()*l;r||t.update(a),t.render(),t.stats.end()};let s=!1;const i=()=>{s||(t.render(),s=!0,setTimeout(()=>s=!1,50))};let u="";return{start(){u!=="active"&&(t.renderer.setAnimationLoop(o),t.controls.removeEventListener("change",i),u="active")},stop(){u!=="inactive"&&(t.renderer.setAnimationLoop(null),t.controls.addEventListener("change",i),u="inactive")},pause(){r=!0},resume(){r=!1},get state(){return u},get timeScale(){return e},set timeScale(l){const a=parseFloat(l);e=isNaN(a)?1:Math.abs(a)},get reverse(){return n},set reverse(l){n=!!l},get paused(){return r},set paused(l){r=!!l}}}const hf=async t=>{const{zip:e}=await L(()=>import("./1aaa63f0-browser.js"),[]);return new Promise(n=>e(t,{},(r,o)=>n(new Blob([o]))))},mf=t=>{const e=t.indexOf(",");return t.slice(e+1,1/0)},gf=async t=>{if(t=await t,t instanceof Blob&&(t=await t.arrayBuffer()),t instanceof ArrayBuffer)return new Uint8Array(t);if(typeof t=="string"){const e=t.startsWith("data")?mf(t):t,n=window.atob(e);return Uint8Array.from(n,r=>r.charCodeAt(0))}};async function _f(t){const e=await Promise.all(t.map(({data:r})=>gf(r))),n=Object.fromEntries(t.map(({name:r},o)=>[r,[e[o],{level:0,consume:!0}]]));return hf(n)}async function yf(t,e){const n=t.length.toString().length,r=t.map((o,s)=>{const i=s.toString().padStart(n,"0");return{name:`${e||"ss"}_${i}.png`,data:o}});return _f(r)}function vf(t,e){const n=document.createElement("a");n.style.display="none",n.href=t,n.download=e,document.body.appendChild(n),n.click(),document.body.removeChild(n)}async function $n(t,e="frames"){const n=await yf(t,e);ut.saveAs(n,`${e}.zip`)}function bf(t){const{canvas:e,scene:n}=t;return{settings:Nl,downloadFrame(o=1){const{noBackground:s,fileName:i}=this.settings,u=s&&!t.postProcessing.enabled;let c=null;const l=()=>[n.background,c]=[c,n.background];if(t.loop.state==="inactive"||o===1){u&&l(),t.render();const d=e.toDataURL();u&&l(),vf(d,`${i}.png`),t.render();return}let a=0;const f=[];u&&t.addCountedEventListener("beforeRender",l);function p(){const d=e.toDataURL("image/png");f.push(d),++a===o&&(u&&t.addCountedEventListener("beforeRender",l),$n(f,i))}t.addCountedEventListener("afterRender",p,o)},getFrame(){let o;const{noBackground:s}=this.settings;if(s&&!t.postProcessing.enabled){let u=null;[n.background,u]=[u,n.background],t.render(),o=e.toDataURL("image/png"),[n.background,u]=[u,n.background],t.render()}else t.render(),o=e.toDataURL("image/png");return o},getAllFrames(o){var h,g;const s=o==null?void 0:o.animation.current.chainName;if(!s||o.animation.chain[s].duration===1/0)return;console.info("main thread locked");const u=t.loop.state;t.loop.stop(),(g=(h=o.face)==null?void 0:h.reset)==null||g.call(h),o.animation.stop();const c=[],{frameRate:l,noBackground:a}=this.settings,f=1/(l||30);let p=null,d=!0;for(a&&([n.background,p]=[p,n.background]),o.animation.addCountedEventListener("chainFinished",()=>d=!1),o.animation.play();d;){t.update(f);const y=e.toDataURL();c.push(y)}return console.info("main thread unlocked"),a&&([n.background,p]=[p,n.background]),u==="active"&&t.loop.start(),c},downloadAllFrames(o=0){const s=t.model[o],i=this.getAllFrames(s),{fileName:u}=this.settings;$n(i,u)},getAllFramesAsArrayBuffer(o){var _,P;const s=o==null?void 0:o.animation.current.chainName;if(!s||o.animation.chain[s].duration===1/0)return;console.info("main thread locked");const u=t.renderer.getContext(),c=t.loop.state;(P=(_=o.face)==null?void 0:_.reset)==null||P.call(_),t.loop.stop(),o.animation.stop();const l=[],{frameRate:a,noBackground:f}=this.settings,p=1/(a||30),{width:d,height:h}=e,y=d*h*4;let v=null,b=!0;for(f&&([n.background,v]=[v,n.background]),o.animation.addCountedEventListener("chainFinished",()=>b=!1),o.animation.play();b;){t.update(p);const w=new Uint8Array(y);u.readPixels(0,0,d,h,u.RGBA,u.UNSIGNED_BYTE,w);const T=wf(w,{width:d,height:h});l.push(T.buffer)}return console.info("main thread unlocked"),f&&([n.background,v]=[v,n.background]),c==="active"&&t.loop.start(),l}}}function wf(t,{width:e,height:n}){const r=n/2|0,o=e*4,s=new Uint8Array(e*4);for(let i=0;i<r;++i){const u=i*o,c=(n-i-1)*o;s.set(t.subarray(u,u+o)),t.copyWithin(u,c,c+o),t.set(s,c)}return t}const Ef=()=>Promise.all([Hl(),Wl(),Xl(),ru()]),Pf={directional:Oo,ambient:Do,point:bn},xf={directional:fa,point:pa},Sf=t=>{var c,l;const e=Pf[t];if(!e)return null;const n=zl[t],{color:r,intensity:o,...s}=n,i=new e(r,o);i.name=(l=(c=i.type)==null?void 0:c.replace)==null?void 0:l.call(c,"Light","");const u=xf[t];return u&&(i.helper=new u(i),Object.defineProperty(i,"showHelper",{get(){return i.helper.visible},set(a){i.helper.visible=!!a,i.helper.update()}}),i.showHelper=!1),Object.defineProperty(i,"colorCode",{get(){return"#"+this.color.getHexString()},set(a){var f,p;this.color=new U(a),(p=(f=this.helper)==null?void 0:f.update)==null||p.call(f)}}),Object.entries(s).forEach(([a,f])=>{i[a].isVector3?i[a].set(...f):i[a]=f}),i};function Af(t){const e={list:new me,add:n=>{const r=Sf(n);if(r)return t.scene.add(r),r.helper&&(t.scene.add(r.helper),r.helper.update()),e.list.push(r),r.remove=()=>{var o,s,i,u,c;e.list.remove(r),r.helper&&((o=r.parent)==null||o.remove(r.helper),(i=(s=r.helper).dispose)==null||i.call(s)),(u=r.parent)==null||u.remove(r),(c=r.dispose)==null||c.call(r)},r}};return e}const bo={"<":">","(":")","[":"]","{":"}"},Tf=t=>{let e="";const n=[],r=[];for(const o of t){if(n.length){e+=o;const s=n.at(-1);o===bo[s]&&n.pop();continue}if(o==="/"){e&&r.push(e),e="";continue}e+=o,o in bo&&n.push(o)}return e&&r.push(e),r},di=t=>Tf(t).reduce((n,r)=>{const[o,...s]=r.split("="),i=s==null?void 0:s.join("=");return o&&i&&n.push([o,i]),n},[]),Mf={mat:{keys:["material","code"],valueMap:t=>t.slice(1,-1)},ol:{keys:["outline","code"],valueMap:t=>t.slice(1,-1)},ei:{keys:["face","eyeBaseIdx"]},et:{keys:["face","eyeTexture"]},mi:{keys:["face","mouthBaseIdx"]},mt:{keys:["face","mouthTexture"]},tx:{keys:["texture"]},scl:{keys:["scale"]}};async function Cf(t){const e=di(t),n=Object.fromEntries(e),{id:r}=n,o=await this.loadDLModel(r);return await Lf(o,n),o}async function Lf(t,e){const{ani:n,...r}=e;Object.entries(r).forEach(([o,s])=>{const i=Mf[o];if(!i)return;const{keys:u,valueMap:c}=i,l=(c==null?void 0:c(s))??s;Qs(t,u,l)}),n&&await t.animation.addChain(n)}const sr=class{constructor(){te(this,"userData",{ani:new me});te(this,"dataLoaded",!1);te(this,"initData",async()=>{await Ef(),this.dataLoaded=!0,this.dispatchEvent({type:"dataLoaded"})});te(this,"_background","");te(this,"model",new me);te(this,"loadedModel",new me);te(this,"loadModelFromCode",Cf);te(this,"settings",{outline:je,material:Te});te(this,"viewport",{width:0,height:0,set(e,n){this.width=e,this.height=n}});Object.assign(this,mt);const e=new da;this.scene=e,this.background=$l,this.clock=new $o;const n=gl();this.camera=n;const r=Af(this);r.add("directional"),r.add("ambient"),this.light=r;const o=ml();this.renderer=o,this.canvas=o.domElement,this.screenshot=bf(this),this.record=pf(this.canvas),this.controls=new xc(this.camera,this.canvas),this.postProcessing={enabled:!1,passes:new me,composer:vo({renderer:o,scene:e,camera:n}),async addPass(s,i={}){const u=await Qu(s,{...i,renderer:o,scene:e,camera:n});this.composer.addPass(u);const c=cf(u),{passes:l}=this,a=this;return c.remove=()=>{l.remove(c),a.refresh()},l.push(c),u},async refresh(){this.composer=vo({renderer:o,scene:e,camera:n});const s=this.passes.map(({type:u,params:c})=>({type:u,params:Object.entries(c)}));this.passes.length=0;const{length:i}=s;for(let u=0;u<i;u++){const{type:c,params:l}=s[u],a=await this.addPass(c);l.forEach(([f,p])=>void(a[f]=p))}},updatePasses(s){this.passes.length=0,this.passes.splice(0,0,...s),this.refresh()}},this.stats=new Fn,this.loop=df(this),this.loop.start(),console.info("%cDragalia Lost Model Viewer","color:yellow;background-color:black;font-size:1.5rem;text-shadow: 0 0 0.5rem white")}get background(){return this._background}set background(e){var r,o;if(this._background===e)return;this._background="loading",(o=(r=this.scene.background)==null?void 0:r.dispose)==null||o.call(r);const n=this;(async function(){n.scene.background=await _l(e),n._background=e,e.startsWith("img:")&&n.updateBgAspectRatio()})()}get toneMapping(){var n;const{toneMapping:e}=this.renderer;return((n=Object.entries(_n).find(([,r])=>r===e))==null?void 0:n[0])??"Unknown"}set toneMapping(e){const n=_n[e]?e:"No Mapping";this.renderer.toneMapping=_n[n]}get pixelRatio(){return this.renderer.getPixelRatio()}set pixelRatio(e){this.renderer.setPixelRatio(e),this.postProcessing.composer.setPixelRatio(e)}get unusedModel(){return this.loadedModel.filter(e=>!this.model.includes(e))}async loadDLModel(e=Bl){this.dataLoaded||await new Promise(i=>this.addCountedEventListener("dataLoaded",i));const n=sr.getModelPath(e),r=await qs(n);r.name=e;const o={id:e,outline:this.settings.outline,material:this.settings.material,viewer:this},s=Vu(r,o);return this.loadedModel.push(s),s.addEventListener("dispose",()=>this.loadedModel.remove(s)),s}add(e){var n;(n=e.detach)==null||n.call(e),this.model.push(e),this.scene.add(e.model),e.parent=this}remove(e){this.model.remove(e),this.scene.remove(e.model)}disposeAllModels(){this.loadedModel.forEach(e=>{var n;return(n=e.dispose)==null?void 0:n.call(e)}),this.model.length=0}static getModelPath(e){return`${this.source.fbx}/${e}/${e}.fbx`}async setViewport(e,n){var i;await pl(200);const r=e??window.innerWidth,o=n??window.innerHeight;this.viewport.set(r,o),this.renderer.setSize(r,o);const s=r/o;return this.camera.aspect=s,this.camera.updateProjectionMatrix(),(i=this.postProcessing.composer)==null||i.setSize(r,o),this.background.startsWith("img:")&&this.updateBgAspectRatio(),this}updateBgAspectRatio(){if(!this.background.startsWith("img:"))return;const{width:e,height:n}=this.viewport,r=e/n,{background:o}=this.scene,{naturalWidth:s,naturalHeight:i}=o.image,u=s/i,c=r/u,l=r>u?[1,1/c]:[c,1];o.repeat.set(...l)}update(e){var n;(n=this.animation)==null||n.update(e),this.model.forEach(r=>{var o;return(o=r.update)==null?void 0:o.call(r,e)}),this.loop.state==="inactive"&&this.render(),this.dispatchEvent({type:"timeUpdate",dt:e})}stopAll(){this.model.forEach(e=>{var n,r;return(r=(n=e.animation)==null?void 0:n.stop)==null?void 0:r.call(n)})}playAll(){this.model.forEach(e=>{var n,r;return(r=(n=e.animation)==null?void 0:n.play)==null?void 0:r.call(n)})}render(){this.dispatchEvent({type:"beforeRender"}),this.postProcessing.enabled?this.postProcessing.composer.render():this.renderer.render(this.scene,this.camera),this.dispatchEvent({type:"afterRender"})}toString(){return"Dragalia Lost Model Viewer"}dispose(){var e,n,r;this.model.forEach(o=>o.dispose()),(n=(e=this.scene.background)==null?void 0:e.dispose)==null||n.call(e),(r=this.renderer.renderLists)==null||r.dispose(),this.renderer.dispose()}};let ot=sr;te(ot,"source",{fbx:$s,ani:js});var X={fullscreenEnabled:0,fullscreenElement:1,requestFullscreen:2,exitFullscreen:3,fullscreenchange:4,fullscreenerror:5,fullscreen:6},wo=["webkitFullscreenEnabled","webkitFullscreenElement","webkitRequestFullscreen","webkitExitFullscreen","webkitfullscreenchange","webkitfullscreenerror","-webkit-full-screen"],Eo=["mozFullScreenEnabled","mozFullScreenElement","mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozfullscreenerror","-moz-full-screen"],Po=["msFullscreenEnabled","msFullscreenElement","msRequestFullscreen","msExitFullscreen","MSFullscreenChange","MSFullscreenError","-ms-fullscreen"],V=typeof window<"u"&&typeof window.document<"u"?window.document:{},q="fullscreenEnabled"in V&&Object.keys(X)||wo[0]in V&&wo||Eo[0]in V&&Eo||Po[0]in V&&Po||[],Of={requestFullscreen:function(t){return t[q[X.requestFullscreen]]()},requestFullscreenFunction:function(t){return t[q[X.requestFullscreen]]},get exitFullscreen(){return V[q[X.exitFullscreen]].bind(V)},get fullscreenPseudoClass(){return":"+q[X.fullscreen]},addEventListener:function(t,e,n){return V.addEventListener(q[X[t]],e,n)},removeEventListener:function(t,e,n){return V.removeEventListener(q[X[t]],e,n)},get fullscreenEnabled(){return Boolean(V[q[X.fullscreenEnabled]])},set fullscreenEnabled(t){},get fullscreenElement(){return V[q[X.fullscreenElement]]},set fullscreenElement(t){},get onfullscreenchange(){return V[("on"+q[X.fullscreenchange]).toLowerCase()]},set onfullscreenchange(t){return V[("on"+q[X.fullscreenchange]).toLowerCase()]=t},get onfullscreenerror(){return V[("on"+q[X.fullscreenerror]).toLowerCase()]},set onfullscreenerror(t){return V[("on"+q[X.fullscreenerror]).toLowerCase()]=t}};const St=Of,D=new ot;D.initData();D.setViewport();D.userData.specialCapture={frameRate:30,duration:5,program:"rotate"};window.addEventListener("resize",()=>D.setViewport());D.canvas.addEventListener("dblclick",kf);window.viewer=D;window.model=D.model;window.getFrame=D.screenshot.getFrame;window.downloadFrames=$n;window.saveAs=ut.saveAs;window.THREE=Ro;window.makeGif=async t=>{const{makeGif:e}=await L(()=>import("./e220d14b-index.js"),[]);return await e(t)};function kf(){St.fullscreenEnabled&&(St.fullscreenElement?St.exitFullscreen():St.requestFullscreen(D.canvas))}function Df(){try{return window.self!==window.top}catch{return!0}}let xo="";const hi=Df(),If=hi?!1:!window.location.hash.includes("showSettings=false"),Rf=hi?!1:!window.location.hash.includes("showAC=false"),Ff=t=>({showSettings:If,toggleSettings:()=>t(e=>{e.showSettings=!e.showSettings}),loadingMsg:"",setLoadingMsg:e=>t(n=>{n.loadingMsg=e}),showTimeControl:Rf,toggleTimeControl:()=>t(e=>{e.showTimeControl=!e.showTimeControl}),showFrameRate:!1,toggleFrameRate:()=>t(e=>{e.showFrameRate=!e.showFrameRate}),sidebar:{open:!0,toggle:()=>t(e=>{e.sidebar.open=!e.sidebar.open}),settings:{tab:"Model",setTab:e=>t(n=>{n.sidebar.settings.tab=e})},modal:{mode:"",handleSelect:void 0,open:(e,n)=>{xo=D.loop.state,D.loop.stop(),t(r=>{r.sidebar.modal.mode=e,r.sidebar.modal.handleSelect=n})},close:()=>{xo==="active"&&D.loop.start(),t(e=>{e.sidebar.modal.mode="",e.sidebar.modal.handleSelect=void 0})}},manageMode:"single",setManageMode:e=>t(n=>{n.sidebar.manageMode=e})},chainMaker:{target:null,setTarget:e=>t(n=>{n.chainMaker.target=e})},dock:{mode:"",handleSelect:void 0,open:(e="",n)=>t(r=>{r.dock.mode=e,r.dock.handleSelect=n}),close:()=>t(e=>{e.dock.mode="",e.dock.handleSelect=void 0})}});var $f=0;function re(t,e,n,r,o,s){var i,u,c={};for(u in e)u=="ref"?i=e[u]:c[u]=e[u];var l={type:t,props:c,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:--$f,__source:o,__self:s};if(typeof t=="function"&&(i=t.defaultProps))for(u in i)c[u]===void 0&&(c[u]=i[u]);return E.vnode&&E.vnode(l),l}const jf=H(()=>L(()=>import("./0cc99df4-index.js"),["assets/0cc99df4-index.js","assets/33a13417-TabBar.js","assets/37ae16c3-ButtonBase.js","assets/d975ff8a-Gallery.js","assets/a80fa034-Popover.js","assets/28aed76d-createSvgIcon.js","assets/4f38926d-Box.js","assets/5e1dd928-DialogTitle.js","assets/3242b92e-ColorPicker.js","assets/f5b4f7b7-ColorButton.js","assets/f74993c8-Button.js","assets/a4b8921d-ColorPicker.css","assets/557ffbcd-file2dataURL.js","assets/f81b78b9-three.js","assets/aa80096d-index.css"])),Bf=H(()=>L(()=>import("./314bd5f5-index.js"),["assets/314bd5f5-index.js","assets/93518b81-lists.js","assets/28aed76d-createSvgIcon.js","assets/37ae16c3-ButtonBase.js","assets/d975ff8a-Gallery.js","assets/a80fa034-Popover.js","assets/4f38926d-Box.js","assets/5e1dd928-DialogTitle.js","assets/e711acec-Close.js","assets/4341b07e-lists.css","assets/f728529b-filterConfig.js","assets/462ad7a4-GlowToggle.js","assets/eb519626-GlowToggle.css","assets/ea114570-filterConfig.css","assets/aead7db9-styles.js","assets/6d95f099-styles.css","assets/2ff56570-styles.css","assets/ac44886b-index.js","assets/f81b78b9-three.js"])),Nf=H(()=>L(()=>import("./9469a155-index.js"),["assets/9469a155-index.js","assets/93518b81-lists.js","assets/28aed76d-createSvgIcon.js","assets/37ae16c3-ButtonBase.js","assets/d975ff8a-Gallery.js","assets/a80fa034-Popover.js","assets/4f38926d-Box.js","assets/5e1dd928-DialogTitle.js","assets/e711acec-Close.js","assets/4341b07e-lists.css","assets/5beb8502-Stretcher.js","assets/c7840dc6-Stretcher.css","assets/33a13417-TabBar.js","assets/f74993c8-Button.js","assets/9d2b3ba7-ModelIcon.js","assets/ba622e6d-aniFunction.js","assets/ea5a64e9-Selector.js","assets/462ad7a4-GlowToggle.js","assets/eb519626-GlowToggle.css","assets/88a094c7-Selector.css","assets/d8213837-useKey.js","assets/557ffbcd-file2dataURL.js","assets/837c2f4a-useToggleState.js","assets/54e5f033-Check.js","assets/f81b78b9-three.js","assets/a584847b-index.css","assets/2ff56570-styles.css"])),Uf=H(()=>L(()=>import("./68ed82e0-index.js"),["assets/68ed82e0-index.js","assets/87a695d1-AddWeapon.js","assets/93518b81-lists.js","assets/28aed76d-createSvgIcon.js","assets/37ae16c3-ButtonBase.js","assets/d975ff8a-Gallery.js","assets/a80fa034-Popover.js","assets/4f38926d-Box.js","assets/5e1dd928-DialogTitle.js","assets/e711acec-Close.js","assets/4341b07e-lists.css","assets/f728529b-filterConfig.js","assets/462ad7a4-GlowToggle.js","assets/eb519626-GlowToggle.css","assets/ea114570-filterConfig.css","assets/ac44886b-index.js","assets/837c2f4a-useToggleState.js","assets/9d2b3ba7-ModelIcon.js","assets/45b642d6-AddWeapon.css","assets/2ff56570-styles.css","assets/f81b78b9-three.js"])),zf=H(()=>L(()=>import("./ff35081d-ColorSelect.js"),["assets/ff35081d-ColorSelect.js","assets/3242b92e-ColorPicker.js","assets/f5b4f7b7-ColorButton.js","assets/f74993c8-Button.js","assets/37ae16c3-ButtonBase.js","assets/a4b8921d-ColorPicker.css","assets/5e1dd928-DialogTitle.js","assets/f81b78b9-three.js"])),Vf=H(()=>L(()=>import("./6c233cc2-index.js"),["assets/6c233cc2-index.js","assets/c1a0c2c2-FaceSelect.js","assets/d8213837-useKey.js","assets/74c0b2c0-FacePartSelector.js","assets/ea5a64e9-Selector.js","assets/462ad7a4-GlowToggle.js","assets/eb519626-GlowToggle.css","assets/88a094c7-Selector.css","assets/39de67ba-MeshMouthSelect.js","assets/4f38926d-Box.js","assets/37ae16c3-ButtonBase.js","assets/5e1dd928-DialogTitle.js","assets/f74993c8-Button.js","assets/7f49998c-MeshMouthSelect.css","assets/febe3778-FaceSelect.css","assets/f81b78b9-three.js"])),Hf=H(()=>L(()=>import("./6a9a24f2-index.js"),["assets/6a9a24f2-index.js","assets/be756d7b-FaceTexture.js","assets/837c2f4a-useToggleState.js","assets/93518b81-lists.js","assets/28aed76d-createSvgIcon.js","assets/37ae16c3-ButtonBase.js","assets/d975ff8a-Gallery.js","assets/a80fa034-Popover.js","assets/4f38926d-Box.js","assets/5e1dd928-DialogTitle.js","assets/e711acec-Close.js","assets/4341b07e-lists.css","assets/74c0b2c0-FacePartSelector.js","assets/ea5a64e9-Selector.js","assets/462ad7a4-GlowToggle.js","assets/eb519626-GlowToggle.css","assets/88a094c7-Selector.css","assets/f728529b-filterConfig.js","assets/ea114570-filterConfig.css","assets/aead7db9-styles.js","assets/6d95f099-styles.css","assets/2ff56570-styles.css","assets/f81b78b9-three.js"])),Wf=H(()=>L(()=>import("./c1963664-index.js"),["assets/c1963664-index.js","assets/d8213837-useKey.js","assets/5beb8502-Stretcher.js","assets/c7840dc6-Stretcher.css","assets/e04eba49-BoneManager.js","assets/9d2b3ba7-ModelIcon.js","assets/6f2527b0-Accordion.js","assets/837c2f4a-useToggleState.js","assets/28aed76d-createSvgIcon.js","assets/37ae16c3-ButtonBase.js","assets/09fd7fc3-Accordion.css","assets/f728529b-filterConfig.js","assets/d975ff8a-Gallery.js","assets/a80fa034-Popover.js","assets/4f38926d-Box.js","assets/5e1dd928-DialogTitle.js","assets/462ad7a4-GlowToggle.js","assets/eb519626-GlowToggle.css","assets/93518b81-lists.js","assets/e711acec-Close.js","assets/4341b07e-lists.css","assets/ea114570-filterConfig.css","assets/f5b4f7b7-ColorButton.js","assets/f74993c8-Button.js","assets/db9b2f6c-SkipPrevious.js","assets/c1a0c2c2-FaceSelect.js","assets/74c0b2c0-FacePartSelector.js","assets/ea5a64e9-Selector.js","assets/88a094c7-Selector.css","assets/39de67ba-MeshMouthSelect.js","assets/7f49998c-MeshMouthSelect.css","assets/febe3778-FaceSelect.css","assets/be756d7b-FaceTexture.js","assets/aead7db9-styles.js","assets/6d95f099-styles.css","assets/2ff56570-styles.css","assets/87a695d1-AddWeapon.js","assets/ac44886b-index.js","assets/45b642d6-AddWeapon.css","assets/bf3fbd2c-BoneManager.css","assets/f81b78b9-three.js","assets/98b9a174-index.css"])),So=H(()=>L(()=>import("./016f12ec-index.js"),["assets/016f12ec-index.js","assets/39de67ba-MeshMouthSelect.js","assets/4f38926d-Box.js","assets/37ae16c3-ButtonBase.js","assets/5e1dd928-DialogTitle.js","assets/f74993c8-Button.js","assets/7f49998c-MeshMouthSelect.css","assets/f81b78b9-three.js","assets/045f3dd6-index.css"])),Gf=H(()=>L(()=>import("./dd0f0f1d-index.js"),["assets/dd0f0f1d-index.js","assets/d8213837-useKey.js","assets/6f2527b0-Accordion.js","assets/837c2f4a-useToggleState.js","assets/28aed76d-createSvgIcon.js","assets/37ae16c3-ButtonBase.js","assets/09fd7fc3-Accordion.css","assets/9d2b3ba7-ModelIcon.js","assets/f74993c8-Button.js","assets/54e5f033-Check.js","assets/5e1dd928-DialogTitle.js","assets/4f38926d-Box.js","assets/f81b78b9-three.js","assets/79f787e2-index.css","assets/2ff56570-styles.css"])),Ao={background:jf,model:Bf,animation:Nf,weapon:Uf,color:zf,face:Vf,faceTexture:Hf,attachment:Wf,target:Gf,eye:({onSelect:t})=>re(So,{part:"eye",onSelect:t}),mouth:({onSelect:t})=>re(So,{part:"mouth",onSelect:t})},Xf=(t,e)=>({Component:void 0,props:void 0,openModal:(n,r)=>t(o=>{o.props=r,o.Component=n}),close:()=>t(n=>{n.Component=void 0}),onClose:void 0,reset:()=>t(n=>{n.Component=n.props=n.onClose=void 0}),getInput:async n=>{if(!Ao[n])return null;const{close:r,reset:o}=e(),s=new Promise((i,u)=>{const c=(...l)=>i(l);t(l=>{l.onClose=()=>{u(),r()},l.props={onSelect:c,onAfterSelect:r},l.Component=Ao[n]})});try{return await s}catch{return null}finally{o()}},inputModel:()=>e().getInput("model"),inputAni:()=>e().getInput("animation"),inputColor:async()=>{const n=await e().getInput("color");return n==null?void 0:n[0]},inputTarget:()=>e().getInput("target"),inputEye:()=>e().getInput("eye"),inputMouth:()=>e().getInput("mouth")}),Kf=t=>({activeModel:void 0,setActiveModel:e=>t({activeModel:e})}),Yf=t=>({open:!1,toggle:()=>t(e=>({open:!e.open})),target:null,setTarget:e=>{e&&(e.userData.chain||(e.userData.chain=new me),t({target:e}))}}),qf=t=>(e,n,r)=>t(o=>e(Ec(o)),n,r),gt=t=>Gn(qf(t)),jn=gt(Ff),bp=gt(Rs),wp=gt(Rs),Zf=gt(Pc),Ep=gt(Xf),Pp=Gn(Kf),xp=Gn(Yf);function Qf(){return new Worker("/dl-model/assets/fetchWorker-371b1d98.js")}const Jf=t=>{const e=new Qf;return new Promise(n=>{e.addEventListener("message",r=>{e.terminate(),n(r.data)}),e.postMessage(t)})};function mi(){return new Worker("/dl-model/assets/dbWorker-7a44bd92.js")}const gi=(t,e)=>{const n=new mi;return new Promise(r=>{n.addEventListener("message",()=>{r(),n.terminate()}),n.postMessage({type:"put",store:e,value:t})})};function ep(){return new Worker("/dl-model/assets/searchWorker-266b9caf.js")}async function tp(t,e="",n=["name"]){if(!e||!n.length)return t;const r=new ep;return new Promise(o=>{r.addEventListener("message",s=>{r.terminate(),o(s.data)}),r.postMessage({fullList:t,query:e,keys:n})})}const Sp=async t=>{const e=Object.values(t).flat();await gi(e,"model"),console.info("Model DB Initialized")},Ap=t=>Kt({type:"get",store:"model",value:t}),Tp=t=>Kt({type:"search",store:"model",index:"name",value:t}),Mp=async t=>{const n=(await Kt({type:"getByKeyRange",store:"model",value:"c100000_00-c199999_99"})).filter(({id:r})=>!r.endsWith("h"));return tp(n,t)},np=()=>Kt({type:"getMap",store:"model",index:"name"}),Kt=t=>{const e=new mi;return new Promise(n=>{e.addEventListener("message",r=>{e.terminate(),n(r.data)}),e.postMessage(t)})},ft={},rp=async()=>{if(Object.keys(ft).length)return;const t="ani-personal",e=(await Jf([t]))[t];Object.assign(ft,e)},_i=rp(),Cp=t=>ft[t],op=t=>{var e;return((e=ft[t])==null?void 0:e[0])??(t.startsWith("c")?{name:"Bob",code:"CMN_MWM_03"}:null)},Lp=async()=>{const t=await np();await _i;const e=Object.entries(ft).flatMap(([n,r])=>{const o=t.get(n);return r.map(s=>({...s,user:n,fullName:`${o} ${s.name}`}))});await gi(e,"animation")},sp="cccccc",ip="c100001_01",To=(t,e="Unknown")=>{const n=fi(t),{length:r}=n,o=n.map((s,i)=>{const{aniName:u,reps:c=1,timeScale:l=1,duration:a=[0,100],aniAction:f}=s,p=r>1?e+` #${i+1}`:e;return{id:nr(),name:p,aniName:u,reps:c,timeScale:l,duration:a,aniAction:f}});return me.from(o)},Mo={ts:{key:"timeScale",defaultValue:1},r:{key:"reps",defaultValue:1}},ap={"face.eyeIdx":"ei","face.mouthIdx":"mi"},Op=t=>t.map(cp).join(">"),cp=t=>{const{aniName:e}=t,n=lp(t),r=up(t),o=fp(t);return`${e}${n}${r}${o}`},lp=t=>{const e=[];return Object.keys(Mo).forEach(n=>{const{key:r,defaultValue:o}=Mo[n];t[r]&&t[r]!==o&&e.push(`&${n}=${t[r]}`)}),e.join("")},up=t=>{const{duration:e=[0,100]}=t,[n,r]=e;return n!==0?`&dur=${n}-${r}`:r===100?"":`&dur=${r}`},fp=t=>{const{aniAction:e}=t;return e.length?"&"+e.map(r=>{const{time:o,...s}=r,i=Object.entries(s).map(([u,c])=>`${ap[u]??u}=${c}`);return`@${o}=(${i.join("/")})`}).join("&"):""};function pp(t){if(!(t!=null&&t.userData))return;const{type:e,id:n}=t,{name:r}=t.userData;t.userData.aniSelectState={category:e==="adventurer"?"Adv":"Personal",personalAni:{source:n,sourceName:r}}}function vn(){const t=decodeURI(window.location.hash),e=di(t),n=Object.fromEntries(e);dp(n),hp(t)}function dp(t){const{bg:e=sp,showAC:n="true",showSettings:r="true"}=t;D.background=e,jn.setState({showTimeControl:to(n)}),jn.setState({showSettings:to(r)})}async function hp(t){D.disposeAllModels(),setTimeout(async()=>{const e=t.includes("id=")?t:t+`/id=${ip}`,n=await D.loadModelFromCode(e);D.add(n);const r=n.type==="adventurer"?"Adv":"Personal";Zf.getState().setCategory(r),pp(n);const{id:o}=n;if(!t.includes("camPos=")){const i=Gl(o);D.camera.position.set(...i)}const s=Kl(o);if(D.controls.target.set(...s),t.includes("ani=")){const i=n.animation.current.chainCode??"";i&&(n.userData.chain=To(i,"init"))}else{const i=op(o);if(i){const{code:u,name:c}=i;n.animation.addChain(u),n.userData.chain=To(u,c)}}})}const mp=H(()=>L(()=>import("./9104f217-index.js"),["assets/9104f217-index.js","assets/28aed76d-createSvgIcon.js","assets/37ae16c3-ButtonBase.js","assets/e04eba49-BoneManager.js","assets/9d2b3ba7-ModelIcon.js","assets/6f2527b0-Accordion.js","assets/837c2f4a-useToggleState.js","assets/09fd7fc3-Accordion.css","assets/f728529b-filterConfig.js","assets/d975ff8a-Gallery.js","assets/a80fa034-Popover.js","assets/4f38926d-Box.js","assets/5e1dd928-DialogTitle.js","assets/462ad7a4-GlowToggle.js","assets/eb519626-GlowToggle.css","assets/93518b81-lists.js","assets/e711acec-Close.js","assets/4341b07e-lists.css","assets/ea114570-filterConfig.css","assets/f5b4f7b7-ColorButton.js","assets/f74993c8-Button.js","assets/db9b2f6c-SkipPrevious.js","assets/d8213837-useKey.js","assets/c1a0c2c2-FaceSelect.js","assets/74c0b2c0-FacePartSelector.js","assets/ea5a64e9-Selector.js","assets/88a094c7-Selector.css","assets/39de67ba-MeshMouthSelect.js","assets/7f49998c-MeshMouthSelect.css","assets/febe3778-FaceSelect.css","assets/be756d7b-FaceTexture.js","assets/aead7db9-styles.js","assets/6d95f099-styles.css","assets/2ff56570-styles.css","assets/87a695d1-AddWeapon.js","assets/ac44886b-index.js","assets/45b642d6-AddWeapon.css","assets/bf3fbd2c-BoneManager.css","assets/33a13417-TabBar.js","assets/ba622e6d-aniFunction.js","assets/f81b78b9-three.js","assets/0f03617c-index.css"])),gp=H(()=>L(()=>import("./6b552668-index.js"),["assets/6b552668-index.js","assets/837c2f4a-useToggleState.js","assets/462ad7a4-GlowToggle.js","assets/eb519626-GlowToggle.css","assets/f74993c8-Button.js","assets/37ae16c3-ButtonBase.js","assets/a80fa034-Popover.js","assets/db9b2f6c-SkipPrevious.js","assets/28aed76d-createSvgIcon.js","assets/e711acec-Close.js","assets/f81b78b9-three.js","assets/0a450c69-index.css"]));function _p(){const t=ja(),e=at(),n=at(),{loadingMsg:r,showTimeControl:o,showSettings:s,showFrameRate:i}=jn();return He(()=>(t&&_i.then(vn),window.addEventListener("hashchange",vn),()=>window.removeEventListener("hashchange",vn))),He(()=>{e.current.appendChild(D.canvas),D.stats.dom.style.position="",n.current.appendChild(D.stats.dom)},[]),re(le,{children:[s&&re(Ce,{fallback:null,children:re(mp,{})}),re("div",{className:"mount",ref:u=>e.current=u}),re("div",{className:"stats",style:{display:i?"unset":"none"},ref:u=>n.current=u}),r&&re("div",{className:"loading-msg",children:r}),o&&re(Ce,{fallback:null,children:re(gp,{})})]})}ze(re(_p,{}),document.getElementById("app"));export{ls as $,ut as A,L as B,co as C,Ce as D,yf as E,Ut as F,_f as G,Ep as H,Op as I,nr as J,Jf as K,Sp as L,_i as M,Lp as N,ja as O,jl as P,Tp as Q,as as R,tp as S,ns as T,Kc as U,Cp as V,gi as W,Kt as X,Hn as Y,ts as Z,at as _,Pp as a,H as a0,fl as a1,ds as a2,wp as a3,Mp as a4,$a as a5,Ec as a6,xs as a7,Jo as a8,Gn as a9,fo as aa,$s as ab,_o as ac,ce as ad,Gt as ae,Gu as af,Hu as ag,$e as ah,Os as ai,Rt as aj,se as ak,To as b,bs as c,Ao as d,Gl as e,Kl as f,op as g,He as h,pp as i,Zf as j,cs as k,Fa as l,le as m,bp as n,re as o,Nt as p,Ap as q,xp as r,dt as s,_n as t,jn as u,D as v,rs as w,Ps as x,Un as y,or as z};
