const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/f_DC0lY0Il-UnrealBloomPass.js","assets/f_xkHyBaMY-three.js","assets/f_Ao47wC88-SMAAPass.js","assets/f_DWLvnOId-RenderPixelatedPass.js","assets/f_DCBMgKDW-SobelOperatorShader.js","assets/f_DGTZY5-I-HalftonePass.js","assets/f_9hNh_bKA-DotScreenPass.js","assets/f_D2xRw46K-BokehPass.js","assets/f_GRnVcELV-AfterimagePass.js","assets/f_B7dvkY4S-index.js","assets/f_DAzvRKTa-TabBar.js","assets/f_BSbFFHNz-ButtonBase.js","assets/f_ksWbzNOi-Popover.js","assets/f_ED9QBcyw-useTheme.js","assets/f_BLuUxRqD-createSvgIcon.js","assets/f_PFNIE11d-ColorPicker.js","assets/f_Bzz3vr_X-ColorButton.js","assets/f_CrDsqLse-Button.js","assets/f_DOkd0J7a-ColorPicker.css","assets/f_CGPzmaB9-Gallery.js","assets/f_BQ_oNapm-Box.js","assets/f_B4Yphr1F-file2dataURL.js","assets/f_--xtMAYD-DialogTitle.js","assets/f_CC_FZrpF-index.css","assets/f_D265CAaw-index.js","assets/f_CNvzVtHW-lists.js","assets/f_CXDyWi9V-Close.js","assets/f_BmgjgQkf-lists.css","assets/f_CNDaE4a9-filterConfig.js","assets/f_BbexqgtD-GlowToggle.js","assets/f_i_v629Ua-GlowToggle.css","assets/f_YUy5lOXF-filterConfig.css","assets/f_M5wn20aT-styles.js","assets/f_DcE1GK0K-styles.css","assets/f_DTlAd7Dn-styles.css","assets/f_VT8WWdcC-index.js","assets/f_BmuG9NUh-index.js","assets/f_Cd4RPYIT-Stretcher.js","assets/f_CykHxqOs-Stretcher.css","assets/f_DhOXniNW-ModelIcon.js","assets/f_CWk5-OtY-aniFunction.js","assets/f_CQqut15n-Selector.js","assets/f_tY7sRDVY-Selector.css","assets/f_Bau7jsyF-useKey.js","assets/f_Q7kizPsT-useToggleState.js","assets/f_VDCb33r9-Check.js","assets/f_DzS1WTFL-index.css","assets/f_CraM7OKL-index.js","assets/f_CM9Pt-QL-index.css","assets/f_Dda1rdJe-ColorSelect.js","assets/f_CfkdavYI-index.js","assets/f_CMnyX_YQ-FacePartSelector.js","assets/f_D11bsGAA-MeshMouthSelect.js","assets/f_a3xgdy8u-MeshMouthSelect.css","assets/f_zXhT5QLt-index.css","assets/f_CcIF8W1F-index.js","assets/f_COl3m-JS-index.js","assets/f_IVzRioln-BoneManager.js","assets/f_B0Vu2vQ_-Accordion.js","assets/f_vBdlptXV-Accordion.css","assets/f_B4UTLLCT-SkipPrevious.js","assets/f_CIqfjCCo-BoneManager.css","assets/f_DN0w2pSx-index.css","assets/f_Bwutc1mz-index.js","assets/f_B0XIIxkL-index.css","assets/f_BJUs8swG-index.js","assets/f_owdQ4QxP-index.css","assets/f_CWKoiEUw-index.js","assets/f_NQTMArhG-index.css","assets/f_Cg_KtOXh-index.js","assets/f_BuJwm3yO-index.css"])))=>i.map(i=>d[i]);
var Yi=Object.defineProperty;var Ki=(t,e,n)=>e in t?Yi(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var ie=(t,e,n)=>Ki(t,typeof e!="symbol"?e+"":e,n);import{J as qi,K as Zi,q as H,O as Qi,b as I,X as ze,Y as Ue,Q as de,Z as Br,V as U,a as en,_ as Ji,$ as On,a0 as ea,a1 as ta,a2 as et,F as jr,E as Nr,T as na,a3 as gn,a4 as ra,C as V,g as oe,a5 as sa,u as j,a6 as $r,a7 as zr,t as Gt,a8 as yn,a9 as Gs,i as Xs,aa as Rn,ab as oa,ac as Ys,ad as ia,h as Ks,ae as aa,af as ca,ag as la,ah as qs,ai as Ut,aj as Me,ak as ua,al as fa,am as pa,an as Zs,ao as da,ap as he,aq as Ur,ar as ha,as as ma,k as _a,U as tr,at as dt,S as _t,au as Vr,av as ga,aw as Hr,ax as ya,ay as va,N as wa,az as Qs,aA as ba,aB as Ea,aC as Pa,aD as Sa,aE as xa,aF as Ta,aG as Aa,aH as Ma,aI as Ca,aJ as La,B as ka,aK as Da,A as Ia,s as Oa,W as Js,H as Ra,e as Fa,aL as eo,L as Wr,r as Ba,aM as ja,aN as Na,j as $a}from"./f_xkHyBaMY-three.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();var bt,S,to,De,Gr,no,Fn,nr,Bn,jn,ro,gt={},so=[],za=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,tn=Array.isArray;function we(t,e){for(var n in e)t[n]=e[n];return t}function oo(t){var e=t.parentNode;e&&e.removeChild(t)}function me(t,e,n){var r,s,o,i={};for(o in e)o=="key"?r=e[o]:o=="ref"?s=e[o]:i[o]=e[o];if(arguments.length>2&&(i.children=arguments.length>3?bt.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(o in t.defaultProps)i[o]===void 0&&(i[o]=t.defaultProps[o]);return ht(t,i,r,s,null)}function ht(t,e,n,r,s){var o={type:t,props:e,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:s??++to,__i:-1,__u:0};return s==null&&S.vnode!=null&&S.vnode(o),o}function io(){return{current:null}}function pe(t){return t.children}function fe(t,e){this.props=t,this.context=e}function Oe(t,e){if(e==null)return t.__?Oe(t.__,t.__i+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?Oe(t):null}function ao(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return ao(t)}}function Nn(t){(!t.__d&&(t.__d=!0)&&De.push(t)&&!Xt.__r++||Gr!==S.debounceRendering)&&((Gr=S.debounceRendering)||no)(Xt)}function Xt(){var t,e,n,r,s,o,i,a;for(De.sort(Fn);t=De.shift();)t.__d&&(e=De.length,r=void 0,o=(s=(n=t).__v).__e,i=[],a=[],n.__P&&((r=we({},s)).__v=s.__v+1,S.vnode&&S.vnode(r),rr(n.__P,r,s,n.__n,n.__P.namespaceURI,32&s.__u?[o]:null,i,o??Oe(s),!!(32&s.__u),a),r.__v=s.__v,r.__.__k[r.__i]=r,uo(i,r,a),r.__e!=o&&ao(r)),De.length>e&&De.sort(Fn));Xt.__r=0}function co(t,e,n,r,s,o,i,a,c,u,f){var l,p,d,m,g,y=r&&r.__k||so,v=e.length;for(n.__d=c,Ua(n,e,y),c=n.__d,l=0;l<v;l++)(d=n.__k[l])!=null&&typeof d!="boolean"&&typeof d!="function"&&(p=d.__i===-1?gt:y[d.__i]||gt,d.__i=l,rr(t,d,p,s,o,i,a,c,u,f),m=d.__e,d.ref&&p.ref!=d.ref&&(p.ref&&sr(p.ref,null,d),f.push(d.ref,d.__c||m,d)),g==null&&m!=null&&(g=m),65536&d.__u||p.__k===d.__k?(c&&typeof d.type=="string"&&!t.contains(c)&&(c=Oe(p)),c=lo(d,c,t)):typeof d.type=="function"&&d.__d!==void 0?c=d.__d:m&&(c=m.nextSibling),d.__d=void 0,d.__u&=-196609);n.__d=c,n.__e=g}function Ua(t,e,n){var r,s,o,i,a,c=e.length,u=n.length,f=u,l=0;for(t.__k=[],r=0;r<c;r++)i=r+l,(s=t.__k[r]=(s=e[r])==null||typeof s=="boolean"||typeof s=="function"?null:typeof s=="string"||typeof s=="number"||typeof s=="bigint"||s.constructor==String?ht(null,s,null,null,null):tn(s)?ht(pe,{children:s},null,null,null):s.constructor===void 0&&s.__b>0?ht(s.type,s.props,s.key,s.ref?s.ref:null,s.__v):s)!=null?(s.__=t,s.__b=t.__b+1,a=Va(s,n,i,f),s.__i=a,o=null,a!==-1&&(f--,(o=n[a])&&(o.__u|=131072)),o==null||o.__v===null?(a==-1&&l--,typeof s.type!="function"&&(s.__u|=65536)):a!==i&&(a==i-1?l=a-i:a==i+1?l++:a>i?f>c-i?l+=a-i:l--:a<i&&l++,a!==r+l&&(s.__u|=65536))):(o=n[i])&&o.key==null&&o.__e&&!(131072&o.__u)&&(o.__e==t.__d&&(t.__d=Oe(o)),$n(o,o,!1),n[i]=null,f--);if(f)for(r=0;r<u;r++)(o=n[r])!=null&&!(131072&o.__u)&&(o.__e==t.__d&&(t.__d=Oe(o)),$n(o,o))}function lo(t,e,n){var r,s;if(typeof t.type=="function"){for(r=t.__k,s=0;r&&s<r.length;s++)r[s]&&(r[s].__=t,e=lo(r[s],e,n));return e}t.__e!=e&&(n.insertBefore(t.__e,e||null),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType===8);return e}function Pe(t,e){return e=e||[],t==null||typeof t=="boolean"||(tn(t)?t.some(function(n){Pe(n,e)}):e.push(t)),e}function Va(t,e,n,r){var s=t.key,o=t.type,i=n-1,a=n+1,c=e[n];if(c===null||c&&s==c.key&&o===c.type&&!(131072&c.__u))return n;if(r>(c!=null&&!(131072&c.__u)?1:0))for(;i>=0||a<e.length;){if(i>=0){if((c=e[i])&&!(131072&c.__u)&&s==c.key&&o===c.type)return i;i--}if(a<e.length){if((c=e[a])&&!(131072&c.__u)&&s==c.key&&o===c.type)return a;a++}}return-1}function Xr(t,e,n){e[0]==="-"?t.setProperty(e,n??""):t[e]=n==null?"":typeof n!="number"||za.test(e)?n:n+"px"}function Ft(t,e,n,r,s){var o;e:if(e==="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof r=="string"&&(t.style.cssText=r=""),r)for(e in r)n&&e in n||Xr(t.style,e,"");if(n)for(e in n)r&&n[e]===r[e]||Xr(t.style,e,n[e])}else if(e[0]==="o"&&e[1]==="n")o=e!==(e=e.replace(/(PointerCapture)$|Capture$/i,"$1")),e=e.toLowerCase()in t||e==="onFocusOut"||e==="onFocusIn"?e.toLowerCase().slice(2):e.slice(2),t.l||(t.l={}),t.l[e+o]=n,n?r?n.u=r.u:(n.u=nr,t.addEventListener(e,o?jn:Bn,o)):t.removeEventListener(e,o?jn:Bn,o);else{if(s=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&e[4]!=="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&n==1?"":n))}}function Yr(t){return function(e){if(this.l){var n=this.l[e.type+t];if(e.t==null)e.t=nr++;else if(e.t<n.u)return;return n(S.event?S.event(e):e)}}}function rr(t,e,n,r,s,o,i,a,c,u){var f,l,p,d,m,g,y,v,w,_,E,x,A,T,R,z,C=e.type;if(e.constructor!==void 0)return null;128&n.__u&&(c=!!(32&n.__u),o=[a=e.__e=n.__e]),(f=S.__b)&&f(e);e:if(typeof C=="function")try{if(v=e.props,w="prototype"in C&&C.prototype.render,_=(f=C.contextType)&&r[f.__c],E=f?_?_.props.value:f.__:r,n.__c?y=(l=e.__c=n.__c).__=l.__E:(w?e.__c=l=new C(v,E):(e.__c=l=new fe(v,E),l.constructor=C,l.render=Wa),_&&_.sub(l),l.props=v,l.state||(l.state={}),l.context=E,l.__n=r,p=l.__d=!0,l.__h=[],l._sb=[]),w&&l.__s==null&&(l.__s=l.state),w&&C.getDerivedStateFromProps!=null&&(l.__s==l.state&&(l.__s=we({},l.__s)),we(l.__s,C.getDerivedStateFromProps(v,l.__s))),d=l.props,m=l.state,l.__v=e,p)w&&C.getDerivedStateFromProps==null&&l.componentWillMount!=null&&l.componentWillMount(),w&&l.componentDidMount!=null&&l.__h.push(l.componentDidMount);else{if(w&&C.getDerivedStateFromProps==null&&v!==d&&l.componentWillReceiveProps!=null&&l.componentWillReceiveProps(v,E),!l.__e&&(l.shouldComponentUpdate!=null&&l.shouldComponentUpdate(v,l.__s,E)===!1||e.__v===n.__v)){for(e.__v!==n.__v&&(l.props=v,l.state=l.__s,l.__d=!1),e.__e=n.__e,e.__k=n.__k,e.__k.forEach(function(k){k&&(k.__=e)}),x=0;x<l._sb.length;x++)l.__h.push(l._sb[x]);l._sb=[],l.__h.length&&i.push(l);break e}l.componentWillUpdate!=null&&l.componentWillUpdate(v,l.__s,E),w&&l.componentDidUpdate!=null&&l.__h.push(function(){l.componentDidUpdate(d,m,g)})}if(l.context=E,l.props=v,l.__P=t,l.__e=!1,A=S.__r,T=0,w){for(l.state=l.__s,l.__d=!1,A&&A(e),f=l.render(l.props,l.state,l.context),R=0;R<l._sb.length;R++)l.__h.push(l._sb[R]);l._sb=[]}else do l.__d=!1,A&&A(e),f=l.render(l.props,l.state,l.context),l.state=l.__s;while(l.__d&&++T<25);l.state=l.__s,l.getChildContext!=null&&(r=we(we({},r),l.getChildContext())),w&&!p&&l.getSnapshotBeforeUpdate!=null&&(g=l.getSnapshotBeforeUpdate(d,m)),co(t,tn(z=f!=null&&f.type===pe&&f.key==null?f.props.children:f)?z:[z],e,n,r,s,o,i,a,c,u),l.base=e.__e,e.__u&=-161,l.__h.length&&i.push(l),y&&(l.__E=l.__=null)}catch(k){e.__v=null,c||o!=null?(e.__e=a,e.__u|=c?160:32,o[o.indexOf(a)]=null):(e.__e=n.__e,e.__k=n.__k),S.__e(k,e,n)}else o==null&&e.__v===n.__v?(e.__k=n.__k,e.__e=n.__e):e.__e=Ha(n.__e,e,n,r,s,o,i,c,u);(f=S.diffed)&&f(e)}function uo(t,e,n){e.__d=void 0;for(var r=0;r<n.length;r++)sr(n[r],n[++r],n[++r]);S.__c&&S.__c(e,t),t.some(function(s){try{t=s.__h,s.__h=[],t.some(function(o){o.call(s)})}catch(o){S.__e(o,s.__v)}})}function Ha(t,e,n,r,s,o,i,a,c){var u,f,l,p,d,m,g,y=n.props,v=e.props,w=e.type;if(w==="svg"?s="http://www.w3.org/2000/svg":w==="math"?s="http://www.w3.org/1998/Math/MathML":s||(s="http://www.w3.org/1999/xhtml"),o!=null){for(u=0;u<o.length;u++)if((d=o[u])&&"setAttribute"in d==!!w&&(w?d.localName===w:d.nodeType===3)){t=d,o[u]=null;break}}if(t==null){if(w===null)return document.createTextNode(v);t=document.createElementNS(s,w,v.is&&v),o=null,a=!1}if(w===null)y===v||a&&t.data===v||(t.data=v);else{if(o=o&&bt.call(t.childNodes),y=n.props||gt,!a&&o!=null)for(y={},u=0;u<t.attributes.length;u++)y[(d=t.attributes[u]).name]=d.value;for(u in y)if(d=y[u],u!="children"){if(u=="dangerouslySetInnerHTML")l=d;else if(u!=="key"&&!(u in v)){if(u=="value"&&"defaultValue"in v||u=="checked"&&"defaultChecked"in v)continue;Ft(t,u,null,d,s)}}for(u in v)d=v[u],u=="children"?p=d:u=="dangerouslySetInnerHTML"?f=d:u=="value"?m=d:u=="checked"?g=d:u==="key"||a&&typeof d!="function"||y[u]===d||Ft(t,u,d,y[u],s);if(f)a||l&&(f.__html===l.__html||f.__html===t.innerHTML)||(t.innerHTML=f.__html),e.__k=[];else if(l&&(t.innerHTML=""),co(t,tn(p)?p:[p],e,n,r,w==="foreignObject"?"http://www.w3.org/1999/xhtml":s,o,i,o?o[0]:n.__k&&Oe(n,0),a,c),o!=null)for(u=o.length;u--;)o[u]!=null&&oo(o[u]);a||(u="value",m!==void 0&&(m!==t[u]||w==="progress"&&!m||w==="option"&&m!==y[u])&&Ft(t,u,m,y[u],s),u="checked",g!==void 0&&g!==t[u]&&Ft(t,u,g,y[u],s))}return t}function sr(t,e,n){try{typeof t=="function"?t(e):t.current=e}catch(r){S.__e(r,n)}}function $n(t,e,n){var r,s;if(S.unmount&&S.unmount(t),(r=t.ref)&&(r.current&&r.current!==t.__e||sr(r,null,e)),(r=t.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(o){S.__e(o,e)}r.base=r.__P=null}if(r=t.__k)for(s=0;s<r.length;s++)r[s]&&$n(r[s],e,n||typeof t.type!="function");n||t.__e==null||oo(t.__e),t.__c=t.__=t.__e=t.__d=void 0}function Wa(t,e,n){return this.constructor(t,n)}function Ye(t,e,n){var r,s,o,i;S.__&&S.__(t,e),s=(r=typeof n=="function")?null:n&&n.__k||e.__k,o=[],i=[],rr(e,t=(!r&&n||e).__k=me(pe,null,[t]),s||gt,gt,e.namespaceURI,!r&&n?[n]:s?null:e.firstChild?bt.call(e.childNodes):null,o,!r&&n?n:s?s.__e:e.firstChild,r,i),uo(o,t,i)}function fo(t,e){Ye(t,e,fo)}function Ga(t,e,n){var r,s,o,i,a=we({},t.props);for(o in t.type&&t.type.defaultProps&&(i=t.type.defaultProps),e)o=="key"?r=e[o]:o=="ref"?s=e[o]:a[o]=e[o]===void 0&&i!==void 0?i[o]:e[o];return arguments.length>2&&(a.children=arguments.length>3?bt.call(arguments,2):n),ht(t.type,a,r||t.key,s||t.ref,null)}function po(t,e){var n={__c:e="__cC"+ro++,__:t,Consumer:function(r,s){return r.children(s)},Provider:function(r){var s,o;return this.getChildContext||(s=[],(o={})[e]=this,this.getChildContext=function(){return o},this.componentWillUnmount=function(){s=null},this.shouldComponentUpdate=function(i){this.props.value!==i.value&&s.some(function(a){a.__e=!0,Nn(a)})},this.sub=function(i){s.push(i);var a=i.componentWillUnmount;i.componentWillUnmount=function(){s&&s.splice(s.indexOf(i),1),a&&a.call(i)}}),r.children}};return n.Provider.__=n.Consumer.contextType=n}bt=so.slice,S={__e:function(t,e,n,r){for(var s,o,i;e=e.__;)if((s=e.__c)&&!s.__)try{if((o=s.constructor)&&o.getDerivedStateFromError!=null&&(s.setState(o.getDerivedStateFromError(t)),i=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(t,r||{}),i=s.__d),i)return s.__E=s}catch(a){t=a}throw t}},to=0,fe.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=we({},this.state),typeof t=="function"&&(t=t(we({},n),this.props)),t&&we(n,t),t!=null&&this.__v&&(e&&this._sb.push(e),Nn(this))},fe.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),Nn(this))},fe.prototype.render=pe,De=[],no=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Fn=function(t,e){return t.__v.__b-e.__v.__b},Xt.__r=0,nr=0,Bn=Yr(!1),jn=Yr(!0),ro=0;var Xa=0;function ce(t,e,n,r,s,o){e||(e={});var i,a,c=e;if("ref"in c)for(a in c={},e)a=="ref"?i=e[a]:c[a]=e[a];var u={type:t,props:c,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:--Xa,__i:-1,__u:0,__source:s,__self:o};if(typeof t=="function"&&(i=t.defaultProps))for(a in i)c[a]===void 0&&(c[a]=i[a]);return S.vnode&&S.vnode(u),u}const Ya="modulepreload",Ka=function(t){return"/dl-model/"+t},Kr={},B=function(e,n,r){let s=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),i=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));s=Promise.all(n.map(a=>{if(a=Ka(a),a in Kr)return;Kr[a]=!0;const c=a.endsWith(".css"),u=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${u}`))return;const f=document.createElement("link");if(f.rel=c?"stylesheet":Ya,c||(f.as="script",f.crossOrigin=""),f.href=a,i&&f.setAttribute("nonce",i),document.head.appendChild(f),c)return new Promise((l,p)=>{f.addEventListener("load",l),f.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${a}`)))})}))}return s.then(()=>e()).catch(o=>{const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=o,window.dispatchEvent(i),!i.defaultPrevented)throw o})};var Se,L,vn,qr,Ke=0,ho=[],F=S,Zr=F.__b,Qr=F.__r,Jr=F.diffed,es=F.__c,ts=F.unmount,ns=F.__;function je(t,e){F.__h&&F.__h(L,t,Ke||e),Ke=0;var n=L.__H||(L.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({}),n.__[t]}function Et(t){return Ke=1,nn(mo,t)}function nn(t,e,n){var r=je(Se++,2);if(r.t=t,!r.__c&&(r.__=[n?n(e):mo(void 0,e),function(a){var c=r.__N?r.__N[0]:r.__[0],u=r.t(c,a);c!==u&&(r.__N=[u,r.__[1]],r.__c.setState({}))}],r.__c=L,!L.u)){var s=function(a,c,u){if(!r.__c.__H)return!0;var f=r.__c.__H.__.filter(function(p){return!!p.__c});if(f.every(function(p){return!p.__N}))return!o||o.call(this,a,c,u);var l=!1;return f.forEach(function(p){if(p.__N){var d=p.__[0];p.__=p.__N,p.__N=void 0,d!==p.__[0]&&(l=!0)}}),!(!l&&r.__c.props===a)&&(!o||o.call(this,a,c,u))};L.u=!0;var o=L.shouldComponentUpdate,i=L.componentWillUpdate;L.componentWillUpdate=function(a,c,u){if(this.__e){var f=o;o=void 0,s(a,c,u),o=f}i&&i.call(this,a,c,u)},L.shouldComponentUpdate=s}return r.__N||r.__}function Re(t,e){var n=je(Se++,3);!F.__s&&ur(n.__H,e)&&(n.__=t,n.i=e,L.__H.__h.push(n))}function tt(t,e){var n=je(Se++,4);!F.__s&&ur(n.__H,e)&&(n.__=t,n.i=e,L.__h.push(n))}function qe(t){return Ke=5,Pt(function(){return{current:t}},[])}function or(t,e,n){Ke=6,tt(function(){return typeof t=="function"?(t(e()),function(){return t(null)}):t?(t.current=e(),function(){return t.current=null}):void 0},n==null?n:n.concat(t))}function Pt(t,e){var n=je(Se++,7);return ur(n.__H,e)&&(n.__=t(),n.__H=e,n.__h=t),n.__}function ir(t,e){return Ke=8,Pt(function(){return t},e)}function ar(t){var e=L.context[t.__c],n=je(Se++,9);return n.c=t,e?(n.__==null&&(n.__=!0,e.sub(L)),e.props.value):t.__}function cr(t,e){F.useDebugValue&&F.useDebugValue(e?e(t):t)}function qa(t){var e=je(Se++,10),n=Et();return e.__=t,L.componentDidCatch||(L.componentDidCatch=function(r,s){e.__&&e.__(r,s),n[1](r)}),[n[0],function(){n[1](void 0)}]}function lr(){var t=je(Se++,11);if(!t.__){for(var e=L.__v;e!==null&&!e.__m&&e.__!==null;)e=e.__;var n=e.__m||(e.__m=[0,0]);t.__="P"+n[0]+"-"+n[1]++}return t.__}function Za(){for(var t;t=ho.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(Vt),t.__H.__h.forEach(zn),t.__H.__h=[]}catch(e){t.__H.__h=[],F.__e(e,t.__v)}}F.__b=function(t){L=null,Zr&&Zr(t)},F.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),ns&&ns(t,e)},F.__r=function(t){Qr&&Qr(t),Se=0;var e=(L=t.__c).__H;e&&(vn===L?(e.__h=[],L.__h=[],e.__.forEach(function(n){n.__N&&(n.__=n.__N),n.i=n.__N=void 0})):(e.__h.forEach(Vt),e.__h.forEach(zn),e.__h=[],Se=0)),vn=L},F.diffed=function(t){Jr&&Jr(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(ho.push(e)!==1&&qr===F.requestAnimationFrame||((qr=F.requestAnimationFrame)||Qa)(Za)),e.__H.__.forEach(function(n){n.i&&(n.__H=n.i),n.i=void 0})),vn=L=null},F.__c=function(t,e){e.some(function(n){try{n.__h.forEach(Vt),n.__h=n.__h.filter(function(r){return!r.__||zn(r)})}catch(r){e.some(function(s){s.__h&&(s.__h=[])}),e=[],F.__e(r,n.__v)}}),es&&es(t,e)},F.unmount=function(t){ts&&ts(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(r){try{Vt(r)}catch(s){e=s}}),n.__H=void 0,e&&F.__e(e,n.__v))};var rs=typeof requestAnimationFrame=="function";function Qa(t){var e,n=function(){clearTimeout(r),rs&&cancelAnimationFrame(e),setTimeout(t)},r=setTimeout(n,100);rs&&(e=requestAnimationFrame(n))}function Vt(t){var e=L,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),L=e}function zn(t){var e=L;t.__c=t.__(),L=e}function ur(t,e){return!t||t.length!==e.length||e.some(function(n,r){return n!==t[r]})}function mo(t,e){return typeof e=="function"?e(t):e}function _o(t,e){for(var n in e)t[n]=e[n];return t}function Un(t,e){for(var n in t)if(n!=="__source"&&!(n in e))return!0;for(var r in e)if(r!=="__source"&&t[r]!==e[r])return!0;return!1}function Yt(t,e){this.props=t,this.context=e}function go(t,e){function n(s){var o=this.props.ref,i=o==s.ref;return!i&&o&&(o.call?o(null):o.current=null),e?!e(this.props,s)||!i:Un(this.props,s)}function r(s){return this.shouldComponentUpdate=n,me(t,s)}return r.displayName="Memo("+(t.displayName||t.name)+")",r.prototype.isReactComponent=!0,r.__f=!0,r}(Yt.prototype=new fe).isPureReactComponent=!0,Yt.prototype.shouldComponentUpdate=function(t,e){return Un(this.props,t)||Un(this.state,e)};var ss=S.__b;S.__b=function(t){t.type&&t.type.__f&&t.ref&&(t.props.ref=t.ref,t.ref=null),ss&&ss(t)};var Ja=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function yo(t){function e(n){var r=_o({},n);return delete r.ref,t(r,n.ref||null)}return e.$$typeof=Ja,e.render=e,e.prototype.isReactComponent=e.__f=!0,e.displayName="ForwardRef("+(t.displayName||t.name)+")",e}var os=function(t,e){return t==null?null:Pe(Pe(t).map(e))},vo={map:os,forEach:os,count:function(t){return t?Pe(t).length:0},only:function(t){var e=Pe(t);if(e.length!==1)throw"Children.only";return e[0]},toArray:Pe},ec=S.__e;S.__e=function(t,e,n,r){if(t.then){for(var s,o=e;o=o.__;)if((s=o.__c)&&s.__c)return e.__e==null&&(e.__e=n.__e,e.__k=n.__k),s.__c(t,e)}ec(t,e,n,r)};var is=S.unmount;function wo(t,e,n){return t&&(t.__c&&t.__c.__H&&(t.__c.__H.__.forEach(function(r){typeof r.__c=="function"&&r.__c()}),t.__c.__H=null),(t=_o({},t)).__c!=null&&(t.__c.__P===n&&(t.__c.__P=e),t.__c=null),t.__k=t.__k&&t.__k.map(function(r){return wo(r,e,n)})),t}function bo(t,e,n){return t&&n&&(t.__v=null,t.__k=t.__k&&t.__k.map(function(r){return bo(r,e,n)}),t.__c&&t.__c.__P===e&&(t.__e&&n.appendChild(t.__e),t.__c.__e=!0,t.__c.__P=n)),t}function Ie(){this.__u=0,this.t=null,this.__b=null}function Eo(t){var e=t.__.__c;return e&&e.__a&&e.__a(t)}function Y(t){var e,n,r;function s(o){if(e||(e=t()).then(function(i){n=i.default||i},function(i){r=i}),r)throw r;if(!n)throw e;return me(n,o)}return s.displayName="Lazy",s.__f=!0,s}function Ge(){this.u=null,this.o=null}S.unmount=function(t){var e=t.__c;e&&e.__R&&e.__R(),e&&32&t.__u&&(t.type=null),is&&is(t)},(Ie.prototype=new fe).__c=function(t,e){var n=e.__c,r=this;r.t==null&&(r.t=[]),r.t.push(n);var s=Eo(r.__v),o=!1,i=function(){o||(o=!0,n.__R=null,s?s(a):a())};n.__R=i;var a=function(){if(!--r.__u){if(r.state.__a){var c=r.state.__a;r.__v.__k[0]=bo(c,c.__c.__P,c.__c.__O)}var u;for(r.setState({__a:r.__b=null});u=r.t.pop();)u.forceUpdate()}};r.__u++||32&e.__u||r.setState({__a:r.__b=r.__v.__k[0]}),t.then(i,i)},Ie.prototype.componentWillUnmount=function(){this.t=[]},Ie.prototype.render=function(t,e){if(this.__b){if(this.__v.__k){var n=document.createElement("div"),r=this.__v.__k[0].__c;this.__v.__k[0]=wo(this.__b,n,r.__O=r.__P)}this.__b=null}var s=e.__a&&me(pe,null,t.fallback);return s&&(s.__u&=-33),[me(pe,null,e.__a?null:t.children),s]};var as=function(t,e,n){if(++n[1]===n[0]&&t.o.delete(e),t.props.revealOrder&&(t.props.revealOrder[0]!=="t"||!t.o.size))for(n=t.u;n;){for(;n.length>3;)n.pop()();if(n[1]<n[0])break;t.u=n=n[2]}};function tc(t){return this.getChildContext=function(){return t.context},t.children}function nc(t){var e=this,n=t.i;e.componentWillUnmount=function(){Ye(null,e.l),e.l=null,e.i=null},e.i&&e.i!==n&&e.componentWillUnmount(),e.l||(e.i=n,e.l={nodeType:1,parentNode:n,childNodes:[],contains:function(){return!0},appendChild:function(r){this.childNodes.push(r),e.i.appendChild(r)},insertBefore:function(r,s){this.childNodes.push(r),e.i.appendChild(r)},removeChild:function(r){this.childNodes.splice(this.childNodes.indexOf(r)>>>1,1),e.i.removeChild(r)}}),Ye(me(tc,{context:e.context},t.__v),e.l)}function Po(t,e){var n=me(nc,{__v:t,i:e});return n.containerInfo=e,n}(Ge.prototype=new fe).__a=function(t){var e=this,n=Eo(e.__v),r=e.o.get(t);return r[0]++,function(s){var o=function(){e.props.revealOrder?(r.push(s),as(e,t,r)):s()};n?n(o):o()}},Ge.prototype.render=function(t){this.u=null,this.o=new Map;var e=Pe(t.children);t.revealOrder&&t.revealOrder[0]==="b"&&e.reverse();for(var n=e.length;n--;)this.o.set(e[n],this.u=[1,0,this.u]);return t.children},Ge.prototype.componentDidUpdate=Ge.prototype.componentDidMount=function(){var t=this;this.o.forEach(function(e,n){as(t,n,e)})};var So=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,rc=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,sc=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,oc=/[A-Z0-9]/g,ic=typeof document<"u",ac=function(t){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(t)};function xo(t,e,n){return e.__k==null&&(e.textContent=""),Ye(t,e),typeof n=="function"&&n(),t?t.__c:null}function To(t,e,n){return fo(t,e),typeof n=="function"&&n(),t?t.__c:null}fe.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(t){Object.defineProperty(fe.prototype,t,{configurable:!0,get:function(){return this["UNSAFE_"+t]},set:function(e){Object.defineProperty(this,t,{configurable:!0,writable:!0,value:e})}})});var cs=S.event;function cc(){}function lc(){return this.cancelBubble}function uc(){return this.defaultPrevented}S.event=function(t){return cs&&(t=cs(t)),t.persist=cc,t.isPropagationStopped=lc,t.isDefaultPrevented=uc,t.nativeEvent=t};var fr,fc={enumerable:!1,configurable:!0,get:function(){return this.class}},ls=S.vnode;S.vnode=function(t){typeof t.type=="string"&&function(e){var n=e.props,r=e.type,s={};for(var o in n){var i=n[o];if(!(o==="value"&&"defaultValue"in n&&i==null||ic&&o==="children"&&r==="noscript"||o==="class"||o==="className")){var a=o.toLowerCase();o==="defaultValue"&&"value"in n&&n.value==null?o="value":o==="download"&&i===!0?i="":a==="translate"&&i==="no"?i=!1:a==="ondoubleclick"?o="ondblclick":a!=="onchange"||r!=="input"&&r!=="textarea"||ac(n.type)?a==="onfocus"?o="onfocusin":a==="onblur"?o="onfocusout":sc.test(o)?o=a:r.indexOf("-")===-1&&rc.test(o)?o=o.replace(oc,"-$&").toLowerCase():i===null&&(i=void 0):a=o="oninput",a==="oninput"&&s[o=a]&&(o="oninputCapture"),s[o]=i}}r=="select"&&s.multiple&&Array.isArray(s.value)&&(s.value=Pe(n.children).forEach(function(c){c.props.selected=s.value.indexOf(c.props.value)!=-1})),r=="select"&&s.defaultValue!=null&&(s.value=Pe(n.children).forEach(function(c){c.props.selected=s.multiple?s.defaultValue.indexOf(c.props.value)!=-1:s.defaultValue==c.props.value})),n.class&&!n.className?(s.class=n.class,Object.defineProperty(s,"className",fc)):(n.className&&!n.class||n.class&&n.className)&&(s.class=s.className=n.className),e.props=s}(t),t.$$typeof=So,ls&&ls(t)};var us=S.__r;S.__r=function(t){us&&us(t),fr=t.__c};var fs=S.diffed;S.diffed=function(t){fs&&fs(t);var e=t.props,n=t.__e;n!=null&&t.type==="textarea"&&"value"in e&&e.value!==n.value&&(n.value=e.value==null?"":e.value),fr=null};var Ao={ReactCurrentDispatcher:{current:{readContext:function(t){return fr.__n[t.__c].props.value},useCallback:ir,useContext:ar,useDebugValue:cr,useDeferredValue:dr,useEffect:Re,useId:lr,useImperativeHandle:or,useInsertionEffect:mr,useLayoutEffect:tt,useMemo:Pt,useReducer:nn,useRef:qe,useState:Et,useSyncExternalStore:_r,useTransition:hr}}},pc="17.0.2";function Mo(t){return me.bind(null,t)}function St(t){return!!t&&t.$$typeof===So}function Co(t){return St(t)&&t.type===pe}function Lo(t){return!!t&&!!t.displayName&&(typeof t.displayName=="string"||t.displayName instanceof String)&&t.displayName.startsWith("Memo(")}function ko(t){return St(t)?Ga.apply(null,arguments):t}function Do(t){return!!t.__k&&(Ye(null,t),!0)}function Io(t){return t&&(t.base||t.nodeType===1&&t)||null}var Oo=function(t,e){return t(e)},Ro=function(t,e){return t(e)},Fo=pe;function pr(t){t()}function dr(t){return t}function hr(){return[!1,pr]}var mr=tt,Bo=St;function _r(t,e){var n=e(),r=Et({h:{__:n,v:e}}),s=r[0].h,o=r[1];return tt(function(){s.__=n,s.v=e,wn(s)&&o({h:s})},[t,n,e]),Re(function(){return wn(s)&&o({h:s}),t(function(){wn(s)&&o({h:s})})},[t]),n}function wn(t){var e,n,r=t.v,s=t.__;try{var o=r();return!((e=s)===(n=o)&&(e!==0||1/e==1/n)||e!=e&&n!=n)}catch{return!0}}var jo={useState:Et,useId:lr,useReducer:nn,useEffect:Re,useLayoutEffect:tt,useInsertionEffect:mr,useTransition:hr,useDeferredValue:dr,useSyncExternalStore:_r,startTransition:pr,useRef:qe,useImperativeHandle:or,useMemo:Pt,useCallback:ir,useContext:ar,useDebugValue:cr,version:"17.0.2",Children:vo,render:xo,hydrate:To,unmountComponentAtNode:Do,createPortal:Po,createElement:me,createContext:po,createFactory:Mo,cloneElement:ko,createRef:io,Fragment:pe,isValidElement:St,isElement:Bo,isFragment:Co,isMemo:Lo,findDOMNode:Io,Component:fe,PureComponent:Yt,memo:go,forwardRef:yo,flushSync:Ro,unstable_batchedUpdates:Oo,StrictMode:Fo,Suspense:Ie,SuspenseList:Ge,lazy:Y,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:Ao};const dc=Object.freeze(Object.defineProperty({__proto__:null,Children:vo,Component:fe,Fragment:pe,PureComponent:Yt,StrictMode:Fo,Suspense:Ie,SuspenseList:Ge,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:Ao,cloneElement:ko,createContext:po,createElement:me,createFactory:Mo,createPortal:Po,createRef:io,default:jo,findDOMNode:Io,flushSync:Ro,forwardRef:yo,hydrate:To,isElement:Bo,isFragment:Co,isMemo:Lo,isValidElement:St,lazy:Y,memo:go,render:xo,startTransition:pr,unmountComponentAtNode:Do,unstable_batchedUpdates:Oo,useCallback:ir,useContext:ar,useDebugValue:cr,useDeferredValue:dr,useEffect:Re,useErrorBoundary:qa,useId:lr,useImperativeHandle:or,useInsertionEffect:mr,useLayoutEffect:tt,useMemo:Pt,useReducer:nn,useRef:qe,useState:Et,useSyncExternalStore:_r,useTransition:hr,version:pc},Symbol.toStringTag,{value:"Module"})),hc=()=>{const t=qe(!0);return Re(()=>{t.current=!1},[]),t.current};var mc={BASE_URL:"/dl-model/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const ps=t=>{let e;const n=new Set,r=(f,l)=>{const p=typeof f=="function"?f(e):f;if(!Object.is(p,e)){const d=e;e=l??(typeof p!="object"||p===null)?p:Object.assign({},e,p),n.forEach(m=>m(e,d))}},s=()=>e,c={setState:r,getState:s,getInitialState:()=>u,subscribe:f=>(n.add(f),()=>n.delete(f)),destroy:()=>{(mc?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},u=e=t(r,s,c);return c},_c=t=>t?ps(t):ps;var He=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function No(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function gc(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var s=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,s.get?s:{enumerable:!0,get:function(){return t[r]}})}),n}var $o={exports:{}},zo={};const Uo=gc(dc);var Vo={exports:{}},Ho={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ze=Uo;function yc(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var vc=typeof Object.is=="function"?Object.is:yc,wc=Ze.useState,bc=Ze.useEffect,Ec=Ze.useLayoutEffect,Pc=Ze.useDebugValue;function Sc(t,e){var n=e(),r=wc({inst:{value:n,getSnapshot:e}}),s=r[0].inst,o=r[1];return Ec(function(){s.value=n,s.getSnapshot=e,bn(s)&&o({inst:s})},[t,n,e]),bc(function(){return bn(s)&&o({inst:s}),t(function(){bn(s)&&o({inst:s})})},[t]),Pc(n),n}function bn(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!vc(t,n)}catch{return!0}}function xc(t,e){return e()}var Tc=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?xc:Sc;Ho.useSyncExternalStore=Ze.useSyncExternalStore!==void 0?Ze.useSyncExternalStore:Tc;Vo.exports=Ho;var Ac=Vo.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rn=Uo,Mc=Ac;function Cc(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Lc=typeof Object.is=="function"?Object.is:Cc,kc=Mc.useSyncExternalStore,Dc=rn.useRef,Ic=rn.useEffect,Oc=rn.useMemo,Rc=rn.useDebugValue;zo.useSyncExternalStoreWithSelector=function(t,e,n,r,s){var o=Dc(null);if(o.current===null){var i={hasValue:!1,value:null};o.current=i}else i=o.current;o=Oc(function(){function c(d){if(!u){if(u=!0,f=d,d=r(d),s!==void 0&&i.hasValue){var m=i.value;if(s(m,d))return l=m}return l=d}if(m=l,Lc(f,d))return m;var g=r(d);return s!==void 0&&s(m,g)?m:(f=d,l=g)}var u=!1,f,l,p=n===void 0?null:n;return[function(){return c(e())},p===null?void 0:function(){return c(p())}]},[e,n,r,s]);var a=kc(t,o[0],o[1]);return Ic(function(){i.hasValue=!0,i.value=a},[a]),Rc(a),a};$o.exports=zo;var Fc=$o.exports;const Bc=No(Fc);var Wo={BASE_URL:"/dl-model/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{useDebugValue:jc}=jo,{useSyncExternalStoreWithSelector:Nc}=Bc;let ds=!1;const $c=t=>t;function zc(t,e=$c,n){(Wo?"production":void 0)!=="production"&&n&&!ds&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),ds=!0);const r=Nc(t.subscribe,t.getState,t.getServerState||t.getInitialState,e,n);return jc(r),r}const hs=t=>{(Wo?"production":void 0)!=="production"&&typeof t!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const e=typeof t=="function"?_c(t):t,n=(r,s)=>zc(e,r,s);return Object.assign(n,e),n},gr=t=>t?hs(t):hs;var Go=Symbol.for("immer-nothing"),ms=Symbol.for("immer-draftable"),Q=Symbol.for("immer-state");function ue(t,...e){throw new Error(`[Immer] minified error nr: ${t}. Full error at: https://bit.ly/3cXEKWf`)}var Qe=Object.getPrototypeOf;function Je(t){return!!t&&!!t[Q]}function Fe(t){var e;return t?Xo(t)||Array.isArray(t)||!!t[ms]||!!((e=t.constructor)!=null&&e[ms])||on(t)||an(t):!1}var Uc=Object.prototype.constructor.toString();function Xo(t){if(!t||typeof t!="object")return!1;const e=Qe(t);if(e===null)return!0;const n=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return n===Object?!0:typeof n=="function"&&Function.toString.call(n)===Uc}function Kt(t,e){sn(t)===0?Reflect.ownKeys(t).forEach(n=>{e(n,t[n],t)}):t.forEach((n,r)=>e(r,n,t))}function sn(t){const e=t[Q];return e?e.type_:Array.isArray(t)?1:on(t)?2:an(t)?3:0}function Vn(t,e){return sn(t)===2?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function Yo(t,e,n){const r=sn(t);r===2?t.set(e,n):r===3?t.add(n):t[e]=n}function Vc(t,e){return t===e?t!==0||1/t===1/e:t!==t&&e!==e}function on(t){return t instanceof Map}function an(t){return t instanceof Set}function Le(t){return t.copy_||t.base_}function Hn(t,e){if(on(t))return new Map(t);if(an(t))return new Set(t);if(Array.isArray(t))return Array.prototype.slice.call(t);const n=Xo(t);if(e===!0||e==="class_only"&&!n){const r=Object.getOwnPropertyDescriptors(t);delete r[Q];let s=Reflect.ownKeys(r);for(let o=0;o<s.length;o++){const i=s[o],a=r[i];a.writable===!1&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(r[i]={configurable:!0,writable:!0,enumerable:a.enumerable,value:t[i]})}return Object.create(Qe(t),r)}else{const r=Qe(t);if(r!==null&&n)return{...t};const s=Object.create(r);return Object.assign(s,t)}}function yr(t,e=!1){return cn(t)||Je(t)||!Fe(t)||(sn(t)>1&&(t.set=t.add=t.clear=t.delete=Hc),Object.freeze(t),e&&Object.entries(t).forEach(([n,r])=>yr(r,!0))),t}function Hc(){ue(2)}function cn(t){return Object.isFrozen(t)}var Wc={};function Be(t){const e=Wc[t];return e||ue(0,t),e}var yt;function Ko(){return yt}function Gc(t,e){return{drafts_:[],parent_:t,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function _s(t,e){e&&(Be("Patches"),t.patches_=[],t.inversePatches_=[],t.patchListener_=e)}function Wn(t){Gn(t),t.drafts_.forEach(Xc),t.drafts_=null}function Gn(t){t===yt&&(yt=t.parent_)}function gs(t){return yt=Gc(yt,t)}function Xc(t){const e=t[Q];e.type_===0||e.type_===1?e.revoke_():e.revoked_=!0}function ys(t,e){e.unfinalizedDrafts_=e.drafts_.length;const n=e.drafts_[0];return t!==void 0&&t!==n?(n[Q].modified_&&(Wn(e),ue(4)),Fe(t)&&(t=qt(e,t),e.parent_||Zt(e,t)),e.patches_&&Be("Patches").generateReplacementPatches_(n[Q].base_,t,e.patches_,e.inversePatches_)):t=qt(e,n,[]),Wn(e),e.patches_&&e.patchListener_(e.patches_,e.inversePatches_),t!==Go?t:void 0}function qt(t,e,n){if(cn(e))return e;const r=e[Q];if(!r)return Kt(e,(s,o)=>vs(t,r,e,s,o,n)),e;if(r.scope_!==t)return e;if(!r.modified_)return Zt(t,r.base_,!0),r.base_;if(!r.finalized_){r.finalized_=!0,r.scope_.unfinalizedDrafts_--;const s=r.copy_;let o=s,i=!1;r.type_===3&&(o=new Set(s),s.clear(),i=!0),Kt(o,(a,c)=>vs(t,r,s,a,c,n,i)),Zt(t,s,!1),n&&t.patches_&&Be("Patches").generatePatches_(r,n,t.patches_,t.inversePatches_)}return r.copy_}function vs(t,e,n,r,s,o,i){if(Je(s)){const a=o&&e&&e.type_!==3&&!Vn(e.assigned_,r)?o.concat(r):void 0,c=qt(t,s,a);if(Yo(n,r,c),Je(c))t.canAutoFreeze_=!1;else return}else i&&n.add(s);if(Fe(s)&&!cn(s)){if(!t.immer_.autoFreeze_&&t.unfinalizedDrafts_<1)return;qt(t,s),(!e||!e.scope_.parent_)&&typeof r!="symbol"&&Object.prototype.propertyIsEnumerable.call(n,r)&&Zt(t,s)}}function Zt(t,e,n=!1){!t.parent_&&t.immer_.autoFreeze_&&t.canAutoFreeze_&&yr(e,n)}function Yc(t,e){const n=Array.isArray(t),r={type_:n?1:0,scope_:e?e.scope_:Ko(),modified_:!1,finalized_:!1,assigned_:{},parent_:e,base_:t,draft_:null,copy_:null,revoke_:null,isManual_:!1};let s=r,o=vr;n&&(s=[r],o=vt);const{revoke:i,proxy:a}=Proxy.revocable(s,o);return r.draft_=a,r.revoke_=i,a}var vr={get(t,e){if(e===Q)return t;const n=Le(t);if(!Vn(n,e))return Kc(t,n,e);const r=n[e];return t.finalized_||!Fe(r)?r:r===En(t.base_,e)?(Pn(t),t.copy_[e]=Yn(r,t)):r},has(t,e){return e in Le(t)},ownKeys(t){return Reflect.ownKeys(Le(t))},set(t,e,n){const r=qo(Le(t),e);if(r!=null&&r.set)return r.set.call(t.draft_,n),!0;if(!t.modified_){const s=En(Le(t),e),o=s==null?void 0:s[Q];if(o&&o.base_===n)return t.copy_[e]=n,t.assigned_[e]=!1,!0;if(Vc(n,s)&&(n!==void 0||Vn(t.base_,e)))return!0;Pn(t),Xn(t)}return t.copy_[e]===n&&(n!==void 0||e in t.copy_)||Number.isNaN(n)&&Number.isNaN(t.copy_[e])||(t.copy_[e]=n,t.assigned_[e]=!0),!0},deleteProperty(t,e){return En(t.base_,e)!==void 0||e in t.base_?(t.assigned_[e]=!1,Pn(t),Xn(t)):delete t.assigned_[e],t.copy_&&delete t.copy_[e],!0},getOwnPropertyDescriptor(t,e){const n=Le(t),r=Reflect.getOwnPropertyDescriptor(n,e);return r&&{writable:!0,configurable:t.type_!==1||e!=="length",enumerable:r.enumerable,value:n[e]}},defineProperty(){ue(11)},getPrototypeOf(t){return Qe(t.base_)},setPrototypeOf(){ue(12)}},vt={};Kt(vr,(t,e)=>{vt[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}});vt.deleteProperty=function(t,e){return vt.set.call(this,t,e,void 0)};vt.set=function(t,e,n){return vr.set.call(this,t[0],e,n,t[0])};function En(t,e){const n=t[Q];return(n?Le(n):t)[e]}function Kc(t,e,n){var s;const r=qo(e,n);return r?"value"in r?r.value:(s=r.get)==null?void 0:s.call(t.draft_):void 0}function qo(t,e){if(!(e in t))return;let n=Qe(t);for(;n;){const r=Object.getOwnPropertyDescriptor(n,e);if(r)return r;n=Qe(n)}}function Xn(t){t.modified_||(t.modified_=!0,t.parent_&&Xn(t.parent_))}function Pn(t){t.copy_||(t.copy_=Hn(t.base_,t.scope_.immer_.useStrictShallowCopy_))}var qc=class{constructor(t){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,n,r)=>{if(typeof e=="function"&&typeof n!="function"){const o=n;n=e;const i=this;return function(c=o,...u){return i.produce(c,f=>n.call(this,f,...u))}}typeof n!="function"&&ue(6),r!==void 0&&typeof r!="function"&&ue(7);let s;if(Fe(e)){const o=gs(this),i=Yn(e,void 0);let a=!0;try{s=n(i),a=!1}finally{a?Wn(o):Gn(o)}return _s(o,r),ys(s,o)}else if(!e||typeof e!="object"){if(s=n(e),s===void 0&&(s=e),s===Go&&(s=void 0),this.autoFreeze_&&yr(s,!0),r){const o=[],i=[];Be("Patches").generateReplacementPatches_(e,s,o,i),r(o,i)}return s}else ue(1,e)},this.produceWithPatches=(e,n)=>{if(typeof e=="function")return(i,...a)=>this.produceWithPatches(i,c=>e(c,...a));let r,s;return[this.produce(e,n,(i,a)=>{r=i,s=a}),r,s]},typeof(t==null?void 0:t.autoFreeze)=="boolean"&&this.setAutoFreeze(t.autoFreeze),typeof(t==null?void 0:t.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(t.useStrictShallowCopy)}createDraft(t){Fe(t)||ue(8),Je(t)&&(t=Zc(t));const e=gs(this),n=Yn(t,void 0);return n[Q].isManual_=!0,Gn(e),n}finishDraft(t,e){const n=t&&t[Q];(!n||!n.isManual_)&&ue(9);const{scope_:r}=n;return _s(r,e),ys(void 0,r)}setAutoFreeze(t){this.autoFreeze_=t}setUseStrictShallowCopy(t){this.useStrictShallowCopy_=t}applyPatches(t,e){let n;for(n=e.length-1;n>=0;n--){const s=e[n];if(s.path.length===0&&s.op==="replace"){t=s.value;break}}n>-1&&(e=e.slice(n+1));const r=Be("Patches").applyPatches_;return Je(t)?r(t,e):this.produce(t,s=>r(s,e))}};function Yn(t,e){const n=on(t)?Be("MapSet").proxyMap_(t,e):an(t)?Be("MapSet").proxySet_(t,e):Yc(t,e);return(e?e.scope_:Ko()).drafts_.push(n),n}function Zc(t){return Je(t)||ue(10,t),Zo(t)}function Zo(t){if(!Fe(t)||cn(t))return t;const e=t[Q];let n;if(e){if(!e.modified_)return e.base_;e.finalized_=!0,n=Hn(t,e.scope_.immer_.useStrictShallowCopy_)}else n=Hn(t,!0);return Kt(n,(r,s)=>{Yo(n,r,Zo(s))}),e&&(e.finalized_=!1),n}var J=new qc,Qc=J.produce;J.produceWithPatches.bind(J);J.setAutoFreeze.bind(J);J.setUseStrictShallowCopy.bind(J);J.applyPatches.bind(J);J.createDraft.bind(J);J.finishDraft.bind(J);const Qo=t=>({indices:[0,0],_indicesCache:{},setIndex:(e,n)=>{t(r=>{const{indices:s,_indicesCache:o}=r;s[e]=n;const i=s.slice(0,e+1).join(),a=o[i]??[],{length:c}=s;for(let l=0;e+1+l<c;l++)s[e+1+l]=a[l]??0;const u=s.slice(e),f=s.slice(0,e).join();f&&(o[f]=u)})},showFilter:!1,toggleFilter:()=>t(e=>{e.showFilter=!e.showFilter}),searchAll:!1,toggleSearchAll:()=>t(e=>{e.searchAll=!e.searchAll})}),ws=t=>t==="true";function Jo(t,e){return t&&e&&Object.keys(e).forEach(n=>{const r=e[n];typeof r=="object"?(t[n]||(t[n]={}),Jo(t[n],r)):t[n]=r}),t}const Jc=(t,e)=>({category:"Adv",setCategory:n=>t(r=>{r.category=n}),advAni:{category:"home",setCategory:n=>t(r=>{r.advAni.category=n}),home:{gender:"Male",setGender:n=>t(r=>{r.advAni.home.gender=n})},weapon:{type:"Sword",setType:n=>t(r=>{r.advAni.weapon.type=n}),gunMode:"Long",setGunMode:n=>t(r=>{r.advAni.weapon.gunMode=n})},genericSkill:{type:"Sword",setType:n=>t(r=>{r.advAni.genericSkill.type=n})},groupByWeapon:{setGroupWeaponType:(n,r)=>t(s=>{s.advAni.groupByWeapon[n]=r})},uniqueOther:{type:"Sword",setType:n=>t(r=>{r.advAni.uniqueOther.type=n}),selected:"",setSelected:n=>t(r=>{r.advAni.uniqueOther.selected=n})}},extraAni:{category:"Dance",setCategory:n=>t(r=>{r.extraAni.category=n})},personalAni:{source:"",setSource:n=>t(r=>{r.personalAni.source=n}),sourceName:"",setSourceName:n=>t(r=>{r.personalAni.sourceName=n})},getCurrentState:()=>{const n=e();return JSON.parse(JSON.stringify(n))},loadState:(n={})=>{t(r=>Jo(r,n))}}),bs={type:"change"},Sn={type:"start"},Es={type:"end"},Bt=new qi,Ps=new Zi,el=Math.cos(70*H.DEG2RAD);class tl extends Qi{constructor(e,n){super(),this.object=e,this.domElement=n,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new I,this.cursor=new I,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:ze.ROTATE,MIDDLE:ze.DOLLY,RIGHT:ze.PAN},this.touches={ONE:Ue.ROTATE,TWO:Ue.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(h){h.addEventListener("keydown",_n),this._domElementKeyEvents=h},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",_n),this._domElementKeyEvents=null},this.saveState=function(){r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=function(){r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(bs),r.update(),o=s.NONE},this.update=function(){const h=new I,b=new de().setFromUnitVectors(e.up,new I(0,1,0)),M=b.clone().invert(),D=new I,W=new de,Te=new I,ne=2*Math.PI;return function(Xi=null){const Rr=r.object.position;h.copy(Rr).sub(r.target),h.applyQuaternion(b),a.setFromVector3(h),r.autoRotate&&o===s.NONE&&ee(C(Xi)),r.enableDamping?(a.theta+=c.theta*r.dampingFactor,a.phi+=c.phi*r.dampingFactor):(a.theta+=c.theta,a.phi+=c.phi);let ge=r.minAzimuthAngle,ye=r.maxAzimuthAngle;isFinite(ge)&&isFinite(ye)&&(ge<-Math.PI?ge+=ne:ge>Math.PI&&(ge-=ne),ye<-Math.PI?ye+=ne:ye>Math.PI&&(ye-=ne),ge<=ye?a.theta=Math.max(ge,Math.min(ye,a.theta)):a.theta=a.theta>(ge+ye)/2?Math.max(ge,a.theta):Math.min(ye,a.theta)),a.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,a.phi)),a.makeSafe(),r.enableDamping===!0?r.target.addScaledVector(f,r.dampingFactor):r.target.add(f),r.target.sub(r.cursor),r.target.clampLength(r.minTargetRadius,r.maxTargetRadius),r.target.add(r.cursor);let ft=!1;if(r.zoomToCursor&&A||r.object.isOrthographicCamera)a.radius=st(a.radius);else{const ve=a.radius;a.radius=st(a.radius*u),ft=ve!=a.radius}if(h.setFromSpherical(a),h.applyQuaternion(M),Rr.copy(r.target).add(h),r.object.lookAt(r.target),r.enableDamping===!0?(c.theta*=1-r.dampingFactor,c.phi*=1-r.dampingFactor,f.multiplyScalar(1-r.dampingFactor)):(c.set(0,0,0),f.set(0,0,0)),r.zoomToCursor&&A){let ve=null;if(r.object.isPerspectiveCamera){const pt=h.length();ve=st(pt*u);const Rt=pt-ve;r.object.position.addScaledVector(E,Rt),r.object.updateMatrixWorld(),ft=!!Rt}else if(r.object.isOrthographicCamera){const pt=new I(x.x,x.y,0);pt.unproject(r.object);const Rt=r.object.zoom;r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/u)),r.object.updateProjectionMatrix(),ft=Rt!==r.object.zoom;const Fr=new I(x.x,x.y,0);Fr.unproject(r.object),r.object.position.sub(Fr).add(pt),r.object.updateMatrixWorld(),ve=h.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),r.zoomToCursor=!1;ve!==null&&(this.screenSpacePanning?r.target.set(0,0,-1).transformDirection(r.object.matrix).multiplyScalar(ve).add(r.object.position):(Bt.origin.copy(r.object.position),Bt.direction.set(0,0,-1).transformDirection(r.object.matrix),Math.abs(r.object.up.dot(Bt.direction))<el?e.lookAt(r.target):(Ps.setFromNormalAndCoplanarPoint(r.object.up,r.target),Bt.intersectPlane(Ps,r.target))))}else if(r.object.isOrthographicCamera){const ve=r.object.zoom;r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/u)),ve!==r.object.zoom&&(r.object.updateProjectionMatrix(),ft=!0)}return u=1,A=!1,ft||D.distanceToSquared(r.object.position)>i||8*(1-W.dot(r.object.quaternion))>i||Te.distanceToSquared(r.target)>i?(r.dispatchEvent(bs),D.copy(r.object.position),W.copy(r.object.quaternion),Te.copy(r.target),!0):!1}}(),this.dispose=function(){r.domElement.removeEventListener("contextmenu",Ir),r.domElement.removeEventListener("pointerdown",Mr),r.domElement.removeEventListener("pointercancel",ut),r.domElement.removeEventListener("wheel",Cr),r.domElement.removeEventListener("pointermove",mn),r.domElement.removeEventListener("pointerup",ut),r.domElement.getRootNode().removeEventListener("keydown",Lr,{capture:!0}),r._domElementKeyEvents!==null&&(r._domElementKeyEvents.removeEventListener("keydown",_n),r._domElementKeyEvents=null)};const r=this,s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let o=s.NONE;const i=1e-6,a=new Br,c=new Br;let u=1;const f=new I,l=new U,p=new U,d=new U,m=new U,g=new U,y=new U,v=new U,w=new U,_=new U,E=new I,x=new U;let A=!1;const T=[],R={};let z=!1;function C(h){return h!==null?2*Math.PI/60*r.autoRotateSpeed*h:2*Math.PI/60/60*r.autoRotateSpeed}function k(h){const b=Math.abs(h*.01);return Math.pow(.95,r.zoomSpeed*b)}function ee(h){c.theta-=h}function Ne(h){c.phi-=h}const Mt=function(){const h=new I;return function(M,D){h.setFromMatrixColumn(D,0),h.multiplyScalar(-M),f.add(h)}}(),nt=function(){const h=new I;return function(M,D){r.screenSpacePanning===!0?h.setFromMatrixColumn(D,1):(h.setFromMatrixColumn(D,0),h.crossVectors(r.object.up,h)),h.multiplyScalar(M),f.add(h)}}(),K=function(){const h=new I;return function(M,D){const W=r.domElement;if(r.object.isPerspectiveCamera){const Te=r.object.position;h.copy(Te).sub(r.target);let ne=h.length();ne*=Math.tan(r.object.fov/2*Math.PI/180),Mt(2*M*ne/W.clientHeight,r.object.matrix),nt(2*D*ne/W.clientHeight,r.object.matrix)}else r.object.isOrthographicCamera?(Mt(M*(r.object.right-r.object.left)/r.object.zoom/W.clientWidth,r.object.matrix),nt(D*(r.object.top-r.object.bottom)/r.object.zoom/W.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}}();function xe(h){r.object.isPerspectiveCamera||r.object.isOrthographicCamera?u/=h:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function rt(h){r.object.isPerspectiveCamera||r.object.isOrthographicCamera?u*=h:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function te(h,b){if(!r.zoomToCursor)return;A=!0;const M=r.domElement.getBoundingClientRect(),D=h-M.left,W=b-M.top,Te=M.width,ne=M.height;x.x=D/Te*2-1,x.y=-(W/ne)*2+1,E.set(x.x,x.y,1).unproject(r.object).sub(r.object.position).normalize()}function st(h){return Math.max(r.minDistance,Math.min(r.maxDistance,h))}function Ct(h){l.set(h.clientX,h.clientY)}function ot(h){te(h.clientX,h.clientX),v.set(h.clientX,h.clientY)}function _e(h){m.set(h.clientX,h.clientY)}function Lt(h){p.set(h.clientX,h.clientY),d.subVectors(p,l).multiplyScalar(r.rotateSpeed);const b=r.domElement;ee(2*Math.PI*d.x/b.clientHeight),Ne(2*Math.PI*d.y/b.clientHeight),l.copy(p),r.update()}function Ce(h){w.set(h.clientX,h.clientY),_.subVectors(w,v),_.y>0?xe(k(_.y)):_.y<0&&rt(k(_.y)),v.copy(w),r.update()}function it(h){g.set(h.clientX,h.clientY),y.subVectors(g,m).multiplyScalar(r.panSpeed),K(y.x,y.y),m.copy(g),r.update()}function at(h){te(h.clientX,h.clientY),h.deltaY<0?rt(k(h.deltaY)):h.deltaY>0&&xe(k(h.deltaY)),r.update()}function kt(h){let b=!1;switch(h.code){case r.keys.UP:h.ctrlKey||h.metaKey||h.shiftKey?Ne(2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):K(0,r.keyPanSpeed),b=!0;break;case r.keys.BOTTOM:h.ctrlKey||h.metaKey||h.shiftKey?Ne(-2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):K(0,-r.keyPanSpeed),b=!0;break;case r.keys.LEFT:h.ctrlKey||h.metaKey||h.shiftKey?ee(2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):K(r.keyPanSpeed,0),b=!0;break;case r.keys.RIGHT:h.ctrlKey||h.metaKey||h.shiftKey?ee(-2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):K(-r.keyPanSpeed,0),b=!0;break}b&&(h.preventDefault(),r.update())}function ct(h){if(T.length===1)l.set(h.pageX,h.pageY);else{const b=$e(h),M=.5*(h.pageX+b.x),D=.5*(h.pageY+b.y);l.set(M,D)}}function Dt(h){if(T.length===1)m.set(h.pageX,h.pageY);else{const b=$e(h),M=.5*(h.pageX+b.x),D=.5*(h.pageY+b.y);m.set(M,D)}}function lt(h){const b=$e(h),M=h.pageX-b.x,D=h.pageY-b.y,W=Math.sqrt(M*M+D*D);v.set(0,W)}function It(h){r.enableZoom&&lt(h),r.enablePan&&Dt(h)}function Ot(h){r.enableZoom&&lt(h),r.enableRotate&&ct(h)}function xr(h){if(T.length==1)p.set(h.pageX,h.pageY);else{const M=$e(h),D=.5*(h.pageX+M.x),W=.5*(h.pageY+M.y);p.set(D,W)}d.subVectors(p,l).multiplyScalar(r.rotateSpeed);const b=r.domElement;ee(2*Math.PI*d.x/b.clientHeight),Ne(2*Math.PI*d.y/b.clientHeight),l.copy(p)}function Tr(h){if(T.length===1)g.set(h.pageX,h.pageY);else{const b=$e(h),M=.5*(h.pageX+b.x),D=.5*(h.pageY+b.y);g.set(M,D)}y.subVectors(g,m).multiplyScalar(r.panSpeed),K(y.x,y.y),m.copy(g)}function Ar(h){const b=$e(h),M=h.pageX-b.x,D=h.pageY-b.y,W=Math.sqrt(M*M+D*D);w.set(0,W),_.set(0,Math.pow(w.y/v.y,r.zoomSpeed)),xe(_.y),v.copy(w);const Te=(h.pageX+b.x)*.5,ne=(h.pageY+b.y)*.5;te(Te,ne)}function ji(h){r.enableZoom&&Ar(h),r.enablePan&&Tr(h)}function Ni(h){r.enableZoom&&Ar(h),r.enableRotate&&xr(h)}function Mr(h){r.enabled!==!1&&(T.length===0&&(r.domElement.setPointerCapture(h.pointerId),r.domElement.addEventListener("pointermove",mn),r.domElement.addEventListener("pointerup",ut)),!Gi(h)&&(Hi(h),h.pointerType==="touch"?Dr(h):$i(h)))}function mn(h){r.enabled!==!1&&(h.pointerType==="touch"?Vi(h):zi(h))}function ut(h){switch(Wi(h),T.length){case 0:r.domElement.releasePointerCapture(h.pointerId),r.domElement.removeEventListener("pointermove",mn),r.domElement.removeEventListener("pointerup",ut),r.dispatchEvent(Es),o=s.NONE;break;case 1:const b=T[0],M=R[b];Dr({pointerId:b,pageX:M.x,pageY:M.y});break}}function $i(h){let b;switch(h.button){case 0:b=r.mouseButtons.LEFT;break;case 1:b=r.mouseButtons.MIDDLE;break;case 2:b=r.mouseButtons.RIGHT;break;default:b=-1}switch(b){case ze.DOLLY:if(r.enableZoom===!1)return;ot(h),o=s.DOLLY;break;case ze.ROTATE:if(h.ctrlKey||h.metaKey||h.shiftKey){if(r.enablePan===!1)return;_e(h),o=s.PAN}else{if(r.enableRotate===!1)return;Ct(h),o=s.ROTATE}break;case ze.PAN:if(h.ctrlKey||h.metaKey||h.shiftKey){if(r.enableRotate===!1)return;Ct(h),o=s.ROTATE}else{if(r.enablePan===!1)return;_e(h),o=s.PAN}break;default:o=s.NONE}o!==s.NONE&&r.dispatchEvent(Sn)}function zi(h){switch(o){case s.ROTATE:if(r.enableRotate===!1)return;Lt(h);break;case s.DOLLY:if(r.enableZoom===!1)return;Ce(h);break;case s.PAN:if(r.enablePan===!1)return;it(h);break}}function Cr(h){r.enabled===!1||r.enableZoom===!1||o!==s.NONE||(h.preventDefault(),r.dispatchEvent(Sn),at(Ui(h)),r.dispatchEvent(Es))}function Ui(h){const b=h.deltaMode,M={clientX:h.clientX,clientY:h.clientY,deltaY:h.deltaY};switch(b){case 1:M.deltaY*=16;break;case 2:M.deltaY*=100;break}return h.ctrlKey&&!z&&(M.deltaY*=10),M}function Lr(h){h.key==="Control"&&(z=!0,r.domElement.getRootNode().addEventListener("keyup",kr,{passive:!0,capture:!0}))}function kr(h){h.key==="Control"&&(z=!1,r.domElement.getRootNode().removeEventListener("keyup",kr,{passive:!0,capture:!0}))}function _n(h){r.enabled===!1||r.enablePan===!1||kt(h)}function Dr(h){switch(Or(h),T.length){case 1:switch(r.touches.ONE){case Ue.ROTATE:if(r.enableRotate===!1)return;ct(h),o=s.TOUCH_ROTATE;break;case Ue.PAN:if(r.enablePan===!1)return;Dt(h),o=s.TOUCH_PAN;break;default:o=s.NONE}break;case 2:switch(r.touches.TWO){case Ue.DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;It(h),o=s.TOUCH_DOLLY_PAN;break;case Ue.DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;Ot(h),o=s.TOUCH_DOLLY_ROTATE;break;default:o=s.NONE}break;default:o=s.NONE}o!==s.NONE&&r.dispatchEvent(Sn)}function Vi(h){switch(Or(h),o){case s.TOUCH_ROTATE:if(r.enableRotate===!1)return;xr(h),r.update();break;case s.TOUCH_PAN:if(r.enablePan===!1)return;Tr(h),r.update();break;case s.TOUCH_DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;ji(h),r.update();break;case s.TOUCH_DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;Ni(h),r.update();break;default:o=s.NONE}}function Ir(h){r.enabled!==!1&&h.preventDefault()}function Hi(h){T.push(h.pointerId)}function Wi(h){delete R[h.pointerId];for(let b=0;b<T.length;b++)if(T[b]==h.pointerId){T.splice(b,1);return}}function Gi(h){for(let b=0;b<T.length;b++)if(T[b]==h.pointerId)return!0;return!1}function Or(h){let b=R[h.pointerId];b===void 0&&(b=new U,R[h.pointerId]=b),b.set(h.pageX,h.pageY)}function $e(h){const b=h.pointerId===T[0]?T[1]:T[0];return R[b]}r.domElement.addEventListener("contextmenu",Ir),r.domElement.addEventListener("pointerdown",Mr),r.domElement.addEventListener("pointercancel",ut),r.domElement.addEventListener("wheel",Cr,{passive:!1}),r.domElement.getRootNode().addEventListener("keydown",Lr,{passive:!0,capture:!0}),this.update()}}const ei="fbx",ti="animations",nl="img/textures/matcap",ln="data";/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.8.2
*/var se=Uint8Array,Xe=Uint16Array,rl=Int32Array,ni=new se([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ri=new se([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),sl=new se([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),si=function(t,e){for(var n=new Xe(31),r=0;r<31;++r)n[r]=e+=1<<t[r-1];for(var s=new rl(n[30]),r=1;r<30;++r)for(var o=n[r];o<n[r+1];++o)s[o]=o-n[r]<<5|r;return{b:n,r:s}},oi=si(ni,2),ii=oi.b,ol=oi.r;ii[28]=258,ol[258]=28;var il=si(ri,0),al=il.b,Kn=new Xe(32768);for(var O=0;O<32768;++O){var Ae=(O&43690)>>1|(O&21845)<<1;Ae=(Ae&52428)>>2|(Ae&13107)<<2,Ae=(Ae&61680)>>4|(Ae&3855)<<4,Kn[O]=((Ae&65280)>>8|(Ae&255)<<8)>>1}var mt=function(t,e,n){for(var r=t.length,s=0,o=new Xe(e);s<r;++s)t[s]&&++o[t[s]-1];var i=new Xe(e);for(s=1;s<e;++s)i[s]=i[s-1]+o[s-1]<<1;var a;if(n){a=new Xe(1<<e);var c=15-e;for(s=0;s<r;++s)if(t[s])for(var u=s<<4|t[s],f=e-t[s],l=i[t[s]-1]++<<f,p=l|(1<<f)-1;l<=p;++l)a[Kn[l]>>c]=u}else for(a=new Xe(r),s=0;s<r;++s)t[s]&&(a[s]=Kn[i[t[s]-1]++]>>15-t[s]);return a},xt=new se(288);for(var O=0;O<144;++O)xt[O]=8;for(var O=144;O<256;++O)xt[O]=9;for(var O=256;O<280;++O)xt[O]=7;for(var O=280;O<288;++O)xt[O]=8;var ai=new se(32);for(var O=0;O<32;++O)ai[O]=5;var cl=mt(xt,9,1),ll=mt(ai,5,1),xn=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},ae=function(t,e,n){var r=e/8|0;return(t[r]|t[r+1]<<8)>>(e&7)&n},Tn=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(e&7)},ul=function(t){return(t+7)/8|0},fl=function(t,e,n){return(n==null||n>t.length)&&(n=t.length),new se(t.subarray(e,n))},pl=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],le=function(t,e,n){var r=new Error(e||pl[t]);if(r.code=t,Error.captureStackTrace&&Error.captureStackTrace(r,le),!n)throw r;return r},dl=function(t,e,n,r){var s=t.length,o=0;if(!s||e.f&&!e.l)return n||new se(0);var i=!n,a=i||e.i!=2,c=e.i;i&&(n=new se(s*3));var u=function(lt){var It=n.length;if(lt>It){var Ot=new se(Math.max(It*2,lt));Ot.set(n),n=Ot}},f=e.f||0,l=e.p||0,p=e.b||0,d=e.l,m=e.d,g=e.m,y=e.n,v=s*8;do{if(!d){f=ae(t,l,1);var w=ae(t,l+1,3);if(l+=3,w)if(w==1)d=cl,m=ll,g=9,y=5;else if(w==2){var A=ae(t,l,31)+257,T=ae(t,l+10,15)+4,R=A+ae(t,l+5,31)+1;l+=14;for(var z=new se(R),C=new se(19),k=0;k<T;++k)C[sl[k]]=ae(t,l+k*3,7);l+=T*3;for(var ee=xn(C),Ne=(1<<ee)-1,Mt=mt(C,ee,1),k=0;k<R;){var nt=Mt[ae(t,l,Ne)];l+=nt&15;var _=nt>>4;if(_<16)z[k++]=_;else{var K=0,xe=0;for(_==16?(xe=3+ae(t,l,3),l+=2,K=z[k-1]):_==17?(xe=3+ae(t,l,7),l+=3):_==18&&(xe=11+ae(t,l,127),l+=7);xe--;)z[k++]=K}}var rt=z.subarray(0,A),te=z.subarray(A);g=xn(rt),y=xn(te),d=mt(rt,g,1),m=mt(te,y,1)}else le(1);else{var _=ul(l)+4,E=t[_-4]|t[_-3]<<8,x=_+E;if(x>s){c&&le(0);break}a&&u(p+E),n.set(t.subarray(_,x),p),e.b=p+=E,e.p=l=x*8,e.f=f;continue}if(l>v){c&&le(0);break}}a&&u(p+131072);for(var st=(1<<g)-1,Ct=(1<<y)-1,ot=l;;ot=l){var K=d[Tn(t,l)&st],_e=K>>4;if(l+=K&15,l>v){c&&le(0);break}if(K||le(2),_e<256)n[p++]=_e;else if(_e==256){ot=l,d=null;break}else{var Lt=_e-254;if(_e>264){var k=_e-257,Ce=ni[k];Lt=ae(t,l,(1<<Ce)-1)+ii[k],l+=Ce}var it=m[Tn(t,l)&Ct],at=it>>4;it||le(3),l+=it&15;var te=al[at];if(at>3){var Ce=ri[at];te+=Tn(t,l)&(1<<Ce)-1,l+=Ce}if(l>v){c&&le(0);break}a&&u(p+131072);var kt=p+Lt;if(p<te){var ct=o-te,Dt=Math.min(te,kt);for(ct+p<0&&le(3);p<Dt;++p)n[p]=r[ct+p]}for(;p<kt;++p)n[p]=n[p-te]}}e.l=d,e.p=ot,e.b=p,e.f=f,d&&(f=1,e.m=g,e.d=m,e.n=y)}while(!f);return p!=n.length&&i?fl(n,0,p):n.subarray(0,p)},hl=new se(0),ml=function(t,e){return((t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31)&&le(6,"invalid zlib data"),(t[1]>>5&1)==+!e&&le(6,"invalid zlib data: "+(t[1]&32?"need":"unexpected")+" dictionary"),(t[1]>>3&4)+2};function _l(t,e){return dl(t.subarray(ml(t,e),-4),{i:2},e,e)}var gl=typeof TextDecoder<"u"&&new TextDecoder,yl=0;try{gl.decode(hl,{stream:!0}),yl=1}catch{}function ci(t,e,n){const r=n.length-t-1;if(e>=n[r])return r-1;if(e<=n[t])return t;let s=t,o=r,i=Math.floor((s+o)/2);for(;e<n[i]||e>=n[i+1];)e<n[i]?o=i:s=i,i=Math.floor((s+o)/2);return i}function vl(t,e,n,r){const s=[],o=[],i=[];s[0]=1;for(let a=1;a<=n;++a){o[a]=e-r[t+1-a],i[a]=r[t+a]-e;let c=0;for(let u=0;u<a;++u){const f=i[u+1],l=o[a-u],p=s[u]/(f+l);s[u]=c+f*p,c=l*p}s[a]=c}return s}function wl(t,e,n,r){const s=ci(t,r,e),o=vl(s,r,t,e),i=new en(0,0,0,0);for(let a=0;a<=t;++a){const c=n[s-t+a],u=o[a],f=c.w*u;i.x+=c.x*f,i.y+=c.y*f,i.z+=c.z*f,i.w+=c.w*u}return i}function bl(t,e,n,r,s){const o=[];for(let l=0;l<=n;++l)o[l]=0;const i=[];for(let l=0;l<=r;++l)i[l]=o.slice(0);const a=[];for(let l=0;l<=n;++l)a[l]=o.slice(0);a[0][0]=1;const c=o.slice(0),u=o.slice(0);for(let l=1;l<=n;++l){c[l]=e-s[t+1-l],u[l]=s[t+l]-e;let p=0;for(let d=0;d<l;++d){const m=u[d+1],g=c[l-d];a[l][d]=m+g;const y=a[d][l-1]/a[l][d];a[d][l]=p+m*y,p=g*y}a[l][l]=p}for(let l=0;l<=n;++l)i[0][l]=a[l][n];for(let l=0;l<=n;++l){let p=0,d=1;const m=[];for(let g=0;g<=n;++g)m[g]=o.slice(0);m[0][0]=1;for(let g=1;g<=r;++g){let y=0;const v=l-g,w=n-g;l>=g&&(m[d][0]=m[p][0]/a[w+1][v],y=m[d][0]*a[v][w]);const _=v>=-1?1:-v,E=l-1<=w?g-1:n-l;for(let A=_;A<=E;++A)m[d][A]=(m[p][A]-m[p][A-1])/a[w+1][v+A],y+=m[d][A]*a[v+A][w];l<=w&&(m[d][g]=-m[p][g-1]/a[w+1][l],y+=m[d][g]*a[l][w]),i[g][l]=y;const x=p;p=d,d=x}}let f=n;for(let l=1;l<=r;++l){for(let p=0;p<=n;++p)i[l][p]*=f;f*=n-l}return i}function El(t,e,n,r,s){const o=s<t?s:t,i=[],a=ci(t,r,e),c=bl(a,r,t,o,e),u=[];for(let f=0;f<n.length;++f){const l=n[f].clone(),p=l.w;l.x*=p,l.y*=p,l.z*=p,u[f]=l}for(let f=0;f<=o;++f){const l=u[a-t].clone().multiplyScalar(c[f][0]);for(let p=1;p<=t;++p)l.add(u[a-t+p].clone().multiplyScalar(c[f][p]));i[f]=l}for(let f=o+1;f<=s+1;++f)i[f]=new en(0,0,0);return i}function Pl(t,e){let n=1;for(let s=2;s<=t;++s)n*=s;let r=1;for(let s=2;s<=e;++s)r*=s;for(let s=2;s<=t-e;++s)r*=s;return n/r}function Sl(t){const e=t.length,n=[],r=[];for(let o=0;o<e;++o){const i=t[o];n[o]=new I(i.x,i.y,i.z),r[o]=i.w}const s=[];for(let o=0;o<e;++o){const i=n[o].clone();for(let a=1;a<=o;++a)i.sub(s[o-a].clone().multiplyScalar(Pl(o,a)*r[a]));s[o]=i.divideScalar(r[0])}return s}function xl(t,e,n,r,s){const o=El(t,e,n,r,s);return Sl(o)}class Tl extends Ji{constructor(e,n,r,s,o){super(),this.degree=e,this.knots=n,this.controlPoints=[],this.startKnot=s||0,this.endKnot=o||this.knots.length-1;for(let i=0;i<r.length;++i){const a=r[i];this.controlPoints[i]=new en(a.x,a.y,a.z,a.w)}}getPoint(e,n=new I){const r=n,s=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),o=wl(this.degree,this.knots,this.controlPoints,s);return o.w!==1&&o.divideScalar(o.w),r.set(o.x,o.y,o.z)}getTangent(e,n=new I){const r=n,s=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),o=xl(this.degree,this.knots,this.controlPoints,s,1);return r.copy(o[1]).normalize(),r}}let P,N,G;class Al extends On{constructor(e){super(e)}load(e,n,r,s){const o=this,i=o.path===""?ea.extractUrlBase(e):o.path,a=new ta(this.manager);a.setPath(o.path),a.setResponseType("arraybuffer"),a.setRequestHeader(o.requestHeader),a.setWithCredentials(o.withCredentials),a.load(e,function(c){try{n(o.parse(c,i))}catch(u){s?s(u):console.error(u),o.manager.itemError(e)}},r,s)}parse(e,n){if(Il(e))P=new Dl().parse(e);else{const s=pi(e);if(!Ol(s))throw new Error("THREE.FBXLoader: Unknown format.");if(xs(s)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+xs(s));P=new kl().parse(s)}const r=new et(this.manager).setPath(this.resourcePath||n).setCrossOrigin(this.crossOrigin);return new Ml(r,this.manager).parse(P)}}class Ml{constructor(e,n){this.textureLoader=e,this.manager=n}parse(){N=this.parseConnections();const e=this.parseImages(),n=this.parseTextures(e),r=this.parseMaterials(n),s=this.parseDeformers(),o=new Cl().parse(s);return this.parseScene(s,o,r),G}parseConnections(){const e=new Map;return"Connections"in P&&P.Connections.connections.forEach(function(r){const s=r[0],o=r[1],i=r[2];e.has(s)||e.set(s,{parents:[],children:[]});const a={ID:o,relationship:i};e.get(s).parents.push(a),e.has(o)||e.set(o,{parents:[],children:[]});const c={ID:s,relationship:i};e.get(o).children.push(c)}),e}parseImages(){const e={},n={};if("Video"in P.Objects){const r=P.Objects.Video;for(const s in r){const o=r[s],i=parseInt(s);if(e[i]=o.RelativeFilename||o.Filename,"Content"in o){const a=o.Content instanceof ArrayBuffer&&o.Content.byteLength>0,c=typeof o.Content=="string"&&o.Content!=="";if(a||c){const u=this.parseImage(r[s]);n[o.RelativeFilename||o.Filename]=u}}}}for(const r in e){const s=e[r];n[s]!==void 0?e[r]=n[s]:e[r]=e[r].split("\\").pop()}return e}parseImage(e){const n=e.Content,r=e.RelativeFilename||e.Filename,s=r.slice(r.lastIndexOf(".")+1).toLowerCase();let o;switch(s){case"bmp":o="image/bmp";break;case"jpg":case"jpeg":o="image/jpeg";break;case"png":o="image/png";break;case"tif":o="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",r),o="image/tga";break;default:console.warn('FBXLoader: Image type "'+s+'" is not supported.');return}if(typeof n=="string")return"data:"+o+";base64,"+n;{const i=new Uint8Array(n);return window.URL.createObjectURL(new Blob([i],{type:o}))}}parseTextures(e){const n=new Map;if("Texture"in P.Objects){const r=P.Objects.Texture;for(const s in r){const o=this.parseTexture(r[s],e);n.set(parseInt(s),o)}}return n}parseTexture(e,n){const r=this.loadTexture(e,n);r.ID=e.id,r.name=e.attrName;const s=e.WrapModeU,o=e.WrapModeV,i=s!==void 0?s.value:0,a=o!==void 0?o.value:0;if(r.wrapS=i===0?jr:Nr,r.wrapT=a===0?jr:Nr,"Scaling"in e){const c=e.Scaling.value;r.repeat.x=c[0],r.repeat.y=c[1]}if("Translation"in e){const c=e.Translation.value;r.offset.x=c[0],r.offset.y=c[1]}return r}loadTexture(e,n){const r=new Set(["tga","tif","tiff","exr","dds","hdr","ktx2"]),s=e.FileName.split(".").pop().toLowerCase(),o=r.has(s)?this.manager.getHandler(`.${s}`):this.textureLoader;if(!o)return console.warn(`FBXLoader: ${s.toUpperCase()} loader not found, creating placeholder texture for`,e.RelativeFilename),new na;const i=o.path;i||o.setPath(this.textureLoader.path);const a=N.get(e.id).children;let c;a!==void 0&&a.length>0&&n[a[0].ID]!==void 0&&(c=n[a[0].ID],(c.indexOf("blob:")===0||c.indexOf("data:")===0)&&o.setPath(void 0));const u=o.load(c);return o.setPath(i),u}parseMaterials(e){const n=new Map;if("Material"in P.Objects){const r=P.Objects.Material;for(const s in r){const o=this.parseMaterial(r[s],e);o!==null&&n.set(parseInt(s),o)}}return n}parseMaterial(e,n){const r=e.id,s=e.attrName;let o=e.ShadingModel;if(typeof o=="object"&&(o=o.value),!N.has(r))return null;const i=this.parseParameters(e,n,r);let a;switch(o.toLowerCase()){case"phong":a=new gn;break;case"lambert":a=new ra;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',o),a=new gn;break}return a.setValues(i),a.name=s,a}parseParameters(e,n,r){const s={};e.BumpFactor&&(s.bumpScale=e.BumpFactor.value),e.Diffuse?s.color=new V().fromArray(e.Diffuse.value).convertSRGBToLinear():e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(s.color=new V().fromArray(e.DiffuseColor.value).convertSRGBToLinear()),e.DisplacementFactor&&(s.displacementScale=e.DisplacementFactor.value),e.Emissive?s.emissive=new V().fromArray(e.Emissive.value).convertSRGBToLinear():e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(s.emissive=new V().fromArray(e.EmissiveColor.value).convertSRGBToLinear()),e.EmissiveFactor&&(s.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(s.opacity=parseFloat(e.Opacity.value)),s.opacity<1&&(s.transparent=!0),e.ReflectionFactor&&(s.reflectivity=e.ReflectionFactor.value),e.Shininess&&(s.shininess=e.Shininess.value),e.Specular?s.specular=new V().fromArray(e.Specular.value).convertSRGBToLinear():e.SpecularColor&&e.SpecularColor.type==="Color"&&(s.specular=new V().fromArray(e.SpecularColor.value).convertSRGBToLinear());const o=this;return N.get(r).children.forEach(function(i){const a=i.relationship;switch(a){case"Bump":s.bumpMap=o.getTexture(n,i.ID);break;case"Maya|TEX_ao_map":s.aoMap=o.getTexture(n,i.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":s.map=o.getTexture(n,i.ID),s.map!==void 0&&(s.map.colorSpace=oe);break;case"DisplacementColor":s.displacementMap=o.getTexture(n,i.ID);break;case"EmissiveColor":s.emissiveMap=o.getTexture(n,i.ID),s.emissiveMap!==void 0&&(s.emissiveMap.colorSpace=oe);break;case"NormalMap":case"Maya|TEX_normal_map":s.normalMap=o.getTexture(n,i.ID);break;case"ReflectionColor":s.envMap=o.getTexture(n,i.ID),s.envMap!==void 0&&(s.envMap.mapping=sa,s.envMap.colorSpace=oe);break;case"SpecularColor":s.specularMap=o.getTexture(n,i.ID),s.specularMap!==void 0&&(s.specularMap.colorSpace=oe);break;case"TransparentColor":case"TransparencyFactor":s.alphaMap=o.getTexture(n,i.ID),s.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",a);break}}),s}getTexture(e,n){return"LayeredTexture"in P.Objects&&n in P.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),n=N.get(n).children[0].ID),e.get(n)}parseDeformers(){const e={},n={};if("Deformer"in P.Objects){const r=P.Objects.Deformer;for(const s in r){const o=r[s],i=N.get(parseInt(s));if(o.attrType==="Skin"){const a=this.parseSkeleton(i,r);a.ID=s,i.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),a.geometryID=i.parents[0].ID,e[s]=a}else if(o.attrType==="BlendShape"){const a={id:s};a.rawTargets=this.parseMorphTargets(i,r),a.id=s,i.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),n[s]=a}}}return{skeletons:e,morphTargets:n}}parseSkeleton(e,n){const r=[];return e.children.forEach(function(s){const o=n[s.ID];if(o.attrType!=="Cluster")return;const i={ID:s.ID,indices:[],weights:[],transformLink:new j().fromArray(o.TransformLink.a)};"Indexes"in o&&(i.indices=o.Indexes.a,i.weights=o.Weights.a),r.push(i)}),{rawBones:r,bones:[]}}parseMorphTargets(e,n){const r=[];for(let s=0;s<e.children.length;s++){const o=e.children[s],i=n[o.ID],a={name:i.attrName,initialWeight:i.DeformPercent,id:i.id,fullWeights:i.FullWeights.a};if(i.attrType!=="BlendShapeChannel")return;a.geoID=N.get(parseInt(o.ID)).children.filter(function(c){return c.relationship===void 0})[0].ID,r.push(a)}return r}parseScene(e,n,r){G=new $r;const s=this.parseModels(e.skeletons,n,r),o=P.Objects.Model,i=this;s.forEach(function(c){const u=o[c.ID];i.setLookAtProperties(c,u),N.get(c.ID).parents.forEach(function(l){const p=s.get(l.ID);p!==void 0&&p.add(c)}),c.parent===null&&G.add(c)}),this.bindSkeleton(e.skeletons,n,s),this.addGlobalSceneSettings(),G.traverse(function(c){if(c.userData.transformData){c.parent&&(c.userData.transformData.parentMatrix=c.parent.matrix,c.userData.transformData.parentMatrixWorld=c.parent.matrixWorld);const u=ui(c.userData.transformData);c.applyMatrix4(u),c.updateWorldMatrix()}});const a=new Ll().parse();G.children.length===1&&G.children[0].isGroup&&(G.children[0].animations=a,G=G.children[0]),G.animations=a}parseModels(e,n,r){const s=new Map,o=P.Objects.Model;for(const i in o){const a=parseInt(i),c=o[i],u=N.get(a);let f=this.buildSkeleton(u,e,a,c.attrName);if(!f){switch(c.attrType){case"Camera":f=this.createCamera(u);break;case"Light":f=this.createLight(u);break;case"Mesh":f=this.createMesh(u,n,r);break;case"NurbsCurve":f=this.createCurve(u,n);break;case"LimbNode":case"Root":f=new zr;break;case"Null":default:f=new $r;break}f.name=c.attrName?Gt.sanitizeNodeName(c.attrName):"",f.userData.originalName=c.attrName,f.ID=a}this.getTransformData(f,c),s.set(a,f)}return s}buildSkeleton(e,n,r,s){let o=null;return e.parents.forEach(function(i){for(const a in n){const c=n[a];c.rawBones.forEach(function(u,f){if(u.ID===i.ID){const l=o;o=new zr,o.matrixWorld.copy(u.transformLink),o.name=s?Gt.sanitizeNodeName(s):"",o.userData.originalName=s,o.ID=r,c.bones[f]=o,l!==null&&o.add(l)}})}}),o}createCamera(e){let n,r;if(e.children.forEach(function(s){const o=P.Objects.NodeAttribute[s.ID];o!==void 0&&(r=o)}),r===void 0)n=new yn;else{let s=0;r.CameraProjectionType!==void 0&&r.CameraProjectionType.value===1&&(s=1);let o=1;r.NearPlane!==void 0&&(o=r.NearPlane.value/1e3);let i=1e3;r.FarPlane!==void 0&&(i=r.FarPlane.value/1e3);let a=window.innerWidth,c=window.innerHeight;r.AspectWidth!==void 0&&r.AspectHeight!==void 0&&(a=r.AspectWidth.value,c=r.AspectHeight.value);const u=a/c;let f=45;r.FieldOfView!==void 0&&(f=r.FieldOfView.value);const l=r.FocalLength?r.FocalLength.value:null;switch(s){case 0:n=new Xs(f,u,o,i),l!==null&&n.setFocalLength(l);break;case 1:n=new Gs(-a/2,a/2,c/2,-c/2,o,i);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+s+"."),n=new yn;break}}return n}createLight(e){let n,r;if(e.children.forEach(function(s){const o=P.Objects.NodeAttribute[s.ID];o!==void 0&&(r=o)}),r===void 0)n=new yn;else{let s;r.LightType===void 0?s=0:s=r.LightType.value;let o=16777215;r.Color!==void 0&&(o=new V().fromArray(r.Color.value).convertSRGBToLinear());let i=r.Intensity===void 0?1:r.Intensity.value/100;r.CastLightOnObject!==void 0&&r.CastLightOnObject.value===0&&(i=0);let a=0;r.FarAttenuationEnd!==void 0&&(r.EnableFarAttenuation!==void 0&&r.EnableFarAttenuation.value===0?a=0:a=r.FarAttenuationEnd.value);const c=1;switch(s){case 0:n=new Rn(o,i,a,c);break;case 1:n=new Ys(o,i);break;case 2:let u=Math.PI/3;r.InnerAngle!==void 0&&(u=H.degToRad(r.InnerAngle.value));let f=0;r.OuterAngle!==void 0&&(f=H.degToRad(r.OuterAngle.value),f=Math.max(f,1)),n=new oa(o,i,a,u,f,c);break;default:console.warn("THREE.FBXLoader: Unknown light type "+r.LightType.value+", defaulting to a PointLight."),n=new Rn(o,i);break}r.CastShadows!==void 0&&r.CastShadows.value===1&&(n.castShadow=!0)}return n}createMesh(e,n,r){let s,o=null,i=null;const a=[];return e.children.forEach(function(c){n.has(c.ID)&&(o=n.get(c.ID)),r.has(c.ID)&&a.push(r.get(c.ID))}),a.length>1?i=a:a.length>0?i=a[0]:(i=new gn({name:On.DEFAULT_MATERIAL_NAME,color:13421772}),a.push(i)),"color"in o.attributes&&a.forEach(function(c){c.vertexColors=!0}),o.FBX_Deformer?(s=new ia(o,i),s.normalizeSkinWeights()):s=new Ks(o,i),s}createCurve(e,n){const r=e.children.reduce(function(o,i){return n.has(i.ID)&&(o=n.get(i.ID)),o},null),s=new aa({name:On.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new ca(r,s)}getTransformData(e,n){const r={};"InheritType"in n&&(r.inheritType=parseInt(n.InheritType.value)),"RotationOrder"in n?r.eulerOrder=fi(n.RotationOrder.value):r.eulerOrder="ZYX","Lcl_Translation"in n&&(r.translation=n.Lcl_Translation.value),"PreRotation"in n&&(r.preRotation=n.PreRotation.value),"Lcl_Rotation"in n&&(r.rotation=n.Lcl_Rotation.value),"PostRotation"in n&&(r.postRotation=n.PostRotation.value),"Lcl_Scaling"in n&&(r.scale=n.Lcl_Scaling.value),"ScalingOffset"in n&&(r.scalingOffset=n.ScalingOffset.value),"ScalingPivot"in n&&(r.scalingPivot=n.ScalingPivot.value),"RotationOffset"in n&&(r.rotationOffset=n.RotationOffset.value),"RotationPivot"in n&&(r.rotationPivot=n.RotationPivot.value),e.userData.transformData=r}setLookAtProperties(e,n){"LookAtProperty"in n&&N.get(e.ID).children.forEach(function(s){if(s.relationship==="LookAtProperty"){const o=P.Objects.Model[s.ID];if("Lcl_Translation"in o){const i=o.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(i),G.add(e.target)):e.lookAt(new I().fromArray(i))}}})}bindSkeleton(e,n,r){const s=this.parsePoseNodes();for(const o in e){const i=e[o];N.get(parseInt(i.ID)).parents.forEach(function(c){if(n.has(c.ID)){const u=c.ID;N.get(u).parents.forEach(function(l){r.has(l.ID)&&r.get(l.ID).bind(new la(i.bones),s[l.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in P.Objects){const n=P.Objects.Pose;for(const r in n)if(n[r].attrType==="BindPose"&&n[r].NbPoseNodes>0){const s=n[r].PoseNode;Array.isArray(s)?s.forEach(function(o){e[o.Node]=new j().fromArray(o.Matrix.a)}):e[s.Node]=new j().fromArray(s.Matrix.a)}}return e}addGlobalSceneSettings(){if("GlobalSettings"in P){if("AmbientColor"in P.GlobalSettings){const e=P.GlobalSettings.AmbientColor.value,n=e[0],r=e[1],s=e[2];if(n!==0||r!==0||s!==0){const o=new V(n,r,s).convertSRGBToLinear();G.add(new qs(o,1))}}"UnitScaleFactor"in P.GlobalSettings&&(G.userData.unitScaleFactor=P.GlobalSettings.UnitScaleFactor.value)}}}class Cl{constructor(){this.negativeMaterialIndices=!1}parse(e){const n=new Map;if("Geometry"in P.Objects){const r=P.Objects.Geometry;for(const s in r){const o=N.get(parseInt(s)),i=this.parseGeometry(o,r[s],e);n.set(parseInt(s),i)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),n}parseGeometry(e,n,r){switch(n.attrType){case"Mesh":return this.parseMeshGeometry(e,n,r);case"NurbsCurve":return this.parseNurbsGeometry(n)}}parseMeshGeometry(e,n,r){const s=r.skeletons,o=[],i=e.parents.map(function(l){return P.Objects.Model[l.ID]});if(i.length===0)return;const a=e.children.reduce(function(l,p){return s[p.ID]!==void 0&&(l=s[p.ID]),l},null);e.children.forEach(function(l){r.morphTargets[l.ID]!==void 0&&o.push(r.morphTargets[l.ID])});const c=i[0],u={};"RotationOrder"in c&&(u.eulerOrder=fi(c.RotationOrder.value)),"InheritType"in c&&(u.inheritType=parseInt(c.InheritType.value)),"GeometricTranslation"in c&&(u.translation=c.GeometricTranslation.value),"GeometricRotation"in c&&(u.rotation=c.GeometricRotation.value),"GeometricScaling"in c&&(u.scale=c.GeometricScaling.value);const f=ui(u);return this.genGeometry(n,a,o,f)}genGeometry(e,n,r,s){const o=new Ut;e.attrName&&(o.name=e.attrName);const i=this.parseGeoNode(e,n),a=this.genBuffers(i),c=new Me(a.vertex,3);if(c.applyMatrix4(s),o.setAttribute("position",c),a.colors.length>0&&o.setAttribute("color",new Me(a.colors,3)),n&&(o.setAttribute("skinIndex",new ua(a.weightsIndices,4)),o.setAttribute("skinWeight",new Me(a.vertexWeights,4)),o.FBX_Deformer=n),a.normal.length>0){const u=new fa().getNormalMatrix(s),f=new Me(a.normal,3);f.applyNormalMatrix(u),o.setAttribute("normal",f)}if(a.uvs.forEach(function(u,f){const l=f===0?"uv":`uv${f}`;o.setAttribute(l,new Me(a.uvs[f],2))}),i.material&&i.material.mappingType!=="AllSame"){let u=a.materialIndex[0],f=0;if(a.materialIndex.forEach(function(l,p){l!==u&&(o.addGroup(f,p-f,u),u=l,f=p)}),o.groups.length>0){const l=o.groups[o.groups.length-1],p=l.start+l.count;p!==a.materialIndex.length&&o.addGroup(p,a.materialIndex.length-p,u)}o.groups.length===0&&o.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(o,e,r,s),o}parseGeoNode(e,n){const r={};if(r.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],r.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(r.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(r.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(r.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){r.uv=[];let s=0;for(;e.LayerElementUV[s];)e.LayerElementUV[s].UV&&r.uv.push(this.parseUVs(e.LayerElementUV[s])),s++}return r.weightTable={},n!==null&&(r.skeleton=n,n.rawBones.forEach(function(s,o){s.indices.forEach(function(i,a){r.weightTable[i]===void 0&&(r.weightTable[i]=[]),r.weightTable[i].push({id:o,weight:s.weights[a]})})})),r}genBuffers(e){const n={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let r=0,s=0,o=!1,i=[],a=[],c=[],u=[],f=[],l=[];const p=this;return e.vertexIndices.forEach(function(d,m){let g,y=!1;d<0&&(d=d^-1,y=!0);let v=[],w=[];if(i.push(d*3,d*3+1,d*3+2),e.color){const _=jt(m,r,d,e.color);c.push(_[0],_[1],_[2])}if(e.skeleton){if(e.weightTable[d]!==void 0&&e.weightTable[d].forEach(function(_){w.push(_.weight),v.push(_.id)}),w.length>4){o||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),o=!0);const _=[0,0,0,0],E=[0,0,0,0];w.forEach(function(x,A){let T=x,R=v[A];E.forEach(function(z,C,k){if(T>z){k[C]=T,T=z;const ee=_[C];_[C]=R,R=ee}})}),v=_,w=E}for(;w.length<4;)w.push(0),v.push(0);for(let _=0;_<4;++_)f.push(w[_]),l.push(v[_])}if(e.normal){const _=jt(m,r,d,e.normal);a.push(_[0],_[1],_[2])}e.material&&e.material.mappingType!=="AllSame"&&(g=jt(m,r,d,e.material)[0],g<0&&(p.negativeMaterialIndices=!0,g=0)),e.uv&&e.uv.forEach(function(_,E){const x=jt(m,r,d,_);u[E]===void 0&&(u[E]=[]),u[E].push(x[0]),u[E].push(x[1])}),s++,y&&(p.genFace(n,e,i,g,a,c,u,f,l,s),r++,s=0,i=[],a=[],c=[],u=[],f=[],l=[])}),n}getNormalNewell(e){const n=new I(0,0,0);for(let r=0;r<e.length;r++){const s=e[r],o=e[(r+1)%e.length];n.x+=(s.y-o.y)*(s.z+o.z),n.y+=(s.z-o.z)*(s.x+o.x),n.z+=(s.x-o.x)*(s.y+o.y)}return n.normalize(),n}getNormalTangentAndBitangent(e){const n=this.getNormalNewell(e),s=(Math.abs(n.z)>.5?new I(0,1,0):new I(0,0,1)).cross(n).normalize(),o=n.clone().cross(s).normalize();return{normal:n,tangent:s,bitangent:o}}flattenVertex(e,n,r){return new U(e.dot(n),e.dot(r))}genFace(e,n,r,s,o,i,a,c,u,f){let l;if(f>3){const p=[],d=n.baseVertexPositions||n.vertexPositions;for(let v=0;v<r.length;v+=3)p.push(new I(d[r[v]],d[r[v+1]],d[r[v+2]]));const{tangent:m,bitangent:g}=this.getNormalTangentAndBitangent(p),y=[];for(const v of p)y.push(this.flattenVertex(v,m,g));l=pa.triangulateShape(y,[])}else l=[[0,1,2]];for(const[p,d,m]of l)e.vertex.push(n.vertexPositions[r[p*3]]),e.vertex.push(n.vertexPositions[r[p*3+1]]),e.vertex.push(n.vertexPositions[r[p*3+2]]),e.vertex.push(n.vertexPositions[r[d*3]]),e.vertex.push(n.vertexPositions[r[d*3+1]]),e.vertex.push(n.vertexPositions[r[d*3+2]]),e.vertex.push(n.vertexPositions[r[m*3]]),e.vertex.push(n.vertexPositions[r[m*3+1]]),e.vertex.push(n.vertexPositions[r[m*3+2]]),n.skeleton&&(e.vertexWeights.push(c[p*4]),e.vertexWeights.push(c[p*4+1]),e.vertexWeights.push(c[p*4+2]),e.vertexWeights.push(c[p*4+3]),e.vertexWeights.push(c[d*4]),e.vertexWeights.push(c[d*4+1]),e.vertexWeights.push(c[d*4+2]),e.vertexWeights.push(c[d*4+3]),e.vertexWeights.push(c[m*4]),e.vertexWeights.push(c[m*4+1]),e.vertexWeights.push(c[m*4+2]),e.vertexWeights.push(c[m*4+3]),e.weightsIndices.push(u[p*4]),e.weightsIndices.push(u[p*4+1]),e.weightsIndices.push(u[p*4+2]),e.weightsIndices.push(u[p*4+3]),e.weightsIndices.push(u[d*4]),e.weightsIndices.push(u[d*4+1]),e.weightsIndices.push(u[d*4+2]),e.weightsIndices.push(u[d*4+3]),e.weightsIndices.push(u[m*4]),e.weightsIndices.push(u[m*4+1]),e.weightsIndices.push(u[m*4+2]),e.weightsIndices.push(u[m*4+3])),n.color&&(e.colors.push(i[p*3]),e.colors.push(i[p*3+1]),e.colors.push(i[p*3+2]),e.colors.push(i[d*3]),e.colors.push(i[d*3+1]),e.colors.push(i[d*3+2]),e.colors.push(i[m*3]),e.colors.push(i[m*3+1]),e.colors.push(i[m*3+2])),n.material&&n.material.mappingType!=="AllSame"&&(e.materialIndex.push(s),e.materialIndex.push(s),e.materialIndex.push(s)),n.normal&&(e.normal.push(o[p*3]),e.normal.push(o[p*3+1]),e.normal.push(o[p*3+2]),e.normal.push(o[d*3]),e.normal.push(o[d*3+1]),e.normal.push(o[d*3+2]),e.normal.push(o[m*3]),e.normal.push(o[m*3+1]),e.normal.push(o[m*3+2])),n.uv&&n.uv.forEach(function(g,y){e.uvs[y]===void 0&&(e.uvs[y]=[]),e.uvs[y].push(a[y][p*2]),e.uvs[y].push(a[y][p*2+1]),e.uvs[y].push(a[y][d*2]),e.uvs[y].push(a[y][d*2+1]),e.uvs[y].push(a[y][m*2]),e.uvs[y].push(a[y][m*2+1])})}addMorphTargets(e,n,r,s){if(r.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const o=this;r.forEach(function(i){i.rawTargets.forEach(function(a){const c=P.Objects.Geometry[a.geoID];c!==void 0&&o.genMorphGeometry(e,n,c,s,a.name)})})}genMorphGeometry(e,n,r,s,o){const i=n.Vertices!==void 0?n.Vertices.a:[],a=n.PolygonVertexIndex!==void 0?n.PolygonVertexIndex.a:[],c=r.Vertices!==void 0?r.Vertices.a:[],u=r.Indexes!==void 0?r.Indexes.a:[],f=e.attributes.position.count*3,l=new Float32Array(f);for(let g=0;g<u.length;g++){const y=u[g]*3;l[y]=c[g*3],l[y+1]=c[g*3+1],l[y+2]=c[g*3+2]}const p={vertexIndices:a,vertexPositions:l,baseVertexPositions:i},d=this.genBuffers(p),m=new Me(d.vertex,3);m.name=o||r.attrName,m.applyMatrix4(s),e.morphAttributes.position.push(m)}parseNormals(e){const n=e.MappingInformationType,r=e.ReferenceInformationType,s=e.Normals.a;let o=[];return r==="IndexToDirect"&&("NormalIndex"in e?o=e.NormalIndex.a:"NormalsIndex"in e&&(o=e.NormalsIndex.a)),{dataSize:3,buffer:s,indices:o,mappingType:n,referenceType:r}}parseUVs(e){const n=e.MappingInformationType,r=e.ReferenceInformationType,s=e.UV.a;let o=[];return r==="IndexToDirect"&&(o=e.UVIndex.a),{dataSize:2,buffer:s,indices:o,mappingType:n,referenceType:r}}parseVertexColors(e){const n=e.MappingInformationType,r=e.ReferenceInformationType,s=e.Colors.a;let o=[];r==="IndexToDirect"&&(o=e.ColorIndex.a);for(let i=0,a=new V;i<s.length;i+=4)a.fromArray(s,i).convertSRGBToLinear().toArray(s,i);return{dataSize:4,buffer:s,indices:o,mappingType:n,referenceType:r}}parseMaterialIndices(e){const n=e.MappingInformationType,r=e.ReferenceInformationType;if(n==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:r};const s=e.Materials.a,o=[];for(let i=0;i<s.length;++i)o.push(i);return{dataSize:1,buffer:s,indices:o,mappingType:n,referenceType:r}}parseNurbsGeometry(e){const n=parseInt(e.Order);if(isNaN(n))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new Ut;const r=n-1,s=e.KnotVector.a,o=[],i=e.Points.a;for(let l=0,p=i.length;l<p;l+=4)o.push(new en().fromArray(i,l));let a,c;if(e.Form==="Closed")o.push(o[0]);else if(e.Form==="Periodic"){a=r,c=s.length-1-a;for(let l=0;l<r;++l)o.push(o[l])}const f=new Tl(r,s,o,a,c).getPoints(o.length*12);return new Ut().setFromPoints(f)}}class Ll{parse(){const e=[],n=this.parseClips();if(n!==void 0)for(const r in n){const s=n[r],o=this.addClip(s);e.push(o)}return e}parseClips(){if(P.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const n=this.parseAnimationLayers(e);return this.parseAnimStacks(n)}parseAnimationCurveNodes(){const e=P.Objects.AnimationCurveNode,n=new Map;for(const r in e){const s=e[r];if(s.attrName.match(/S|R|T|DeformPercent/)!==null){const o={id:s.id,attr:s.attrName,curves:{}};n.set(o.id,o)}}return n}parseAnimationCurves(e){const n=P.Objects.AnimationCurve;for(const r in n){const s={id:n[r].id,times:n[r].KeyTime.a.map(Rl),values:n[r].KeyValueFloat.a},o=N.get(s.id);if(o!==void 0){const i=o.parents[0].ID,a=o.parents[0].relationship;a.match(/X/)?e.get(i).curves.x=s:a.match(/Y/)?e.get(i).curves.y=s:a.match(/Z/)?e.get(i).curves.z=s:a.match(/DeformPercent/)&&e.has(i)&&(e.get(i).curves.morph=s)}}}parseAnimationLayers(e){const n=P.Objects.AnimationLayer,r=new Map;for(const s in n){const o=[],i=N.get(parseInt(s));i!==void 0&&(i.children.forEach(function(c,u){if(e.has(c.ID)){const f=e.get(c.ID);if(f.curves.x!==void 0||f.curves.y!==void 0||f.curves.z!==void 0){if(o[u]===void 0){const l=N.get(c.ID).parents.filter(function(p){return p.relationship!==void 0})[0].ID;if(l!==void 0){const p=P.Objects.Model[l.toString()];if(p===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",c);return}const d={modelName:p.attrName?Gt.sanitizeNodeName(p.attrName):"",ID:p.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};G.traverse(function(m){m.ID===p.id&&(d.transform=m.matrix,m.userData.transformData&&(d.eulerOrder=m.userData.transformData.eulerOrder))}),d.transform||(d.transform=new j),"PreRotation"in p&&(d.preRotation=p.PreRotation.value),"PostRotation"in p&&(d.postRotation=p.PostRotation.value),o[u]=d}}o[u]&&(o[u][f.attr]=f)}else if(f.curves.morph!==void 0){if(o[u]===void 0){const l=N.get(c.ID).parents.filter(function(v){return v.relationship!==void 0})[0].ID,p=N.get(l).parents[0].ID,d=N.get(p).parents[0].ID,m=N.get(d).parents[0].ID,g=P.Objects.Model[m],y={modelName:g.attrName?Gt.sanitizeNodeName(g.attrName):"",morphName:P.Objects.Deformer[l].attrName};o[u]=y}o[u][f.attr]=f}}}),r.set(parseInt(s),o))}return r}parseAnimStacks(e){const n=P.Objects.AnimationStack,r={};for(const s in n){const o=N.get(parseInt(s)).children;o.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const i=e.get(o[0].ID);r[s]={name:n[s].attrName,layer:i}}return r}addClip(e){let n=[];const r=this;return e.layer.forEach(function(s){n=n.concat(r.generateTracks(s))}),new Zs(e.name,-1,n)}generateTracks(e){const n=[];let r=new I,s=new I;if(e.transform&&e.transform.decompose(r,new de,s),r=r.toArray(),s=s.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const o=this.generateVectorTrack(e.modelName,e.T.curves,r,"position");o!==void 0&&n.push(o)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const o=this.generateRotationTrack(e.modelName,e.R.curves,e.preRotation,e.postRotation,e.eulerOrder);o!==void 0&&n.push(o)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const o=this.generateVectorTrack(e.modelName,e.S.curves,s,"scale");o!==void 0&&n.push(o)}if(e.DeformPercent!==void 0){const o=this.generateMorphTrack(e);o!==void 0&&n.push(o)}return n}generateVectorTrack(e,n,r,s){const o=this.getTimesForAllAxes(n),i=this.getKeyframeTrackValues(o,n,r);return new da(e+"."+s,o,i)}generateRotationTrack(e,n,r,s,o){let i,a;if(n.x!==void 0&&n.y!==void 0&&n.z!==void 0){const l=this.interpolateRotations(n.x,n.y,n.z,o);i=l[0],a=l[1]}r!==void 0&&(r=r.map(H.degToRad),r.push(o),r=new he().fromArray(r),r=new de().setFromEuler(r)),s!==void 0&&(s=s.map(H.degToRad),s.push(o),s=new he().fromArray(s),s=new de().setFromEuler(s).invert());const c=new de,u=new he,f=[];if(!a||!i)return new Ur(e+".quaternion",[0],[0]);for(let l=0;l<a.length;l+=3)u.set(a[l],a[l+1],a[l+2],o),c.setFromEuler(u),r!==void 0&&c.premultiply(r),s!==void 0&&c.multiply(s),l>2&&new de().fromArray(f,(l-3)/3*4).dot(c)<0&&c.set(-c.x,-c.y,-c.z,-c.w),c.toArray(f,l/3*4);return new Ur(e+".quaternion",i,f)}generateMorphTrack(e){const n=e.DeformPercent.curves.morph,r=n.values.map(function(o){return o/100}),s=G.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new ha(e.modelName+".morphTargetInfluences["+s+"]",n.times,r)}getTimesForAllAxes(e){let n=[];if(e.x!==void 0&&(n=n.concat(e.x.times)),e.y!==void 0&&(n=n.concat(e.y.times)),e.z!==void 0&&(n=n.concat(e.z.times)),n=n.sort(function(r,s){return r-s}),n.length>1){let r=1,s=n[0];for(let o=1;o<n.length;o++){const i=n[o];i!==s&&(n[r]=i,s=i,r++)}n=n.slice(0,r)}return n}getKeyframeTrackValues(e,n,r){const s=r,o=[];let i=-1,a=-1,c=-1;return e.forEach(function(u){if(n.x&&(i=n.x.times.indexOf(u)),n.y&&(a=n.y.times.indexOf(u)),n.z&&(c=n.z.times.indexOf(u)),i!==-1){const f=n.x.values[i];o.push(f),s[0]=f}else o.push(s[0]);if(a!==-1){const f=n.y.values[a];o.push(f),s[1]=f}else o.push(s[1]);if(c!==-1){const f=n.z.values[c];o.push(f),s[2]=f}else o.push(s[2])}),o}interpolateRotations(e,n,r,s){const o=[],i=[];o.push(e.times[0]),i.push(H.degToRad(e.values[0])),i.push(H.degToRad(n.values[0])),i.push(H.degToRad(r.values[0]));for(let a=1;a<e.values.length;a++){const c=[e.values[a-1],n.values[a-1],r.values[a-1]];if(isNaN(c[0])||isNaN(c[1])||isNaN(c[2]))continue;const u=c.map(H.degToRad),f=[e.values[a],n.values[a],r.values[a]];if(isNaN(f[0])||isNaN(f[1])||isNaN(f[2]))continue;const l=f.map(H.degToRad),p=[f[0]-c[0],f[1]-c[1],f[2]-c[2]],d=[Math.abs(p[0]),Math.abs(p[1]),Math.abs(p[2])];if(d[0]>=180||d[1]>=180||d[2]>=180){const g=Math.max(...d)/180,y=new he(...u,s),v=new he(...l,s),w=new de().setFromEuler(y),_=new de().setFromEuler(v);w.dot(_)&&_.set(-_.x,-_.y,-_.z,-_.w);const E=e.times[a-1],x=e.times[a]-E,A=new de,T=new he;for(let R=0;R<1;R+=1/g)A.copy(w.clone().slerp(_.clone(),R)),o.push(E+R*x),T.setFromQuaternion(A,s),i.push(T.x),i.push(T.y),i.push(T.z)}else o.push(e.times[a]),i.push(H.degToRad(e.values[a])),i.push(H.degToRad(n.values[a])),i.push(H.degToRad(r.values[a]))}return[o,i]}}class kl{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,n){this.currentProp=e,this.currentPropName=n}parse(e){this.currentIndent=0,this.allNodes=new li,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const n=this,r=e.split(/[\r\n]+/);return r.forEach(function(s,o){const i=s.match(/^[\s\t]*;/),a=s.match(/^[\s\t]*$/);if(i||a)return;const c=s.match("^\\t{"+n.currentIndent+"}(\\w+):(.*){",""),u=s.match("^\\t{"+n.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),f=s.match("^\\t{"+(n.currentIndent-1)+"}}");c?n.parseNodeBegin(s,c):u?n.parseNodeProperty(s,u,r[++o]):f?n.popStack():s.match(/^[^\s\t}]/)&&n.parseNodePropertyContinued(s)}),this.allNodes}parseNodeBegin(e,n){const r=n[1].trim().replace(/^"/,"").replace(/"$/,""),s=n[2].split(",").map(function(c){return c.trim().replace(/^"/,"").replace(/"$/,"")}),o={name:r},i=this.parseNodeAttr(s),a=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(r,o):r in a?(r==="PoseNode"?a.PoseNode.push(o):a[r].id!==void 0&&(a[r]={},a[r][a[r].id]=a[r]),i.id!==""&&(a[r][i.id]=o)):typeof i.id=="number"?(a[r]={},a[r][i.id]=o):r!=="Properties70"&&(r==="PoseNode"?a[r]=[o]:a[r]=o),typeof i.id=="number"&&(o.id=i.id),i.name!==""&&(o.attrName=i.name),i.type!==""&&(o.attrType=i.type),this.pushStack(o)}parseNodeAttr(e){let n=e[0];e[0]!==""&&(n=parseInt(e[0]),isNaN(n)&&(n=e[0]));let r="",s="";return e.length>1&&(r=e[1].replace(/^(\w+)::/,""),s=e[2]),{id:n,name:r,type:s}}parseNodeProperty(e,n,r){let s=n[1].replace(/^"/,"").replace(/"$/,"").trim(),o=n[2].replace(/^"/,"").replace(/"$/,"").trim();s==="Content"&&o===","&&(o=r.replace(/"/g,"").replace(/,$/,"").trim());const i=this.getCurrentNode();if(i.name==="Properties70"){this.parseNodeSpecialProperty(e,s,o);return}if(s==="C"){const c=o.split(",").slice(1),u=parseInt(c[0]),f=parseInt(c[1]);let l=o.split(",").slice(3);l=l.map(function(p){return p.trim().replace(/^"/,"")}),s="connections",o=[u,f],Bl(o,l),i[s]===void 0&&(i[s]=[])}s==="Node"&&(i.id=o),s in i&&Array.isArray(i[s])?i[s].push(o):s!=="a"?i[s]=o:i.a=o,this.setCurrentProp(i,s),s==="a"&&o.slice(-1)!==","&&(i.a=Mn(o))}parseNodePropertyContinued(e){const n=this.getCurrentNode();n.a+=e,e.slice(-1)!==","&&(n.a=Mn(n.a))}parseNodeSpecialProperty(e,n,r){const s=r.split('",').map(function(f){return f.trim().replace(/^\"/,"").replace(/\s/,"_")}),o=s[0],i=s[1],a=s[2],c=s[3];let u=s[4];switch(i){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":u=parseFloat(u);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":u=Mn(u);break}this.getPrevNode()[o]={type:i,type2:a,flag:c,value:u},this.setCurrentProp(this.getPrevNode(),o)}}class Dl{parse(e){const n=new Ss(e);n.skip(23);const r=n.getUint32();if(r<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+r);const s=new li;for(;!this.endOfContent(n);){const o=this.parseNode(n,r);o!==null&&s.add(o.name,o)}return s}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,n){const r={},s=n>=7500?e.getUint64():e.getUint32(),o=n>=7500?e.getUint64():e.getUint32();n>=7500?e.getUint64():e.getUint32();const i=e.getUint8(),a=e.getString(i);if(s===0)return null;const c=[];for(let p=0;p<o;p++)c.push(this.parseProperty(e));const u=c.length>0?c[0]:"",f=c.length>1?c[1]:"",l=c.length>2?c[2]:"";for(r.singleProperty=o===1&&e.getOffset()===s;s>e.getOffset();){const p=this.parseNode(e,n);p!==null&&this.parseSubNode(a,r,p)}return r.propertyList=c,typeof u=="number"&&(r.id=u),f!==""&&(r.attrName=f),l!==""&&(r.attrType=l),a!==""&&(r.name=a),r}parseSubNode(e,n,r){if(r.singleProperty===!0){const s=r.propertyList[0];Array.isArray(s)?(n[r.name]=r,r.a=s):n[r.name]=s}else if(e==="Connections"&&r.name==="C"){const s=[];r.propertyList.forEach(function(o,i){i!==0&&s.push(o)}),n.connections===void 0&&(n.connections=[]),n.connections.push(s)}else if(r.name==="Properties70")Object.keys(r).forEach(function(o){n[o]=r[o]});else if(e==="Properties70"&&r.name==="P"){let s=r.propertyList[0],o=r.propertyList[1];const i=r.propertyList[2],a=r.propertyList[3];let c;s.indexOf("Lcl ")===0&&(s=s.replace("Lcl ","Lcl_")),o.indexOf("Lcl ")===0&&(o=o.replace("Lcl ","Lcl_")),o==="Color"||o==="ColorRGB"||o==="Vector"||o==="Vector3D"||o.indexOf("Lcl_")===0?c=[r.propertyList[4],r.propertyList[5],r.propertyList[6]]:c=r.propertyList[4],n[s]={type:o,type2:i,flag:a,value:c}}else n[r.name]===void 0?typeof r.id=="number"?(n[r.name]={},n[r.name][r.id]=r):n[r.name]=r:r.name==="PoseNode"?(Array.isArray(n[r.name])||(n[r.name]=[n[r.name]]),n[r.name].push(r)):n[r.name][r.id]===void 0&&(n[r.name][r.id]=r)}parseProperty(e){const n=e.getString(1);let r;switch(n){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return r=e.getUint32(),e.getArrayBuffer(r);case"S":return r=e.getUint32(),e.getString(r);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const s=e.getUint32(),o=e.getUint32(),i=e.getUint32();if(o===0)switch(n){case"b":case"c":return e.getBooleanArray(s);case"d":return e.getFloat64Array(s);case"f":return e.getFloat32Array(s);case"i":return e.getInt32Array(s);case"l":return e.getInt64Array(s)}const a=_l(new Uint8Array(e.getArrayBuffer(i))),c=new Ss(a.buffer);switch(n){case"b":case"c":return c.getBooleanArray(s);case"d":return c.getFloat64Array(s);case"f":return c.getFloat32Array(s);case"i":return c.getInt32Array(s);case"l":return c.getInt64Array(s)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+n)}}}class Ss{constructor(e,n){this.dv=new DataView(e),this.offset=0,this.littleEndian=n!==void 0?n:!0,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const n=[];for(let r=0;r<e;r++)n.push(this.getBoolean());return n}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const n=[];for(let r=0;r<e;r++)n.push(this.getInt32());return n}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,n;return this.littleEndian?(e=this.getUint32(),n=this.getUint32()):(n=this.getUint32(),e=this.getUint32()),n&2147483648?(n=~n&4294967295,e=~e&4294967295,e===4294967295&&(n=n+1&4294967295),e=e+1&4294967295,-(n*4294967296+e)):n*4294967296+e}getInt64Array(e){const n=[];for(let r=0;r<e;r++)n.push(this.getInt64());return n}getUint64(){let e,n;return this.littleEndian?(e=this.getUint32(),n=this.getUint32()):(n=this.getUint32(),e=this.getUint32()),n*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const n=[];for(let r=0;r<e;r++)n.push(this.getFloat32());return n}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const n=[];for(let r=0;r<e;r++)n.push(this.getFloat64());return n}getArrayBuffer(e){const n=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,n}getString(e){const n=this.offset;let r=new Uint8Array(this.dv.buffer,n,e);this.skip(e);const s=r.indexOf(0);return s>=0&&(r=new Uint8Array(this.dv.buffer,n,s)),this._textDecoder.decode(r)}}class li{add(e,n){this[e]=n}}function Il(t){const e="Kaydara FBX Binary  \0";return t.byteLength>=e.length&&e===pi(t,0,e.length)}function Ol(t){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let n=0;function r(s){const o=t[s-1];return t=t.slice(n+s),n++,o}for(let s=0;s<e.length;++s)if(r(1)===e[s])return!1;return!0}function xs(t){const e=/FBXVersion: (\d+)/,n=t.match(e);if(n)return parseInt(n[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function Rl(t){return t/46186158e3}const Fl=[];function jt(t,e,n,r){let s;switch(r.mappingType){case"ByPolygonVertex":s=t;break;case"ByPolygon":s=e;break;case"ByVertice":s=n;break;case"AllSame":s=r.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+r.mappingType)}r.referenceType==="IndexToDirect"&&(s=r.indices[s]);const o=s*r.dataSize,i=o+r.dataSize;return jl(Fl,r.buffer,o,i)}const An=new he,Ve=new I;function ui(t){const e=new j,n=new j,r=new j,s=new j,o=new j,i=new j,a=new j,c=new j,u=new j,f=new j,l=new j,p=new j,d=t.inheritType?t.inheritType:0;if(t.translation&&e.setPosition(Ve.fromArray(t.translation)),t.preRotation){const C=t.preRotation.map(H.degToRad);C.push(t.eulerOrder||he.DEFAULT_ORDER),n.makeRotationFromEuler(An.fromArray(C))}if(t.rotation){const C=t.rotation.map(H.degToRad);C.push(t.eulerOrder||he.DEFAULT_ORDER),r.makeRotationFromEuler(An.fromArray(C))}if(t.postRotation){const C=t.postRotation.map(H.degToRad);C.push(t.eulerOrder||he.DEFAULT_ORDER),s.makeRotationFromEuler(An.fromArray(C)),s.invert()}t.scale&&o.scale(Ve.fromArray(t.scale)),t.scalingOffset&&a.setPosition(Ve.fromArray(t.scalingOffset)),t.scalingPivot&&i.setPosition(Ve.fromArray(t.scalingPivot)),t.rotationOffset&&c.setPosition(Ve.fromArray(t.rotationOffset)),t.rotationPivot&&u.setPosition(Ve.fromArray(t.rotationPivot)),t.parentMatrixWorld&&(l.copy(t.parentMatrix),f.copy(t.parentMatrixWorld));const m=n.clone().multiply(r).multiply(s),g=new j;g.extractRotation(f);const y=new j;y.copyPosition(f);const v=y.clone().invert().multiply(f),w=g.clone().invert().multiply(v),_=o,E=new j;if(d===0)E.copy(g).multiply(m).multiply(w).multiply(_);else if(d===1)E.copy(g).multiply(w).multiply(m).multiply(_);else{const k=new j().scale(new I().setFromMatrixScale(l)).clone().invert(),ee=w.clone().multiply(k);E.copy(g).multiply(m).multiply(ee).multiply(_)}const x=u.clone().invert(),A=i.clone().invert();let T=e.clone().multiply(c).multiply(u).multiply(n).multiply(r).multiply(s).multiply(x).multiply(a).multiply(i).multiply(o).multiply(A);const R=new j().copyPosition(T),z=f.clone().multiply(R);return p.copyPosition(z),T=p.clone().multiply(E),T.premultiply(f.invert()),T}function fi(t){t=t||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return t===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[t]}function Mn(t){return t.split(",").map(function(n){return parseFloat(n)})}function pi(t,e,n){return e===void 0&&(e=0),n===void 0&&(n=t.byteLength),new TextDecoder().decode(new Uint8Array(t,e,n))}function Bl(t,e){for(let n=0,r=t.length,s=e.length;n<s;n++,r++)t[r]=e[n]}function jl(t,e,n,r){for(let s=n,o=0;s<r;s++,o++)t[o]=e[s];return t}const di=t=>t&&new Promise(e=>{new Al().load(t,e)}),hi=t=>t&&new Promise(e=>{new et().load(t,e)}),Nl=["px.png","nx.png","py.png","ny.png","pz.png","nz.png"],$l=t=>t&&new Promise(e=>{new ma().setPath(`${t}/`).load(Nl,e)}),zl=["c100007_01","c100007_05","c100007_09","c100034_01","c100035_01","c100036_01","c100037_01","c100041_01"],Ul="https://dgk3593.github.io/dl-model",mi=async t=>t.startsWith("http")?fetch(t):fetch(`${Ul}/${t}`),Vl=async t=>await(await mi(t)).json(),un=async t=>(await Vl(t)).data,Hl=(...t)=>e=>t.reduce((n,r)=>r(n),e),Wl=t=>[...new Set(t)],be=t=>t==="false"?!1:!!t,_i=(t,e,n)=>{if(!e.length)return;const r=e.pop(),s=e.reduce((o,i)=>o==null?void 0:o[i],t);s&&(s[r]=n)};function wr(t){return!!/[0-9A-Fa-f]{6}/.test(t)}function Ht(t){return wr(t)&&!t.startsWith("#")?new V(`#${t}`):new V(t)}async function Gl(t=100){return await new Promise(e=>setTimeout(e,t))}function gi(t,e="="){const[n,...r]=t.split(e),s=r.join(e);return[n,s]}const Xl=t=>t.startsWith("w302"),Ts=([t,...e])=>`${t.toUpperCase()}${e.join("")}`;function Yl(t){return t==="smith"?"dragon":t.endsWith("h")?"story":zl.includes(t)?"spAdventurer":{c:"adventurer",b:"boss",d:"dragon",e:"enemy",h:"high boss",o:"object",r:"raid boss",w:"weapon"}[t[0]]??"other"}function Kl(t=_u){const e=new _a(t);return e.outputColorSpace=oe,e}function ql(t={}){const{fov:e,aspect:n,near:r,far:s}={...yu,...t};return new Xs(e,n,r,s)}async function Zl(t){if(t.startsWith("img:")){const e=t.replace("img:",""),n=await hi(e);return n.colorSpace=oe,n.center.set(.5,0),n}if(t.startsWith("sky:")){const e=t.replace("sky:",""),n=await $l(e);return n.colorSpace=oe,n}if(t==="transparent")return null;if(wr(t)){const e=t.startsWith("#")?t:`#${t}`;return new V(e)}}function Ql(t){var e,n,r,s;(n=(e=t.map)==null?void 0:e.dispose)==null||n.call(e),(s=(r=t.userData.backupMap)==null?void 0:r.dispose)==null||s.call(r),t.dispose()}const yi=t=>{const e=new et().load(t);return e.colorSpace=oe,e};function Jl(t){const e=[],n=[];return t.traverse(r=>{r.isMesh&&e.push(r),r.isBone&&n.push(r)}),[e,n]}function eu(t){var n,r;if(!t)return;[t.material].flat().forEach(s=>{var o,i,a,c,u,f;(i=(o=s.map)==null?void 0:o.dispose)==null||i.call(o),(u=(c=(a=s.userData)==null?void 0:a.backupMap)==null?void 0:c.dispose)==null||u.call(c),(f=s.dispose)==null||f.call(s)}),(r=(n=t.geometry)==null?void 0:n.dispose)==null||r.call(n)}const tu=()=>{const t=new Date,e=t.toDateString().replaceAll(" ","_"),n=t.toLocaleTimeString().replaceAll(":","-").replaceAll(" ","");return`${e}_${n}`},vi=t=>t?t.split("/").reduce((n,r)=>{const[s,o]=r.split("=");return s&&o&&(n[s]=o),n},{}):{},nu=`
varying vec3 vViewPosition;

struct BlinnPhongMaterial {

	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;

};

void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {

	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;

	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );

	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;

}

void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {

	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );

}

#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
`,ru=`
#ifdef USE_MATCAP

	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks
	vec4 matcapColor = texture2D( matcap, uv );

	#ifdef MATCAP_BLENDING_MULTIPLY

		outgoingLight *= matcapColor.rgb;

	#elif defined( MATCAP_BLENDING_ADD )

		outgoingLight += matcapColor.rgb;

	#endif

#endif
`,Nt={name:"MMDToonShader",defines:{TOON:!0,MATCAP:!0,MATCAP_BLENDING_ADD:!0},uniforms:tr.merge([dt.toon.uniforms,dt.phong.uniforms,dt.matcap.uniforms]),vertexShader:dt.phong.vertexShader.replace("#include <envmap_pars_vertex>","").replace("#include <envmap_vertex>",""),fragmentShader:dt.phong.fragmentShader.replace("#include <common>",`
					#ifdef USE_MATCAP
						uniform sampler2D matcap;
					#endif

					#include <common>
				`).replace("#include <envmap_common_pars_fragment>",`
					#include <gradientmap_pars_fragment>
				`).replace("#include <envmap_pars_fragment>","").replace("#include <lights_phong_pars_fragment>",nu).replace("#include <envmap_fragment>",`
					${ru}
				`)};class wi extends _t{constructor(e){super(),this._matcapCombine=Vr,this.emissiveIntensity=1,this.normalMapType=ga,this.combine=Hr,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.lights=!0,this.vertexShader=Nt.vertexShader,this.fragmentShader=Nt.fragmentShader,this.defines=Object.assign({},Nt.defines),Object.defineProperty(this,"matcapCombine",{get:function(){return this._matcapCombine},set:function(r){switch(this._matcapCombine=r,r){case Hr:this.defines.MATCAP_BLENDING_MULTIPLY=!0,delete this.defines.MATCAP_BLENDING_ADD;break;default:case Vr:this.defines.MATCAP_BLENDING_ADD=!0,delete this.defines.MATCAP_BLENDING_MULTIPLY;break}}}),this.uniforms=tr.clone(Nt.uniforms);const n=["specular","shininess","opacity","diffuse","map","matcap","gradientMap","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveMap","bumpMap","bumpScale","normalMap","normalScale","displacemantBias","displacemantMap","displacemantScale","specularMap","alphaMap","envMap","reflectivity","refractionRatio"];for(const r of n)Object.defineProperty(this,r,{get:function(){return this.uniforms[r].value},set:function(s){this.uniforms[r].value=s}});Object.defineProperty(this,"color",Object.getOwnPropertyDescriptor(this,"diffuse")),this.setValues(e)}copy(e){return super.copy(e),this.matcapCombine=e.matcapCombine,this.emissiveIntensity=e.emissiveIntensity,this.normalMapType=e.normalMapType,this.combine=e.combine,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}wi.prototype.isMMDToonMaterial=!0;const su=["color","emissive","specular"],ou=["wireframe","metalness","opacity","roughness","shininess","transparent","emissiveIntensity","transmission","thickness","ior"],bi=["type","flatShading","showTexture","gradientMap","matcap"],iu=[...su,...ou,...bi],au=["transparent","opacity","wireframe","showTexture","color"],cu={Basic:[],Toon:["emissive","emissiveIntensity","gradientMap"],Lambert:["emissive","emissiveIntensity"],Phong:["emissive","emissiveIntensity","specular","shininess","flatShading"],Standard:["emissive","emissiveIntensity","metalness","roughness","flatShading"],Physical:["emissive","emissiveIntensity","metalness","roughness","flatShading","transmission","thickness","ior"],Matcap:["flatShading","matcap"],MMDToon:["emissive","emissiveIntensity","specular","shininess","matcap","gradientMap","flatShading"]},q=t=>`${t}`,Cn=t=>wr(t)?`${t.startsWith("#")?"":"#"}${t}`:t,lu=t=>Array.isArray(t)?t.join(","):t,br={wireframe:{name:"Wireframe",type:"boolean",default:!1,valueMap:be,toString:q},showTexture:{name:"Texture",type:"boolean",default:!0,valueMap:be,toString:q},transparent:{name:"Transparent",type:"boolean",default:!1,valueMap:be,toString:q},flatShading:{name:"Flat Shading",type:"boolean",default:!1,valueMap:be,toString:q},color:{name:"Color",type:"color",default:"#ffffff",valueMap:Ht,toString:Cn},emissive:{name:"Emissive",type:"color",default:"#000000",valueMap:Ht,toString:Cn},opacity:{name:"Opacity",type:"percentage",default:1,min:0,max:1,valueMap:parseFloat,toString:q},emissiveIntensity:{name:"Emissive Intensity",type:"percentage",default:1,min:0,max:1,valueMap:parseFloat,toString:q},specular:{name:"Specular",type:"color",default:"#111111",valueMap:Ht,toString:Cn},metalness:{name:"Metalness",type:"percentage",default:0,min:0,max:1,valueMap:parseFloat,toString:q},roughness:{name:"Roughness",type:"percentage",default:1,min:0,max:1,valueMap:parseFloat,toString:q},shininess:{name:"Shininess",type:"number",default:30,min:1,max:100,valueMap:parseFloat,toString:q},gradientMap:{name:"Gradient Map",type:"select",default:"none",valueMap:Ei,toString:lu},matcap:{name:"Matcap",type:"select",default:"matcap_fresnel.jpg",valueMap:Pi,toString:q},transmission:{name:"Transmission",type:"number",default:1,min:0,max:1,valueMap:parseFloat,toString:q},thickness:{name:"Thickness",type:"number",default:.01,min:0,max:10,valueMap:parseFloat,toString:q},ior:{name:"Index-of-refraction",type:"number",default:1.5,min:1,max:2.333,valueMap:parseFloat,toString:q}},uu=Object.fromEntries(Object.entries(br).map(([t,{default:e}])=>[t,e])),ke={...uu,type:"Basic"},fu=Object.fromEntries(Object.entries(br).map(([t,{valueMap:e}])=>[t,e])),pu=Object.fromEntries(Object.entries(br).map(([t,{toString:e}])=>[t,e])),Ln=t=>[...au,...cu[t]],du=(t,e={})=>{if(t==="MMDToon")return new wi(e);const n=`Mesh${t}Material`;return new Qs[n](e)},As=(t,{matType:e="Basic",texturePath:n="",force:r=!1}={})=>{t.forEach(s=>{const o=[s.material].flat(),i=Array.isArray(s.material);if(!r&&!n){const a=`isMesh${e}Material`;if(!o.some(u=>!u[a]))return}o.forEach((a,c)=>{var l,p,d,m;const u=n?new et().load(n):o[c].map;n&&(u.colorSpace=oe);const f=du(e);if(f.name=a.name,f.map=u,f.userData.backupMap=a.userData.backupMap,n&&((p=(l=a.map)==null?void 0:l.dispose)==null||p.call(l),(m=(d=a.userData.backupMap)==null?void 0:d.dispose)==null||m.call(d)),a.dispose(),i){s.material[c]=f;return}s.material=f})})},hu=t=>Array.isArray(t)?t:t.split(",").map(e=>parseInt(e));function Ei(t){const e=hu(t),n=e.length;if(n<2)return null;const r=Uint8Array.from(e),s=new ya(r,n,1,va);return s.minFilter=s.magFilter=wa,s.generateMipmaps=!1,s}const mu=t=>t.includes("/")||t.includes(":")?t:`${nl}/${t}`;function Pi(t){const e=mu(t);return e?yi(e):null}const _u={alpha:!0,antialias:!0},gu="#cccccc",yu={type:"Perspective",fov:45,aspect:1,far:300,near:.01},vu="c100001_01",We={enabled:!0,size:5,color:"#000000",opacity:1},wu={noBackground:!0,fileName:"screenshot",frameRate:30},bu={frameRate:30,fileName:"ani",appendDate:!0},Ms=1,qn=30,Eu={directional:{color:"#ffffff",intensity:.8,position:[1,0,2]},ambient:{color:"#444444",intensity:1},point:{color:"#ffffff",intensity:1}},kn={"No Mapping":ba,Linear:Ea,Reinhard:Pa,Cineon:Sa,"ACES Filmic":xa},Tt={addEventListener(t,e){if(!e)return;this._listeners??(this._listeners={});const n=this._listeners;return t=t.toLowerCase(),n[t]??(n[t]=[]),n[t].includes(e)||n[t].push(e),e},hasEventListener(t,e){var n,r;return t=t.toLowerCase(),!!((r=(n=this._listeners)==null?void 0:n[t])!=null&&r.includes(e))},removeEventListener(t,e){var s;t=t.toLowerCase();const n=(s=this._listeners)==null?void 0:s[t];if(!n)return;const r=n.indexOf(e);r!==-1&&n.splice(r,1)},dispatchEvent(t){var s,o;const e=(s=t.type)==null?void 0:s.toLowerCase(),n=(o=this._listeners)==null?void 0:o[e];if(!n)return;t.target=this,[...n].forEach(i=>i.call(this,t))},addCountedEventListener(t,e,n=1){const r=this;function s(o){e.call(r,o),n--,n===0&&r.removeEventListener(t,s)}this.addEventListener(t,s)}},Pu={face1:[2,1],face2:[0,0],face3:[1,0],face4:[2,0],face5:[3,0],face6:[0,-1],face7:[1,-1],face8:[2,-1],face9:[3,-1]},Si={},Su=async()=>{const t=await un(`${ln}/face-offset.json`);Object.assign(Si,t)},Cs=t=>Si[t]||[0,0],Zn={},xu=async()=>{const t=await un(`${ln}/camera-position.json`);Object.assign(Zn,t)},Tu=t=>Zn[t]??Zn[t[0]],Qn={},Au=async()=>{const t=await un(`${ln}/control-position.json`);Object.assign(Qn,t)},Mu=t=>Qn[t]??Qn[t[0]],Ls=t=>Pu[`face${t}`],Cu=(t,e)=>{const n={x:0,y:0};if(t!==e){const[r,s]=Ls(e),[o,i]=Ls(t);n.x=o-r,n.y=i-s}return[n.x,n.y]},Lu=(t,e)=>{const n={x:0,y:0};if(t!==e){const[r,s]=Cs(e),[o,i]=Cs(t);n.x=o-r,n.y=i-s}return[n.x,n.y]},fn=t=>new Proxy(Object.assign(t,Tt),{get(e,n){return e[n]},set(e,n,r){return e[n]=r,e.dispatchEvent({type:"change",propName:n,value:r}),!0}}),xi=/mEye_[0-9]/m,Ti=/mMouth_[0-9]/m,ku=/[0-9]{2}/,Ai=["eye","mouth"];function Du(t){const{type:e,meshes:n}=t;return e==="adventurer"?Iu(t):n.some(({name:s})=>s.match(/mEye|mMouth/))?Ou(t):t}function Iu(t){const{meshes:e,id:n}=t,r=u=>`${ei}/${u}/${u}.png`,s=e.find(({name:u})=>u==="mBodyAll"),o={eyeIdx:2,eyeBaseIdx:2,mouthIdx:2,mouthBaseIdx:2,eyeTexture:n,mouthTexture:n},i={type:"uv",reset:function(){this.eyeIdx=this.eyeBaseIdx,this.mouthIdx=this.mouthBaseIdx}},a=u=>([f,l])=>{var w;if(!s)return;const p=`mt${Ts(u)}CH`,d=(w=s.geometry.groups)==null?void 0:w.find(_=>{var E;return((E=s.material[_.materialIndex])==null?void 0:E.name)===p});if(!d)return;const{start:m,count:g}=d,y=m+g,v=s.geometry.attributes.uv;for(let _=m;_<y;_++){const E=v.getX(_)+.25*f,x=v.getY(_)+.25*l;v.setXY(_,E,x)}v.needsUpdate=!0},c=u=>f=>{var m,g;if(!s)return;const l=`mt${Ts(u)}CH`,p=(g=(m=s.material).find)==null?void 0:g.call(m,({name:y})=>y===l);if(!p)return;const d=r(f);p.map.dispose(),p.map=yi(d),p.needsUpdate=!0};return Ai.forEach(u=>{Object.defineProperties(i,{[`${u}Idx`]:{get(){return o[`${u}Idx`]},set(f){const l=parseInt(f),p=this[`${u}Idx`];o[`${u}Idx`]=l;const d=Cu(l,p);a(u)(d)}},[`${u}BaseIdx`]:{get(){return o[`${u}BaseIdx`]},set(f){o[`${u}BaseIdx`]=f,this[`${u}Idx`]=f}},[`${u}Texture`]:{get(){return o[`${u}Texture`]},set(f){const l=this[`${u}Texture`];o[`${u}Texture`]=f,c(u)(f);const p=Lu(f,l);a(u)(p)}}})}),t.face=fn(i),t}function Ou(t){const{meshes:e}=t,[n,r]=Ru(e);[...n,...r].forEach(c=>c.frustumCulled=!1);const s={eye:n,mouth:r},o={eyeIdx:"",eyeBaseIdx:"",mouthIdx:"",mouthBaseIdx:""},i={eyeList:n,mouthList:r,type:"meshes",reset:function(){this.eyeIdx=this.eyeBaseIdx,this.mouthIdx=this.mouthBaseIdx}},a=c=>u=>{s[c].forEach(f=>{const{name:l}=f,p=ku.exec(l)[0];f.visible=parseInt(p)===u})};return Ai.forEach(c=>Object.defineProperties(i,{[`${c}Idx`]:{get(){return o[`${c}Idx`]},set(u){const f=parseInt(u);a(c)(f),o[`${c}Idx`]=`${f}`}},[`${c}BaseIdx`]:{get(){return o[`${c}BaseIdx`]},set(u){o[`${c}BaseIdx`]=u,this[`${c}Idx`]=u}}})),i.eyeBaseIdx=Ms,i.mouthBaseIdx=Ms,t.face=fn(i),t}function Ru(t){const e=t.filter(({name:r})=>r.match(xi)),n=t.filter(({name:r})=>r.match(Ti));return[e,n]}function Fu(t){const{model:e,uniqueId:n}=t,[r,s]=Jl(e);return Object.defineProperty(s,"list",{value:Wl(s.map(({name:o})=>o))}),Object.defineProperty(r,"visible",{get(){return this.filter(({visible:o})=>o)}}),s.forEach(o=>{o.name=`${n}|${o.name}`}),Object.defineProperties(t,{meshes:{get(){return r}},bones:{get(){return s}}})}const Mi={},Bu=async()=>{const t=await un(`${ln}/model-parts.json`);Object.assign(Mi,t)},ju=t=>Mi[t],Nu=/mParts([A-Za-z]+)/,ks=/mParts[A-Za-z]+_([A-Za-z]*)/;function $u(t){const{meshes:e,id:n}=t,r=ju(n),s=[],o=[];if(e.forEach(u=>{var l;let{name:f}=u;if(f!=null&&f.match){if((f.includes("Effect")||f.includes("Extension"))&&(u.visible=!1),(l=r==null?void 0:r.custom)!=null&&l[f]&&(f=u.name=r.custom[f]),f.match(/mParts/)){s.push(u);return}!f.match(xi)&&!f.match(Ti)&&o.push(u)}}),!s.length&&o.length<2)return t;const i=Object.defineProperties({},{list:{get(){return Object.keys(this)},enumerable:!1},reset:{value:function(){this.list.forEach(u=>this[u].reset())},enumerable:!1},others:{get(){return o},enumerable:!1}});if(t.parts=i,!s.length)return t;const a=new Set(s.map(({name:u})=>{var f;return(f=Nu.exec(u))==null?void 0:f[1]}).sort((u,f)=>u>f?1:-1)),c=u=>s.filter(({name:f})=>f.includes(`mParts${u}`)).sort((f,l)=>f.name>l.name?1:-1);return a.forEach(u=>{var y;const f=r==null?void 0:r[u],l=((y=f==null?void 0:f.name)==null?void 0:y.replaceAll(" ","_"))??u,p=f==null?void 0:f.options,d=c(u);d.forEach(v=>v.frustumCulled=!1);const m=d.map(({name:v})=>{var _;const w=((_=ks.exec(v))==null?void 0:_[1])??"default";return(p==null?void 0:p[w])??w}),g=(f==null?void 0:f.default)??m[0];i[l]={_meshes:d,list:m,default:g??m[0]},Object.defineProperties(i[l],{current:{get(){var x;const v=d.filter(({visible:A})=>A).length;if(v===0)return"None";if(v!==1)return"custom";const _=(x=d.find(({visible:A})=>A).name.match(ks))==null?void 0:x[1];return(p==null?void 0:p[_??"default"])??_??"default"},set(v){if(v.toLowerCase()==="none"){this._meshes.forEach((_,E)=>{_.visible=!1});return}if(!this.list.includes(v))return;const w=this.list.indexOf(v);this._meshes.forEach((_,E)=>{_.visible=E===w})}},index:{get(){return this.current==="custom"?NaN:this.list.indexOf(this.current)},set(v){this._meshes.forEach((w,_)=>{w.visible=_===Number(v)})}},reset:{value:function(){this.current=this.default}}})}),i.reset(),t.parts=i,t}const zu=t=>e=>{const n=e.meshes,r={...ke,...t},{type:s}=r;As(n,{force:!0,matType:s});let o={type:s,showTexture:!0},i=Ln(s);const a={get code(){const{type:c,propList:u}=this,f=[];return c!==ke.type&&f.push(`type=${c}`),u.forEach(p=>{const d=pu[p],m=d(this[p]),g=d(ke[p]);m!==g&&f.push(`${p}=${m}`)}),f.join("/").replaceAll("#","")},set code(c){const u=Object.keys(ke),f={...ke,...vi(c)};u.forEach(l=>{this[l]=f[l]})},toString(){const{code:c}=this;return c?`mat=(${c})`:""},get list(){return n.flatMap(({material:c})=>c)},get propList(){return i},set type(c){if(this.type===c)return;i=Ln(c),As(n,{matType:c}),o.type=c;const u={...o};o={showTexture:u.showTexture},i.forEach(f=>this[f]=u[f]),o=u},set flatShading(c){const u=be(c);u!==this.flatShading&&(o.flatShading=u,this.propList.includes("flatShading")&&this.list.forEach(f=>{f.flatShading=u,f.needsUpdate=!0}))},set gradientMap(c){var l,p;if(c===this.gradientMap||(o.gradientMap=c,!this.propList.includes("gradientMap")))return;const u=(l=this.list[0])==null?void 0:l.gradientMap;(p=u==null?void 0:u.dispose)==null||p.call(u);const f=c==="none"?null:Ei(c);this.list.forEach(d=>{d.gradientMap=f,d.needsUpdate=!0})},set showTexture(c){const u=be(c);if(this.showTexture===u)return;o.showTexture=u;const f=u?l=>{l.map=l.userData.backupMap,l.userData.backupMap=null,l.needsUpdate=!0}:l=>{l.userData.backupMap=l.map,l.map=null,l.needsUpdate=!0};this.list.forEach(f)},set matcap(c){var l,p;if(o.matcap===c||(o.matcap=c,!this.propList.includes("matcap")))return;const u=(l=this.list[0])==null?void 0:l.matcap;(p=u==null?void 0:u.dispose)==null||p.call(u);const f=Pi(c);this.list.forEach(d=>{d.matcap=f,d.needsUpdate=!0})}};return iu.forEach(c=>Object.defineProperty(a,c,{get(){return o[c]},...!bi.includes(c)&&{set(u){u!==this[c]&&(o[c]=u,this.propList.includes(c)&&this.list.forEach(f=>f[c]=fu[c](u)))}}})),Ln(s).forEach(c=>a[c]=r[c]),o={...ke,...o},e.material=fn(a),e},Uu=`uniform float opacity;\r
uniform vec3 color;\r
\r
void main() {\r
	gl_FragColor = vec4( color, opacity );\r
}\r
`,Vu=`uniform float size;\r
\r
#include <skinning_pars_vertex>\r
\r
void main() {\r
	#include <skinbase_vertex>\r
	\r
    vec3 transformed = position + normal * 0.0005 * size;\r
        \r
	#include <skinning_vertex>\r
	#include <project_vertex>\r
}`,Hu=t=>new _t({side:Ta,transparent:!0,depthFunc:Aa,vertexShader:Vu,fragmentShader:Uu,uniforms:t});function Wu(t,e){const{material:n}=t,r=Array.isArray(t.material);[n].flat().forEach(Ql),t.material=r?new Array(t.material.length).fill(e):e}function Gu(t,e){const n=Hu(e),r=[],s=["Eff","Extension"];return t.forEach(o=>{const{name:i}=o;if(s.some(c=>i.includes(c)))return;const a=o.clone();a.name=`outline-${o.name}`,Wu(a,n),o.isSkinnedMesh&&a.bind(o.skeleton,o.bindMatrix),o.add(a),r.push(a)}),r}const Xu={size:parseFloat,opacity:parseFloat,color:Ht},Yu=t=>e=>{const n={...We,...t},r=e.meshes,s={size:{value:n.size},opacity:{value:n.opacity},color:{value:new V(n.color)}},o=Gu(r,s),i={...n,enabled:!0},a={get propList(){return["enabled","color","size","opacity"]},get enabled(){return i.enabled},set enabled(c){const u=be(c);o.forEach(f=>f.visible=u),i.enabled=u},get code(){if(!this.enabled)return"none";const c=[];return Object.keys(We).forEach(u=>{const f=this[u];f!==We[u]&&c.push(`${u}=${f}`)}),c.join("/").replaceAll("#","")},set code(c){if(c==="none"){this.enabled=!1;return}const u=Object.keys(We),f={...We,...vi(c)};u.forEach(l=>{this[l]=f[l]})},toString(){const{code:c}=this;return c?`ol=(${c})`:""}};return["size","opacity","color"].forEach(c=>Object.defineProperty(a,c,{get(){return i[c]},set(u){u!==this[c]&&(i[c]=u,s[c].value=Xu[c](u))}})),a.enabled=n.enabled,e.outline=fn(a),e},Ku=["push","pop","shift","unshift","splice","reverse","sort"];class Ee extends Array{constructor(...e){super(...e),Object.assign(this,Tt),Ku.forEach(n=>{Object.defineProperty(this,n,{value:(...r)=>{Array.prototype[n].call(this,...r),this.dispatchEvent({type:"change",method:n,args:r})},enumerable:!1})})}remove(e){const n=this.indexOf(e);n!==-1&&this.splice(n,1)}}const Ds={chainName:"",chainCode:"",chainLength:0,aniIdx:0,clipDuration:0,clipTimeScale:1,action:null,aniAction:[],aniActionPointer:0};function Ci(t){return t.split(">").map(qu)}function qu(t){const[e,...n]=t.split("&"),r=Zu(n);return{aniName:e,...r}}function Zu(t){const e={},n=[],r={r:{name:"reps",map:parseInt},ts:{name:"timeScale",map:parseFloat},dur:{name:"duration",map:Qu}};return t.forEach(s=>{const[o,i]=gi(s);if(o.startsWith("@")){const u=Ju(i.replace(/[()]/g,""));u.time=parseFloat(o.slice(1)),n.push(u);return}if(!r[o])return;const{name:a,map:c}=r[o];e[a]=c(i)}),e.aniAction=n.filter(({time:s})=>s<=100&&s>=0).sort((s,o)=>s.time-o.time),e}function Qu(t){if(!t)return[0,100];const e=t.split("-").slice(0,2).map(parseFloat),n=e.length===2?e:[0,e[0]];return n.some(r=>r>100||r<0)||n[0]>n[1]?[0,100]:n}function Ju(t){return t.split("/").reduce((n,r)=>{const[s,o]=gi(r);return{...n,...ef(s,o)}},{})}const Is={ei:{name:"face.eyeIdx",valueMap:parseInt},mi:{name:"face.mouthIdx",valueMap:parseInt},et:{name:"face.eyeTexture"},mt:{name:"face.mouthTexture"}};function ef(t,e){if(t in Is){const{name:s,valueMap:o}=Is[t];return{[s]:(o==null?void 0:o(e))??e}}let n=t,r=e;return t.startsWith("att")&&n.replace("att","attachment"),t.startsWith("parts")&&(n+="index",r=parseInt(e)),{[n]:r}}const tf=t=>`${ti}/${t}.json`;function nf(t,e){if(t.startsWith("fbx:"))return rf(t);if(t.startsWith("ex:")){const[,r]=t.split(":"),s=e==null?void 0:e.find(({uuid:o})=>r===o);return Promise.resolve(s.clone())}const n=tf(t);return new Promise(r=>mi(n).then(s=>s.json()).then(s=>Zs.parse(s)).then(r))}async function rf(t){const e=t.replace("fbx:",""),[n,r]=e.split("+"),{animations:s}=await di(n);return r?s.find(({name:o})=>o===r):s[0]}function sf(t,e=null){return Promise.all(t.map(n=>nf(n,e)))}function of(t,e=[]){return t.map((n,r)=>{const s=e[r];if(!s||s[0]===0&&s[1]===100)return n;const o=n.duration*qn,[i,a]=s.map(c=>Math.round(c*o/100));return Ma.subclip(n,n.name,i,a,qn)})}async function af(t,e=null){const n=Ci(t),r=n.map(({aniName:u})=>u),s=n.map(({duration:u})=>u),o=n.map(({aniName:u,duration:f,...l})=>({...l})),i=await sf(r,e),a=of(i,s);return{code:t,clips:a,mod:o,get duration(){return o.some(({timeScale:f})=>f===0)?1/0:a.map((f,l)=>f.duration/Math.abs(o[l].timeScale??1)*(o[l].reps??1)).reduce((f,l)=>f+l,0)}}}const cf=/[a-z][0-9]{6}/;function lf(t){const{model:e,uniqueId:n,bones:r,id:s,viewer:o}=t,i=o.userData.ani,a=new Ca(e),c=(r==null?void 0:r.list)??[],u={...Tt,mixer:a,chain:{},current:{...Ds},toString(){var p;const l=(p=this.chain.default)==null?void 0:p.code;return l?`ani=${l}`:""},async addChain(l,{name:p="default",autoplay:d=!0}={}){var g;if(!l||((g=this.chain[p])==null?void 0:g.code)===l)return;a.stopAllAction();const m=await af(l,i);m.clips.forEach(y=>{y.tracks=y.tracks.reduce((v,w)=>{let _=w.name.split(".")[0];return cf.test(_)&&(w.name.replace(_,s),_=s),c.includes(_)&&(w.name=`${n}|${w.name}`,v.push(w)),v},[])}),this.chain[p]=m,a.addEventListener("finished",f),d&&this.play(p)},play(l=this.current.chainName||"default"){const p=this.chain[l];p&&(this.current.chainName=l,this.current.chainCode=p.code,this.current.chainLength=p.clips.length,this.aniIdx=0)},pause(){this.current.action&&(this.current.action.paused=!0)},resume(){this.current.action&&(this.current.action.paused=!1)},stop(){a.stopAllAction()},reset(){const l=this.current.chainName;this.stop(),this.current={...Ds},this.chain[l]=void 0},update(l){var y;a.update(l);const{current:p}=this,{action:d,aniAction:m,clipDuration:g}=p;if(!(!m[p.aniActionPointer]||!d))for(;(d==null?void 0:d.time)>((y=m[p.aniActionPointer])==null?void 0:y.time)*g/100;)this.applyAniAction(m[p.aniActionPointer]),this.current.aniActionPointer++},applyAniAction(l){t.dispatchEvent({type:"aniAction",id:n,aniAction:l});const{time:p,...d}=l;Object.entries(d).forEach(([m,g])=>{const y=m.split(".");_i(t,y,g)})},nextFrame(l=1,p=qn){if(!this.isPaused)return;const{clipTimeScale:d,clipDuration:m,action:g}=this.current,y=l*d/p;if(g.time+=y,g.time>=m){const v=g.time-m;f(),this.pause(),this.current.action.time+=v*this.current.clipTimeScale}},setTime(l){const{clipDuration:p,action:d}=this.current;!p||l>p||(d.time=l)},get isPaused(){var l;return(l=this.current.action)==null?void 0:l.paused},get aniIdx(){return this.current.aniIdx},set aniIdx(l){if(l>=this.current.chainLength)return;this.current.aniIdx=l,this.current.aniActionPointer=0;const p={type:l===0?"chainStart":"chainMove",index:l,uniqueId:n,chainName:this.current.chainName};this.dispatchEvent(p),a.stopAllAction();const d=this.chain[this.current.chainName],m=d.mod[l],{timeScale:g,reps:y,aniAction:v}=m,w=d.clips[l],_=a.clipAction(w);_.timeScale=g??1,_.setLoop(La,y??1),this.current.clipDuration=w.duration,this.current.action=_,this.current.aniAction=v,this.current.aniActionPointer=0,this.current.clipTimeScale=g??1,_.play()}};function f(){const{aniIdx:l,chainLength:p}=u.current,d=(l+1)%p;if(d===0){u.dispatchEvent({type:"ChainFinished",chainName:u.current.chainName});const{face:m}=t;m&&(m.eyeIdx=m.eyeBaseIdx,m.mouthIdx=m.mouthBaseIdx)}u.aniIdx=d}return t.animation=u,t.addEventListener("TimeUpdated",({dt:l})=>u.update(l)),t}function uf(t){const{model:e,bones:n,uniqueId:r}=t,s={};return Object.defineProperty(s,"list",{get(){return Object.values(this).flat()}}),Object.defineProperty(s,"traverse",{value:function(f){this.list.forEach(l=>{var p,d;f(l),(d=(p=l.attachment)==null?void 0:p.traverse)==null||d.call(p,f)})}}),Object.assign(t,{attachment:s,parent:null,parentBone:"",attach:(f,l="root")=>{s[l]=s[l]??new Ee;const p=l==="root"?e:n.find(({name:d})=>d===`${r}|${l}`);p!=null&&p.add&&(f.detach(),p.add(f.model),s[l].push(f),f.parent=t,f.parentBone=l,t.dispatchEvent({type:"AttachmentChanged"}))},remove:(f,l="")=>{var d,m,g;const p=l||Object.keys(s).find(y=>s[y].indexOf(f)!==-1);p&&((m=(d=s[p]).remove)==null||m.call(d,f),(g=f.model.parent)==null||g.remove(f.model),t.dispatchEvent({type:"AttachmentChanged"}))},detach:()=>{var p;(p=e.parent)==null||p.remove(e);const{parent:f,parentBone:l}=t;f&&(f.remove(t,l),t.parent=t.parentBone=null)},attachTo:(f,l="root")=>{var p;t.detach(),(p=f==null?void 0:f.attach)==null||p.call(f,t,l)}})}function ff(t){const{material:e,id:n}=t,r=Qt.source.fbx,s=Os(n);Xl(n)&&async function(){const c=a(s),u=new et().load(c);u.colorSpace=oe,u.name=s,e.list.forEach(f=>f.map=f.map??u)}();let o=s;Object.defineProperty(t,"texture",{get(){return o},set(c){if(!c){this.texture=s;return}if(c===o)return;const u=a(c),[,f]=i(c),[,l]=i(this.texture),p=e.list.filter(d=>{var m,g,y,v;return((g=(m=d.map)==null?void 0:m.name)==null?void 0:g.includes(l))||((v=(y=d.userData.backupMap)==null?void 0:y.name)==null?void 0:v.includes(l))});p.length&&(async function(){const d=await hi(u);d.name=f,d.colorSpace=oe,p.forEach(m=>{var g,y,v,w;m.map&&((y=(g=m.map).dispose)==null||y.call(g),m.map=d),m.userData.backupMap&&((w=(v=m.userData.backupMap).dispose)==null||w.call(v),m.userData.backupMap=d)})}(),o=c)}});function i(c){const[u,f]=c.split(">"),l=u||n,p=f||Os(l);return[l,p]}function a(c){const[u,f]=i(c);return`${r}/${u}/${f}.png`}return t}const Os=t=>t.match(/_[0-9]{2}/)||t.startsWith("h")?t:`>${t}_01`,pf=`uniform float uTime;\r
uniform float uSpread;\r
uniform float uThreshold;\r
uniform float uSpeed;\r
uniform float uParticleSize;\r
uniform float uAuraSize;\r
\r
attribute float aRandom;\r
\r
varying float vIsParticle;\r
varying float vRandom;\r
\r
#include <skinning_pars_vertex>\r
void main() {\r
    #include <skinbase_vertex>\r
\r
    vec3 transformed = position + normal * 0.005 * uSpread;\r
\r
    #include <skinning_vertex>\r
\r
    vec3 objectNormal = normal;\r
\r
	#include <skinnormal_vertex>\r
    \r
    vec4 viewPosition = viewMatrix * modelMatrix * vec4(transformed, 1.0);\r
    float yDisplacement = fract( uTime * uSpeed + aRandom ) * 0.1;\r
    viewPosition.y += yDisplacement;\r
    viewPosition.x += sin( uTime * aRandom * uSpeed + aRandom ) * 0.02;\r
    \r
    gl_Position = projectionMatrix * viewPosition;\r
    \r
    objectNormal.z *= objectNormal.z > 0.7 ? -1.0 : 1.0;\r
    vIsParticle = objectNormal.z - uThreshold;\r
\r
    gl_PointSize = vIsParticle > 0.0 ? uParticleSize : uAuraSize;\r
    gl_PointSize /= -viewPosition.z;\r
\r
    vRandom = aRandom;\r
}\r
`,df=`uniform sampler2D uTexture;\r
\r
uniform float uTime;\r
uniform float uParticleOpacity;\r
uniform float uAuraOpacity;\r
uniform vec3 uColor;\r
uniform vec3 uColor2;\r
\r
varying float vRandom;\r
varying float vIsParticle;\r
\r
void main(){\r
    vec4 textureColor = texture2D( uTexture, gl_PointCoord );\r
    textureColor.a = length( textureColor.rgb ) ;\r
    textureColor.a *= abs( 1.0 - fract( uTime + vRandom ) ) * 0.5;\r
    textureColor.rgb = mix( uColor, uColor2,  textureColor.a * 2.0 );\r
    textureColor.a *= vIsParticle > 0.0 ? uParticleOpacity * 4.0 : uAuraOpacity;\r
\r
    gl_FragColor = textureColor;\r
    gl_FragColor /= vIsParticle > 0.0 ? 2.0 : 4.0;\r
}\r
`,Wt=[{name:"time",uName:"uTime",defaultValue:0,valueMap:Number},{name:"speed",uName:"uSpeed",defaultValue:1,valueMap:Number},{name:"particleOpacity",uName:"uParticleOpacity",defaultValue:.3,valueMap:Number},{name:"auraOpacity",uName:"uAuraOpacity",defaultValue:.3,valueMap:Number},{name:"particleSize",uName:"uParticleSize",defaultValue:10,valueMap:Number},{name:"auraSize",uName:"uAuraSize",defaultValue:100,valueMap:Number},{name:"spread",uName:"uSpread",defaultValue:5,valueMap:Number},{name:"threshold",uName:"uThreshold",defaultValue:.3,valueMap:Number},{name:"texture",uName:"uTexture",defaultValue:"img/textures/particle/cloud.png",valueMap:t=>new et().load(t)},{name:"color",uName:"uColor",defaultValue:"#ffffff",valueMap:t=>new V(t)},{name:"color2",uName:"uColor2",defaultValue:"#33ffff",valueMap:t=>new V(t)}],hf={aura:["visible",...Wt.slice(1).map(({name:t})=>t)]},mf=(t="aura")=>(e,n={})=>{if(e!=null&&e.length&&t==="aura")return gf(e,n)};function _f(t){return new _t({vertexShader:pf,fragmentShader:df,uniforms:t,transparent:!0,blending:Ia,depthWrite:!1,side:Oa})}function gf(t,e){const n=Wt.map(c=>{const{uName:u,defaultValue:f,valueMap:l}=c,p=(l==null?void 0:l(f))??f;return[u,{value:p}]}),r=Object.fromEntries(n),s=_f(r),o=[];t.forEach(c=>{const{name:u}=c.geometry;if(u.startsWith("mEye")||u.startsWith("mMouth"))return;const f=c.geometry.clone(),l=f.attributes.position.count,p=new Float32Array(l).fill(0).map(()=>Math.random()-.5);f.setAttribute("aRandom",new ka(p,1)),f.deleteAttribute("color"),f.deleteAttribute("uv");const d=new Da(f,s);d.name="aura",c.isSkinnedMesh&&(d.type="SkinnedMesh",d.isSkinnedMesh=!0,d.skeleton=c.skeleton,d.bindMatrix=c.bindMatrix,d.bindMatrixInverse=c.bindMatrixInverse,d.bindMode=c.bindMode,d.bind=c.bind,d.clone=c.clone,d.initBones=c.initBones,d.normalizeSkinWeights=c.normalizeSkinWeights,d.pose=c.pose,d.updateMatrixWorld=c.updateMatrixWorld),c.add(d),o.push(d)});const i={visible:!0},a={name:"aura",onDispose:()=>{},get list(){return o},get propList(){return hf.aura},get visible(){return i.visible},set visible(c){const u=be(c);this.list.forEach(f=>f.visible=u),i.visible=u},dispose(){this.onDispose(),this.list.forEach(c=>{var u,f,l,p,d;(u=c.parent)==null||u.remove(c),(l=(f=c.material).dispose)==null||l.call(f),(d=(p=c.geometry).dispose)==null||d.call(p)})},set code(c){c.split("/").forEach(f=>{const[l,p]=f.split("=");Wt.map(({name:d})=>d).includes(l)&&(this[l]=p)})}};return Wt.forEach(c=>{const{name:u,uName:f,defaultValue:l,valueMap:p}=c;i[u]=l,Object.defineProperty(a,u,{get(){return i[u]},set(d){i[u]=d,r[f].value=(p==null?void 0:p(d))??d}})}),a.onTimeUpdate=({time:c})=>a.time=c,Object.entries(e).forEach(([c,u])=>a[c]=u),a}function yf(t){const{meshes:e}=t,n={list:new Ee,dispose(){this.list.forEach(r=>{var s;return(s=r.dispose)==null?void 0:s.call(r)})},add(r="aura",s={}){const o=mf(r)(e,s);return o.onDispose=()=>this.list.remove(o),this.list.push(o),t.addEventListener("TimeUpdated",o.onTimeUpdate),o}};return t.particle=n,t}const vf=t=>{var a,c;if(t.dispatchEvent({type:"dispose"}),!t)return;const{model:e,meshes:n,outline:r,particle:s,viewer:o}=t;s==null||s.list.forEach(u=>u.dispose()),(a=e.parent)!=null&&a.isScene&&(e.parent.remove(e),o.loadedModel.remove(t)),(c=t.detach)==null||c.call(t),[n.reverse(),r==null?void 0:r.all].flat().forEach(eu)};function wf(t){const{x:e,y:n,z:r}=t;return[e,n,r].map(s=>s||"").join()}const bf={position:",,",rotation:",,",scale:"1,1,1"},Ef={position:"pos",rotation:"rot",scale:"scl"};function Pf(t){return Object.assign(t,{...t.isDLModel&&{toString(){const{id:e,animation:n,outline:r,material:s}=this,o=Object.entries(bf).map(([i,a])=>{const c=wf(this[i]);return c===a?"":`${Ef[i]}=${c}`});return[`id=${e}`,...o,n,r,s].filter(i=>`${i}`).join("/")}},dispose(){const{attachment:e,parent:n,parentBone:r}=this;e.list.forEach(s=>s.dispose()),n==null||n.remove(this,r),this.dispatchEvent({type:"dispose"}),vf(this)}})}const Sf="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Er=(t=21)=>{let e="",n=crypto.getRandomValues(new Uint8Array(t));for(;t--;)e+=Sf[n[t]&63];return e};function xf(t,e){const{id:n,material:r,outline:s,viewer:o}=e,i=[Fu,$u,uf,Yu(s),zu(r),ff,Du,lf,yf,Pf],a={...Tt,isDLModel:!0,model:t,id:n,uniqueId:Er(),type:Yl(n),viewer:o,userData:{},_time:0,update(c){var u;this._time+=c,(u=this.attachment)==null||u.list.forEach(f=>{var l;return(l=f.update)==null?void 0:l.call(f,c)}),this.dispatchEvent({type:"TimeUpdated",dt:c,time:this._time})},set scale(c){var f;if((f=c.includes)!=null&&f.call(c,",")){const[l,p,d]=c.split(",").map(m=>m?parseFloat(m):1);this.model.scale.set(l,p,d);return}const u=Number(c)||1;this.model.scale.set(u,u,u)},get scale(){const{scale:c}=this.model,{x:u,y:f,z:l}=c;return u===f&&u===l?u:[u,f,l].join(",")},set visible(c){this.model.visible=be(c)}};return["position","rotation","visible"].forEach(c=>Object.defineProperty(a,c,{get(){return this.model[c]},enumerable:!0})),t.userData.container=a,Hl(...i)(a)}const Tf={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class pn{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const Af=new Gs(-1,1,1,-1,0,1);class Mf extends Ut{constructor(){super(),this.setAttribute("position",new Me([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Me([0,2,0,0,2,0],2))}}const Cf=new Mf;class Lf{constructor(e){this._mesh=new Ks(Cf,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,Af)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class Li extends pn{constructor(e,n){super(),this.textureID=n!==void 0?n:"tDiffuse",e instanceof _t?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=tr.clone(e.uniforms),this.material=new _t({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new Lf(this.material)}render(e,n,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(n),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}const kf=Object.freeze(Object.defineProperty({__proto__:null,ShaderPass:Li},Symbol.toStringTag,{value:"Module"}));class Rs extends pn{constructor(e,n){super(),this.scene=e,this.camera=n,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,n,r){const s=e.getContext(),o=e.state;o.buffers.color.setMask(!1),o.buffers.depth.setMask(!1),o.buffers.color.setLocked(!0),o.buffers.depth.setLocked(!0);let i,a;this.inverse?(i=0,a=1):(i=1,a=0),o.buffers.stencil.setTest(!0),o.buffers.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),o.buffers.stencil.setFunc(s.ALWAYS,i,4294967295),o.buffers.stencil.setClear(a),o.buffers.stencil.setLocked(!0),e.setRenderTarget(r),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),o.buffers.color.setLocked(!1),o.buffers.depth.setLocked(!1),o.buffers.color.setMask(!0),o.buffers.depth.setMask(!0),o.buffers.stencil.setLocked(!1),o.buffers.stencil.setFunc(s.EQUAL,1,4294967295),o.buffers.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),o.buffers.stencil.setLocked(!0)}}class Df extends pn{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class If{constructor(e,n){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),n===void 0){const r=e.getSize(new U);this._width=r.width,this._height=r.height,n=new Js(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Ra}),n.texture.name="EffectComposer.rt1"}else this._width=n.width,this._height=n.height;this.renderTarget1=n,this.renderTarget2=n.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new Li(Tf),this.copyPass.material.blending=Fa,this.clock=new eo}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,n){this.passes.splice(n,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const n=this.passes.indexOf(e);n!==-1&&this.passes.splice(n,1)}isLastEnabledPass(e){for(let n=e+1;n<this.passes.length;n++)if(this.passes[n].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const n=this.renderer.getRenderTarget();let r=!1;for(let s=0,o=this.passes.length;s<o;s++){const i=this.passes[s];if(i.enabled!==!1){if(i.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(s),i.render(this.renderer,this.writeBuffer,this.readBuffer,e,r),i.needsSwap){if(r){const a=this.renderer.getContext(),c=this.renderer.state.buffers.stencil;c.setFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),c.setFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}Rs!==void 0&&(i instanceof Rs?r=!0:i instanceof Df&&(r=!1))}}this.renderer.setRenderTarget(n)}reset(e){if(e===void 0){const n=this.renderer.getSize(new U);this._pixelRatio=this.renderer.getPixelRatio(),this._width=n.width,this._height=n.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,n){this._width=e,this._height=n;const r=this._width*this._pixelRatio,s=this._height*this._pixelRatio;this.renderTarget1.setSize(r,s),this.renderTarget2.setSize(r,s);for(let o=0;o<this.passes.length;o++)this.passes[o].setSize(r,s)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class Of extends pn{constructor(e,n,r=null,s=null,o=null){super(),this.scene=e,this.camera=n,this.overrideMaterial=r,this.clearColor=s,this.clearAlpha=o,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new V}render(e,n,r){const s=e.autoClear;e.autoClear=!1;let o,i;this.overrideMaterial!==null&&(i=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor,e.getClearAlpha())),this.clearAlpha!==null&&(o=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),this.clearDepth==!0&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:r),this.clear===!0&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor!==null&&e.setClearColor(this._oldClearColor),this.clearAlpha!==null&&e.setClearAlpha(o),this.overrideMaterial!==null&&(this.scene.overrideMaterial=i),e.autoClear=s}}function Fs({renderer:t,scene:e,camera:n}){const r=Rf(),s=new If(t,r),o=new Of(e,n);return s.addPass(o),s}const Rf=()=>new Js(800,600,{minFilter:Wr,magFilter:Wr,format:Ba,colorSpace:oe}),Dn={bloom:Bf,pixel:Nf,afterimage:Hf,sobel:$f,halftone:zf,dotscreen:Uf,bokeh:Vf,smaa:jf};async function Ff(t,e){var r;t=t.toLowerCase();const n=await((r=Dn[t])==null?void 0:r.call(Dn,e));return n.type=t,n.name=Pr[t].name,n}function dn(t,e){Object.defineProperty(t,"propList",{value:e}),e.forEach(n=>{Object.defineProperty(t,n,{get(){return this.uniforms[n].value},set(r){this.uniforms[n].value=r}})})}async function Bf({resolution:t=new U(800,600),strength:e=.3,radius:n=.5,threshold:r=.8}={}){const{UnrealBloomPass:s}=await B(async()=>{const{UnrealBloomPass:i}=await import("./f_DC0lY0Il-UnrealBloomPass.js");return{UnrealBloomPass:i}},__vite__mapDeps([0,1])),o=new s(t,e,n,r);return Object.defineProperty(o,"propList",{value:["radius","strength","threshold"],writable:!1}),o}async function jf({renderer:t}){const{SMAAPass:e}=await B(async()=>{const{SMAAPass:s}=await import("./f_Ao47wC88-SMAAPass.js");return{SMAAPass:s}},__vite__mapDeps([2,1])),n=new U;t.getSize(n);const r=new e(n.x,n.y);return Object.defineProperty(r,"propList",{value:[],writable:!1}),r}async function Nf({scene:t,camera:e}){const{RenderPixelatedPass:n}=await B(async()=>{const{RenderPixelatedPass:s}=await import("./f_DWLvnOId-RenderPixelatedPass.js");return{RenderPixelatedPass:s}},__vite__mapDeps([3,1])),r=new n(5,t,e);return Object.defineProperty(r,"propList",{value:["size"],writable:!1}),Object.defineProperty(r,"size",{get(){return this.pixelSize},set(s){this.setPixelSize(s)}}),r}async function $f({renderer:t}){const{ShaderPass:e}=await B(async()=>{const{ShaderPass:o}=await Promise.resolve().then(()=>kf);return{ShaderPass:o}},void 0),{SobelOperatorShader:n}=await B(async()=>{const{SobelOperatorShader:o}=await import("./f_DCBMgKDW-SobelOperatorShader.js");return{SobelOperatorShader:o}},__vite__mapDeps([4,1])),r=new U;t.getSize(r),r.multiplyScalar(window.devicePixelRatio);const s=new e(n);return s.uniforms.resolution.value.x=r.x,s.uniforms.resolution.value.y=r.y,Object.defineProperty(s,"propList",{value:[],writable:!1}),s}async function zf({renderer:t}){const{HalftonePass:e}=await B(async()=>{const{HalftonePass:o}=await import("./f_DGTZY5-I-HalftonePass.js");return{HalftonePass:o}},__vite__mapDeps([5,1])),n=new U;t.getSize(n);const r=new e(n.x,n.y,{radius:4});return dn(r,["greyscale","radius","scatter","shape"]),r}async function Uf(){const{DotScreenPass:t}=await B(async()=>{const{DotScreenPass:r}=await import("./f_9hNh_bKA-DotScreenPass.js");return{DotScreenPass:r}},__vite__mapDeps([6,1])),e=new t;return dn(e,["scale","center"]),e}async function Vf({scene:t,camera:e}){const{BokehPass:n}=await B(async()=>{const{BokehPass:o}=await import("./f_D2xRw46K-BokehPass.js");return{BokehPass:o}},__vite__mapDeps([7,1])),r=new n(t,e,{});return dn(r,["focus","aperture","aspect"]),r}async function Hf(){const{AfterimagePass:t}=await B(async()=>{const{AfterimagePass:n}=await import("./f_GRnVcELV-AfterimagePass.js");return{AfterimagePass:n}},__vite__mapDeps([8,1])),e=new t(.7);return dn(e,["damp"]),e}function Wf(t){const{name:e,type:n}=t,r=Pr[n].propList??[],s={};return r.forEach(i=>{Object.defineProperty(s,i,{get(){return t[i]},set(a){t[i]=a},enumerable:!0})}),{target:t,name:e,type:n,params:s,id:Er()}}const Pr={bloom:{name:"Bloom",propList:["enabled","radius","strength","threshold"]},pixel:{name:"Pixelate",propList:["enabled","size"]},afterimage:{name:"Afterimage",propList:["enabled","damp"]},sobel:{name:"Sobel",propList:["enabled"]},halftone:{name:"Halftone",propList:["enabled","greyscale","radius","scatter","shape"]},dotscreen:{name:"Dot Screen",propList:["enabled","scale"]},bokeh:{name:"Bokeh",propList:["enabled","focus","aperture","aspect"]},smaa:{name:"SMAA",propList:["enabled"]}},rd=Object.entries(Pr).map(([t,{name:e}])=>({value:t,label:e}));var ki={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(He,function(){var n=function(){function r(d){return i.appendChild(d.dom),d}function s(d){for(var m=0;m<i.children.length;m++)i.children[m].style.display=m===d?"block":"none";o=d}var o=0,i=document.createElement("div");i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",function(d){d.preventDefault(),s(++o%i.children.length)},!1);var a=(performance||Date).now(),c=a,u=0,f=r(new n.Panel("FPS","#0ff","#002")),l=r(new n.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var p=r(new n.Panel("MB","#f08","#201"));return s(0),{REVISION:16,dom:i,addPanel:r,showPanel:s,begin:function(){a=(performance||Date).now()},end:function(){u++;var d=(performance||Date).now();if(l.update(d-a,200),d>c+1e3&&(f.update(1e3*u/(d-c),100),c=d,u=0,p)){var m=performance.memory;p.update(m.usedJSHeapSize/1048576,m.jsHeapSizeLimit/1048576)}return d},update:function(){a=this.end()},domElement:i,setMode:s}};return n.Panel=function(r,s,o){var i=1/0,a=0,c=Math.round,u=c(window.devicePixelRatio||1),f=80*u,l=48*u,p=3*u,d=2*u,m=3*u,g=15*u,y=74*u,v=30*u,w=document.createElement("canvas");w.width=f,w.height=l,w.style.cssText="width:80px;height:48px";var _=w.getContext("2d");return _.font="bold "+9*u+"px Helvetica,Arial,sans-serif",_.textBaseline="top",_.fillStyle=o,_.fillRect(0,0,f,l),_.fillStyle=s,_.fillText(r,p,d),_.fillRect(m,g,y,v),_.fillStyle=o,_.globalAlpha=.9,_.fillRect(m,g,y,v),{dom:w,update:function(E,x){i=Math.min(i,E),a=Math.max(a,E),_.fillStyle=o,_.globalAlpha=1,_.fillRect(0,0,f,g),_.fillStyle=s,_.fillText(c(E)+" "+r+" ("+c(i)+"-"+c(a)+")",p,d),_.drawImage(w,m+u,g,y-u,v,m,g,y-u,v),_.fillRect(m+y-u,g,u,v),_.fillStyle=o,_.globalAlpha=.9,_.fillRect(m+y-u,g,u,c((1-E/x)*v))}}},n})})(ki);var Gf=ki.exports;const Xf=No(Gf);var Di={exports:{}};(function(t,e){(function(n,r){r()})(He,function(){function n(u,f){return typeof f>"u"?f={autoBom:!1}:typeof f!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),f={autoBom:!f}),f.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(u.type)?new Blob(["\uFEFF",u],{type:u.type}):u}function r(u,f,l){var p=new XMLHttpRequest;p.open("GET",u),p.responseType="blob",p.onload=function(){c(p.response,f,l)},p.onerror=function(){console.error("could not download file")},p.send()}function s(u){var f=new XMLHttpRequest;f.open("HEAD",u,!1);try{f.send()}catch{}return 200<=f.status&&299>=f.status}function o(u){try{u.dispatchEvent(new MouseEvent("click"))}catch{var f=document.createEvent("MouseEvents");f.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),u.dispatchEvent(f)}}var i=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof He=="object"&&He.global===He?He:void 0,a=i.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),c=i.saveAs||(typeof window!="object"||window!==i?function(){}:"download"in HTMLAnchorElement.prototype&&!a?function(u,f,l){var p=i.URL||i.webkitURL,d=document.createElement("a");f=f||u.name||"download",d.download=f,d.rel="noopener",typeof u=="string"?(d.href=u,d.origin===location.origin?o(d):s(d.href)?r(u,f,l):o(d,d.target="_blank")):(d.href=p.createObjectURL(u),setTimeout(function(){p.revokeObjectURL(d.href)},4e4),setTimeout(function(){o(d)},0))}:"msSaveOrOpenBlob"in navigator?function(u,f,l){if(f=f||u.name||"download",typeof u!="string")navigator.msSaveOrOpenBlob(n(u,l),f);else if(s(u))r(u,f,l);else{var p=document.createElement("a");p.href=u,p.target="_blank",setTimeout(function(){o(p)})}}:function(u,f,l,p){if(p=p||open("","_blank"),p&&(p.document.title=p.document.body.innerText="downloading..."),typeof u=="string")return r(u,f,l);var d=u.type==="application/octet-stream",m=/constructor/i.test(i.HTMLElement)||i.safari,g=/CriOS\/[\d]+/.test(navigator.userAgent);if((g||d&&m||a)&&typeof FileReader<"u"){var y=new FileReader;y.onloadend=function(){var _=y.result;_=g?_:_.replace(/^data:[^;]*;/,"data:attachment/file;"),p?p.location.href=_:location=_,p=null},y.readAsDataURL(u)}else{var v=i.URL||i.webkitURL,w=v.createObjectURL(u);p?p.location=w:location.href=w,p=null,setTimeout(function(){v.revokeObjectURL(w)},4e4)}});i.saveAs=c.saveAs=c,t.exports=c})})(Di);var Sr=Di.exports;const Yf=["video/mp4;codecs=h264","video/webm;codecs=h264","video/webm;codecs=vp9","video/webm;codecs=vp8","video/webm"],$t=Yf.filter(MediaRecorder.isTypeSupported);function Kf(t){if(!$t.length)return;const e=[],n=$t[0],r={settings:{...bu,mimeType:n},get supportedMimeTypes(){return $t},get mimeType(){return this.settings.mimeType},set mimeType(s){$t.includes(s)&&(this.settings.mimeType=s)},start(){if(this.recorder)return;const{fileName:s,frameRate:o,mimeType:i}=this.settings,a=t.captureStream(o||30),c=a.getTracks()[0],u=new MediaRecorder(a,{mimeType:i});u.onstart=()=>e.length=0,u.ondataavailable=({data:f})=>e.push(f),u.onstop=()=>{c.stop(),this.recorder=void 0;const f=this.settings.mimeType.includes("webm")?"webm":"mp4",l=new Blob(e,{type:`video/${f}`}),p=this.settings.appendDate?`_${tu()}`:"",d=`${s||"ani"}${p}.${f}`;Sr.saveAs(l,d)},u.start(),this.recorder=u},get state(){var s;return((s=this.recorder)==null?void 0:s.state)??"idle"}};return["pause","resume","stop"].forEach(s=>{Object.defineProperty(r,s,{value:()=>{var o;return(o=r.recorder)==null?void 0:o[s]()}})}),r}function qf(t){let e=1,n=!1,r=!1;const s=()=>{t.stats.begin(),t.controls.update();const u=n?-e:e,f=t.clock.getDelta()*u;r||t.update(f),t.render(),t.stats.end()};let o=!1;const i=()=>{o||(t.render(),o=!0,setTimeout(()=>o=!1,50))};let a="";return{start(){a!=="active"&&(t.renderer.setAnimationLoop(s),t.controls.removeEventListener("change",i),a="active")},stop(){a!=="inactive"&&(t.renderer.setAnimationLoop(null),t.controls.addEventListener("change",i),a="inactive")},pause(){r=!0},resume(){r=!1},get state(){return a},get timeScale(){return e},set timeScale(u){const f=parseFloat(u);e=isNaN(f)?1:Math.abs(f)},get reverse(){return n},set reverse(u){n=!!u},get paused(){return r},set paused(u){r=!!u}}}const Zf=async t=>{const{zip:e}=await B(async()=>{const{zip:n}=await import("./f_BtwqvtBK-browser.js");return{zip:n}},[]);return new Promise(n=>e(t,{},(r,s)=>n(new Blob([s]))))},Qf=t=>{const e=t.indexOf(",");return t.slice(e+1,1/0)},Jf=async t=>{if(t=await t,t instanceof Blob&&(t=await t.arrayBuffer()),t instanceof ArrayBuffer)return new Uint8Array(t);if(typeof t=="string"){const e=t.startsWith("data")?Qf(t):t,n=window.atob(e);return Uint8Array.from(n,r=>r.charCodeAt(0))}};async function ep(t){const e=await Promise.all(t.map(({data:r})=>Jf(r))),n=Object.fromEntries(t.map(({name:r},s)=>[r,[e[s],{level:0,consume:!0}]]));return Zf(n)}async function tp(t,e){const n=t.length.toString().length,r=t.map((s,o)=>{const i=o.toString().padStart(n,"0");return{name:`${e||"ss"}_${i}.png`,data:s}});return ep(r)}function np(t,e){const n=document.createElement("a");n.style.display="none",n.href=t,n.download=e,document.body.appendChild(n),n.click(),document.body.removeChild(n)}async function Jn(t,e="frames"){const n=await tp(t,e);Sr.saveAs(n,`${e}.zip`)}function rp(t){const{canvas:e,scene:n}=t;return{settings:wu,downloadFrame(s=1){const{noBackground:o,fileName:i}=this.settings,a=o&&!t.postProcessing.enabled;let c=null;const u=()=>[n.background,c]=[c,n.background];if(t.loop.state==="inactive"||s===1){a&&u(),t.render();const d=e.toDataURL();a&&u(),np(d,`${i}.png`),t.render();return}let f=0;const l=[];a&&t.addCountedEventListener("beforeRender",u);function p(){const d=e.toDataURL("image/png");l.push(d),++f===s&&(a&&t.addCountedEventListener("beforeRender",u),Jn(l,i))}t.addCountedEventListener("afterRender",p,s)},getFrame(){let s;const{noBackground:o}=this.settings;if(o&&!t.postProcessing.enabled){let a=null;[n.background,a]=[a,n.background],t.render(),s=e.toDataURL("image/png"),[n.background,a]=[a,n.background],t.render()}else t.render(),s=e.toDataURL("image/png");return s},getAllFrames(s){var m,g;const o=s==null?void 0:s.animation.current.chainName;if(!o||s.animation.chain[o].duration===1/0)return;console.info("main thread locked");const a=t.loop.state;t.loop.stop(),(g=(m=s.face)==null?void 0:m.reset)==null||g.call(m),s.animation.stop();const c=[],{frameRate:u,noBackground:f}=this.settings,l=1/(u||30);let p=null,d=!0;for(f&&([n.background,p]=[p,n.background]),s.animation.addCountedEventListener("chainFinished",()=>d=!1),s.animation.play();d;){t.update(l);const y=e.toDataURL();c.push(y)}return console.info("main thread unlocked"),f&&([n.background,p]=[p,n.background]),a==="active"&&t.loop.start(),c},downloadAllFrames(s=0){const o=t.model[s],i=this.getAllFrames(o),{fileName:a}=this.settings;Jn(i,a)},getAllFramesAsArrayBuffer(s){var _,E;const o=s==null?void 0:s.animation.current.chainName;if(!o||s.animation.chain[o].duration===1/0)return;console.info("main thread locked");const a=t.renderer.getContext(),c=t.loop.state;(E=(_=s.face)==null?void 0:_.reset)==null||E.call(_),t.loop.stop(),s.animation.stop();const u=[],{frameRate:f,noBackground:l}=this.settings,p=1/(f||30),{width:d,height:m}=e,y=d*m*4;let v=null,w=!0;for(l&&([n.background,v]=[v,n.background]),s.animation.addCountedEventListener("chainFinished",()=>w=!1),s.animation.play();w;){t.update(p);const x=new Uint8Array(y);a.readPixels(0,0,d,m,a.RGBA,a.UNSIGNED_BYTE,x);const A=sp(x,{width:d,height:m});u.push(A.buffer)}return console.info("main thread unlocked"),l&&([n.background,v]=[v,n.background]),c==="active"&&t.loop.start(),u}}}function sp(t,{width:e,height:n}){const r=n/2|0,s=e*4,o=new Uint8Array(e*4);for(let i=0;i<r;++i){const a=i*s,c=(n-i-1)*s;o.set(t.subarray(a,a+s)),t.copyWithin(a,c,c+s),t.set(o,c)}return t}const op=()=>Promise.all([Su(),xu(),Au(),Bu()]),ip={directional:Ys,ambient:qs,point:Rn},ap={directional:ja,point:Na},cp=t=>{var c,u;const e=ip[t];if(!e)return null;const n=Eu[t],{color:r,intensity:s,...o}=n,i=new e(r,s);i.name=(u=(c=i.type)==null?void 0:c.replace)==null?void 0:u.call(c,"Light","");const a=ap[t];return a&&(i.helper=new a(i),Object.defineProperty(i,"showHelper",{get(){return i.helper.visible},set(f){i.helper.visible=!!f,i.helper.update()}}),i.showHelper=!1),Object.defineProperty(i,"colorCode",{get(){return"#"+this.color.getHexString()},set(f){var l,p;this.color=new V(f),(p=(l=this.helper)==null?void 0:l.update)==null||p.call(l)}}),Object.entries(o).forEach(([f,l])=>{i[f].isVector3?i[f].set(...l):i[f]=l}),i};function lp(t){const e={list:new Ee,add:n=>{const r=cp(n);if(r)return t.scene.add(r),r.helper&&(t.scene.add(r.helper),r.helper.update()),e.list.push(r),r.remove=()=>{var s,o,i,a,c;e.list.remove(r),r.helper&&((s=r.parent)==null||s.remove(r.helper),(i=(o=r.helper).dispose)==null||i.call(o)),(a=r.parent)==null||a.remove(r),(c=r.dispose)==null||c.call(r)},r}};return e}const Bs={"<":">","(":")","[":"]","{":"}"},up=t=>{let e="";const n=[],r=[];for(const s of t){if(n.length){e+=s;const o=n.at(-1);s===Bs[o]&&n.pop();continue}if(s==="/"){e&&r.push(e),e="";continue}e+=s,s in Bs&&n.push(s)}return e&&r.push(e),r},Ii=t=>up(t).reduce((n,r)=>{const[s,...o]=r.split("="),i=o==null?void 0:o.join("=");return s&&i&&n.push([s,i]),n},[]),fp={mat:{keys:["material","code"],valueMap:t=>t.slice(1,-1)},ol:{keys:["outline","code"],valueMap:t=>t.slice(1,-1)},ei:{keys:["face","eyeBaseIdx"]},et:{keys:["face","eyeTexture"]},mi:{keys:["face","mouthBaseIdx"]},mt:{keys:["face","mouthTexture"]},tx:{keys:["texture"]},scl:{keys:["scale"]}};async function pp(t){const e=Ii(t),n=Object.fromEntries(e),{id:r}=n,s=await this.loadDLModel(r);return await dp(s,n),s}async function dp(t,e){const{ani:n,...r}=e;Object.entries(r).forEach(([s,o])=>{const i=fp[s];if(!i)return;const{keys:a,valueMap:c}=i,u=(c==null?void 0:c(o))??o;_i(t,a,u)}),n&&await t.animation.addChain(n)}const Jt=class Jt{constructor(){ie(this,"userData",{ani:new Ee});ie(this,"dataLoaded",!1);ie(this,"initData",async()=>{await op(),this.dataLoaded=!0,this.dispatchEvent({type:"dataLoaded"})});ie(this,"_background","");ie(this,"model",new Ee);ie(this,"loadedModel",new Ee);ie(this,"loadModelFromCode",pp);ie(this,"settings",{outline:We,material:ke});ie(this,"viewport",{width:0,height:0,set(e,n){this.width=e,this.height=n}});Object.assign(this,Tt);const e=new $a;this.scene=e,this.background=gu,this.clock=new eo;const n=ql();this.camera=n;const r=lp(this);r.add("directional"),r.add("ambient"),this.light=r;const s=Kl();this.renderer=s,this.canvas=s.domElement,this.screenshot=rp(this),this.record=Kf(this.canvas),this.controls=new tl(this.camera,this.canvas),this.postProcessing={enabled:!1,passes:new Ee,composer:Fs({renderer:s,scene:e,camera:n}),async addPass(o,i={}){const a=await Ff(o,{...i,renderer:s,scene:e,camera:n});this.composer.addPass(a);const c=Wf(a),{passes:u}=this,f=this;return c.remove=()=>{u.remove(c),f.refresh()},u.push(c),a},async refresh(){this.composer=Fs({renderer:s,scene:e,camera:n});const o=this.passes.map(({type:a,params:c})=>({type:a,params:Object.entries(c)}));this.passes.length=0;const{length:i}=o;for(let a=0;a<i;a++){const{type:c,params:u}=o[a],f=await this.addPass(c);u.forEach(([l,p])=>void(f[l]=p))}},updatePasses(o){this.passes.length=0,this.passes.splice(0,0,...o),this.refresh()}},this.stats=new Xf,this.loop=qf(this),this.loop.start(),console.info("%cDragalia Lost Model Viewer","color:yellow;background-color:black;font-size:1.5rem;text-shadow: 0 0 0.5rem white")}get background(){return this._background}set background(e){var r,s;if(this._background===e)return;this._background="loading",(s=(r=this.scene.background)==null?void 0:r.dispose)==null||s.call(r);const n=this;(async function(){n.scene.background=await Zl(e),n._background=e,e.startsWith("img:")&&n.updateBgAspectRatio()})()}get toneMapping(){var n;const{toneMapping:e}=this.renderer;return((n=Object.entries(kn).find(([,r])=>r===e))==null?void 0:n[0])??"Unknown"}set toneMapping(e){const n=kn[e]?e:"No Mapping";this.renderer.toneMapping=kn[n]}get pixelRatio(){return this.renderer.getPixelRatio()}set pixelRatio(e){this.renderer.setPixelRatio(e),this.postProcessing.composer.setPixelRatio(e)}get unusedModel(){return this.loadedModel.filter(e=>!this.model.includes(e))}async loadDLModel(e=vu){this.dataLoaded||await new Promise(i=>this.addCountedEventListener("dataLoaded",i));const n=Jt.getModelPath(e),r=await di(n);r.name=e;const s={id:e,outline:this.settings.outline,material:this.settings.material,viewer:this},o=xf(r,s);return this.loadedModel.push(o),o.addEventListener("dispose",()=>this.loadedModel.remove(o)),o}add(e){var n;(n=e.detach)==null||n.call(e),this.model.push(e),this.scene.add(e.model),e.parent=this}remove(e){this.model.remove(e),this.scene.remove(e.model)}disposeAllModels(){this.loadedModel.forEach(e=>{var n;return(n=e.dispose)==null?void 0:n.call(e)}),this.model.length=0}static getModelPath(e){return`${this.source.fbx}/${e}/${e}.fbx`}async setViewport(e,n){var i;await Gl(200);const r=e??window.innerWidth,s=n??window.innerHeight;this.viewport.set(r,s),this.renderer.setSize(r,s);const o=r/s;return this.camera.aspect=o,this.camera.updateProjectionMatrix(),(i=this.postProcessing.composer)==null||i.setSize(r,s),this.background.startsWith("img:")&&this.updateBgAspectRatio(),this}updateBgAspectRatio(){if(!this.background.startsWith("img:"))return;const{width:e,height:n}=this.viewport,r=e/n,{background:s}=this.scene,{naturalWidth:o,naturalHeight:i}=s.image,a=o/i,c=r/a,u=r>a?[1,1/c]:[c,1];s.repeat.set(...u)}update(e){var n;(n=this.animation)==null||n.update(e),this.model.forEach(r=>{var s;return(s=r.update)==null?void 0:s.call(r,e)}),this.loop.state==="inactive"&&this.render(),this.dispatchEvent({type:"timeUpdate",dt:e})}stopAll(){this.model.forEach(e=>{var n,r;return(r=(n=e.animation)==null?void 0:n.stop)==null?void 0:r.call(n)})}playAll(){this.model.forEach(e=>{var n,r;return(r=(n=e.animation)==null?void 0:n.play)==null?void 0:r.call(n)})}render(){this.dispatchEvent({type:"beforeRender"}),this.postProcessing.enabled?this.postProcessing.composer.render():this.renderer.render(this.scene,this.camera),this.dispatchEvent({type:"afterRender"})}toString(){return"Dragalia Lost Model Viewer"}dispose(){var e,n,r;this.model.forEach(s=>s.dispose()),(n=(e=this.scene.background)==null?void 0:e.dispose)==null||n.call(e),(r=this.renderer.renderLists)==null||r.dispose(),this.renderer.dispose()}};ie(Jt,"source",{fbx:ei,ani:ti});let Qt=Jt;var Z={fullscreenEnabled:0,fullscreenElement:1,requestFullscreen:2,exitFullscreen:3,fullscreenchange:4,fullscreenerror:5,fullscreen:6},js=["webkitFullscreenEnabled","webkitFullscreenElement","webkitRequestFullscreen","webkitExitFullscreen","webkitfullscreenchange","webkitfullscreenerror","-webkit-full-screen"],Ns=["mozFullScreenEnabled","mozFullScreenElement","mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozfullscreenerror","-moz-full-screen"],$s=["msFullscreenEnabled","msFullscreenElement","msRequestFullscreen","msExitFullscreen","MSFullscreenChange","MSFullscreenError","-ms-fullscreen"],X=typeof window<"u"&&typeof window.document<"u"?window.document:{},re="fullscreenEnabled"in X&&Object.keys(Z)||js[0]in X&&js||Ns[0]in X&&Ns||$s[0]in X&&$s||[],zt={requestFullscreen:function(t){return t[re[Z.requestFullscreen]]()},requestFullscreenFunction:function(t){return t[re[Z.requestFullscreen]]},get exitFullscreen(){return X[re[Z.exitFullscreen]].bind(X)},get fullscreenPseudoClass(){return":"+re[Z.fullscreen]},addEventListener:function(t,e,n){return X.addEventListener(re[Z[t]],e,n)},removeEventListener:function(t,e,n){return X.removeEventListener(re[Z[t]],e,n)},get fullscreenEnabled(){return!!X[re[Z.fullscreenEnabled]]},set fullscreenEnabled(t){},get fullscreenElement(){return X[re[Z.fullscreenElement]]},set fullscreenElement(t){},get onfullscreenchange(){return X[("on"+re[Z.fullscreenchange]).toLowerCase()]},set onfullscreenchange(t){return X[("on"+re[Z.fullscreenchange]).toLowerCase()]=t},get onfullscreenerror(){return X[("on"+re[Z.fullscreenerror]).toLowerCase()]},set onfullscreenerror(t){return X[("on"+re[Z.fullscreenerror]).toLowerCase()]=t}};const $=new Qt;$.initData();$.setViewport();$.userData.specialCapture={frameRate:30,duration:5,program:"rotate"};window.addEventListener("resize",()=>$.setViewport());$.canvas.addEventListener("dblclick",hp);window.viewer=$;window.model=$.model;window.getFrame=$.screenshot.getFrame;window.downloadFrames=Jn;window.saveAs=Sr.saveAs;window.THREE=Qs;window.makeGif=async t=>{const{makeGif:e}=await B(async()=>{const{makeGif:n}=await import("./f_DOqUXJZN-index.js");return{makeGif:n}},[]);return await e(t)};function hp(){zt.fullscreenEnabled&&(zt.fullscreenElement?zt.exitFullscreen():zt.requestFullscreen($.canvas))}function mp(){try{return window.self!==window.top}catch{return!0}}let zs="";const Oi=mp(),_p=Oi?!1:!window.location.hash.includes("showSettings=false"),gp=Oi?!1:!window.location.hash.includes("showAC=false"),yp=t=>({showSettings:_p,toggleSettings:()=>t(e=>{e.showSettings=!e.showSettings}),loadingMsg:"",setLoadingMsg:e=>t(n=>{n.loadingMsg=e}),showTimeControl:gp,toggleTimeControl:()=>t(e=>{e.showTimeControl=!e.showTimeControl}),showFrameRate:!1,toggleFrameRate:()=>t(e=>{e.showFrameRate=!e.showFrameRate}),sidebar:{open:!0,toggle:()=>t(e=>{e.sidebar.open=!e.sidebar.open}),settings:{tab:"Model",setTab:e=>t(n=>{n.sidebar.settings.tab=e})},modal:{mode:"",handleSelect:void 0,open:(e,n)=>{zs=$.loop.state,$.loop.stop(),t(r=>{r.sidebar.modal.mode=e,r.sidebar.modal.handleSelect=n})},close:()=>{zs==="active"&&$.loop.start(),t(e=>{e.sidebar.modal.mode="",e.sidebar.modal.handleSelect=void 0})}},manageMode:"single",setManageMode:e=>t(n=>{n.sidebar.manageMode=e})},chainMaker:{target:null,setTarget:e=>t(n=>{n.chainMaker.target=e})},dock:{mode:"",handleSelect:void 0,open:(e="",n)=>t(r=>{r.dock.mode=e,r.dock.handleSelect=n}),close:()=>t(e=>{e.dock.mode="",e.dock.handleSelect=void 0})}}),vp=Y(()=>B(()=>import("./f_B7dvkY4S-index.js"),__vite__mapDeps([9,10,11,12,13,14,15,16,17,18,19,20,21,22,1,23]))),wp=Y(()=>B(()=>import("./f_D265CAaw-index.js"),__vite__mapDeps([24,25,14,11,19,12,13,20,26,27,28,22,29,30,31,32,33,34,35,1]))),bp=Y(()=>B(()=>import("./f_BmuG9NUh-index.js"),__vite__mapDeps([36,25,14,11,19,12,13,20,26,27,37,38,10,17,39,40,41,29,30,42,43,21,44,45,22,1,46,34]))),Ep=Y(()=>B(()=>import("./f_CraM7OKL-index.js"),__vite__mapDeps([47,25,14,11,19,12,13,20,26,27,28,22,29,30,31,35,44,39,1,48,34]))),Pp=Y(()=>B(()=>import("./f_Dda1rdJe-ColorSelect.js"),__vite__mapDeps([49,15,16,17,11,18,22,1]))),Sp=Y(()=>B(()=>import("./f_CfkdavYI-index.js"),__vite__mapDeps([50,43,51,41,29,30,42,52,20,11,13,17,53,22,1,54]))),xp=Y(()=>B(()=>import("./f_CcIF8W1F-index.js"),__vite__mapDeps([55,44,25,14,11,19,12,13,20,26,27,51,41,29,30,42,28,22,31,32,33,34,1]))),Tp=Y(()=>B(()=>import("./f_COl3m-JS-index.js"),__vite__mapDeps([56,43,37,38,57,39,58,44,14,11,59,28,19,12,13,20,22,29,30,25,26,27,31,16,17,60,50,51,41,42,52,53,1,54,55,32,33,34,47,35,48,61,62]))),Us=Y(()=>B(()=>import("./f_Bwutc1mz-index.js"),__vite__mapDeps([63,52,20,11,13,17,53,22,1,64]))),Ap=Y(()=>B(()=>import("./f_BJUs8swG-index.js"),__vite__mapDeps([65,43,58,44,14,11,59,39,17,45,22,20,13,1,66,34]))),Vs={background:vp,model:wp,animation:bp,weapon:Ep,color:Pp,face:Sp,faceTexture:xp,attachment:Tp,target:Ap,eye:({onSelect:t})=>ce(Us,{part:"eye",onSelect:t}),mouth:({onSelect:t})=>ce(Us,{part:"mouth",onSelect:t})},Mp=(t,e)=>({Component:void 0,props:void 0,openModal:(n,r)=>t(s=>{s.props=r,s.Component=n}),close:()=>t(n=>{n.Component=void 0}),onClose:void 0,reset:()=>t(n=>{n.Component=n.props=n.onClose=void 0}),getInput:async n=>{if(!Vs[n])return null;const{close:r,reset:s}=e(),o=new Promise((i,a)=>{const c=(...u)=>i(u);t(u=>{u.onClose=()=>{a(),r()},u.props={onSelect:c,onAfterSelect:r},u.Component=Vs[n]})});try{return await o}catch{return null}finally{s()}},inputModel:()=>e().getInput("model"),inputAni:()=>e().getInput("animation"),inputColor:async()=>{const n=await e().getInput("color");return n==null?void 0:n[0]},inputTarget:()=>e().getInput("target"),inputEye:()=>e().getInput("eye"),inputMouth:()=>e().getInput("mouth")}),Cp=t=>({activeModel:void 0,setActiveModel:e=>t({activeModel:e})}),Lp=t=>({open:!1,toggle:()=>t(e=>({open:!e.open})),target:null,setTarget:e=>{e&&(e.userData.chain||(e.userData.chain=new Ee),t({target:e}))}}),kp=t=>(e,n,r)=>t(s=>e(Qc(s)),n,r),At=t=>gr(kp(t)),er=At(yp),sd=At(Qo),od=At(Qo),Dp=At(Jc),id=At(Mp),ad=gr(Cp),cd=gr(Lp);function Ip(t){return new Worker("/dl-model/assets/fetchWorker-DnsFcaV4.js",{name:t==null?void 0:t.name})}const Op=t=>{const e=new Ip;return new Promise(n=>{e.addEventListener("message",r=>{e.terminate(),n(r.data)}),e.postMessage(t)})};function Ri(t){return new Worker("/dl-model/assets/dbWorker-Cxbauwi9.js",{name:t==null?void 0:t.name})}const Fi=(t,e)=>{const n=new Ri;return new Promise(r=>{n.addEventListener("message",()=>{r(),n.terminate()}),n.postMessage({type:"put",store:e,value:t})})};function Rp(t){return new Worker("/dl-model/assets/searchWorker-FW25Qm2l.js",{name:t==null?void 0:t.name})}async function Fp(t,e="",n=["name"]){if(!e||!n.length)return t;const r=new Rp;return new Promise(s=>{r.addEventListener("message",o=>{r.terminate(),s(o.data)}),r.postMessage({fullList:t,query:e,keys:n})})}const ld=async t=>{const e=Object.values(t).flat();await Fi(e,"model"),console.info("Model DB Initialized")},ud=t=>hn({type:"get",store:"model",value:t}),fd=t=>hn({type:"search",store:"model",index:"name",value:t}),pd=async t=>{const n=(await hn({type:"getByKeyRange",store:"model",value:"c100000_00-c199999_99"})).filter(({id:r})=>!r.endsWith("h"));return Fp(n,t)},Bp=()=>hn({type:"getMap",store:"model",index:"name"}),hn=t=>{const e=new Ri;return new Promise(n=>{e.addEventListener("message",r=>{e.terminate(),n(r.data)}),e.postMessage(t)})},wt={},jp=async()=>{if(Object.keys(wt).length)return;const t="ani-personal",e=(await Op([t]))[t];Object.assign(wt,e)},Bi=jp(),dd=t=>wt[t],Np=t=>{var e;return((e=wt[t])==null?void 0:e[0])??(t.startsWith("c")?{name:"Bob",code:"CMN_MWM_03"}:null)},hd=async()=>{const t=await Bp();await Bi;const e=Object.entries(wt).flatMap(([n,r])=>{const s=t.get(n);return r.map(o=>({...o,user:n,fullName:`${s} ${o.name}`}))});await Fi(e,"animation")},$p="cccccc",zp="c100001_01",Hs=(t,e="Unknown")=>{const n=Ci(t),{length:r}=n,s=n.map((o,i)=>{const{aniName:a,reps:c=1,timeScale:u=1,duration:f=[0,100],aniAction:l}=o,p=r>1?e+` #${i+1}`:e;return{id:Er(),name:p,aniName:a,reps:c,timeScale:u,duration:f,aniAction:l}});return Ee.from(s)},Ws={ts:{key:"timeScale",defaultValue:1},r:{key:"reps",defaultValue:1}},Up={"face.eyeIdx":"ei","face.mouthIdx":"mi"},md=t=>t.map(Vp).join(">"),Vp=t=>{const{aniName:e}=t,n=Hp(t),r=Wp(t),s=Gp(t);return`${e}${n}${r}${s}`},Hp=t=>{const e=[];return Object.keys(Ws).forEach(n=>{const{key:r,defaultValue:s}=Ws[n];t[r]&&t[r]!==s&&e.push(`&${n}=${t[r]}`)}),e.join("")},Wp=t=>{const{duration:e=[0,100]}=t,[n,r]=e;return n!==0?`&dur=${n}-${r}`:r===100?"":`&dur=${r}`},Gp=t=>{const{aniAction:e}=t;return e.length?"&"+e.map(r=>{const{time:s,...o}=r,i=Object.entries(o).map(([a,c])=>`${Up[a]??a}=${c}`);return`@${s}=(${i.join("/")})`}).join("&"):""};function Xp(t){if(!(t!=null&&t.userData))return;const{type:e,id:n}=t,{name:r}=t.userData;t.userData.aniSelectState={category:e==="adventurer"?"Adv":"Personal",personalAni:{source:n,sourceName:r}}}function In(){const t=decodeURI(window.location.hash),e=Ii(t),n=Object.fromEntries(e);Yp(n),Kp(t)}function Yp(t){const{bg:e=$p,showAC:n="true",showSettings:r="true"}=t;$.background=e,er.setState({showTimeControl:ws(n)}),er.setState({showSettings:ws(r)})}async function Kp(t){$.disposeAllModels(),setTimeout(async()=>{const e=t.includes("id=")?t:t+`/id=${zp}`,n=await $.loadModelFromCode(e);$.add(n);const r=n.type==="adventurer"?"Adv":"Personal";Dp.getState().setCategory(r),Xp(n);const{id:s}=n;if(!t.includes("camPos=")){const i=Tu(s);$.camera.position.set(...i)}const o=Mu(s);if($.controls.target.set(...o),t.includes("ani=")){const i=n.animation.current.chainCode??"";i&&(n.userData.chain=Hs(i,"init"))}else{const i=Np(s);if(i){const{code:a,name:c}=i;n.animation.addChain(a),n.userData.chain=Hs(a,c)}}})}const qp=Y(()=>B(()=>import("./f_CWKoiEUw-index.js"),__vite__mapDeps([67,14,11,57,39,58,44,59,28,19,12,13,20,22,29,30,25,26,27,31,16,17,60,43,50,51,41,42,52,53,1,54,55,32,33,34,47,35,48,61,10,40,68]))),Zp=Y(()=>B(()=>import("./f_Cg_KtOXh-index.js"),__vite__mapDeps([69,44,29,30,17,11,12,13,60,14,26,1,70])));function Qp(){const t=hc(),e=qe(),n=qe(),{loadingMsg:r,showTimeControl:s,showSettings:o,showFrameRate:i}=er();return Re(()=>(t&&Bi.then(In),window.addEventListener("hashchange",In),()=>window.removeEventListener("hashchange",In))),Re(()=>{e.current.appendChild($.canvas),$.stats.dom.style.position="",n.current.appendChild($.stats.dom)},[]),ce(pe,{children:[o&&ce(Ie,{fallback:null,children:ce(qp,{})}),ce("div",{className:"mount",ref:a=>e.current=a}),ce("div",{className:"stats",style:{display:i?"unset":"none"},ref:a=>n.current=a}),r&&ce("div",{className:"loading-msg",children:r}),s&&ce(Ie,{fallback:null,children:ce(Zp,{})})]})}Ye(ce(Qp,{}),document.getElementById("app"));export{Tu as $,qe as A,or as B,Tf as C,Qc as D,Po as E,Lf as F,po as G,dc as H,gr as I,Dp as J,dd as K,Ie as L,Al as M,vo as N,cd as O,pn as P,Hs as Q,jo as R,No as S,Pt as T,tt as U,me as V,gc as W,Vs as X,Xp as Y,Np as Z,B as _,ad as a,Mu as a0,kn as a1,nn as a2,Oo as a3,Pr as a4,rd as a5,yu as a6,Sr as a7,Ts as a8,tp as a9,ep as aa,md as ab,Er as ac,Op as ad,ld as ae,Bi as af,hd as ag,hc as ah,He as ai,Uo as aj,Yt as ak,fe as al,od as am,pd as an,id as b,go as c,Fp as d,sd as e,hn as f,Wl as g,Et as h,Y as i,St as j,yo as k,pe as l,er as m,ud as n,_r as o,Fi as p,ir as q,Cs as r,fd as s,ei as t,ce as u,$ as v,Os as w,ar as x,Re as y,ko as z};
